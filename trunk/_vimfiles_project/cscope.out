cscope 16 Z:\foundationlib"               0000744725
	@data_structure\list.c

20 
	~<¡dio.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

24 
	~"mgosi.h
"

25 
	~"li¡.h
"

26 
	~"toŞ.h
"

30 
	mHªdËTy³
;

31 * 
	mEÁryPŒ
;

32 }
	tDS_HANDLE_ENTRY
,*
	tDS_HANDLE_ENTRY_PTR
;

36 
OSI_LIB_HANDLE
 
	mMu‹xHªdË
;

37 
	mCmpFúAmouÁ
;

38 ** 
	mCmpFúA¼ay
;

39 
	mEÁryAmouÁ
;

40 * 
	mEÁr›sLi¡
;

41 }
	tLIST_HEAD
,*
	tLIST_HEAD_PTR
;

43 
	s_Node


45 
	mËngth
;

46 * 
	md©a
;

47 
	mR—dP”missiÚ
;

48 
	mWr™eP”missiÚ
;

49 
LIST_HEAD_PTR
 
	mH—dPŒ
;

50 
_Node
* 
	mP»viousNode
;

51 
_Node
* 
	mNextNode
;

52 }
	tLIST_NODE
,*
	tLIST_NODE_PTR
;

65 
LIST_HANDLE
 
	$C»©eHªdË
(
HªdËTy³
)

67 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

69 ià((
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)

70 
	`m®loc
((
DS_HANDLE_ENTRY
)))==
NULL
)

72  
NULL
;

74 
	`mem£t
(
HªdËEÁryPŒ
,0,(
DS_HANDLE_ENTRY
));

75 
HªdËEÁryPŒ
->
HªdËTy³
=HandleType;

76  (
LIST_HANDLE
)
HªdËEÁryPŒ
;

77 
	}
}

90 
	$D–‘eHªdË
(
LIST_HANDLE
 
hªdË
)

92 ià(
hªdË
 !ğ
NULL
)

94 
	`ä“
(
hªdË
);

95 
hªdË
 = 
NULL
;

99 
	}
}

115 
	$In™Ÿlize
(

116 
LIST_HANDLE
 
hªdË
,

117 
CmpFúAmouÁ
,

118 ** 
CmpFúA¼ay


121 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

122 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

123 
İt
;

125 
Li¡H—dPŒ
 = 
NULL
;

126 
DSHªdËEÁryPŒ
 = 
NULL
;

128 ià((
hªdË
 =ğ
NULL
)||(
CmpFúAmouÁ
 == 0))

130  
OSI_ERROR
;

133 ià((
Li¡H—dPŒ
=(
LIST_HEAD_PTR
)
	`m®loc
((
LIST_HEAD
)))==0)

135  
OSI_ERROR
;

137 
	`mem£t
((*)
Li¡H—dPŒ
, 0, (
LIST_HEAD
));

140 
Li¡H—dPŒ
->
CmpFúAmouÁ
=CmpFcnAmount;

141 ià((
Li¡H—dPŒ
->
CmpFúA¼ay
=(**)

142 
	`m®loc
(
CmpFúAmouÁ
*(*)))==
NULL
)

144 ià(
Li¡H—dPŒ
 !ğ
NULL
)

146 
	`ä“
(
Li¡H—dPŒ
);

147 
Li¡H—dPŒ
 = 
NULL
;

149  
OSI_ERROR
;

152 
	`memıy
(
Li¡H—dPŒ
->
CmpFúA¼ay
,CmpFúA¼ay,
CmpFúAmouÁ
*(*));

153 
Li¡H—dPŒ
->
EÁryAmouÁ
=0;

154 
Li¡H—dPŒ
->
EÁr›sLi¡
=
NULL
;

155 
İt
=
OSI_SEM_Q_PRIORITY
 | 
OSI_SEM_DELETE_SAFE
 | 
OSI_SEM_INVERSION_SAFE
;

156 
Li¡H—dPŒ
->
Mu‹xHªdË
=
	`mu‹x_ü—‹
(
İt
);

158 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

159 
DSHªdËEÁryPŒ
->
EÁryPŒ
=(*)
Li¡H—dPŒ
;

160 
DSHªdËEÁryPŒ
->
HªdËTy³
=
LIST_HEAD_TYPE
;

161  
OSI_OK
;

162 
	}
}

173 
	$CouÁ
(
LIST_HANDLE
 
hªdË
)

175 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

176 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

177 
amouÁ
;

179 
Li¡H—dPŒ
 = 
NULL
;

180 
DSHªdËEÁryPŒ
 = 
NULL
;

181 
amouÁ
 = 0;

183 ià(
	`IsHªdËEm±y
(
hªdË
)==
True
)

185  
OSI_ERROR
;

188 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

189 ià(
DSHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

191 
	`´štf
("List classƒrror: DS HeadHandleypeƒrror!\n");

192  
OSI_ERROR
;

194 
Li¡H—dPŒ
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

195 ià(
Li¡H—dPŒ
 =ğ
NULL
)

197  
OSI_ERROR
;

200 
	`mu‹x_lock
(
Li¡H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

201 
amouÁ
=
Li¡H—dPŒ
->
EÁryAmouÁ
;

202 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

204  
amouÁ
;

205 
	}
}

218 
	$IsEm±y
(
LIST_HANDLE
 
H—dHªdË
)

220 
LIST_HEAD_PTR
 
li¡
;

221 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

222 
LOGICAL
 
logi
;

224 
li¡
 = 
NULL
;

225 
DSHªdËEÁryPŒ
 = 
NULL
;

226 
logi
 = 
F®£
;

228 ià(
	`IsHªdËEm±y
(
H—dHªdË
)==
True
)

230  
OSI_ERROR
;

233 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

234 ià(
DSHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

236  
OSI_ERROR
;

239 ià(
DSHªdËEÁryPŒ
->
EÁryPŒ
)

241 
li¡
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

245  
OSI_ERROR
;

248 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

249 
logi
=(
li¡
->
EÁryAmouÁ
==0)?
True
:
F®£
;

250 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

252  
logi
;

253 
	}
}

275 
	$FšdSW
(

276 
LIST_HANDLE
 
H—dHªdË
,

277 ** 
KeyWÜdPŒA¼ay
,

278 
CmpFúIndex
,

279 
LIST_HANDLE
 
NodeHªdË
,

280 
P”missiÚTag
,

281 * 
U£rD©a


284 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
;

285 (*
CmpFúPŒ
)(*,*);

286 ** 
CmpFúA¼ay
;

287 
LIST_HEAD_PTR
 
li¡
;

288 
DS_HANDLE_ENTRY_PTR
 
DSH—dHªdËEÁryPŒ
;

289 
DS_HANDLE_ENTRY_PTR
 
DSNodeHªdËEÁryPŒ
;

290 
logi
,
i
,
MaskTmp
,
NodeIndex
;

292 
Cu¼’tNodePŒ
 = 
NULL
;

293 
CmpFúA¼ay
 = 
NULL
;

294 
li¡
 = 
NULL
;

295 
DSH—dHªdËEÁryPŒ
 = 
NULL
;

296 
DSNodeHªdËEÁryPŒ
 = 
NULL
;

297 
logi
=
i
=
MaskTmp
=0;

299 ià(
	`IsEm±y
(
H—dHªdË
è|| 
KeyWÜdPŒA¼ay
==
NULL
 || 
NodeHªdË
==NULL)

301  
OSI_ERROR
;

304 
DSH—dHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

305 
DSNodeHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

306 ià(
DSH—dHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
 || 
DSNodeHªdËEÁryPŒ
->HªdËTy³!=
LIST_NODE_TYPE
)

308 
	`´štf
("List classƒrror: DS handleypeƒrror!\n");

309  
OSI_ERROR
;

312 
li¡
=(
LIST_HEAD_PTR
)
DSH—dHªdËEÁryPŒ
->
EÁryPŒ
;

314 ià(
li¡
->
CmpFúA¼ay
)

316 
CmpFúA¼ay
=
li¡
->CmpFcnArray;

320  
OSI_ERROR
;

323 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

325 ià(
li¡
->
EÁr›sLi¡
)

327 
Cu¼’tNodePŒ
=
li¡
->
EÁr›sLi¡
;

331 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

332  
OSI_ERROR
;

336 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

337 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

338 
NodeIndex
=0;

341 
MaskTmp
=
CmpFúIndex
;

343 
i
=0;i<
li¡
->
CmpFúAmouÁ
;i++)

345 ià((
MaskTmp
 & 0x1è&& 
KeyWÜdPŒA¼ay
[
i
])

347 
CmpFúPŒ
=
CmpFúA¼ay
[
i
];

348 ià(((*
CmpFúPŒ
)(
Cu¼’tNodePŒ
->
d©a
,
KeyWÜdPŒA¼ay
[
i
]),
U£rD©a
)==
OSI_OK
)

350 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

351 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

352 
DSNodeHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

353 
DSNodeHªdËEÁryPŒ
->
EÁryPŒ
=(*)
Cu¼’tNodePŒ
;

355 
P”missiÚTag
)

357 
READ_PERMISSION_TAG
:

358 ià(
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
>0)

360 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

361  
LIST_PERMISSION_DENY
;

364 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

366 
WRITE_PERMISSION_TAG
:

367 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

369 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

370  
LIST_PERMISSION_DENY
;

373 
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
++;

378 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

379  
NodeIndex
;

382 
MaskTmp
>>=1;

385 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

387 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

388 
Cu¼’tNodePŒ
=Cu¼’tNodePŒ->
NextNode
;

389 
NodeIndex
++;

391 ià(
Cu¼’tNodePŒ
 =ğ
li¡
->
EÁr›sLi¡
)

393 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

398 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

399 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

402  
OSI_ERROR
;

403 
	}
}

428 
	$FšdMW
(

429 
LIST_HANDLE
 
H—dHªdË
,

430 ** 
KeyWÜdPŒA¼ay
,

431 
CmpFúIndex
,

432 
LIST_HANDLE
 
NodeHªdË
,

433 
P”missiÚTag
,

434 ** 
U£rD©aA¼ay


437 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
;

438 (*
CmpFúPŒ
)(*,*);

439 ** 
CmpFúA¼ay
;

440 
LIST_HEAD_PTR
 
li¡
;

441 
DS_HANDLE_ENTRY_PTR
 
DSH—dHªdËEÁryPŒ
;

442 
DS_HANDLE_ENTRY_PTR
 
DSNodeHªdËEÁryPŒ
;

443 
logi
,
i
,
MaskTmp
,
Com·»CÁ
, 
NodeIndex
;

444 * 
Cu¼’tU£rD©a
;

446 
Cu¼’tNodePŒ
 = 
NULL
;

447 
CmpFúA¼ay
 = 
NULL
;

448 
li¡
 = 
NULL
;

449 
DSH—dHªdËEÁryPŒ
 = 
NULL
;

450 
DSNodeHªdËEÁryPŒ
 = 
NULL
;

451 
logi
=
i
=
MaskTmp
=
Com·»CÁ
=0;

454 
	`IsHªdËEm±y
(
H—dHªdË
)==
True
 || IsHªdËEm±y(
NodeHªdË
)==True

455 || 
KeyWÜdPŒA¼ay
==
NULL


458  
OSI_ERROR
;

460 
DSH—dHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

461 
DSNodeHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

462 ià(
DSH—dHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
 || 
DSNodeHªdËEÁryPŒ
->HªdËTy³!=
LIST_NODE_TYPE
)

464 
	`´štf
("List classƒrror: DS handleypeƒrror!\n");

465  
OSI_ERROR
;

468 
li¡
=(
LIST_HEAD_PTR
)
DSH—dHªdËEÁryPŒ
->
EÁryPŒ
;

470 ià(
li¡
->
CmpFúA¼ay
)

472 
CmpFúA¼ay
=
li¡
->CmpFcnArray;

476  
OSI_ERROR
;

479 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

480 ià(
li¡
->
EÁr›sLi¡
)

482 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
li¡
->
EÁr›sLi¡
;

486 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

487  
OSI_ERROR
;

490 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

491 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

492 
NodeIndex
=0;

495 
MaskTmp
=
CmpFúIndex
;

496 
logi
=0;

498 
Com·»CÁ
=0;

499 
i
=0;i<
li¡
->
CmpFúAmouÁ
;i++)

501 ià((
MaskTmp
 & 0x1è&& 
KeyWÜdPŒA¼ay
[
i
])

503 ià(
U£rD©aA¼ay
 =ğ
NULL
)

505 
Cu¼’tU£rD©a
=
NULL
;

509 
Cu¼’tU£rD©a
=
U£rD©aA¼ay
[
i
];

512 
CmpFúPŒ
=
CmpFúA¼ay
[
i
];

513 
logi
+=(((*
CmpFúPŒ
)(
Cu¼’tNodePŒ
->
d©a
,
KeyWÜdPŒA¼ay
[
i
]),
Cu¼’tU£rD©a
)==
OSI_OK
);

514 
Com·»CÁ
++;

516 
MaskTmp
>>=1;

519 ià(
logi
==
Com·»CÁ
)

521 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

522 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

523 
DSNodeHªdËEÁryPŒ
->
EÁryPŒ
=(*)
Cu¼’tNodePŒ
;

524 
DSNodeHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

526 
P”missiÚTag
)

528 
READ_PERMISSION_TAG
:

529 ià(
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
>0)

531 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

532  
LIST_PERMISSION_DENY
;

534 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

536 
WRITE_PERMISSION_TAG
:

537 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

539 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

540  
LIST_PERMISSION_DENY
;

542 
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
++;

547 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

548  
NodeIndex
;

551 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

553 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

554 
Cu¼’tNodePŒ
=Cu¼’tNodePŒ->
NextNode
;

555 
NodeIndex
++;

557 ià(
Cu¼’tNodePŒ
 =ğ
li¡
->
EÁr›sLi¡
)

559 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

563 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

564 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

566  
OSI_ERROR
;

567 
	}
}

587 
	$FšdNodeNum
(

588 
LIST_HANDLE
 
H—dHªdË
,

589 
IndexNum
,

590 
LIST_HANDLE
 
NodeHªdË
,

591 
P”missiÚTag


594 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
;

595 
LIST_HEAD_PTR
 
li¡
;

596 
DS_HANDLE_ENTRY_PTR
 
DSH—dHªdËEÁryPŒ
;

597 
DS_HANDLE_ENTRY_PTR
 
DSNodeHªdËEÁryPŒ
;

599 
Cu¼’tNodePŒ
=
li¡
=
NULL
;

600 
DSH—dHªdËEÁryPŒ
=
DSNodeHªdËEÁryPŒ
=
NULL
;

602 ià(
	`IsHªdËEm±y
(
H—dHªdË
)==
True
 || IsHªdËEm±y(
NodeHªdË
)==Tru|| 
IndexNum
<0)

604 
	`´štf
("Parameterƒrror!\n");

605  
OSI_ERROR
;

608 
DSH—dHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

609 
DSNodeHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

611 ià(
DSH—dHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
 ||

612 
DSNodeHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_NODE_TYPE
)

614 
	`´štf
("Handleypeƒrror!\n");

615  
OSI_ERROR
;

618 
li¡
=(
LIST_HEAD_PTR
)
DSH—dHªdËEÁryPŒ
->
EÁryPŒ
;

620 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
,
OSI_WAIT_FOREVER
);

621 ià(
li¡
->
EÁr›sLi¡
)

623 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
li¡
->
EÁr›sLi¡
;

627 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

628  
OSI_ERROR
;

631 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

632 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

634 
IndexNum
--)

636 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
,
OSI_WAIT_FOREVER
);

638 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

640 
Cu¼’tNodePŒ
=Cu¼’tNodePŒ->
NextNode
;

642 ià(
Cu¼’tNodePŒ
 =ğ
li¡
->
EÁr›sLi¡
)

644 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

649 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

650 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

653 ià(
Cu¼’tNodePŒ
 =ğ
li¡
->
EÁr›sLi¡
)

655  
OSI_ERROR
;

658 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
,
OSI_WAIT_FOREVER
);

660 
Cu¼’tNodePŒ
->
R—dP”missiÚ
--;

661 
DSNodeHªdËEÁryPŒ
->
EÁryPŒ
=(*)
Cu¼’tNodePŒ
;

662 
DSNodeHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

663 
P”missiÚTag
)

665 
READ_PERMISSION_TAG
:

666 ià(
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
>0)

668 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

669  
LIST_PERMISSION_DENY
;

671 
Cu¼’tNodePŒ
->
R—dP”missiÚ
++;

673 
WRITE_PERMISSION_TAG
:

674 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

676 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

677  
LIST_PERMISSION_DENY
;

679 
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
++;

684 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

686  
OSI_OK
;

687 
	}
}

703 
	$In£¹NodeH—d
(
LIST_HANDLE
 
hªdË
,
D©aL’gth
,* 
D©aPŒ
)

705 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
,
In£¹iÚNodePŒ
;

706 
LIST_HEAD_PTR
 
li¡
;

707 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

709 
Cu¼’tNodePŒ
=
In£¹iÚNodePŒ
=
NULL
;

710 
li¡
 = 
NULL
;

711 
DSHªdËEÁryPŒ
 = 
NULL
;

713 ià(
	`IsHªdËEm±y
(
hªdË
)

714 ||(
D©aPŒ
==
NULL
))

716  
OSI_ERROR
;

718 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

720 ià(
DSHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

722 
	`´štf
("List classƒrror: DS handleypeƒrror!\n");

723  
OSI_ERROR
;

726 ià((
In£¹iÚNodePŒ
=(
LIST_NODE_PTR
)
	`m®loc
((
LIST_NODE
)))==0)

728  
OSI_ERROR
;

731 
	`mem£t
(
In£¹iÚNodePŒ
,0,(
LIST_NODE
));

732 
In£¹iÚNodePŒ
->
d©a
=
D©aPŒ
;

733 
In£¹iÚNodePŒ
->
Ëngth
=
D©aL’gth
;

734 
In£¹iÚNodePŒ
->
H—dPŒ
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

736 
li¡
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

737 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

738 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
li¡
->
EÁr›sLi¡
;

740 ià(
Cu¼’tNodePŒ
==0)

742 
li¡
->
EÁr›sLi¡
=(*)
In£¹iÚNodePŒ
;

743 
In£¹iÚNodePŒ
->
NextNode
=InsertionNodePtr;

744 
In£¹iÚNodePŒ
->
P»viousNode
=InsertionNodePtr;

748 
In£¹iÚNodePŒ
->
P»viousNode
=
Cu¼’tNodePŒ
->PreviousNode;

749 
In£¹iÚNodePŒ
->
P»viousNode
->
NextNode
=InsertionNodePtr;

751 
In£¹iÚNodePŒ
->
NextNode
=
Cu¼’tNodePŒ
;

752 
Cu¼’tNodePŒ
->
P»viousNode
=
In£¹iÚNodePŒ
;

754 
li¡
->
EÁr›sLi¡
=(*)
In£¹iÚNodePŒ
;

757 
li¡
->
EÁryAmouÁ
++;

758 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

760  
OSI_OK
;

761 
	}
}

779 
	$In£¹NodeHªdË
(

780 
LIST_HANDLE
 
H—dHªdË
,

781 
LIST_HANDLE
 
PosiNodeHªdË
,

782 
In£¹Pos™iÚ
,

783 
D©aL’gth
,

784 * 
D©aPŒ


787 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

788 
LIST_NODE_PTR
 
Li¡NodePŒ
, 
Cu¼’tNodePŒ
, 
In£¹NodePŒ
;

789 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ1
, 
HªdËEÁryPŒ2
;

792 
	`IsHªdËEm±y
(
H—dHªdË
) ||

793 
	`IsHªdËEm±y
(
PosiNodeHªdË
) ||

794 
D©aL’gth
<0 ||

795 
D©aPŒ
==
NULL


798 
	`´štf
("Parameters check fail!\n");

799  
OSI_ERROR
;

802 
HªdËEÁryPŒ1
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

803 
HªdËEÁryPŒ2
=(
DS_HANDLE_ENTRY_PTR
)
PosiNodeHªdË
;

805 ià(
HªdËEÁryPŒ1
->
HªdËTy³
 !ğ
LIST_HEAD_TYPE
 ||

806 
HªdËEÁryPŒ2
->
HªdËTy³
 !ğ
LIST_NODE_TYPE
)

808 
	`´štf
("Handleypeƒrror!\n");

809  
OSI_ERROR
;

812 
Li¡H—dPŒ
=(
LIST_HEAD_PTR
)
HªdËEÁryPŒ1
->
EÁryPŒ
;

813 
Li¡NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ2
->
EÁryPŒ
;

815 ià((
In£¹NodePŒ
=(
LIST_NODE_PTR
)
	`m®loc
((
LIST_NODE
)))==
NULL
)

817 
	`´štf
("Memory†imited!\n");

818  
OSI_ERROR
;

821 
	`mem£t
(
In£¹NodePŒ
,0,(
LIST_NODE
));

823 
In£¹NodePŒ
->
d©a
=
D©aPŒ
;

824 
In£¹NodePŒ
->
Ëngth
=
D©aL’gth
;

825 
In£¹NodePŒ
->
H—dPŒ
=
Li¡H—dPŒ
;

826 
	`mu‹x_lock
(
Li¡H—dPŒ
->
Mu‹xHªdË
,
OSI_WAIT_FOREVER
);

827 
In£¹Pos™iÚ
)

829 
INSERT_BEFORE_NODE
:

830 ià(
Li¡NodePŒ
 =ğ
Li¡H—dPŒ
->
EÁr›sLi¡
)

832 
Li¡H—dPŒ
->
EÁr›sLi¡
=(*è
In£¹NodePŒ
;

833 
In£¹NodePŒ
->
P»viousNode
=
Li¡NodePŒ
->PreviousNode;

834 
In£¹NodePŒ
->
P»viousNode
->
NextNode
=InsertNodePtr;

835 
In£¹NodePŒ
->
NextNode
=
Li¡NodePŒ
;

836 
Li¡NodePŒ
->
P»viousNode
=
In£¹NodePŒ
;

840 
Cu¼’tNodePŒ
=
Li¡NodePŒ
->
P»viousNode
;

841 
Cu¼’tNodePŒ
->
NextNode
=
In£¹NodePŒ
;

842 
In£¹NodePŒ
->
P»viousNode
=
Cu¼’tNodePŒ
;

843 
In£¹NodePŒ
->
NextNode
=
Li¡NodePŒ
;

844 
Li¡NodePŒ
->
P»viousNode
=
In£¹NodePŒ
;

848 
INSERT_AFTER_NODE
:

849 ià(
Li¡NodePŒ
->
NextNode
 =ğ
Li¡H—dPŒ
->
EÁr›sLi¡
)

851 
In£¹NodePŒ
->
P»viousNode
=
Li¡NodePŒ
;

852 
In£¹NodePŒ
->
NextNode
=
Li¡NodePŒ
->NextNode;

853 
In£¹NodePŒ
->
NextNode
->
P»viousNode
=InsertNodePtr;

854 
Li¡NodePŒ
->
NextNode
=
In£¹NodePŒ
;

858 
Cu¼’tNodePŒ
=
Li¡NodePŒ
->
NextNode
;

859 
Li¡NodePŒ
->
NextNode
=
In£¹NodePŒ
;

860 
In£¹NodePŒ
->
P»viousNode
=
Li¡NodePŒ
;

861 
In£¹NodePŒ
->
NextNode
=
Cu¼’tNodePŒ
;

862 
Cu¼’tNodePŒ
->
P»viousNode
=
In£¹NodePŒ
;

867 
	`´štf
("Insert…ositionƒrror!\n");

868 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

869 
	`ä“
(
In£¹NodePŒ
);

870  
OSI_ERROR
;

874 
Li¡H—dPŒ
->
EÁryAmouÁ
++;

875 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

877  
OSI_OK
;

878 
	}
}

902 
	$D–‘eNodeSW
(

903 
LIST_HANDLE
 
H—dHªdË
,

904 ** 
KeyWÜdPŒA¼ay
,

905 
CmpFúIndex
,

906 ** 
D–NodeD©aPŒ
,

907 * 
U£rD©a


910 
DS_HANDLE_ENTRY
 
HªdËEÁry
;

911 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

912 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

913 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
,
P»viousNodePŒ
,
NextNodePŒ
;

914 
LIST_HANDLE
 
hªdË
;

915 * 
D©aPŒ
;

916 
»tv®
;

918 
HªdËEÁryPŒ
 = 
NULL
;

919 
Li¡H—dPŒ
 = 
NULL
;

920 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=
NextNodePŒ
=
NULL
;

921 
hªdË
 = 
NULL
;

922 
D©aPŒ
 = 
NULL
;

923 
»tv®
 = 0;

926 ià(
	`IsHªdËEm±y
(
H—dHªdË
è|| 
KeyWÜdPŒA¼ay
==
NULL
 || 
CmpFúIndex
==0)

928  
OSI_ERROR
;

930 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

931 ià(
HªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

933  
OSI_ERROR
;

936 
Li¡H—dPŒ
 = 
HªdËEÁryPŒ
->
EÁryPŒ
;

938 
HªdËEÁry
.
HªdËTy³
=
LIST_NODE_TYPE
;

939 
hªdË
=(
LIST_HANDLE
)&
HªdËEÁry
;

941 
»tv®
=
	`FšdSW
(
H—dHªdË
,
KeyWÜdPŒA¼ay
,
CmpFúIndex
,
hªdË
,
WRITE_PERMISSION_TAG
, 
U£rD©a
);

942 ià(
»tv®
==
OSI_ERROR
 ||„‘v®==
LIST_PERMISSION_DENY
)

944  
»tv®
;

947 
	`mu‹x_lock
(
Li¡H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

948 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁry
.
EÁryPŒ
;

950 ià(
Cu¼’tNodePŒ
==
NULL
)

952 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

953  
OSI_ERROR
;

956 
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
--;

957 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

959 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

960  
OSI_ERROR
;

963 
P»viousNodePŒ
=
Cu¼’tNodePŒ
->
P»viousNode
;

964 
NextNodePŒ
=
Cu¼’tNodePŒ
->
NextNode
;

965 ià(
Cu¼’tNodePŒ
 =ğ
Li¡H—dPŒ
->
EÁr›sLi¡
)

967 ià(
Cu¼’tNodePŒ
->
NextNode
 == CurrentNodePtr)

969 
Li¡H—dPŒ
->
EÁr›sLi¡
=
NULL
;

973 
Li¡H—dPŒ
->
EÁr›sLi¡
=
Cu¼’tNodePŒ
->
NextNode
;

974 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

975 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

981 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

982 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

985 
D©aPŒ
=
Cu¼’tNodePŒ
->
d©a
;

986 
Li¡H—dPŒ
->
EÁryAmouÁ
--;

987 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

989 ià(
Cu¼’tNodePŒ
!=
NULL
)

991 
	`ä“
(
Cu¼’tNodePŒ
);

992 
Cu¼’tNodePŒ
=
NULL
;

995 *
D–NodeD©aPŒ
=(*)
D©aPŒ
;

997  
OSI_OK
;

998 
	}
}

1020 
	$D–‘eNodeMW
(

1021 
LIST_HANDLE
 
H—dHªdË
,

1022 ** 
KeyWÜdPŒA¼ay
,

1023 
CmpFúIndex
,

1024 ** 
D–NodeD©aPŒ
,

1025 ** 
U£rD©aA¼ay


1028 
DS_HANDLE_ENTRY
 
HªdËEÁry
;

1029 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1030 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

1031 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
,
P»viousNodePŒ
,
NextNodePŒ
;

1032 
LIST_HANDLE
 
hªdË
;

1033 * 
D©aPŒ
;

1034 
»tv®
;

1036 
HªdËEÁryPŒ
 = 
NULL
;

1037 
Li¡H—dPŒ
 = 
NULL
;

1038 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=
NextNodePŒ
=
NULL
;

1039 
hªdË
 = 
NULL
;

1040 
D©aPŒ
 = 
NULL
;

1041 
»tv®
 = 0;

1044 ià(
	`IsHªdËEm±y
(
H—dHªdË
è|| 
KeyWÜdPŒA¼ay
==
NULL
 || 
CmpFúIndex
==0)

1046  
OSI_ERROR
;

1048 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

1049 ià(
HªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

1051  
OSI_ERROR
;

1054 
Li¡H—dPŒ
 = 
HªdËEÁryPŒ
->
EÁryPŒ
;

1056 
HªdËEÁry
.
HªdËTy³
=
LIST_NODE_TYPE
;

1057 
hªdË
=(
LIST_HANDLE
)&
HªdËEÁry
;

1059 
»tv®
=
	`FšdMW
(
H—dHªdË
,
KeyWÜdPŒA¼ay
,
CmpFúIndex
,
hªdË
,
WRITE_PERMISSION_TAG
, 
U£rD©aA¼ay
);

1060 ià(
»tv®
==
OSI_ERROR
 ||„‘v®==
LIST_PERMISSION_DENY
)

1062  
»tv®
;

1065 
	`mu‹x_lock
(
Li¡H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1066 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁry
.
EÁryPŒ
;

1068 ià(
Cu¼’tNodePŒ
==
NULL
)

1070 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

1071  
OSI_ERROR
;

1074 
Cu¼’tNodePŒ
->
Wr™eP”missiÚ
--;

1075 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

1077 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

1078  
OSI_ERROR
;

1081 
P»viousNodePŒ
=
Cu¼’tNodePŒ
->
P»viousNode
;

1082 
NextNodePŒ
=
Cu¼’tNodePŒ
->
NextNode
;

1083 ià(
Cu¼’tNodePŒ
 =ğ
Li¡H—dPŒ
->
EÁr›sLi¡
)

1085 ià(
Cu¼’tNodePŒ
->
NextNode
 == CurrentNodePtr)

1087 
Li¡H—dPŒ
->
EÁr›sLi¡
=
NULL
;

1091 
Li¡H—dPŒ
->
EÁr›sLi¡
=
Cu¼’tNodePŒ
->
NextNode
;

1092 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

1093 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

1099 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

1100 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

1103 
D©aPŒ
=
Cu¼’tNodePŒ
->
d©a
;

1104 
Li¡H—dPŒ
->
EÁryAmouÁ
--;

1105 
	`mu‹x_uÆock
(
Li¡H—dPŒ
->
Mu‹xHªdË
);

1107 ià(
Cu¼’tNodePŒ
!=
NULL
)

1109 
	`ä“
(
Cu¼’tNodePŒ
);

1110 
Cu¼’tNodePŒ
=
NULL
;

1113 *
D–NodeD©aPŒ
=(*)
D©aPŒ
;

1115  
OSI_OK
;

1116 
	}
}

1131 
	$D–‘eNodes
Ğ
LIST_HANDLE
 
hªdË
 )

1133 
LIST_NODE_PTR
 
Cu¼’tNodePŒ
,
P»viousNodePŒ
,
La¡NodePŒ
;

1134 
LIST_HEAD_PTR
 
li¡
;

1135 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

1136 
EÁryAmouÁ
;

1138 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=
NULL
;

1139 
li¡
 = 
NULL
;

1140 
DSHªdËEÁryPŒ
 = 
NULL
;

1142 ià(
	`IsHªdËEm±y
(
hªdË
))

1144  
OSI_ERROR
;

1146 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

1147 ià(
DSHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

1149 
	`´štf
("List classƒrror: DS handleypeƒrror!\n");

1150  
OSI_ERROR
;

1153 
li¡
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

1155 
	`mu‹x_lock
(
li¡
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1157 ià(
li¡
->
EÁr›sLi¡
 =ğ
NULL
 ||†i¡->
EÁryAmouÁ
 <=0 )

1159 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

1160  
li¡
->
EÁryAmouÁ
;

1163 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=(
LIST_NODE_PTR
)
li¡
->
EÁr›sLi¡
;

1164 
La¡NodePŒ
=
Cu¼’tNodePŒ
->
P»viousNode
;

1168 ià(
Cu¼’tNodePŒ
==
La¡NodePŒ
)

1170 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
==0 && Cu¼’tNodePŒ->
Wr™eP”missiÚ
==0)

1172 ià(
Cu¼’tNodePŒ
->
NextNode
 == CurrentNodePtr)

1174 
	`ä“
(
Cu¼’tNodePŒ
);

1175 
li¡
->
EÁr›sLi¡
=
NULL
;

1176 
li¡
->
EÁryAmouÁ
--;

1180 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

1181 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

1182 
	`ä“
(
Cu¼’tNodePŒ
);

1183 
li¡
->
EÁryAmouÁ
--;

1189 ià(
Cu¼’tNodePŒ
->
R—dP”missiÚ
>0 || Cu¼’tNodePŒ->
Wr™eP”missiÚ
>0)

1191 
P»viousNodePŒ
=
Cu¼’tNodePŒ
;

1192 
Cu¼’tNodePŒ
=Cu¼’tNodePŒ->
NextNode
;

1196 ià(
Cu¼’tNodePŒ
==
li¡
->
EÁr›sLi¡
)

1198 
li¡
->
EÁr›sLi¡
=
Cu¼’tNodePŒ
->
NextNode
;

1199 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=CurrentNodePtr->PreviousNode;

1200 
Cu¼’tNodePŒ
->
P»viousNode
->
NextNode
=CurrentNodePtr->NextNode;

1201 
	`ä“
(
Cu¼’tNodePŒ
);

1202 
li¡
->
EÁryAmouÁ
--;

1203 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=
li¡
->
EÁr›sLi¡
;

1208 
P»viousNodePŒ
->
NextNode
=
Cu¼’tNodePŒ
->NextNode;

1209 
Cu¼’tNodePŒ
->
NextNode
->
P»viousNode
=
P»viousNodePŒ
;

1210 
	`ä“
(
Cu¼’tNodePŒ
);

1211 
li¡
->
EÁryAmouÁ
--;

1212 
P»viousNodePŒ
=
Cu¼’tNodePŒ
;

1213 
Cu¼’tNodePŒ
=
P»viousNodePŒ
->
NextNode
;

1218 
EÁryAmouÁ
=
li¡
->EntryAmount;

1219 
	`mu‹x_uÆock
(
li¡
->
Mu‹xHªdË
);

1221  
EÁryAmouÁ
;

1222 
	}
}

1240 
	$D–‘e
(
LIST_HANDLE
 
hªdË
)

1242 
»tv®
;

1243 
LIST_HEAD_PTR
 
li¡
;

1244 
DS_HANDLE_ENTRY_PTR
 
DSHªdËEÁryPŒ
;

1246 ià((
»tv®
=
	`D–‘eNodes
(
hªdË
)) != 0)

1248  
»tv®
;

1251 
DSHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

1253 
li¡
=(
LIST_HEAD_PTR
)
DSHªdËEÁryPŒ
->
EÁryPŒ
;

1255 ià(
li¡
->
Mu‹xHªdË
)

1257 
	`mu‹x_d–‘e
(
li¡
->
Mu‹xHªdË
);

1258 
li¡
->
Mu‹xHªdË
=
NULL
;

1261 ià(
li¡
->
CmpFúA¼ay
)

1263 
	`ä“
(
li¡
->
CmpFúA¼ay
);

1264 
li¡
->
CmpFúA¼ay
=
NULL
;

1267 
	`ä“
(
li¡
);

1269 
DSHªdËEÁryPŒ
->
EÁryPŒ
=
NULL
;

1271  
OSI_OK
;

1272 
	}
}

1287 
	$R–—£P”missiÚ
(
LIST_HANDLE
 
NodeHªdË
,
P”missiÚTag
)

1289 
LIST_NODE_PTR
 
NodePŒ
;

1290 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1292 
NodePŒ
 = 
NULL
;

1293 
HªdËEÁryPŒ
 = 
NULL
;

1295 ià(
	`IsHªdËEm±y
(
NodeHªdË
))

1297  
OSI_ERROR
;

1300 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

1301 ià(
HªdËEÁryPŒ
->
HªdËTy³
!=
LIST_NODE_TYPE
)

1303  
OSI_ERROR
;

1306 ià(
HªdËEÁryPŒ
->
EÁryPŒ
)

1308 
NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ
->
EÁryPŒ
;

1312  
OSI_ERROR
;

1315 
	`mu‹x_lock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1316 
P”missiÚTag
)

1318 
READ_PERMISSION_TAG
:

1319 ià(
NodePŒ
->
R—dP”missiÚ
>0)

1321 
NodePŒ
->
R—dP”missiÚ
--;

1324 
WRITE_PERMISSION_TAG
:

1325 ià(
NodePŒ
->
Wr™eP”missiÚ
>0)

1327 
NodePŒ
->
Wr™eP”missiÚ
--;

1333 
	`mu‹x_uÆock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
);

1334  
OSI_OK
;

1335 
	}
}

1348 
	$PrštP”missiÚ
(
LIST_HANDLE
 
NodeHªdË
)

1350 
LIST_NODE_PTR
 
NodePŒ
;

1351 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1353 
NodePŒ
 = 
NULL
;

1354 
HªdËEÁryPŒ
 = 
NULL
;

1356 ià(
	`IsHªdËEm±y
(
NodeHªdË
)==
True
)

1358  
OSI_ERROR
;

1360 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

1361 ià(
HªdËEÁryPŒ
->
HªdËTy³
!=
LIST_NODE_TYPE
)

1363  
OSI_ERROR
;

1365 
NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ
->
EÁryPŒ
;

1367 
	`mu‹x_lock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1368 
	`´štf
("R—d P”missiÚ Tag:%d\n", 
NodePŒ
->
R—dP”missiÚ
);

1369 
	`´štf
("Wr™P”missiÚ Tag:%d\n", 
NodePŒ
->
Wr™eP”missiÚ
);

1370 
	`mu‹x_uÆock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
);

1372  
OSI_OK
;

1373 
	}
}

1395 
	$G‘P”misssiÚ
(
LIST_HANDLE
 
NodeHªdË
,
P”missiÚTag
)

1397 
LIST_NODE_PTR
 
NodePŒ
;

1398 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1400 
NodePŒ
 = 
NULL
;

1401 
HªdËEÁryPŒ
 = 
NULL
;

1403 ià(
	`IsHªdËEm±y
(
NodeHªdË
)==
True
)

1405  
OSI_ERROR
;

1407 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

1408 ià(
HªdËEÁryPŒ
->
HªdËTy³
!=
LIST_NODE_TYPE
)

1410  
OSI_ERROR
;

1412 
NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ
->
EÁryPŒ
;

1414 
	`mu‹x_lock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1415 
P”missiÚTag
)

1417 
READ_PERMISSION_TAG
:

1418 ià(
NodePŒ
->
Wr™eP”missiÚ
>0)

1420 
	`mu‹x_uÆock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
);

1421  
LIST_PERMISSION_DENY
;

1425 
NodePŒ
->
R—dP”missiÚ
++;

1428 
WRITE_PERMISSION_TAG
:

1429 ià(
NodePŒ
->
R—dP”missiÚ
>0 || NodePŒ->
Wr™eP”missiÚ
>0)

1431 
	`mu‹x_uÆock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
);

1432  
LIST_PERMISSION_DENY
;

1436 
NodePŒ
->
Wr™eP”missiÚ
++;

1442 
	`mu‹x_uÆock
(
NodePŒ
->
H—dPŒ
->
Mu‹xHªdË
);

1444  
OSI_OK
;

1445 
	}
}

1458 * 
	$G‘D©a
Ğ
LIST_HANDLE
 
NodeHªdË
 )

1460 
LIST_NODE_PTR
 
NodePŒ
;

1461 
LIST_HEAD_PTR
 
Li¡H—dPŒ
;

1462 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1464 
NodePŒ
 = 
NULL
;

1465 
Li¡H—dPŒ
 = 
NULL
;

1466 
HªdËEÁryPŒ
 = 
NULL
;

1468 ià(
	`IsHªdËEm±y
(
NodeHªdË
)==
True
)

1470  
NULL
;

1473 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NodeHªdË
;

1474 
HªdËEÁryPŒ
->
HªdËTy³
)

1476 
LIST_NODE_TYPE
:

1477 
NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ
->
EÁryPŒ
;

1478  
NodePŒ
->
d©a
;

1479 
LIST_HEAD_TYPE
:

1480  
NULL
;

1485  
NULL
;

1486 
	}
}

1515 
	$G‘NextNode
(

1516 
LIST_HANDLE
 
H—dHªdË
,

1517 
LIST_HANDLE
 
Cu¼’tHªdË
,

1518 
LIST_HANDLE
 
NextHªdË
,

1519 
SkTag
,

1520 
P”missiÚTag


1523 
LIST_NODE_PTR
 
NextNodePŒ
, 
Cu¼’tNodePŒ
;

1524 
LIST_HEAD_PTR
 
H—dPŒ
;

1525 
DS_HANDLE_ENTRY_PTR
 
H—dHªdËEÁryPŒ
,
Cu¼’tHªdËEÁryPŒ
,
NextHªdËEÁryPŒ
;

1527 
Cu¼’tNodePŒ
=
NextNodePŒ
=
NULL
;

1528 
H—dPŒ
 = 
NULL
;

1529 
H—dHªdËEÁryPŒ
=
NULL
;

1530 
H—dHªdËEÁryPŒ
=
NULL
;

1531 
NextHªdËEÁryPŒ
=
NULL
;

1533 ià(
	`IsHªdËEm±y
(
H—dHªdË
è|| IsHªdËEm±y(
Cu¼’tHªdË
è|| 
NextHªdË
==
NULL
)

1535  
OSI_ERROR
;

1538 
H—dHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

1539 ià(
H—dHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

1541  
OSI_ERROR
;

1544 
H—dPŒ
ğ(
LIST_HEAD_PTR
è
H—dHªdËEÁryPŒ
->
EÁryPŒ
;

1545 
	`mu‹x_lock
(
H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1546 ià(
H—dPŒ
->
EÁr›sLi¡
 =ğ
NULL
)

1548 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1549  
OSI_ERROR
;

1552 
Cu¼’tHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
Cu¼’tHªdË
;

1553 
NextHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
NextHªdË
;

1555 ià(
Cu¼’tHªdËEÁryPŒ
->
HªdËTy³
 =ğ
LIST_HEAD_TYPE
 &&

1556 
Cu¼’tHªdËEÁryPŒ
->
EÁryPŒ
 =ğ
H—dHªdËEÁryPŒ
->EntryPtr)

1558 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
H—dPŒ
->
EÁr›sLi¡
;

1559 
NextNodePŒ
=(
LIST_NODE_PTR
)
H—dPŒ
->
EÁr›sLi¡
;

1561 ià(
Cu¼’tHªdËEÁryPŒ
->
HªdËTy³
 =ğ
LIST_NODE_TYPE
)

1563 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
Cu¼’tHªdËEÁryPŒ
->
EÁryPŒ
;

1564 
NextNodePŒ
=
Cu¼’tNodePŒ
->
NextNode
;

1569 ià(
P”missiÚTag
 =ğ
READ_PERMISSION_TAG
)

1571 ià(
NextNodePŒ
->
Wr™eP”missiÚ
 == 0)

1573 
NextNodePŒ
->
R—dP”missiÚ
++;

1574 
NextHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

1575 
NextHªdËEÁryPŒ
->
EÁryPŒ
=
NextNodePŒ
;

1576 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1577  
OSI_OK
;

1581 ià(
SkTag
 == 1)

1583 
NextNodePŒ
=NextNodePŒ->
NextNode
;

1587 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1588  
LIST_PERMISSION_DENY
;

1592 ià(
P”missiÚTag
 =ğ
WRITE_PERMISSION_TAG
)

1594 ià(
NextNodePŒ
->
R—dP”missiÚ
 =ğ0 && NextNodePŒ->
Wr™eP”missiÚ
 == 0)

1596 
NextNodePŒ
->
Wr™eP”missiÚ
++;

1597 
NextHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

1598 
NextHªdËEÁryPŒ
->
EÁryPŒ
=
NextNodePŒ
;

1599 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1600  
OSI_OK
;

1604 ià(
SkTag
==1)

1606 
NextNodePŒ
=NextNodePŒ->
NextNode
;

1610 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1611  
LIST_PERMISSION_DENY
;

1617 
	`´štf
("Permissionagƒrror!\n");

1618 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1619  
OSI_ERROR
;

1622 }
NextNodePŒ
 !ğ
Cu¼’tNodePŒ
);

1624 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1625  
OSI_ERROR
;

1626 
	}
}

1655 
	$G‘P»viousNode
(

1656 
LIST_HANDLE
 
H—dHªdË
,

1657 
LIST_HANDLE
 
Cu¼’tHªdË
,

1658 
LIST_HANDLE
 
P»viousHªdË
,

1659 
SkTag
,

1660 
P”missiÚTag


1663 
LIST_NODE_PTR
 
P»viousNodePŒ
, 
Cu¼’tNodePŒ
;

1664 
LIST_HEAD_PTR
 
H—dPŒ
;

1665 
DS_HANDLE_ENTRY_PTR
 
H—dHªdËEÁryPŒ
,
Cu¼’tHªdËEÁryPŒ
,
P»viousHªdËEÁryPŒ
;

1667 
Cu¼’tNodePŒ
=
P»viousNodePŒ
=
NULL
;

1668 
H—dPŒ
 = 
NULL
;

1669 
H—dHªdËEÁryPŒ
=
NULL
;

1670 
H—dHªdËEÁryPŒ
=
NULL
;

1671 
P»viousHªdËEÁryPŒ
=
NULL
;

1673 ià(
	`IsHªdËEm±y
(
H—dHªdË
è|| IsHªdËEm±y(
Cu¼’tHªdË
è|| 
P»viousHªdË
==
NULL
)

1675  
OSI_ERROR
;

1678 
H—dHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
H—dHªdË
;

1679 ià(
H—dHªdËEÁryPŒ
->
HªdËTy³
!=
LIST_HEAD_TYPE
)

1681  
OSI_ERROR
;

1684 
H—dPŒ
ğ(
LIST_HEAD_PTR
è
H—dHªdËEÁryPŒ
->
EÁryPŒ
;

1685 
	`mu‹x_lock
(
H—dPŒ
->
Mu‹xHªdË
, 
OSI_WAIT_FOREVER
);

1686 ià(
H—dPŒ
->
EÁr›sLi¡
 =ğ
NULL
)

1688 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1689  
OSI_ERROR
;

1692 
Cu¼’tHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
Cu¼’tHªdË
;

1693 
P»viousHªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
P»viousHªdË
;

1695 ià(
Cu¼’tHªdËEÁryPŒ
->
HªdËTy³
 =ğ
LIST_HEAD_TYPE
 &&

1696 
Cu¼’tHªdËEÁryPŒ
->
EÁryPŒ
 =ğ
H—dHªdËEÁryPŒ
->EntryPtr)

1698 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
H—dPŒ
->
EÁr›sLi¡
;

1699 
P»viousNodePŒ
=(
LIST_NODE_PTR
)
H—dPŒ
->
EÁr›sLi¡
;

1701 ià(
Cu¼’tHªdËEÁryPŒ
->
HªdËTy³
 =ğ
LIST_NODE_TYPE
)

1703 
Cu¼’tNodePŒ
=(
LIST_NODE_PTR
)
Cu¼’tHªdËEÁryPŒ
->
EÁryPŒ
;

1704 
P»viousNodePŒ
=
Cu¼’tNodePŒ
->
P»viousNode
;

1709 ià(
P”missiÚTag
 =ğ
READ_PERMISSION_TAG
)

1711 ià(
P»viousNodePŒ
->
Wr™eP”missiÚ
 == 0)

1713 
P»viousNodePŒ
->
R—dP”missiÚ
++;

1714 
P»viousHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

1715 
P»viousHªdËEÁryPŒ
->
EÁryPŒ
=
P»viousNodePŒ
;

1716 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1717  
OSI_OK
;

1721 ià(
SkTag
 == 1)

1723 
P»viousNodePŒ
=P»viousNodePŒ->
P»viousNode
;

1727 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1728  
LIST_PERMISSION_DENY
;

1732 ià(
P”missiÚTag
 =ğ
WRITE_PERMISSION_TAG
)

1734 ià(
P»viousNodePŒ
->
R—dP”missiÚ
 =ğ0 && P»viousNodePŒ->
Wr™eP”missiÚ
 == 0)

1736 
P»viousNodePŒ
->
Wr™eP”missiÚ
++;

1737 
P»viousHªdËEÁryPŒ
->
HªdËTy³
=
LIST_NODE_TYPE
;

1738 
P»viousHªdËEÁryPŒ
->
EÁryPŒ
=
P»viousNodePŒ
;

1739 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1740  
OSI_OK
;

1744 ià(
SkTag
==1)

1746 
P»viousNodePŒ
=P»viousNodePŒ->
P»viousNode
;

1750 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1751  
LIST_PERMISSION_DENY
;

1757 
	`´štf
("Permissionagƒrror!\n");

1758 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1759  
OSI_ERROR
;

1762 }
P»viousNodePŒ
 !ğ
Cu¼’tNodePŒ
);

1764 
	`mu‹x_uÆock
(
H—dPŒ
->
Mu‹xHªdË
);

1765  
OSI_ERROR
;

1766 
	}
}

1780 
	$G‘D©aL’
(
LIST_HANDLE
 
hªdË
)

1782 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1783 
LIST_NODE_PTR
 
NodePŒ
;

1785 
HªdËEÁryPŒ
 = 
NULL
;

1786 
NodePŒ
 = 
NULL
;

1788 ià(
hªdË
==
NULL
)

1790  
OSI_ERROR
;

1793 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

1794 ià(
HªdËEÁryPŒ
->
HªdËTy³
==
LIST_HEAD_TYPE
)

1796  
OSI_ERROR
;

1799 
NodePŒ
=(
LIST_NODE_PTR
)
HªdËEÁryPŒ
->
EÁryPŒ
;

1800 ià(
NodePŒ
==
NULL
)

1802  
OSI_ERROR
;

1804  
NodePŒ
->
Ëngth
;

1805 
	}
}

1818 
LOGICAL
 
	$IsHªdËEm±y
(
LIST_HANDLE
 
hªdË
)

1820 
DS_HANDLE_ENTRY_PTR
 
HªdËEÁryPŒ
;

1822 
HªdËEÁryPŒ
 = 
NULL
;

1824 ià(
hªdË
==
NULL
)

1826  
True
;

1828 
HªdËEÁryPŒ
=(
DS_HANDLE_ENTRY_PTR
)
hªdË
;

1829  (
HªdËEÁryPŒ
->
EÁryPŒ
==
NULL
)?
True
:
F®£
;

1830 
	}
}

1845 
	$HªdËCpy
(
LIST_HANDLE
 
DesHªdË
,cÚ¡ LIST_HANDLE 
SrcHªdË
)

1847 ià(
DesHªdË
==
NULL
 || 
	`IsHªdËEm±y
(
SrcHªdË
))

1851 
	`memıy
(
DesHªdË
,
SrcHªdË
,(
DS_HANDLE_ENTRY
));

1853 
	}
}

	@include\actree.h

9 
	~"d©©y³.h
"

11 * 
	tACT_HANDLE
;

13 
	#ACT_ACN_TYPE
 1

	)

14 
	#ACT_AGN_TYPE
 2

	)

16 
	#ACT_ERROR
 -1

	)

17 
	#ACT_OK
 0

	)

18 
	#ACT_NULL
 ((*è0)

	)

22 
MG_HANDLE
 
	mMGHªdË
;

23 
MG_REGION
 
	mGeom‘ricRegiÚ
;

24 }
	tABSTRACT_COMPONENT_INFO
,*
	tABSTRACT_COMPONENT_INFO_PTR
;

33 
	mAùiveDeviû
;

66 
	mAùiveTy³
;

78 (*
	mAùiveFú
)(*,*,*,*);

80 }
	tACTION_MAP
,*
	tACTION_MAP_PTR
;

85 
	mAùiveDeviû
;

86 
	mVœtu®Ev’t
;

87 
	mKBEv’t
;

88 
MOUSE_EVENT_PTR
 
	mMou£Ev’t
;

89 }
	tUI_EVENT
,*
	tUI_EVENT_PTR
;

93 
	mTag
;

94 
LOGICAL
 
	mEÇbË
;

95 
MG_REGION
 
	mGeom‘ricRegiÚ
;

96 
	mAùiveM­AmouÁ
;

97 
ACTION_MAP_PTR
 
	mAùiÚFúM­
;

98 }
	tFCN_REG_INFO
,*
	tFCN_REG_INFO_PTR
;

103 
š£¹Chd
(

104 
ABSTRACT_COMPONENT_TREE
 
aù»e


105 , 
ABSTRACT_COMPONENT_NODE_PTR
 
aúode


114 
d–‘eT»e
(
ABSTRACT_COMPONENT_TREE
 
aù»e
);

119 
d–Chd»n
(
ABSTRACT_COMPONENT_TREE
 
aù»e
);

125 
d–Chd_hªdË
(
ABSTRACT_COMPONENT_TREE
 
aù»e
,
MG_HANDLE
 
hªdË
);

129 
d–ChdšLi¡
(

130 
ABSTRACT_COMPONENT_TREE
 
aù»e


131 ,
MG_HANDLE
 
hªdË


136 
ABSTRACT_COMPONENT_NODE_PTR
 
fšdChd_gc
(

137 
ABSTRACT_COMPONENT_TREE
 
aù»e


138 , 
COORDINATE_PTR
 
wp


145 
ABSTRACT_COMPONENT_NODE_PTR
 
ãogc
(

146 
ABSTRACT_COMPONENT_TREE
 
aù»e


147 ,
COORDINATE_PTR
 
wp


153 
ABSTRACT_COMPONENT_NODE_PTR
 
fšdachş
(

154 
ABSTRACT_COMPONENT_TREE
 
aù»e
,

155 
MG_HANDLE
 
hªdË


162 
moveACtİ_ACGrid
(
MG_GRID_PTR
 
grid
,
ABSTRACT_COMPONENT_NODE_PTR
 
ACNodePŒ
);

169 
MG_REGION
 
g‘w¬c
(
ABSTRACT_COMPONENT_NODE_PTR
 
ACNodePŒ
);

	@include\configPars.h

14 
	~"libty³.h
"

15 
	~"li¡.h
"

20 
g‘_cÚfig_v®ue
(
LIST_HANDLE
 
‹xt_hªdË
, 
STRING
 
cÚfig_Çme
, STRING* 
cÚfig_v®ue_±r
);

21 
modify_cÚfig
(
LIST_HANDLE
 
‹xt_hªdË
, 
STRING
 
cÚfig_Çme
, STRING 
cÚfig_v®ue
);

	@include\libtype.h

1 #iâdeà
_DATATYPE


2 
	#_DATATYPE


	)

11 #iâdeà
WINDOWS_OS


12 
	#WINDOWS_OS


	)

21 #iâdeà
OSI_ERROR


22 
	#OSI_ERROR
 -1

	)

25 #iâdeà
OSI_OK


26 
	#OSI_OK
 0

	)

30 #iâdeà
TYPE_UINT8


31 
	#TYPE_UINT8


	)

32 
	tUINT8
;

34 #iâdeà
TYPE_UINT16


35 
	#TYPE_UINT16


	)

36 
	tUINT16
;

39 #iâdeà
TYPE_UINT32


40 
	#TYPE_UINT32


	)

41 
	tUINT32
;

44 #iâdeà
TYPE_ULONG


45 
	#TYPE_ULONG


	)

46 
	tULONG
;

49 #iâdeà
TYPE_INT8


50 
	#TYPE_INT8


	)

51 
	tINT8
;

54 #iâdeà
TYPE_INT16


55 
	#TYPE_INT16


	)

56 
	tINT16
;

59 #iâdeà
TYPE_INT32


60 
	#TYPE_INT32


	)

61 
	tINT32
;

64 #iâdeà
TYPE_INT


65 
	#TYPE_INT


	)

66 
	tINT
;

69 #iâdeà
TYPE_UINT


70 
	#TYPE_UINT


	)

71 
	tUINT
;

74 #iâdeà
TYPE_PUINT8


75 
	#TYPE_PUINT8


	)

76 * 
	tPUINT8
;

79 #iâdeà
TYPE_PUINT


80 
	#TYPE_PUINT


	)

81 * 
	tPUINT
;

84 #iâdeà
TYPE_PINT


85 
	#TYPE_PINT


	)

86 * 
	tPINT
;

89 #iâdeà
TYPE_PVOID


90 
	#TYPE_PVOID


	)

91 * 
	tPVOID
;

94 #iâdeà
TYPE_USHORT


95 
	#TYPE_USHORT


	)

96 
	tUSHORT
;

98 * 
	tSTRING
;

99 
UINT8
 * 
	tUSTRING
;

100 ’um {
	mF®£
,
	mTrue
} 
	tLOGICAL
;

105 
	my—r
;

106 
	mmÚth
;

107 
	mday
;

108 
	mw“k
;

109 
	mhour
;

110 
	mmšu‹
;

111 
	m£cÚd
;

112 }
	tDATE_TIME_REP
,*
	tDATE_TIME_REP_PTR
;

116 
DATE_TIME_REP
 
	mS¹D©eTime
;

117 
DATE_TIME_REP
 
	mStİD©eTime
;

118 }
	tDATE_TIME_SEGMENT
,*
	tDATE_TIME_SEGMENT_PTR
;

123 
ULONG
 
	mtv_£c
;

124 
ULONG
 
	mtv_u£c
;

125 }
	tTIME_INTERVAL
,*
	tTIME_INTERVAL_PTR
;

	@include\list.h

20 #iâdeà
_LIST_METHOD


21 
	#_LIST_METHOD


	)

23 
	~"libty³.h
"

25 
	#LIST_HEAD_TYPE
 1

	)

26 
	#LIST_NODE_TYPE
 2

	)

28 
	#READ_PERMISSION_TAG
 0

	)

29 
	#WRITE_PERMISSION_TAG
 1

	)

31 
	#LIST_PERMISSION_DENY
 -2

	)

33 #iâdeà
OSI_ERROR


34 
	#OSI_ERROR
 -1

	)

37 #iâdeà
OSI_OK


38 
	#OSI_OK
 0

	)

41 #iâdeà
NULL


42 
	#NULL
 ((*è0)

	)

45 * 
	tLIST_HANDLE
;

57 
LIST_HANDLE
 
C»©eHªdË
(
HªdËTy³
);

69 
D–‘eHªdË
(
LIST_HANDLE
 
hªdË
);

84 
In™Ÿlize
(

85 
LIST_HANDLE
 
hªdË
,

86 
CmpFúAmouÁ
,

87 ** 
CmpFúA¼ay


98 
CouÁ
(
LIST_HANDLE
 
hªdË
);

111 
IsEm±y
(
LIST_HANDLE
 
H—dHªdË
);

133 
FšdSW
(

134 
LIST_HANDLE
 
H—dHªdË
,

135 ** 
KeyWÜdPŒA¼ay
,

136 
CmpFúIndex
,

137 
LIST_HANDLE
 
NodeHªdË
,

138 
P”missiÚTag
,

139 * 
U£rD©a


165 
FšdMW
(

166 
LIST_HANDLE
 
H—dHªdË
,

167 ** 
KeyWÜdPŒA¼ay
,

168 
CmpFúIndex
,

169 
LIST_HANDLE
 
NodeHªdË
,

170 
P”missiÚTag
,

171 ** 
U£rD©aA¼ay


192 
FšdNodeNum
(

193 
LIST_HANDLE
 
H—dHªdË
,

194 
IndexNum
,

195 
LIST_HANDLE
 
NodeHªdË
,

196 
P”missiÚTag


213 
In£¹NodeH—d
(
LIST_HANDLE
 
hªdË
,
D©aL’gth
,* 
D©aPŒ
);

231 
	#INSERT_BEFORE_NODE
 0

	)

232 
	#INSERT_AFTER_NODE
 1

	)

233 
In£¹NodeHªdË
Ğ
LIST_HANDLE
 
H—dHªdË
,

234 
LIST_HANDLE
 
PosiNodeHªdË
,

235 
In£¹Pos™iÚ
,

236 
D©aL’gth
, * 
D©aPŒ
 );

256 
D–‘eNodeSW
(

257 
LIST_HANDLE
 
H—dHªdË
,

258 ** 
KeyWÜdPŒA¼ay
,

259 
CmpFúIndex
,

260 ** 
D–NodeD©aPŒ


282 
D–‘eNodeMW
(

283 
LIST_HANDLE
 
H—dHªdË
,

284 ** 
KeyWÜdPŒA¼ay
,

285 
CmpFúIndex
,

286 ** 
D–NodeD©aPŒ


302 
D–‘eNodes
Ğ
LIST_HANDLE
 
hªdË
 );

320 
D–‘e
(
LIST_HANDLE
 
hªdË
);

335 
R–—£P”missiÚ
(
LIST_HANDLE
 
NodeHªdË
,
P”missiÚTag
);

348 
PrštP”missiÚ
(
LIST_HANDLE
 
NodeHªdË
);

370 
G‘P”misssiÚ
(
LIST_HANDLE
 
NodeHªdË
,
P”missiÚTag
);

383 * 
G‘D©a
Ğ
LIST_HANDLE
 
NodeHªdË
 );

412 
G‘NextNode
(

413 
LIST_HANDLE
 
H—dHªdË
,

414 
LIST_HANDLE
 
Cu¼’tHªdË
,

415 
LIST_HANDLE
 
NextHªdË
,

416 
SkTag
,

417 
P”missiÚTag


446 
G‘P»viousNode
(

447 
LIST_HANDLE
 
H—dHªdË
,

448 
LIST_HANDLE
 
Cu¼’tHªdË
,

449 
LIST_HANDLE
 
P»viousHªdË
,

450 
SkTag
,

451 
P”missiÚTag


464 
G‘D©aL’
(
LIST_HANDLE
 
hªdË
);

477 
LOGICAL
 
IsHªdËEm±y
(
LIST_HANDLE
 
hªdË
);

492 
HªdËCpy
(
LIST_HANDLE
 
DesHªdË
,cÚ¡ LIST_HANDLE 
SrcHªdË
);

	@include\mgconfig.h

1 #iâdeà
MGCONFIG


2 
	#MGCONFIG


	)

14 
	#WINDOWS


	)

16 
	#GUI_SCREEN_NUM
 0

	)

17 
	#MG_ROOT_PATH
 "..\\..\\..\\»sourûs\\"

	)

18 
	#MG_ROOT_PATH_LEN
 100

	)

	@include\mgosi.h

9 #iâdeà
_OSI_HEAD_FILE


10 
	#_OSI_HEAD_FILE


	)

12 
	~"libty³.h
"

14 * 
	tOSI_LIB_HANDLE
;

19 
	#OSI_SEM_Q_PRIORITY
 (0x1)

	)

20 
	#OSI_SEM_Q_FIFO
 (0x0)

	)

21 
	#OSI_SEM_DELETE_SAFE
 (0x4)

	)

22 
	#OSI_SEM_INVERSION_SAFE
 (0x8)

	)

23 
	#OSI_SEM_EVENTSEND_ERR_NOTIFY
 (0x10)

	)

24 
	#OSI_WAIT_FOREVER
 (-1)

	)

26 
	#OSI_MSG_Q_FIFO
 (0x00)

	)

27 
	#OSI_MSG_Q_PRIORITY
 (0x01)

	)

28 
	#OSI_MSG_Q_EVENTSEND_ERR_NOTIFY
 (0x02)

	)

29 
	#OSI_NO_WAIT
 (0)

	)

30 
	#OSI_MSG_PRI_NORMAL
 (0)

	)

31 
	#OSI_MSG_PRI_URGENT
 (1)

	)

33 #ifdeà
WINDOWS_OS


34 
	~<Wšdows.h
>

35 
HANDLE
 
	tWIN_HANDLE
;

38 
WIN_HANDLE
 
	mR—dEÇbËHªdË
;

39 
WIN_HANDLE
 
	mWr™eEÇbËHªdË
;

40 
DWORD
 
	mR—dTimeout
;

41 
DWORD
 
	mWr™eTimeout
;

43 
UINT32
 
	mH—dIndex
;

44 
UINT32
 
	mR—rIndex
;

45 
UINT32
 
	mMsgL’gth
;

46 * 
	mMsgBufãr
;

47 }
	tMSG_HANDLE_ENTRY
,*
	tMSG_HANDLE_ENTRY_PTR
;

54 #ifdeà
VXWORKS_OS


55 
	~<msgQLib.h
>

56 
	~<£mLib.h
>

57 
	~<skLib.h
>

60 #ifdeà
LINUX_OS


61 
	~<±h»ad.h
>

62 
	~<sys/ty³s.h
>

63 
	~<sys/c.h
>

64 
	~<sys/msg.h
>

67 
OSI_LIB_HANDLE
 
msg_queue_ü—‹
(

68 
MaxMSGs
,

69 
MaxMsgL’gth
,

70 
İtiÚs


73 
msg_£nd
(

74 
OSI_LIB_HANDLE
 
MsgQHªdË
,

75 
UINT8
* 
bufãr
,

76 
UINT32
 
MsgL’gth
,

77 
DWORD
 
timeout
,

78 
´iÜ™y


81 
msg_»ûive
(

82 
OSI_LIB_HANDLE
 
MsgQHªdË
,

83 
UINT8
* 
bufãr
,

84 
UINT32
 
MsgL’gth
,

85 
DWORD
 
timeout


88 
msg_queue_d–‘e
(

89 
OSI_LIB_HANDLE
 
MsgQHªdË


92 
UINT32
 
msg_queue_cÚš
(
OSI_LIB_HANDLE
 
MgMsgHªdË
);

94 
UINT32
 
msg_queue_ÿ·c™y
(
OSI_LIB_HANDLE
 
MgMsgHªdË
);

99 
OSI_LIB_HANDLE
 
mu‹x_ü—‹
(

100 
İtiÚ


102 
mu‹x_lock
(

103 
OSI_LIB_HANDLE
 
MgCr™iÿlSeùiÚHªdË
,

104 
DWORD
 
timeout


106 
mu‹x_uÆock
(

107 
OSI_LIB_HANDLE
 
MgCr™iÿlSeùiÚHªdË


109 
mu‹x_d–‘e
(
OSI_LIB_HANDLE
 
MgCr™iÿlSeùiÚHªdË
);

118 
OSI_LIB_HANDLE
 
sk_ü—‹
(

126 * 
TaskId
,

127 
PriÜ™y
,

141 
O±iÚs
,

142 
SckSize
,

143 * 
FúPŒ
,

144 * 
P¬am‘”s


147 
sk_d–‘e
(

148 
OSI_LIB_HANDLE
 
MgTaskHªdË


164 
sk_d–‘e_fÜû
(
OSI_LIB_HANDLE
 
MgTaskHªdË
);

167 
sk_¦“p
(

168 
DWORD
 
dwtime


	@include\osi\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@include\osi\pthreadWrap.h

11 #iâdeà
_PTHREADWRAP_H


12 
	#_PTHREADWRAP_H


	)

14 
	~<¡d¬g.h
>

15 
	~<±h»ad.h
>

16 
	~<mqueue.h
>

17 
	~<£m­hÜe.h
>

19 #ifdeà
__ılu¥lus


27 
	s__±h»ad_©Œ_s


29 
__d‘ach¡©e
;

30 
__schedpŞicy
;

31 
__sched_·¿m
 
__sched·¿m
;

32 
__šh”™sched
;

33 
__scİe
;

34 
size_t
 
__gu¬dsize
;

35 
__¡ackaddr_£t
;

36 *
__¡ackaddr
;

37 
size_t
 
__¡acksize
;

38 } 
	t±h»ad_©Œ_t
;

43 
	ssched_·¿m


45 
	m__sched_´iÜ™y
;

49 
	#NO_WAIT
 0

	)

50 
	#WAIT_FOREVER
 (-1)

	)

53 
±h»adS·wn
(
±h»ad_t
 *
±id
, 
´iÜ™y
, 
size_t
 
¡acksize
, *
funıŒ
, 
¬gs
, ...);

54 
Pth»ad_£lf
();

55 
Pth»ad_equ®
(
±h»ad_t
 
tid1
,…th»ad_ˆ
tid2
);

56 
Pth»ad_ÿnûl
(
±h»ad_t
 
tid
);

57 
Pth»ad_ex™
(*
v®ue
);

58 
Pth»ad_još
(
±h»ad_t
 
th»ad
, **
v®ue
);

60 
	#Pth»ad_ş—nup_push
(
routše
, 
¬gs
è
	`±h»ad_ş—nup_push
((*routše)(*), *¬gs)

	)

61 
	#Pth»ad_ş—nup_pİ
(
execu‹
è
	`±h»ad_ş—nup_pİ
(execu‹)

	)

62 
±h»adIdV”ify
(
±h»ad_t
 
tid
);

65 
Pth»ad_©Œ_£t
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
, 
size_t
 
¡acksize
);

66 
Pth»ad_©Œ_š™
(
±h»ad_©Œ_t
 *
©Œ
);

67 
Pth»ad_©Œ_de¡roy
(
±h»ad_©Œ_t
 *
©Œ
);

68 
Pth»ad_©Œ_g‘d‘ach¡©e
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
d‘ach¡©e
);

69 
Pth»ad_©Œ_£td‘ach¡©e
(
±h»ad_©Œ_t
 *
©Œ
, 
d‘ach¡©e
);

70 
Pth»ad_©Œ_g‘schedpŞicy
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
pŞicy
);

71 
Pth»ad_©Œ_£tschedpŞicy
(
±h»ad_©Œ_t
 *
©Œ
, 
pŞicy
);

72 
Pth»ad_©Œ_g‘sched·¿m
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
sched_·¿m
 * 
·¿m
);

73 
Pth»ad_©Œ_£tsched·¿m
(
±h»ad_©Œ_t
 *
©Œ
, cÚ¡ 
sched_·¿m
 *
·¿m
);

74 
Pth»ad_©Œ_g‘šh”™sched
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
šh”™sched
);

75 
Pth»ad_©Œ_£tšh”™sched
(
±h»ad_©Œ_t
 *
©Œ
, 
šh”™sched
);

76 
Pth»ad_©Œ_g‘sched´iÜ™y
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
´iÜ™y
);

77 
Pth»ad_©Œ_£tsched´iÜ™y
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
);

78 
Pth»ad_©Œ_g‘scİe
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
scİe
);

79 
Pth»ad_©Œ_£tscİe
(
±h»ad_©Œ_t
 *
©Œ
, 
scİe
);

80 
Pth»ad_©Œ_g‘¡acksize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
¡acksize
);

81 
Pth»ad_©Œ_£t¡acksize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
¡acksize
);

82 
Pth»ad_©Œ_g‘¡ackaddr
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, **
¡ackaddr
);

83 
Pth»ad_©Œ_£t¡ackaddr
(
±h»ad_©Œ_t
 *
©Œ
, *
¡ackaddr
);

84 
Pth»ad_©Œ_g‘gu¬dsize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
gu¬dsize
);

85 
Pth»ad_©Œ_£tgu¬dsize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
gu¬dsize
);

88 
Sched_g‘_´iÜ™y_mš
(
pŞicy
);

89 
Sched_g‘_´iÜ™y_max
(
pŞicy
);

90 
Sched_g‘scheduËr
(
pid_t
 
pid
);

91 
Sched_£tscheduËr
(
pid_t
 
pid
, 
pŞicy
, 
sched_·¿m
 *
·¿m
);

92 
Sched_g‘·¿m
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
);

93 
Sched_£¬am
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
);

94 
Sched_¼_g‘_š‹rv®
(
pid_t
 
pid
, 
time¥ec
 *

);

100 
Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *
mu‹x
);

101 
Pth»ad_mu‹x_de¡roy
(
±h»ad_mu‹x_t
 *
mu‹x
);

102 
Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
);

103 
Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *
mu‹x
);

106 
	#SEM_EMPTY
 0

	)

107 
	#SEM_FULL
 1

	)

108 
Sem_š™
(
£m_t
 *
£m
, 
v®ue
);

109 
Sem_de¡roy
(
£m_t
 *
£m
);

110 
Sem_po¡
(
£m_t
 *
£m
);

111 
Sem_wa™
(
£m_t
 *
£m
, 
wa™_ms
);

114 
Pth»ad_rwlock_š™
(
±h»ad_rwlock_t
 *
rwlock
);

115 
Pth»ad_rwlock_de¡roy
(
±h»ad_rwlock_t
 *
rwlock
);

116 
Pth»ad_rwlock_rdlock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
);

117 
Pth»ad_rwlock_w¾ock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
);

118 
Pth»ad_rwlock_uÆock
(
±h»ad_rwlock_t
 *
rwlock
);

121 
Pth»ad_cÚd_š™
(
±h»ad_cÚd_t
 *
cÚd
);

122 
Pth»ad_cÚd_de¡roy
(
±h»ad_cÚd_t
 *
cÚd
);

123 
Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
);

124 
Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
);

125 
Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *
cÚd
);

126 
Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *
cÚd
);

130 
mqd_t
 
Mq_İ’
(cÚ¡ *
Çme
, 
oæag
, 
mode_t
 
mode
, 
mq_©Œ
 *
©Œ
);

131 
Mq_£nd
(
mqd_t
 
mqdes
, cÚ¡ *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, 
msg_´io
);

132 
ssize_t
 
Mq_»ûive
(
mqd_t
 
mqdes
, *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, *
msg_´io
);

133 
Mq_g‘©Œ
(
mqd_t
 
mqdes
, 
mq_©Œ
 *
mq¡©
);

134 
Mq_£‰r
(
mqd_t
 
mqdes
, cÚ¡ 
mq_©Œ
 *
mq¡©
, mq_©Œ *
omq¡©
);

135 
Mq_uÆšk
(cÚ¡ *
Çme
);

136 
Mq_şo£
(
mqd_t
 
mqdes
);

138 #ifdeà
__ılu¥lus


	@include\text.h

14 
	~"li¡.h
"

15 
	~"libty³.h
"

19 
STRING
 
	mkeywÜd
;

20 
	m³rmi_g
;

21 
LIST_HANDLE
 
	mlše_node_hªdË
;

22 
	mlše_num
;

23 
	mwÜd_šdex_begš
;

24 
	mwÜd_šdex_’d
;

25 }
	tMATCH_WORD_POSITION
,*
	tMATCH_WORD_POSITION_PTR
;

29 
	mlše_Ën
;

30 * 
	mlše_±r
;

31 }
	tLINE_NODE
,*
	tLINE_NODE_PTR
;

33 
LIST_HANDLE
 
»ad_‹xt
(
STRING
 
‹xt_f’ame
);

35 
fšd_keywÜd
(

36 
LIST_HANDLE
 
‹xt_hªdË
,

37 
STRING
 
keywÜd
,

38 
MATCH_WORD_POSITION_PTR
 
¡r_posi_±r
,

39 
³rmi_g


42 
fšd_lše_num
(

43 
LIST_HANDLE
 
‹xt_hªdË
,

44 
lše_num
,

45 
LIST_HANDLE
 
lše_node
,

46 
³rmi_g


49 
»¶aû_lše_num
(

50 
LIST_HANDLE
 
‹xt_hªdË
,

51 
lše_num
,

52 
STRING
 
Ãw_lše_¡r


55 
»¶aû_lše_kw
(

56 
LIST_HANDLE
 
‹xt_hªdË
,

57 
STRING
 
keywÜd
,

58 
STRING
 
Ãw_lše_¡r


61 
»¶aû_kw
(

62 
LIST_HANDLE
 
‹xt_hªdË
,

63 
STRING
 
keywÜd
,

64 
STRING
 
Ãw_¡ršg


67 
š£¹_lše
(

68 
LIST_HANDLE
 
‹xt_hªdË
,

69 
STRING
 
keywÜd
,

70 
STRING
 
šs_lše
,

71 
šs_posi


74 
‹xt_§ve
(

75 
STRING
 
cÚfig_f’ame
,

76 
LIST_HANDLE
 
‹xt_hªdË


	@include\tool.h

16 
	~"libty³.h
"

18 
g‘lše
(** 
lš•Œ
, * 
n
, 
FILE
* 
å
);

29 
fšd¡r
(* 
Üigš®_¡r
, * 
m©ch_¡r
);

34 
©omwr™e
(
fd
, * 
buf
, 
Ën
);

36 
¡rcm²
(cÚ¡ * 
s1
, cÚ¡ * 
s2
, 
n
);

38 * 
z”os
 (
n
);

40 
bez”os
 (
n
,* 
p
);

42 
¡rm©ch
 (
n
,
STRING
 
¡¿¼ay
[], STRING 
cs
);

44 
¡rcm¶ow
(cÚ¡ * 
s1
,cÚ¡ * 
s2
);

46 
low”
 (
c
);

47 
©om»ad
(
fd
,* 
buf
, 
Ën
);

48 
by‹_sum
(* 
buf
, 
Ën
);

49 
TCPLškToS”v”
(
ULONG
 
´eAddr
,
UINT16
 
pÜt
,
bufsize
);

50 
fšdch¬
(
c
, * 
¡r
, 
ÿ£_£ns™ive
);

52 #iâdeà
mš


53 
	#mš
(
a
, 
b
è(×è< (bè? (aè: (b))

	)

56 #iâdeà
max


57 
	#max
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

	@osi\debug\debug.c

11 
	~<¡dio.h
>

12 
	~<¡dlib.h
>

13 
	~<”ºo.h
>

14 
	~<¡d¬g.h
>

15 
	~<¡ršg.h
>

17 
	~"debug.h
"

19 
	#MAXLINE
 1024

	)

21 #undeà
DEBUG_VERSION


35 
	$debug_do™
(
bSysC®l
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

37 
”ºo_§ve
, 
n
;

38 
buf
[
MAXLINE
 + 1];

40 
”ºo_§ve
 = 
”ºo
;

42 
	`v¢´štf
(
buf
, 
MAXLINE
, 
fmt
, 
­
);

44 
n
 = 
	`¡¾’
(
buf
);

45 ià(
bSysC®l
 && (
”ºo_§ve
>0))

47 
	`¢´štf
(
buf
 + 
n
, 
MAXLINE
 -‚, ": (%d)%s", 
”ºo_§ve
, 
	`¡»¼Ü
(errno_save));

49 
	`¡rÿt
(
buf
, "\n");

51 
	`fæush
(
¡dout
);

52 
	`åuts
(
buf
, 
¡d”r
);

53 
	`fæush
(
¡d”r
);

56 
	}
}

70 
	$debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...)

72 
va_li¡
 
­
;

74 
debugLev–
)

76 
DEBUG_LEVEL_1
:

77 #ifdeà
DEBUG_VERSION


78 
	`va_¡¬t
(
­
, 
fmt
);

79 
	`debug_do™
(0, 
fmt
, 
­
);

80 
	`va_’d
(
­
);

84 
DEBUG_LEVEL_2
:

85 
	`va_¡¬t
(
­
, 
fmt
);

86 
	`debug_do™
(0, 
fmt
, 
­
);

87 
	`va_’d
(
­
);

90 
DEBUG_LEVEL_3
:

91 
	`va_¡¬t
(
­
, 
fmt
);

92 
	`debug_do™
(1, 
fmt
, 
­
);

93 
	`va_’d
(
­
);

96 
DEBUG_LEVEL_4
:

97 
	`va_¡¬t
(
­
, 
fmt
);

98 
	`debug_do™
(1, 
fmt
, 
­
);

99 
	`va_’d
(
­
);

101 #ifdeà
DEBUG_VERSION


102 
	`abÜt
();

103 
	`ex™
(1);

108 
	`´štf
("mismatch debugLevel!!!\n");

112 
	}
}

	@osi\debug\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@osi\ioApiWrap\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@osi\ioApiWrap\fileIoWrap.c

11 
	~"ioH—d”.h
"

23 
	$l£ek_g‘_off£t
(
fd
)

25 
rv®
;

27 if((
rv®
 = 
	`l£ek
(
fd
, 0, 
SEEK_CUR
)) == -1)

29 
	`”r_šfo_s
("% %d: g‘FeCu¼Off£ˆ”rÜ!\n", 
__FILE__
, 
__LINE__
);

32  
rv®
;

33 
	}
}

42 
	$l£ek_£t_off£t
(
fd
, 
off£t
)

44 
rv®
;

46 if((
rv®
 = 
	`l£ek
(
fd
, 
off£t
, 
SEEK_SET
)) == -1)

48 
	`”r_šfo_s
("% %d:†oÿ‹FeOff£ˆ”rÜ!\n", 
__FILE__
, 
__LINE__
);

51  
rv®
;

52 
	}
}

61 
	$l£ek_h—d
(
fd
)

63 
rv®
;

65 if((
rv®
 = 
	`l£ek
(
fd
, 0, 
SEEK_SET
)) == -1)

67 
	`”r_šfo_s
("% %d:†oÿ‹FeH—d”ƒ¼Ü!\n", 
__FILE__
, 
__LINE__
);

70  
rv®
;

71 
	}
}

80 
	$l£ek_’d
(
fd
)

82 
rv®
;

84 if((
rv®
 = 
	`l£ek
(
fd
, 0, 
SEEK_END
)) == -1)

86 
	`”r_šfo_s
("% %d:†oÿ‹FeEndƒ¼Ü!\n", 
__FILE__
, 
__LINE__
);

89  
rv®
;

90 
	}
}

	@osi\ioApiWrap\ioApiWrap.h

11 #iâdeà
_IO_API_WRAP_H


12 
	#_IO_API_WRAP_H


	)

14 #ifdeà
__ılu¥lus


20 
l£ek_g‘_off£t
(
fd
);

21 
l£ek_h—d
(
fd
);

22 
l£ek_’d
(
fd
);

23 
l£ek_£t_off£t
(
fd
, 
off£t
);

25 #ifdeà
__ılu¥lus


	@osi\ioApiWrap\ioHeader.h

11 
	~<¡dio.h
>

12 
	~<uni¡d.h
>

13 
	~<¡ršg.h
>

14 
	~<”ºo.h
>

15 
	~<sys/time.h
>

16 
	~<sys/ty³s.h
>

18 
	~"debug.h
"

	@osi\ioApiWrap\stdIoWrap.c

	@osi\mgosi.c

10 
	~<¡dio.h
>

11 
	~<¡dlib.h
>

12 
	~"mgosi.h
"

18 
OSI_LIB_HANDLE
 
	$msg_queue_ü—‹
(

19 
MaxMSGs
,

20 
MaxMsgL’gth
,

21 
İtiÚs


25 #ifdeà
WINDOWS_OS


26 
MSG_HANDLE_ENTRY_PTR
 
MsgHªdËEÁryPŒ
;

29 ià((
MsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)

30 
	`m®loc
((
MSG_HANDLE_ENTRY
)))==
NULL
)

32 
”r
;

35 ià((
MsgHªdËEÁryPŒ
->
R—dEÇbËHªdË
=
	`C»©eEv’t
(

36 
NULL
,

37 
TRUE
,

38 
FALSE
,

39 
NULL


40 ))==
NULL
)

42 
	`´štf
("C»©eEv’ˆçed (%d)\n", 
	`G‘La¡E¼Ü
());

43 
	`ä“
(
MsgHªdËEÁryPŒ
);

44  
NULL
;

47 ià((
MsgHªdËEÁryPŒ
->
Wr™eEÇbËHªdË
=
	`C»©eEv’t
(

48 
NULL
,

49 
TRUE
,

50 
TRUE
,

51 
NULL


52 ))==
NULL
)

54 
	`´štf
("C»©eEv’ˆçed (%d)\n", 
	`G‘La¡E¼Ü
());

55 
	`ä“
(
MsgHªdËEÁryPŒ
);

56  
NULL
;

58 
MsgHªdËEÁryPŒ
->
R—dTimeout
=
INFINITE
;

59 
MsgHªdËEÁryPŒ
->
Wr™eTimeout
=0;

60 
MsgHªdËEÁryPŒ
->
MsgL’gth
=
MaxMsgL’gth
*
MaxMSGs
+1;

61 
MsgHªdËEÁryPŒ
->
H—dIndex
=0;

62 
MsgHªdËEÁryPŒ
->
R—rIndex
=0;

64 ià((
MsgHªdËEÁryPŒ
->
MsgBufãr
=

65 
	`m®loc
(
MsgHªdËEÁryPŒ
->
MsgL’gth
))==
NULL
)

67 
”r
;

69  (
OSI_LIB_HANDLE
)
MsgHªdËEÁryPŒ
;

70 
”r
:

71 
	`´štf
("Memory†imited!\n");

72  
NULL
;

75 #ifdeà
VXWORKS_OS


76  (
OSI_LIB_HANDLE
è
	`msgQC»©e
(
MaxMSGs
,
MaxMsgL’gth
,
İtiÚs
);

79 #ifdeà
LINUX_OS


80 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

81  
OSI_ERROR
;

83 
	}
}

86 
LOGICAL
 
	$mgIsQEm±y
(
OSI_LIB_HANDLE
 
MgMsgHªdË
)

88 #ifdeà
WINDOWS_OS


89 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

91 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MgMsgHªdË
;

92  
MgMsgHªdËEÁryPŒ
->
H—dIndex
==MgMsgHªdËEÁryPŒ->
R—rIndex
;

95 #ifdeà
VXWORKS_OS


96  
	`msgQNumMsgs
((
MSG_Q_ID
)
MgMsgHªdË
)==0;

99 #ifdeà
LINUX_OS


100 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

101  
OSI_ERROR
;

104 
	}
}

107 
LOGICAL
 
	$is_msg_queue_fuÎ
(
OSI_LIB_HANDLE
 
MgMsgHªdË
)

110 #ifdeà
WINDOWS_OS


111 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

112 
UINT32
 
R—rIndex
,
H—dIndex
,
MsgL’gth
;

114 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MgMsgHªdË
;

115 
R—rIndex
=
MgMsgHªdËEÁryPŒ
->RearIndex;

116 
H—dIndex
=
MgMsgHªdËEÁryPŒ
->HeadIndex;

117 
MsgL’gth
=
MgMsgHªdËEÁryPŒ
->MsgLength;

118  ((
R—rIndex
+1)%
MsgL’gth
)==
H—dIndex
%MsgLength;

121 #ifdeà
VXWORKS_OS


122  
OSI_OK
;

125 #ifdeà
LINUX_OS


126 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

127  
OSI_ERROR
;

129 
	}
}

132 
UINT32
 
	$msg_queue_cÚš
(
OSI_LIB_HANDLE
 
MgMsgHªdË
)

135 #ifdeà
WINDOWS_OS


136 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

137 
UINT32
 
R—rIndex
,
H—dIndex
,
MsgL’gth
;

139 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MgMsgHªdË
;

140 
MsgL’gth
=
MgMsgHªdËEÁryPŒ
->MsgLength;

141 
R—rIndex
=
MgMsgHªdËEÁryPŒ
->R—rIndex%
MsgL’gth
;

142 
H—dIndex
=
MgMsgHªdËEÁryPŒ
->H—dIndex%
MsgL’gth
;

143 ià(
R—rIndex
>=
H—dIndex
)

145  
R—rIndex
-
H—dIndex
;

149  
MsgL’gth
-(
H—dIndex
-
R—rIndex
);

153 #ifdeà
VXWORKS_OS


154  
	`msgQNumMsgs
((
MSG_Q_ID
)
MgMsgHªdË
);

157 #ifdeà
LINUX_OS


158 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

159  
OSI_ERROR
;

162 
	}
}

165 
UINT32
 
	$msg_queue_ÿ·c™y
(
OSI_LIB_HANDLE
 
MgMsgHªdË
)

167 #ifdeà
WINDOWS_OS


168 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

169 
UINT32
 
R—rIndex
,
H—dIndex
,
MsgL’gth
;

171 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MgMsgHªdË
;

172 
MsgL’gth
=
MgMsgHªdËEÁryPŒ
->MsgLength;

173 
R—rIndex
=
MgMsgHªdËEÁryPŒ
->R—rIndex%
MsgL’gth
;

174 
H—dIndex
=
MgMsgHªdËEÁryPŒ
->H—dIndex%
MsgL’gth
;

176 ià(
R—rIndex
>=
H—dIndex
)

178  
MsgL’gth
-1-(
R—rIndex
-
H—dIndex
);

182  (
H—dIndex
-
R—rIndex
)-1;

186 #ifdeà
VXWORKS_OS


187 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

188  
OSI_ERROR
;

191 #ifdeà
LINUX_OS


192 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

193  
OSI_ERROR
;

196 
	}
}

200 
	$msg_£nd
(

201 
OSI_LIB_HANDLE
 
MsgQHªdË
,

202 
UINT8
* 
bufãr
,

203 
UINT32
 
MsgL’gth
,

204 
DWORD
 
timeout
,

205 
´iÜ™y


208 #ifdeà
WINDOWS_OS


209 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

210 
UINT8
* 
msgbufãr
;

211 
UINT32
 
i
=0;

212 
DWORD
 
Wa™R‘uº
;

213 
UINT32
 
MsgMaxL’
,
ÿ·c™y
;

215 ià(
MsgQHªdË
==
NULL
 || 
bufãr
==NULL)

217  
OSI_ERROR
;

220 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MsgQHªdË
;

221 
MgMsgHªdËEÁryPŒ
->
Wr™eTimeout
=
timeout
;

222 
msgbufãr
=(
UINT8
*)
MgMsgHªdËEÁryPŒ
->
MsgBufãr
;

223 
MsgMaxL’
=
MgMsgHªdËEÁryPŒ
->
MsgL’gth
;

225 
MsgL’gth
)

227 ià(
	`msg_queue_ÿ·c™y
(
MsgQHªdË
)<
MsgL’gth
)

230 
	`S‘Ev’t
(
MgMsgHªdËEÁryPŒ
->
R—dEÇbËHªdË
);

232 
	`Re£tEv’t
(
MgMsgHªdËEÁryPŒ
->
Wr™eEÇbËHªdË
);

234 
Wa™R‘uº
=
	`Wa™FÜSšgËObjeù
(
MgMsgHªdËEÁryPŒ
->
Wr™eEÇbËHªdË


235 ,
MgMsgHªdËEÁryPŒ
->
Wr™eTimeout
);

236 
Wa™R‘uº
)

245 
WAIT_ABANDONED
:

246  
OSI_ERROR
;

251 
WAIT_OBJECT_0
:

257 
WAIT_TIMEOUT
:

258  
OSI_ERROR
;

266 
MgMsgHªdËEÁryPŒ
->
R—rIndex
%=
MsgMaxL’
;

268 
msgbufãr
[
MgMsgHªdËEÁryPŒ
->
R—rIndex
++]=
bufãr
[
i
++];

269 
MsgL’gth
--;

271 
	`S‘Ev’t
(
MgMsgHªdËEÁryPŒ
->
R—dEÇbËHªdË
);

276  
OSI_OK
;

279 #ifdeà
VXWORKS_OS


280 
¡©us
;

282 
¡©us
=
	`msgQS’d
(

283 (
MSG_Q_ID
)
MsgQHªdË
,

284 
bufãr
,

285 
MsgL’gth
,

286 
timeout
,

287 
´iÜ™y


289  
¡©us
;

292 #ifdeà
LINUX_OS


293 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

294  
OSI_ERROR
;

296 
	}
}

299 
	$msg_»ûive
(

300 
OSI_LIB_HANDLE
 
MsgQHªdË
,

301 
UINT8
* 
bufãr
,

302 
UINT32
 
MsgL’gth
,

303 
DWORD
 
timeout


307 #ifdeà
WINDOWS_OS


308 
MSG_HANDLE_ENTRY_PTR
 
MgMsgHªdËEÁryPŒ
;

309 
UINT8
* 
msgbufãr
;

310 
UINT32
 
i
=0;

311 
DWORD
 
R—dR‘uº
;

312 
UINT32
 
MsgQL’
;

314 ià(
MsgQHªdË
==
NULL
 || 
bufãr
==NULL)

316  
OSI_ERROR
;

318 
MgMsgHªdËEÁryPŒ
=(
MSG_HANDLE_ENTRY_PTR
)
MsgQHªdË
;

319 
MgMsgHªdËEÁryPŒ
->
R—dTimeout
=
timeout
;

320 
msgbufãr
=(
UINT8
*)
MgMsgHªdËEÁryPŒ
->
MsgBufãr
;

321 
MsgQL’
=
MgMsgHªdËEÁryPŒ
->
MsgL’gth
;

322 
MsgL’gth
)

324 ià(
	`msg_queue_cÚš
(
MsgQHªdË
)<
MsgL’gth
)

327 
	`S‘Ev’t
(
MgMsgHªdËEÁryPŒ
->
Wr™eEÇbËHªdË
);

329 
	`Re£tEv’t
(
MgMsgHªdËEÁryPŒ
->
R—dEÇbËHªdË
);

330 
R—dR‘uº
=
	`Wa™FÜSšgËObjeù
(
MgMsgHªdËEÁryPŒ
->
R—dEÇbËHªdË


331 ,
MgMsgHªdËEÁryPŒ
->
R—dTimeout
);

332 
R—dR‘uº
)

341 
WAIT_ABANDONED
:

342  
OSI_ERROR
;

347 
WAIT_OBJECT_0
:

353 
WAIT_TIMEOUT
:

354  
OSI_ERROR
;

363 
MgMsgHªdËEÁryPŒ
->
H—dIndex
%=
MsgQL’
;

365 
bufãr
[
i
++]=
msgbufãr
[
MgMsgHªdËEÁryPŒ
->
H—dIndex
];

366 
MgMsgHªdËEÁryPŒ
->
H—dIndex
++;

367 
MsgL’gth
--;

369 
	`S‘Ev’t
(
MgMsgHªdËEÁryPŒ
->
Wr™eEÇbËHªdË
);

373  
OSI_OK
;

376 #ifdeà
VXWORKS_OS


377 
¡©us
;

379 
¡©us
=
	`msgQReûive
(

380 (
MSG_Q_ID
)
MsgQHªdË
,

381 
bufãr
,

382 
MsgL’gth
,

383 
timeout


385  
¡©us
;

388 #ifdeà
LINUX_OS


389 
	`´štf
("This function is‚ot yet‡vailable Linux!\n");

390  
OSI_ERROR
;

392 
	}
}

403 
OSI_LIB_HANDLE
 
	$mu‹x_ü—‹
(

404 
İtiÚ


407 #ifdeà
WINDOWS_OS


408 
LPCRITICAL_SECTION
 
MgCr™iÿlSeùiÚHªdË
;

410 ià((
MgCr™iÿlSeùiÚHªdË
=(
LPCRITICAL_SECTION
)

411 
	`m®loc
((
CRITICAL_SECTION
)))==
NULL
)

413 
	`´štf
("Memory†imited!\n");

414  
NULL
;

416 
	`In™ŸlizeCr™iÿlSeùiÚ
(
MgCr™iÿlSeùiÚHªdË
);

418  (
OSI_LIB_HANDLE
)
MgCr™iÿlSeùiÚHªdË
;

421 #ifdeà
VXWORKS_OS


422  (
OSI_LIB_HANDLE
)
	`£mMC»©e
(
İtiÚ
);

425 #ifdeà
LINUX_OS


426 
±h»ad_mu‹x_t
* 
posix_mu‹x
;

427 
mu‹x_t
 
mu‹x
;

429 
posix_mu‹x
=
	`m®loc
((
±h»ad_mu‹x_t
));

430 ià(
posix_mu‹x
==
NULL
)

432  
OSI_ERROR
;

435 
mu‹x
=(
mu‹x_t
)
posix_mu‹x
;

437 ià(
	`±h»ad_mu‹x_š™
((
±h»ad_mu‹x_t
*)
mu‹x
,(
±h»ad_mu‹x©Œ_t
*è
İtiÚ
)!=
OSI_OK
)

439  
OSI_ERROR
;

442  (
OSI_LIB_HANDLE
)
mu‹x
;

445 
	}
}

447 
	$mu‹x_lock
(

448 
OSI_LIB_HANDLE
 
mu‹x_hªdË
,

449 
DWORD
 
timeout


452 #ifdeà
WINDOWS_OS


453 
	`EÁ”Cr™iÿlSeùiÚ
((
LPCRITICAL_SECTION
)
mu‹x_hªdË
);

456 #ifdeà
VXWORKS_OS


457 
	`£mTake
((
SEM_ID
)
mu‹x_hªdË
,
timeout
);

460 #ifdeà
LINUX_OS


461 
	`±h»ad_mu‹x_lock
((
±h»ad_mu‹x_t
*)
mu‹x_hªdË
);

464 
	}
}

466 
	$mu‹x_uÆock
(
OSI_LIB_HANDLE
 
mu‹x_hªdË
)

468 #ifdeà
WINDOWS_OS


469 
	`L—veCr™iÿlSeùiÚ
((
LPCRITICAL_SECTION
)
mu‹x_hªdË
);

472 #ifdeà
VXWORKS_OS


473 
	`£mGive
((
SEM_ID
)
mu‹x_hªdË
);

476 #ifdeà
LINUX_OS


477 
	`±h»ad_mu‹x_uÆock
((
±h»ad_mu‹x_t
*)
mu‹x_hªdË
);

479 
	}
}

482 
	$mu‹x_d–‘e
(
OSI_LIB_HANDLE
 
mu‹x_hªdË
)

484 #ifdeà
WINDOWS_OS


485 
	`D–‘eCr™iÿlSeùiÚ
((
LPCRITICAL_SECTION
)
mu‹x_hªdË
);

488 #ifdeà
VXWORKS_OS


489 
	`£mD–‘e
((
SEM_ID
)
mu‹x_hªdË
);

492 #ifdeà
LINUX_OS


493 
	`±h»ad_mu‹x_de¡roy
((
±h»ad_mu‹x_t
*)
mu‹x_hªdË
);

496 
	}
}

509 
OSI_LIB_HANDLE
 
	$sk_ü—‹
(

517 * 
TaskId
,

518 
PriÜ™y
,

532 
O±iÚs
,

533 
SckSize
,

534 * 
FúPŒ
,

535 * 
P¬am‘”s


539 #ifdeà
WINDOWS_OS


540 
WIN_HANDLE
 
WšTh»adHªdË
;

542 
WšTh»adHªdË
=
	`C»©eTh»ad
(

543 
NULL
,

544 
SckSize
,

545 (
LPTHREAD_START_ROUTINE
)
FúPŒ
,

546 
P¬am‘”s
,

547 
O±iÚs
,

548 
NULL


550 
	`S‘Th»adPriÜ™y
(
WšTh»adHªdË
,
PriÜ™y
);

551  (
OSI_LIB_HANDLE
)
WšTh»adHªdË
;

554 #ifdeà
VXWORKS_OS


555 
¬gi
,
vxWÜksTaskID
;

557 
¬gi
=()
P¬am‘”s
;

558 
vxWÜksTaskID
=
	`skS·wn
(

559 (*)
TaskId
,

560 
PriÜ™y
,

561 
O±iÚs
,

562 
SckSize
,

563 
FúPŒ
,

564 
¬gi
,0,0,0,0,0,0,0,0,0

566  
vxWÜksTaskID
;

569 #ifdeà
LINUX_OS


573 
	}
}

576 
	$sk_d–‘e
(

577 
OSI_LIB_HANDLE
 
MgTaskHªdË


580 #ifdeà
WINDOWS_OS


581 
DWORD
 
Ex™Code
;

582 
WIN_HANDLE
 
WšTh»adHªdË
;

584 
WšTh»adHªdË
=(
WIN_HANDLE
)
MgTaskHªdË
;

585 ià(
	`G‘Ex™CodeTh»ad
(
WšTh»adHªdË
,&
Ex™Code
)==0)

587  
OSI_ERROR
;

589 
	`Ex™Th»ad
(
Ex™Code
);

590  
OSI_OK
;

593 #ifdeà
VXWORKS_OS


594 
¡©us
;

596 
¡©us
=
	`skD–‘e
(
MgTaskHªdË
);

597  
¡©us
;

600 #ifdeà
LINUX_OS


604 
	}
}

615 
	$sk_d–‘e_fÜû
(
OSI_LIB_HANDLE
 
MgTaskHªdË
)

617 #ifdeà
WINDOWS_OS


618 
DWORD
 
Ex™Code
;

619 
WIN_HANDLE
 
WšTh»adHªdË
;

621 
WšTh»adHªdË
=(
WIN_HANDLE
)
MgTaskHªdË
;

622 ià(
	`G‘Ex™CodeTh»ad
(
WšTh»adHªdË
,&
Ex™Code
)==0)

624  
OSI_ERROR
;

626 ià(
	`T”mš©eTh»ad
(
WšTh»adHªdË
,
Ex™Code
)==0)

628  
OSI_ERROR
;

630  
OSI_OK
;

633 #ifdeà
VXWORKS_OS


634 
¡©us
;

636 
¡©us
=
	`skD–‘eFÜû
(
MgTaskHªdË
);

637  
¡©us
;

640 #ifdeà
LINUX_OS


644 
	}
}

646 
	$sk_¦“p
(

647 
DWORD
 
dwtime


654 #ifdeà
WINDOWS_OS


655 
	`SË•
(
dwtime
);

658 #ifdeà
VXWORKS_OS


659 
	`skD–ay
(
dwtime
);

662 #ifdeà
LINUX_OS


666 
	}
}

	@osi\netApiWrap\dataType.h

11 #iâdeà
_DATATYPE_H


12 
	#_DATATYPE_H


	)

14 #ifdeà
__ılu¥lus


19 #iâdeà
FOREVER


20 
	#FOREVER
 ;;)

	)

23 #iâdeà
NULL


24 
	#NULL
 0

	)

27 #iâdeà
ERROR


28 
	#ERROR
 -1

	)

31 #iâdeà
OK


32 
	#OK
 0

	)

36 #iâdeà
TRUE


37 
	#TRUE
 1

	)

40 #iâdeà
FALSE


41 
	#FALSE
 0

	)

44 #iâdeà
HIK_TYPE_ERR


45 
	#HIK_TYPE_ERR


	)

46 
	tERR
;

50 #iâdeà
HIK_TYPE_VOID


51 
	#HIK_TYPE_VOID


	)

52 
	tVOID
;

55 #iâdeà
HIK_TYPE_BYTE


56 
	#HIK_TYPE_BYTE


	)

57 
	tBYTE
;

60 #iâdeà
HIK_TYPE_UCHAR


61 
	#HIK_TYPE_UCHAR


	)

62 
	tUCHAR
;

65 #iâdeà
HIK_TYPE_BOOL


66 
	#HIK_TYPE_BOOL


	)

69 
	mF®£
 = 0,

70 
	mTrue
 = 1,

71 }
	tBOOL
;

74 #iâdeà
HIK_TYPE_UINT8


75 
	#HIK_TYPE_UINT8


	)

76 
	tUINT8
;

79 #iâdeà
HIK_TYPE_UINT16


80 
	#HIK_TYPE_UINT16


	)

81 
	tUINT16
;

84 #iâdeà
HIK_TYPE_UINT32


85 
	#HIK_TYPE_UINT32


	)

86 
	tUINT32
;

89 #iâdeà
HIK_TYPE_UINT64


90 
	#HIK_TYPE_UINT64


	)

91 
	tUINT64
;

94 #iâdeà
HIK_TYPE_INT8


95 
	#HIK_TYPE_INT8


	)

96 
	tINT8
;

99 #iâdeà
HIK_TYPE_INT16


100 
	#HIK_TYPE_INT16


	)

101 
	tINT16
;

104 #iâdeà
HIK_TYPE_INT32


105 
	#HIK_TYPE_INT32


	)

106 
	tINT32
;

109 #iâdeà
HIK_TYPE_INT64


110 
	#HIK_TYPE_INT64


	)

111 
	tINT64
;

114 #iâdeà
HIK_TYPE_UINT


115 
	#HIK_TYPE_UINT


	)

116 
	tUINT
;

119 #iâdeà
HIK_TYPE_USHORT


120 
	#HIK_TYPE_USHORT


	)

121 
	tUSHORT
;

124 #iâdeà
HIK_TYPE_ULONG


125 
	#HIK_TYPE_ULONG


	)

126 
	tULONG
;

129 #iâdeà
HIK_TYPE_INT


130 
	#HIK_TYPE_INT


	)

131 
	tINT
;

134 #iâdeà
HIK_TYPE_SHORT


135 
	#HIK_TYPE_SHORT


	)

136 
	tSHORT
;

139 #iâdeà
HIK_TYPE_LONG


140 
	#HIK_TYPE_LONG


	)

141 
	tLONG
;

144 #iâdeà
HIK_TYPE_PUINT


145 
	#HIK_TYPE_PUINT


	)

146 * 
	tPUINT
;

149 #iâdeà
HIK_TYPE_PINT


150 
	#HIK_TYPE_PINT


	)

151 * 
	tPINT
;

154 #iâdeà
HIK_TYPE_PUINT8


155 
	#HIK_TYPE_PUINT8


	)

156 * 
	tPUINT8
;

159 #iâdeà
HIK_TYPE_PVOID


160 
	#HIK_TYPE_PVOID


	)

161 * 
	tPVOID
;

164 #iâdeà
HIK_TYPE_UINTV


165 
	#HIK_TYPE_UINTV


	)

166 vŞ©
	tUINT
 
	tUINTV
;

169 #iâdeà
HIK_TYPE_PUINTV


170 
	#HIK_TYPE_PUINTV


	)

171 vŞ©
	tUINT
* 
	tPUINTV
;

174 #ifdeà
__ılu¥lus


	@osi\netApiWrap\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@osi\netApiWrap\ioctl.c

11 
	~"ÃtH—d”.h
"

13 
	$ioùl_sockBuf_d©as
(
sockfd
)

15 
iBy‹sAva
 = -1;

16 
iR‘V®
;

18 
iR‘V®
 = 
	`ioùl
(
sockfd
, 
FIONREAD
, ()&
iBy‹sAva
);

19 if(
iR‘V®
==-1)

21 
	`”r_šfo_f
("ioctl_socuBuf_datas() isƒrror!\n");

24  (
iBy‹sAva
);

25 
	}
}

27 
	$Sock_noBlock
(
sockfd
)

29 
æag
, 
rv®
;

31 
æag
 = 1;

32 
rv®
 = 
	`ioùl
(
sockfd
, 
FIONBIO
, &
æag
);

33 if(
rv®
 == -1)

35 
	`”r_šfo_f
("Sock_noBlock() isƒrror!\n");

38  
rv®
;

39 
	}
}

41 
	$Sock_block
(
sockfd
)

43 
æag
, 
rv®
;

45 
æag
 = 0;

46 
rv®
 = 
	`ioùl
(
sockfd
, 
FIONBIO
, &
æag
);

47 if(
rv®
 == -1)

49 
	`”r_šfo_f
("Sock_block() isƒrror!\n");

52  
rv®
;

53 
	}
}

	@osi\netApiWrap\mcastApiWrap.c

11 
	~"ÃtH—d”.h
"

16 
	$mÿ¡_još
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

19 #ifdeà
MCAST_JOIN_GROUP


20 
group_»q
 
»q
;

22 ià(
ifšdex
 > 0)

24 
»q
.
gr_š‹rçû
 = 
ifšdex
;

26 ià(
iâame
 !ğ
NULL
)

28 iàĞ(
»q
.
gr_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0)

30 
”ºo
 = 
ENXIO
;

36 
»q
.
gr_š‹rçû
 = 0;

39 ià(
g½Ën
 > (
»q
.
gr_group
))

41 
”ºo
 = 
EINVAL
;

45 
	`memıy
(&
»q
.
gr_group
, 
g½
, 
g½Ën
);

46  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_JOIN_GROUP
, &
»q
, (req)));

49 
g½
->
§_çmy
)

51 
AF_INET
:

53 
_m»q
 
m»q
;

54 
iäeq
 ifreq;

56 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((cÚ¡ 
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

58 ià(
ifšdex
 > 0)

60 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
)

62 
”ºo
 = 
ENXIO
;

65 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

69 
	`memıy
(&
m»q
.
imr_š‹rçû
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

71 ià(
iâame
 !ğ
NULL
)

73 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

74 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

78 
	`memıy
(&
m»q
.
imr_š‹rçû
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

82 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

85  (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, &
m»q
, (mreq)));

88 
AF_INET6
:

90 
v6_m»q
 
m»q6
;

92 
	`memıy
(&
m»q6
.
v6mr_muÉŸddr
, &((cÚ¡ 
sockaddr_š6
 *è
g½
)->
sš6_addr
, (
š6_addr
));

94 ià(
ifšdex
 > 0)

96 
m»q6
.
v6mr_š‹rçû
 = 
ifšdex
;

98 ià(
iâame
 !ğ
NULL
)

100 iàĞ(
m»q6
.
v6mr_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0)

102 
”ºo
 = 
ENXIO
;

108 
m»q6
.
v6mr_š‹rçû
 = 0;

111  (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_JOIN_GROUP
, &
m»q6
, (mreq6)));

115 
”ºo
 = 
EAFNOSUPPORT
;

119 
	}
}

132 
	$Mÿ¡_još
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

134 
rv®
;

136 if((
rv®
 = 
	`mÿ¡_još
(
sockfd
, 
g½
, 
g½Ën
, 
iâame
, 
ifšdex
)) < 0)

138 
	`”r_šfo_f
("mcast_joinƒrror\n");

141  
rv®
;

142 
	}
}

144 
	$mÿ¡_još_sourû_group
(

145 
sockfd
,

146 cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

147 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

148 cÚ¡ *
iâame
, 
u_št
 
ifšdex


151 #ifdeà
MCAST_JOIN_SOURCE_GROUP


152 
group_sourû_»q
 
»q
;

154 ià(
ifšdex
 > 0)

156 
»q
.
g¤_š‹rçû
 = 
ifšdex
;

158 ià(
iâame
 !ğ
NULL
)

160 iàĞ(
»q
.
g¤_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0)

162 
”ºo
 = 
ENXIO
;

168 
»q
.
g¤_š‹rçû
 = 0;

171 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
))

173 
”ºo
 = 
EINVAL
;

177 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

178 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

179  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_JOIN_SOURCE_GROUP
, &
»q
, (req)));

182 
g½
->
§_çmy
)

184 #ifdeà
IP_ADD_SOURCE_MEMBERSHIP


185 
AF_INET
:

187 
_m»q_sourû
 
m»q
;

188 
iäeq
 ifreq;

190 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

191 
	`memıy
(&
m»q
.
imr_sourûaddr
, &((
sockaddr_š
 *è
¤c
)->
sš_addr
, (
š_addr
));

193 ià(
ifšdex
 > 0)

195 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
)

197 
”ºo
 = 
ENXIO
;

200 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

204 
	`memıy
(&
m»q
.
imr_š‹rçû
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

206 ià(
iâame
 !ğ
NULL
)

208 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

209 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

213 
	`memıy
(&
m»q
.
imr_š‹rçû
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

217 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

220 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ADD_SOURCE_MEMBERSHIP
, &
m»q
, (mreq)));

223 #ifdef 
IPV6


224 
AF_INET6
:

227 
”ºo
 = 
EAFNOSUPPORT
;

231 
	}
}

246 
	$Mÿ¡_još_sourû_group
(

247 
sockfd
,

248 cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

249 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

250 cÚ¡ *
iâame
, 
u_št
 
ifšdex


253 
rv®
;

255 if((
rv®
 = 
	`mÿ¡_još_sourû_group
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
, 
iâame
, 
ifšdex
)) < 0)

257 
	`”r_šfo_f
("mcast_join_source_groupƒrror\n");

260  
rv®
;

261 
	}
}

263 
	$mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

265 #ifdeà
MCAST_BLOCK_SOURCE


266 
group_sourû_»q
 
»q
;

268 
»q
.
g¤_š‹rçû
 = 0;

269 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
))

271 
”ºo
 = 
EINVAL
;

274 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

275 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

276  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_BLOCK_SOURCE
, &
»q
, (req)));

278 
g½
->
§_çmy
)

280 #ifdeà
IP_BLOCK_SOURCE


281 
AF_INET
:

283 
_m»q_sourû
 
m»q
;

285 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

286 
	`memıy
(&
m»q
.
imr_sourûaddr
, &((
sockaddr_š
 *è
¤c
)->
sš_addr
, (
š_addr
));

287 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

289 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_BLOCK_SOURCE
, &
m»q
, (mreq)));

292 #ifdef 
IPV6


293 
AF_INET6
:

296 
”ºo
 = 
EAFNOSUPPORT
;

300 
	}
}

313 
	$Mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

315 
rv®
;

317 if((
rv®
 = 
	`mÿ¡_block_sourû
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
)) < 0)

319 
	`”r_šfo_f
("mcast_block_sourceƒrror\n");

322  
rv®
;

323 
	}
}

325 
	$mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

327 #ifdeà
MCAST_UNBLOCK_SOURCE


328 
group_sourû_»q
 
»q
;

330 
»q
.
g¤_š‹rçû
 = 0;

331 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
))

333 
”ºo
 = 
EINVAL
;

337 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

338 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

339  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_UNBLOCK_SOURCE
, &
»q
, (req)));

341 
g½
->
§_çmy
)

343 #ifdeà
IP_UNBLOCK_SOURCE


344 
AF_INET
:

346 
_m»q_sourû
 
m»q
;

348 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

349 
	`memıy
(&
m»q
.
imr_sourûaddr
, &((
sockaddr_š
 *è
¤c
)->
sš_addr
, (
š_addr
));

350 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

352 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_UNBLOCK_SOURCE
, &
m»q
, (mreq)));

356 #ifdef 
IPV6


357 
AF_INET6
:

360 
”ºo
 = 
EAFNOSUPPORT
;

364 
	}
}

377 
	$Mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

379 
rv®
;

381 ià((
rv®
 = 
	`mÿ¡_unblock_sourû
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
)) < 0)

383 
	`”r_šfo_f
("mcast_unblock_sourceƒrror\n");

386  
rv®
;

387 
	}
}

390 
	$mÿ¡_Ëave
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

392 #ifdeà
MCAST_JOIN_GROUP


393 
group_»q
 
»q
;

395 
»q
.
gr_š‹rçû
 = 0;

396 ià(
g½Ën
 > (
»q
.
gr_group
))

398 
”ºo
 = 
EINVAL
;

402 
	`memıy
(&
»q
.
gr_group
, 
g½
, 
g½Ën
);

403  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_LEAVE_GROUP
, &
»q
, (req)));

405 
g½
->
§_çmy
)

408 
AF_INET
:

410 
_m»q
 
m»q
;

412 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((cÚ¡ 
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

413 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

414 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_DROP_MEMBERSHIP
, &
m»q
, (mreq)));

417 
AF_INET6
:

419 
v6_m»q
 
m»q6
;

421 
	`memıy
(&
m»q6
.
v6mr_muÉŸddr
, &((cÚ¡ 
sockaddr_š6
 *è
g½
)->
sš6_addr
, (
š6_addr
));

422 
m»q6
.
v6mr_š‹rçû
 = 0;

423 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_LEAVE_GROUP
, &
m»q6
, (mreq6)));

427 
”ºo
 = 
EAFNOSUPPORT
;

431 
	}
}

442 
	$Mÿ¡_Ëave
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

444 
rv®
;

446 ià((
rv®
 = 
	`mÿ¡_Ëave
(
sockfd
, 
g½
, 
g½Ën
)) < 0)

448 
	`”r_šfo_f
("mcast_leaveƒrror\n");

451  
rv®
;

452 
	}
}

454 
	$mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

456 #ifdeà
MCAST_LEAVE_SOURCE_GROUP


457 
group_sourû_»q
 
»q
;

459 
»q
.
g¤_š‹rçû
 = 0;

460 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
))

462 
”ºo
 = 
EINVAL
;

465 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

466 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

467  (
	`£tsockİt
(
sockfd
, 
	`Famy_to_Ëv–
(
g½
->
§_çmy
), 
MCAST_LEAVE_SOURCE_GROUP
, &
»q
, (req)));

469 
g½
->
§_çmy
)

471 #ifdeà
IP_DROP_SOURCE_MEMBERSHIP


472 
AF_INET
:

474 
_m»q_sourû
 
m»q
;

476 
	`memıy
(&
m»q
.
imr_muÉŸddr
, &((
sockaddr_š
 *è
g½
)->
sš_addr
, (
š_addr
));

477 
	`memıy
(&
m»q
.
imr_sourûaddr
, &((
sockaddr_š
 *è
¤c
)->
sš_addr
, (
š_addr
));

478 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

480 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_DROP_SOURCE_MEMBERSHIP
, &
m»q
, (mreq)));

483 #ifdef 
IPV6


484 
AF_INET6
:

487 
”ºo
 = 
EAFNOSUPPORT
;

491 
	}
}

504 
	$Mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
)

506 
rv®
;

508 iàĞ(
rv®
 = 
	`mÿ¡_Ëave_sourû_group
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
)) < 0)

510 
	`”r_šfo_f
("mcast_leave_source_groupƒrror\n");

513  
rv®
;

514 
	}
}

519 
	$mÿ¡_£t_loİ
(
sockfd
, 
Úoff
)

521 
	`Sockfd_to_çmy
(
sockfd
))

523 
AF_INET
:

525 
u_ch¬
 
æag
;

527 
æag
 = 
Úoff
;

528 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
, &
æag
, (flag)));

531 
AF_INET6
:

533 
u_št
 
æag
;

535 
æag
 = 
Úoff
;

536 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_LOOP
, &
æag
, (flag)));

540 
”ºo
 = 
EAFNOSUPPORT
;

543 
	}
}

553 
	$Mÿ¡_£t_loİ
(
sockfd
, 
Úoff
)

555 
rv®
;

557 ià((
rv®
 = 
	`mÿ¡_£t_loİ
(
sockfd
, 
Úoff
)) < 0)

559 
	`”r_šfo_f
("mcast_set_loopƒrror\n");

562  
rv®
;

563 
	}
}

565 
	$mÿ¡_g‘_loİ
(
sockfd
)

567 
	`Sockfd_to_çmy
(
sockfd
))

569 
AF_INET
:

571 
u_ch¬
 
æag
;

572 
sockËn_t
 
Ën
;

574 
Ën
 = (
æag
);

575 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
, &
æag
, &
Ën
) < 0)

579 (
æag
);

582 
AF_INET6
:

584 
u_št
 
æag
;

585 
sockËn_t
 
Ën
;

587 
Ën
 = (
æag
);

588 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_LOOP
, &
æag
, &
Ën
) < 0)

592 (
æag
);

596 
”ºo
 = 
EAFNOSUPPORT
;

599 
	}
}

608 
	$Mÿ¡_g‘_loİ
(
sockfd
)

610 
rv®
;

612 iàĞ(
rv®
 = 
	`mÿ¡_g‘_loİ
(
sockfd
)) < 0)

614 
	`”r_šfo_f
("mcast_get_loopƒrror\n");

617 (
rv®
);

618 
	}
}

620 
	$mÿ¡_£t_if
(
sockfd
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

622 
	`Sockfd_to_çmy
(
sockfd
))

624 
AF_INET
:

626 
š_addr
 
šaddr
;

627 
iäeq
 ifreq;

629 ià(
ifšdex
 > 0)

631 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
)

633 
”ºo
 = 
ENXIO
;

636 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

640 
	`memıy
(&
šaddr
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

642 ià(
iâame
 !ğ
NULL
)

644 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

645 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

649 
	`memıy
(&
šaddr
, &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
, (
š_addr
));

653 
šaddr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

656  (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_IF
, &
šaddr
, (
š_addr
)));

659 
AF_INET6
:

661 
u_št
 
idx
;

663 iàĞ(
idx
 = 
ifšdex
) == 0)

665 ià(
iâame
 =ğ
NULL
)

667 
”ºo
 = 
EINVAL
;

670 iàĞ(
idx
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0)

672 
”ºo
 = 
ENXIO
;

676 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_IF
, &
idx
, (idx)));

680 
”ºo
 = 
EAFNOSUPPORT
;

683 
	}
}

694 
	$Mÿ¡_£t_if
(
sockfd
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

696 
rv®
;

698 ià((
rv®
 = 
	`mÿ¡_£t_if
(
sockfd
, 
iâame
, 
ifšdex
)) < 0)

700 
	`”r_šfo_f
("mcast_set_ifƒrror\n");

703  
rv®
;

704 
	}
}

706 
	$mÿ¡_g‘_if
(
sockfd
)

708 
	`Sockfd_to_çmy
(
sockfd
))

710 
AF_INET
:

716 
AF_INET6
:

718 
u_št
 
idx
;

719 
sockËn_t
 
Ën
;

721 
Ën
 = (
idx
);

722 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_IF
, &
idx
, &
Ën
) < 0)

726 (
idx
);

730 
”ºo
 = 
EAFNOSUPPORT
;

733 
	}
}

742 
	$Mÿ¡_g‘_if
(
sockfd
)

744 
rv®
;

746 iàĞ(
rv®
 = 
	`mÿ¡_g‘_if
(
sockfd
)) < 0)

748 
	`”r_šfo_f
("mcast_get_ifƒrror\n");

751 (
rv®
);

752 
	}
}

754 
	$mÿ¡_£t_‰l
(
sockfd
, 
v®
)

756 
	`Sockfd_to_çmy
(
sockfd
))

758 
AF_INET
:

760 
u_ch¬
 
‰l
;

762 
‰l
 = 
v®
;

763 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
, &
‰l
, (ttl)));

766 
AF_INET6
:

768 
hİ
;

770 
hİ
 = 
v®
;

771 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_HOPS
, &
hİ
, (hop)));

775 
”ºo
 = 
EAFNOSUPPORT
;

778 
	}
}

787 
	$Mÿ¡_£t_‰l
(
sockfd
, 
v®
)

789 
rv®
;

791 ià((
rv®
 = 
	`mÿ¡_£t_‰l
(
sockfd
, 
v®
)) < 0)

793 
	`”r_šfo_f
("mcast_set_ttlƒrror\n");

796  
rv®
;

797 
	}
}

799 
	$mÿ¡_g‘_‰l
(
sockfd
)

801 
	`Sockfd_to_çmy
(
sockfd
))

803 
AF_INET
:

805 
u_ch¬
 
‰l
;

806 
sockËn_t
 
Ën
;

808 
Ën
 = (
‰l
);

809 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
, &
‰l
, &
Ën
) < 0)

813 (
‰l
);

816 
AF_INET6
:

818 
hİ
;

819 
sockËn_t
 
Ën
;

821 
Ën
 = (
hİ
);

822 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_HOPS
, &
hİ
, &
Ën
) < 0)

826 (
hİ
);

830 
”ºo
 = 
EAFNOSUPPORT
;

833 
	}
}

842 
	$Mÿ¡_g‘_‰l
(
sockfd
)

844 
rv®
;

846 iàĞ(
rv®
 = 
	`mÿ¡_g‘_‰l
(
sockfd
)) < 0)

848 
	`”r_šfo_f
("mcast_get_ttlƒrror\n");

851 (
rv®
);

852 
	}
}

	@osi\netApiWrap\misc.h

	@osi\netApiWrap\netApiWrap.h

11 #iâdeà
_NET_API_WRAP_H


12 
	#_NET_API_WRAP_H


	)

15 #ifdeà
__ılu¥lus


20 
	#INET_ADDR_STRLEN
 
INET_ADDRSTRLEN


	)

21 
	#INET6_ADDR_STRLEN
 
INET6_ADDRSTRLEN


	)

22 
	#SA
 
sockaddr


	)

27 
Sock_±Ú
(
sockaddr
 *
§
, cÚ¡ *
SŒ
);

28 
Sock_±Ú_v4
(cÚ¡ *
SŒ
);

29 
Sock_Áİ
(cÚ¡ 
sockaddr
 *
§
, *
SŒ
);

30 
Sock_Áİ_v4
(
addr
, *
SŒ
);

36 
G‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, *
İtv®
, 
sockËn_t
 *
İ’
);

37 
S‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, cÚ¡ *
İtv®
, 
sockËn_t
 
İ’
);

39 
Sockİt_g‘_»cvBuf
(
sockfd
, *
bufsize
);

40 
Sockİt_£t_»cvBuf
(
sockfd
, 
bufsize
);

41 
Sockİt_g‘_£ndBuf
(
sockfd
, *
bufsize
);

42 
Sockİt_£t_£ndBuf
(
sockfd
, 
bufsize
);

43 
Sockİt_£t_lšg”On
(
sockfd
);

44 
Sockİt_£t_»u£
(
sockfd
);

46 
Famy_to_Ëv–
(
çmy
);

47 
Sockfd_to_çmy
(
sockfd
);

52 
Recv
(
sockfd
, *
buf
, 
size_t
 
Ën
, 
æags
);

53 
»adn
(
cÚnfd
, *
v±r
, 
n
);

54 
wr™’
(
cÚnfd
, *
v±r
, 
size_t
 
n
);

55 
S–eù
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exûpfds
, 
timev®
 *
timeout
);

60 
ioùl_sockBuf_d©as
(
sockfd
);

61 
Sock_noBlock
(
sockfd
);

62 
Sock_block
(
sockfd
);

68 
Sock‘
(
çmy
, 
ty³
, 
´ÙocŞ
);

69 
CÚÃù
(
sockfd
, cÚ¡ 
sockaddr
 *
£rvaddr
, 
sockËn_t
 
add¾’
);

70 
Bšd
(
sockfd
, cÚ¡ 
sockaddr
 *
myaddr
, 
sockËn_t
 
add¾’
);

71 
Li¡’
(
sockfd
, 
backlog
);

72 
Acû±
(
sockfd
, 
sockaddr
 *
şŸddr
, 
sockËn_t
 *
add¾’
);

73 
Clo£
(
sockfd
);

74 
G‘sockÇme
(
sockfd
, 
sockaddr
 *
loÿÏddr
, 
sockËn_t
 *
add¾’
);

75 
G‘³”Çme
(
sockfd
, 
sockaddr
 *
³”addr
, 
sockËn_t
 *
add¾’
);

77 
cÚÃùW™hTimeout
(
sock
, 
sockaddr
*
addrs
, 
adrsL’
,
timev®
* 
tm
);

78 
Tı_cÚÃù
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
);

79 
Tı_cÚÃù_nb
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
, 
timev®
 
d–aytime
);

84 
Recväom
(
sockfd
, *
buf
, 
size_t
 
nby‹s
, 
æags
, 
sockaddr
 *
äom
, 
sockËn_t
 *
add¾’
) ;

85 
S’dto
(
sockfd
, cÚ¡ *
buf
, 
size_t
 
nby‹s
, 
æags
, cÚ¡ 
sockaddr
 *
to
, 
sockËn_t
 
add¾’
);

86 
Udp_sock‘
(
bufsize
);

92 
Mÿ¡_još
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

93 
Mÿ¡_još_sourû_group
(

94 
sockfd
,

95 cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

96 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

97 cÚ¡ *
iâame
, 
u_št
 
ifšdex


99 
Mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
);

100 
Mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
);

101 
Mÿ¡_Ëave
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

102 
Mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
, cÚ¡ SA *
g½
, sockËn_ˆ
g½Ën
);

104 
Mÿ¡_£t_loİ
(
sockfd
, 
Úoff
);

105 
Mÿ¡_g‘_loİ
(
sockfd
);

106 
Mÿ¡_£t_if
(
sockfd
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

107 
Mÿ¡_g‘_if
(
sockfd
);

108 
Mÿ¡_£t_‰l
(
sockfd
, 
v®
);

109 
Mÿ¡_g‘_‰l
(
sockfd
);

112 #ifdeà
__ılu¥lus


	@osi\netApiWrap\netHeader.h

11 
	~<¡dio.h
>

12 
	~<uni¡d.h
>

13 
	~<¡ršg.h
>

14 
	~<”ºo.h
>

15 
	~<sys/time.h
>

16 
	~<sys/ty³s.h
>

17 
	~<sys/sock‘.h
>

18 
	~<sys/£Ëù.h
>

19 
	~<sys/ioùl.h
>

20 
	~<¬·/š‘.h
>

21 
	~<Ãt/if.h
>

22 
	~<Ãtš‘/š.h
>

24 
	~"d©aTy³.h
"

25 
	~"debug.h
"

26 
	~"ÃtApiW¿p.h
"

30 
	#SA
 
sockaddr


	)

	@osi\netApiWrap\netIO.c

11 
	~"ÃtH—d”.h
"

16 
	$S–eù
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exûpfds
, 
timev®
 *
timeout
)

18 
rv®
;

19 
sockfd
;

21 
sockfd
 = 
nfds
 - 1;

23 if(
»adfds
 !ğ
NULL
)

25 
	`FD_ZERO
(
»adfds
);

26 
	`FD_SET
(
sockfd
, 
»adfds
);

28 if(
wr™efds
 !ğ
NULL
)

30 
	`FD_ZERO
(
wr™efds
);

31 
	`FD_SET
(
sockfd
, 
wr™efds
);

33 if(
exûpfds
 !ğ
NULL
)

35 
	`FD_ZERO
(
exûpfds
);

36 
	`FD_SET
(
sockfd
, 
exûpfds
);

39 
rv®
 = 
	`£Ëù
(
nfds
, 
»adfds
, 
wr™efds
, 
exûpfds
, 
timeout
);

40 if(
rv®
 == -1)

42 
	`”r_šfo_s
("select failed!\n");

44 if(
rv®
 == 0)

49  
rv®
;

50 
	}
}

52 
	$Recv
(
sockfd
, *
buf
, 
size_t
 
Ën
, 
æags
)

54 
rv®
;

56 if((
rv®
 = 
	`»cv
(
sockfd
, 
buf
, 
Ën
, 
æags
)) == -1)

58 
	`”r_šfo_s
("recvƒrror!\n");

61  
rv®
;

62 
	}
}

77 
	$»adn
(
cÚnfd
, *
v±r
, 
n
)

79 
Æeá
;

80 
Ä—d
;

81 *
±r
;

82 
timev®
 
£Ëù_timeout
;

83 
fd_£t
 
r£t
;

85 
±r
 = (*)
v±r
;

86 
Æeá
 = 
n
;

87 
Æeá
 > 0)

89 
£Ëù_timeout
.
tv_£c
 = 5;

90 
£Ëù_timeout
.
tv_u£c
 = 0;

91 
	`FD_ZERO
(&
r£t
);

92 
	`FD_SET
(
cÚnfd
, &
r£t
);

94 if(
	`S–eù
(
cÚnfd
+1, &
r£t
, 
NULL
, NULL, &
£Ëù_timeout
) <= 0)

96  
ERROR
;

99 if((
Ä—d
 = 
	`»cv
(
cÚnfd
, 
±r
, 
Æeá
, 0)) < 0)

102 if(
”ºo
 =ğ
EINTR
)

104 
Ä—d
 = 0;

108  
ERROR
;

111 ià(
Ä—d
 == 0)

115 
Æeá
 -ğ
Ä—d
;

116 
±r
 +ğ
Ä—d
;

119 (
n
 - 
Æeá
);

120 
	}
}

132 
	$wr™’
(
cÚnfd
, *
v±r
, 
size_t
 
n
)

134 
Æeá
, 
nwr™‹n
;

135 *
±r
;

137 
±r
 = 
v±r
;

138 
Æeá
 = 
n
;

140 
Æeá
>0)

142 if((
nwr™‹n
 = 
	`£nd
(
cÚnfd
, 
±r
, 
Æeá
, 
MSG_NOSIGNAL
)è=ğ
ERROR
)

145 if(
”ºo
 =ğ
EINTR
)

147 
nwr™‹n
 = 0;

151  
ERROR
;

154 
Æeá
 -ğ
nwr™‹n
;

155 
±r
 +ğ
nwr™‹n
;

158 (
n
);

159 
	}
}

	@osi\netApiWrap\netconfig.c

	@osi\netApiWrap\sock.c

11 
	~"ÃtH—d”.h
"

16 
	$IÃt_±Ú
(
çmy
, cÚ¡ *
¤c
, *
d¡
)

18 
rv®
;

20 if(
¤c
==
NULL
 || 
d¡
==NULL)

25 if((
rv®
 = 
	`š‘_±Ú
(
çmy
, 
¤c
, 
d¡
)) <= 0)

27 
	`”r_šfo_s
("inet_pton() failed!\n");

28 
rv®
 = -1;

31  
rv®
;

32 
	}
}

34 cÚ¡ * 
	$IÃt_Áİ
(
çmy
, cÚ¡ *
¤c
, * 
d¡
, 
sockËn_t
 
Ën
)

36 if(
¤c
==
NULL
 || 
d¡
==NULL)

38  
NULL
;

41 if(
	`š‘_Áİ
(
çmy
, 
¤c
, 
d¡
, 
Ën
è=ğ
NULL
)

43 
	`”r_šfo_s
("inet_pton() failed!\n");

46  
	`š‘_Áİ
(
çmy
, 
¤c
, 
d¡
, 
Ën
);

47 
	}
}

55 *
	$sock_Áİ
(cÚ¡ 
sockaddr
 *
§
)

57 
¡r
[128];

59 
§
->
§_çmy
)

61 
AF_INET
:

63 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

65 ià(
	`IÃt_Áİ
(
AF_INET
, &
sš
->
sš_addr
, 
¡r
, (¡r)è=ğ
NULL
)

67 (
NULL
);

69 (
¡r
);

72 
AF_INET6
:

74 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

76 
¡r
[0] = '[';

77 ià(
	`IÃt_Áİ
(
AF_INET6
, &
sš6
->
sš6_addr
, 
¡r
 + 1, (¡rè- 1è=ğ
NULL
)

79 (
NULL
);

81  (
¡r
 + 1);

86 
	`¢´štf
(
¡r
, (¡r), "sock_Áİ: unknowÀAF_xxx: %d", 
§
->
§_çmy
);

87 (
¡r
);

90  (
NULL
);

91 
	}
}

93 
	$Sock_Áİ
(cÚ¡ 
sockaddr
 *
§
, *
SŒ
)

95 *
±r
;

97 if(
§
==
NULL
 || 
SŒ
==NULL)

102 if((
±r
 = 
	`sock_Áİ
(
§
)è=ğ
NULL
)

104 
	`”r_šfo_s
("sock_ntop() failed!\n");

109 
	`¡rıy
(
SŒ
, 
±r
);

112 
	}
}

114 
	$Sock_Áİ_v4
(
addr
, *
SŒ
)

116 
±r
[
INET_ADDRSTRLEN
];

117 
sockaddr_š
 
sockaddrIn
;

119 if(
SŒ
==
NULL
)

124 
sockaddrIn
.
sš_çmy
 = 
AF_INET
;

125 
sockaddrIn
.
sš_addr
.
s_addr
 = 
addr
;

126 if(
	`Sock_Áİ
((
SA
*)&
sockaddrIn
, 
±r
) == -1)

128 
	`”r_šfo_s
("Sock_ntop() failed!\n");

133 
	`¡rıy
(
SŒ
, 
±r
);

136 
	}
}

138 
	$sock_±Ú
(
sockaddr
 *
§
 , cÚ¡ *
SŒ
)

140 
§
->
§_çmy
)

142 
AF_INET
:

144 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

146 ià(
	`IÃt_±Ú
(
AF_INET
, 
SŒ
, &
sš
->
sš_addr
) == -1)

153 
AF_INET6
:

155 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

157 ià(
	`IÃt_±Ú
(
AF_INET6
, 
SŒ
, &
sš6
->
sš6_addr
) == -1)

165 
	`´štf
("sock_Áİ: unknowÀAF_xxx: %d", 
§
->
§_çmy
);

170 
	}
}

172 
	$Sock_±Ú
(
sockaddr
 *
§
, cÚ¡ *
SŒ
)

174 
rv®
;

176 if(
§
==
NULL
 || 
SŒ
==NULL)

181 if((
rv®
 = 
	`sock_±Ú
(
§
, 
SŒ
)) == -1)

183 
	`”r_šfo_s
("sock_pton() failed!\n");

187 
	}
}

189 
	$Sock_±Ú_v4
(cÚ¡ *
SŒ
)

191 
sockaddr_š
 
sockaddrIn
;

193 if(
SŒ
==
NULL
)

198 
sockaddrIn
.
sš_çmy
 = 
AF_INET
;

199 if(
	`Sock_±Ú
((
SA
*)&
sockaddrIn
,
SŒ
) == -1)

201 
	`”r_šfo_s
("Sock_pton() failed!\n");

205  
sockaddrIn
.
sš_addr
.
s_addr
;

206 
	}
}

	@osi\netApiWrap\sockopt.c

11 
	~"ÃtH—d”.h
"

16 
	$G‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, *
İtv®
, 
sockËn_t
 *
İ’
)

18 
rv®
;

20 if((
rv®
 = 
	`g‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)) == -1)

22 
	`”r_šfo_s
("getsockopt failed!\n");

25  
rv®
;

26 
	}
}

28 
	$S‘sockİt
(
sockfd
, 
Ëv–
, 
İŠame
, cÚ¡ *
İtv®
, 
sockËn_t
 
İ’
)

30 
rv®
;

32 if((
rv®
 = 
	`£tsockİt
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
)) == -1)

34 
	`”r_šfo_s
("setsockopt failed!\n");

37  
rv®
;

38 
	}
}

43 
	$Sockİt_g‘_»cvBuf
(
sockfd
, *
bufsize
)

45 
rv®
;

46 
İ’
 = ();

48 if(
bufsize
==
NULL
)

53 if((
rv®
 = 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, 
bufsize
,(
sockËn_t
*)&
İ’
)) == -1)

55 
	`”r_šfo_f
("Getsockopt_recvbuf failed!\n");

58 if(
İ’
 != ())

60 
	`”r_šfo_s
("Getsockopt_recvbuf optlenƒrror!\n");

63  
rv®
;

64 
	}
}

66 
	$Sockİt_£t_»cvBuf
(
sockfd
, 
bufsize
)

68 
rv®
;

69 
sockËn_t
 
İ’
 = ();

71 if((
rv®
 = 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
bufsize
, 
İ’
)) == -1)

73 
	`”r_šfo_f
("Setsockopt_recvbuf failed!\n");

76  
rv®
;

77 
	}
}

79 
	$Sockİt_g‘_£ndBuf
(
sockfd
, *
bufsize
)

81 
rv®
;

82 
sockËn_t
 
İ’
 = ();

84 if(
bufsize
==
NULL
)

89 if((
rv®
 = 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, 
bufsize
,(
sockËn_t
*)&
İ’
)) == -1)

91 
	`”r_šfo_f
("Getsockopt_sendbuf failed!\n");

94 if(
İ’
 != ())

96 
	`”r_šfo_s
("Getsockopt_sendbuf optlenƒrror!\n");

99  
rv®
;

100 
	}
}

102 
	$Sockİt_£t_£ndBuf
(
sockfd
, 
bufsize
)

104 
rv®
;

105 
sockËn_t
 
İ’
 = ();

107 if((
rv®
 = 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*)&
bufsize
, 
İ’
)) == -1)

109 
	`”r_šfo_f
("Setsockopt_sendbuf failed!\n");

112  
rv®
;

113 
	}
}

115 
	$Sockİt_£t_lšg”On
(
sockfd
)

117 
lšg”
 
şšg”
;

118 
rv®
;

120 
şšg”
.
l_Úoff
 = 1;

121 
şšg”
.
l_lšg”
 = 0;

122 if((
rv®
 = 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
, (*)&
şšg”
, (clinger))) == -1)

124 
	`”r_šfo_f
("Setsockopt_lingerOn failed!\n");

127  
rv®
;

128 
	}
}

130 
	$Sockİt_£t_»u£
(
sockfd
)

132 
İtv®
;

133 
rv®
;

135 
İtv®
 = 1;

136 if((
rv®
 = 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (*)&
İtv®
, (optval))) == -1)

138 
	`”r_šfo_f
("Sockopt_set_reuse failed!\n");

141  
rv®
;

142 
	}
}

147 
	$çmy_to_Ëv–
(
çmy
)

149 
çmy
)

151 
AF_INET
:

152  
IPPROTO_IP
;

153 
AF_INET6
:

154  
IPPROTO_IPV6
;

158 
	}
}

167 
	$Famy_to_Ëv–
(
çmy
)

169 
rv®
;

171 if((
rv®
 = 
	`çmy_to_Ëv–
(
çmy
))<0)

173 
	`”r_šfo_f
("çmy_to_Ëv–ƒ¼Ü,„v®=%d\n", 
rv®
);

176  (
rv®
);

177 
	}
}

179 
	$sockfd_to_çmy
(
sockfd
)

181 
sockaddr_¡Üage
 
ss
;

182 
sockËn_t
 
Ën
;

184 
Ën
 = (
ss
);

185 ià(
	`g‘sockÇme
(
sockfd
, (
SA
 *è&
ss
, &
Ën
) < 0)

189 (
ss
.
ss_çmy
);

190 
	}
}

199 
	$Sockfd_to_çmy
(
sockfd
)

201 
rv®
;

203 iàĞ(
rv®
 = 
	`sockfd_to_çmy
(
sockfd
)) < 0)

205 
	`”r_šfo_f
("sockfd_to_familyƒrror\n");

208 (
rv®
);

209 
	}
}

	@osi\netApiWrap\tcpApiWrap.c

11 
	~"ÃtH—d”.h
"

16 
	$Sock‘
(
çmy
, 
ty³
, 
´ÙocŞ
)

18 
rv®
;

20 if((
rv®
 = 
	`sock‘
(
çmy
, 
ty³
, 
´ÙocŞ
)) == -1)

22 
	`”r_šfo_s
("% %d: sock‘ faed!\n", 
__FILE__
, 
__LINE__
);

25  
rv®
;

26 
	}
}

28 
	$CÚÃù
(
sockfd
, cÚ¡ 
sockaddr
 *
£rvaddr
, 
sockËn_t
 
add¾’
)

30 
rv®
;

32 if((
rv®
 = 
	`cÚÃù
(
sockfd
,
£rvaddr
, 
add¾’
)) == -1)

34 
	`”r_šfo_s
("% %d:cÚÃù faed!\n", 
__FILE__
, 
__LINE__
);

37  
rv®
;

38 
	}
}

40 
	$Bšd
(
sockfd
, cÚ¡ 
sockaddr
 *
myaddr
, 
sockËn_t
 
add¾’
)

42 
rv®
;

44 if((
rv®
 = 
	`bšd
(
sockfd
, 
myaddr
, 
add¾’
)) == -1)

46 
	`”r_šfo_s
("% %d: bšd faed!\n", 
__FILE__
, 
__LINE__
);

49  
rv®
;

50 
	}
}

52 
	$Li¡’
(
sockfd
, 
backlog
)

54 
rv®
;

56 if((
rv®
 = 
	`li¡’
(
sockfd
, 
backlog
)) == -1)

58 
	`”r_šfo_s
("% %d:†i¡’ faed!\n", 
__FILE__
, 
__LINE__
);

61  
rv®
;

62 
	}
}

64 
	$Acû±
(
sockfd
, 
sockaddr
 *
şŸddr
, 
sockËn_t
 *
add¾’
)

66 
rv®
;

68 if((
rv®
 = 
	`acû±
(
sockfd
, 
şŸddr
, 
add¾’
)) == -1)

70 
	`”r_šfo_s
("% %d:‡cû± faed!\n", 
__FILE__
, 
__LINE__
);

73  
rv®
;

74 
	}
}

76 
	$Clo£
(
sockfd
)

78 
rv®
;

80 if((
rv®
 = 
	`şo£
(
sockfd
)) == -1)

82 
	`”r_šfo_s
("% %d: clo£ faed!\n", 
__FILE__
, 
__LINE__
);

85  
rv®
;

86 
	}
}

88 
	$G‘sockÇme
(
sockfd
, 
sockaddr
 *
loÿÏddr
, 
sockËn_t
 *
add¾’
)

90 
rv®
;

92 if((
rv®
 = 
	`g‘sockÇme
(
sockfd
, 
loÿÏddr
, 
add¾’
)) == -1)

94 
	`”r_šfo_s
("% %d :g‘sockÇmçed!\n", 
__FILE__
, 
__LINE__
);

97  
rv®
;

98 
	}
}

100 
	$G‘³”Çme
(
sockfd
, 
sockaddr
 *
³”addr
, 
sockËn_t
 *
add¾’
)

102 
rv®
;

104 if((
rv®
 = 
	`g‘³”Çme
(
sockfd
, 
³”addr
, 
add¾’
)) == -1)

106 
	`”r_šfo_s
("% %d: g‘³”Çmçed!\n", 
__FILE__
, 
__LINE__
);

109  
rv®
;

110 
	}
}

116 
	$cÚÃùW™hTimeout
(
sock
, 
sockaddr
*
addrs
, 
adrsL’
,
timev®
* 
tm
)

118 
”r
 = 0;

119 
Ën
 = ();

120 
æag
;

121 
»t
;

122 
fd_£t
 
w£t
;

123 
timev®
 
mytm
;

125 if(
tm
!=
NULL
)

127 
	`memıy
(&
mytm
, 
tm
, (
timev®
));

131 
æag
 = 1;

132 
	`ioùl
(
sock
,
FIONBIO
,&
æag
);

135 
»t
 = 
	`cÚÃù
(
sock
, 
addrs
, 
adrsL’
);

136 if(
»t
 == -1)

138 if(
EINPROGRESS
 =ğ
”ºo
)

140 
	`FD_ZERO
(&
w£t
);

141 
	`FD_SET
(
sock
,&
w£t
);

142 if(
	`£Ëù
(
sock
+1,
NULL
,&
w£t
,NULL,
tm
) > 0)

144 
	`g‘sockİt
(
sock
,
SOL_SOCKET
,
SO_ERROR
,&
”r
,(
sockËn_t
*)&
Ën
);

145 ià(0 =ğ
”r
)

147 
»t
 = 
OK
;

151 
»t
 = 
ERROR
;

156 
»t
 = 
ERROR
;

162 
æag
 = 0;

163 
	`ioùl
(
sock
,
FIONBIO
,&
æag
);

165 if(
tm
!=
NULL
)

167 
	`memıy
(
tm
, &
mytm
, (
timev®
));

170  
»t
;

171 
	}
}

173 
	$tı_cÚÃù
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
)

175 
sockfd
;

176 
sockaddr_š
 
£rv”Addr
;

178 if(
£rv”Ip
==0 || 
£rv”PÜt
==0)

183 if((
sockfd
 = 
	`Sock‘
(
AF_INET
,
SOCK_STREAM
, 0)) == -1)

188 if(
bufsize
>0)

190 if(
	`Sockİt_£t_»cvBuf
(
sockfd
, 
bufsize
) == -1)

192 
	`Clo£
(
sockfd
);

197 
	`mem£t
(&
£rv”Addr
, 0, (serverAddr));

198 
£rv”Addr
.
sš_çmy
 = 
AF_INET
;

199 
£rv”Addr
.
sš_addr
.
s_addr
 = 
£rv”Ip
;

200 
£rv”Addr
.
sš_pÜt
 = 
	`htÚs
(
£rv”PÜt
);

201 if(
	`CÚÃù
(
sockfd
, (
SA
*)&
£rv”Addr
, (serverAddr)) == -1)

203 
	`Sockİt_£t_lšg”On
(
sockfd
);

204 
	`Clo£
(
sockfd
);

208  
sockfd
;

209 
	}
}

211 
	$Tı_cÚÃù
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
)

213 
sockfd
;

215 if((
sockfd
 = 
	`tı_cÚÃù
(
£rv”Ip
, 
£rv”PÜt
, 
bufsize
)) == -1)

217 
	`”r_šfo_s
("tcp_connect failed!\n");

220  
sockfd
;

221 
	}
}

223 
	$tı_cÚÃù_nb
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
, 
timev®
 
d–aytime
)

225 
sockfd
;

226 
sockaddr_š
 
£rv”Addr
;

227 
timev®
 
timeout
;

229 if(
£rv”Ip
==0 || 
£rv”PÜt
==0)

234 if((
sockfd
 = 
	`Sock‘
(
AF_INET
,
SOCK_STREAM
, 0)) == -1)

239 if(
bufsize
>0)

241 if(
	`Sockİt_£t_»cvBuf
(
sockfd
, 
bufsize
) == -1)

243 
	`Clo£
(
sockfd
);

248 
	`mem£t
(&
£rv”Addr
, 0, (serverAddr));

249 
£rv”Addr
.
sš_çmy
 = 
AF_INET
;

250 
£rv”Addr
.
sš_addr
.
s_addr
 = 
£rv”Ip
;

251 
£rv”Addr
.
sš_pÜt
 = 
	`htÚs
(
£rv”PÜt
);

252 if(
d–aytime
.
tv_£c
==0 && d–aytime.
tv_u£c
==0)

254 
timeout
.
tv_£c
 = 5;

255 
timeout
.
tv_u£c
 = 0;

259 
timeout
.
tv_£c
 = 
d–aytime
.tv_sec;

260 
timeout
.
tv_u£c
 = 
d–aytime
.tv_usec;

262 if(
	`cÚÃùW™hTimeout
(
sockfd
,(
SA
*)&
£rv”Addr
, (£rv”Addr), &
timeout
) == -1)

264 
	`”r_šfo_s
("connectWithTimeout failed!\n");

265 
	`Sockİt_£t_lšg”On
(
sockfd
);

266 
	`Clo£
(
sockfd
);

270  
sockfd
;

271 
	}
}

273 
	$Tı_cÚÃù_nb
(
£rv”Ip
, 
UINT16
 
£rv”PÜt
, 
bufsize
, 
timev®
 
timeout
)

275 
sockfd
;

277 if((
sockfd
 = 
	`tı_cÚÃù_nb
(
£rv”Ip
, 
£rv”PÜt
, 
bufsize
, 
timeout
)) == -1)

279 
	`”r_šfo_s
("tcp_connect_nb failed!\n");

282  
sockfd
;

283 
	}
}

	@osi\netApiWrap\udpApiWrap.c

11 
	~"ÃtH—d”.h
"

27 
	$Recväom
(
sockfd
, *
buf
, 
size_t
 
nby‹s
, 
æags
, 
sockaddr
 *
äom
, 
sockËn_t
 *
add¾’
)

29 
rv®
;

31 if((
rv®
 = 
	`»cväom
(
sockfd
, 
buf
, 
nby‹s
, 
æags
, 
äom
, 
add¾’
)) == -1)

33 
	`”r_šfo_s
("recvfromƒrror!\n");

36  
rv®
;

37 
	}
}

50 
	$S’dto
(
sockfd
, cÚ¡ *
buf
, 
size_t
 
nby‹s
, 
æags
, cÚ¡ 
sockaddr
 *
to
, 
sockËn_t
 
add¾’
)

52 
rv®
;

54 if((
rv®
 = 
	`£ndto
(
sockfd
, 
buf
, 
nby‹s
, 
æags
, 
to
, 
add¾’
)) == -1)

56 
	`”r_šfo_s
("sendtoƒrror!\n");

59  
rv®
;

60 
	}
}

69 
	$Udp_sock‘
(
bufsize
)

71 
sockfd
;

73 if((
sockfd
 = 
	`Sock‘
(
AF_INET
,
SOCK_DGRAM
, 
IPPROTO_UDP
)) == -1)

78 if(
bufsize
>0)

80 if(
	`Sockİt_£t_»cvBuf
(
sockfd
, 
bufsize
) == -1)

86  
sockfd
;

87 
	}
}

	@osi\pthreadWrap\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@osi\pthreadWrap\mqueue.c

11 
	~"±h»adH—d.h
"

13 
šlše
 
	$g‘Time¥ec
(
wa™_ms
, 
time¥ec
 *

)

15 
time_t
 
£c
, 
t
;

16 
n£c
;

18 
£c
 = 0;

19 ià(
wa™_ms
 =ğ
NO_WAIT
)

21 
n£c
 = 0;

25 
n£c
 = 
wa™_ms
 * 1000000LL;

28 ià(
	`şock_g‘time
(
CLOCK_REALTIME
, 

) == -1)

30 
	`debug_šfo
(
DEBUG_LEVEL_1
,"g‘Time¥ec: clock_g‘timÿÎ fa,ƒ¼Ü %d(%s)\n", 
”ºo
, 
	`¡»¼Ü
(errno));

31 

->
tv_£c
 = 
	`time
(
NULL
) + 1;

32 

->
tv_n£c
 = 0;

36 
t
 = 
	`time
(
NULL
) + 1;

37 ià(()(

->
tv_£c
 - 
t
) > 30)

39 

->
tv_£c
 = 
t
;

40 

->
tv_n£c
 = 0;

44 
n£c
 +ğ

->
tv_n£c
;

47 ià(
n£c
 >= 1000000000)

49 
£c
 = 
n£c
 / 1000000000;

50 
n£c
 =‚sec % 1000000000;

52 

->
tv_£c
 +ğ
£c
;

53 

->
tv_n£c
 = 
n£c
;

57 
	}
}

69 
mqd_t
 
	$Mq_İ’
(cÚ¡ *
Çme
, 
oæag
, 
mode_t
 
mode
, 
mq_©Œ
 *
©Œ
)

71 
mqd_t
 
rv®
;

73 if((
rv®
 = 
	`mq_İ’
(
Çme
, 
oæag
, 
mode
, 
©Œ
)) == -1)

75 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_open() failed!\n");

78  
rv®
;

79 
	}
}

92 
	$Mq_£nd
(
mqd_t
 
mqdes
, cÚ¡ *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, 
msg_´io
)

94 
rv®
;

95 
time¥ec
 
timeout
;

97 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

99 if((
rv®
 = 
	`mq_£nd
(
mqdes
, 
msg_±r
, 
msg_Ën
, 
msg_´io
)) != 0)

101 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_send() failed!\n");

106 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

107 if((
rv®
 = 
	`mq_timed£nd
(
mqdes
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, &
timeout
)) != 0)

109 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_timedsend() failed!\n");

113  
rv®
;

114 
	}
}

127 
ssize_t
 
	$Mq_»ûive
(
mqd_t
 
mqdes
, *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, *
msg_´io
)

129 
ssize_t
 
rv®
;

130 
time¥ec
 
timeout
;

132 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

134 if((
rv®
 = 
	`mq_»ûive
(
mqdes
, 
msg_±r
, 
msg_Ën
, 
msg_´io
)) != 0)

141 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

142 if((
rv®
 = 
	`mq_timed»ûive
(
mqdes
, 
msg_±r
, 
msg_Ën
, 
msg_´io
, &
timeout
)) != 0)

148  
rv®
;

149 
	}
}

159 
	$Mq_g‘©Œ
(
mqd_t
 
mqdes
, 
mq_©Œ
 *
mq¡©
)

161 
rv®
;

163 if((
rv®
 = 
	`mq_g‘©Œ
(
mqdes
, 
mq¡©
)))

165 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_getattr() failed!\n");

168  
rv®
;

169 
	}
}

180 
	$Mq_£‰r
(
mqd_t
 
mqdes
, cÚ¡ 
mq_©Œ
 *
mq¡©
, mq_©Œ *
omq¡©
)

182 
rv®
;

184 if((
rv®
 = 
	`mq_£‰r
(
mqdes
, 
mq¡©
, 
omq¡©
)) != 0)

186 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_setattr() failed!\n");

189  
rv®
;

190 
	}
}

199 
	$Mq_uÆšk
(cÚ¡ *
Çme
)

201 
rv®
;

203 if((
rv®
 = 
	`mq_uÆšk
(
Çme
)) != 0)

208  
rv®
;

209 
	}
}

218 
	$Mq_şo£
(
mqd_t
 
mqdes
)

220 
rv®
;

222 if((
rv®
 = 
	`mq_şo£
(
mqdes
)) != 0)

224 
	`debug_šfo
(
DEBUG_LEVEL_3
, "mq_close() failed!\n");

227  
rv®
;

228 
	}
}

	@osi\pthreadWrap\pthread.c

11 
	~"±h»adH—d.h
"

13 *(*
	tFUNCPTR
)(*, *, *, *, *, *, *, *, *, *);

14 *(*
	tSTART_ROUTINE
)(*);

19 
FUNCPTR
 
	m’Œy
;

20 *
	m¬g
[10];

21 }
	tFUNC_WRAPPER2
;

25 (*
	m’Œy
)(,,,,,,,,,);

26 
	m·rms
[10];

27 }
	tFUNC_WRAPPER
;

38 
Pth»ad_ü—‹
(

39 
±h»ad_t
 *
tid
,

40 cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
,

41 *(*
¡¬t_routše
)(*),

42 *
¬g


45 
	grv®
;

47 if(
	g¡¬t_routše
 =ğ
NULL
)

52 if((
	grv®
 = 
±h»ad_ü—‹
(
tid
, 
©Œ
, 
¡¬t_routše
, 
¬g
)) != 0)

54 
debug_šfo
(
DEBUG_LEVEL_4
, "Pthread_create() failed!\n");

57  
	grv®
;

67 
	$Pth»ad_£lf
()

69  
	`±h»ad_£lf
();

70 
	}
}

79 
	$Pth»ad_equ®
(
±h»ad_t
 
tid1
,…th»ad_ˆ
tid2
)

81  
	`±h»ad_equ®
(
tid1
, 
tid2
);

82 
	}
}

91 
	$Pth»ad_ÿnûl
(
±h»ad_t
 
tid
)

93 
rv®
;

95 if((
rv®
 = 
	`±h»ad_ÿnûl
(
tid
)) != 0)

97 
	`debug_šfo
(
DEBUG_LEVEL_3
, "Pthread_cancel() failed!\n");

100  
rv®
;

101 
	}
}

110 
	$Pth»ad_ex™
(*
v®ue
)

112 
	`±h»ad_ex™
(
v®ue
);

113 
	}
}

123 
	$Pth»ad_još
(
±h»ad_t
 
th»ad
, **
v®ue
)

125 
rv®
;

127 if((
rv®
 = 
	`±h»ad_još
(
th»ad
, 
v®ue
)) != 0)

129 
	`debug_šfo
(
DEBUG_LEVEL_3
,"Pthread_join() failed!\n");

132  
rv®
;

133 
	}
}

164 
	$Pth»ad_d‘ach
(
±h»ad_t
 
tid
)

166 
rv®
;

168 if((
rv®
 = 
	`±h»ad_d‘ach
(
tid
)) != 0)

170 
	`debug_šfo
(
DEBUG_LEVEL_3
, "Pthread_detach() failed!\n");

173  
rv®
;

174 
	}
}

183 
	$±h»adIdV”ify
(
±h»ad_t
 
tid
)

185 
rv®
;

187 if((
rv®
 = 
	`±h»ad_kl
(
tid
, 0)) != 0)

189 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_kill(0) failed!\n");

192  
rv®
;

193 
	}
}

202 *
	$th»adW¿µ”2
(*
¬g
)

204 
FUNC_WRAPPER2
 
func
 = *((FUNC_WRAPPER2 *)
¬g
);

205 
	`ä“
((*)
¬g
);

207 (*(
func
.
’Œy
))(func.
¬g
[0], func.arg[1], func.arg[2], func.arg[3], func.arg[4],

208 
func
.
¬g
[5], func.arg[6], func.arg[7], func.arg[8], func.arg[9]);

210  
NULL
;

211 
	}
}

224 
	$±h»adS·wn
(
±h»ad_t
 *
±id
, 
´iÜ™y
, 
size_t
 
¡acksize
, *
funıŒ
, 
¬gs
, ...)

226 
i
, 
rv®
;

227 *
¬g
[] = {[0 ... 9] = 
NULL
};

228 
START_ROUTINE
 
¡¬t
;

229 
±h»ad_t
 
tid
, *
¿w
;

230 
±h»ad_©Œ_t
 
©Œ
;

231 
va_li¡
 
­
;

233 ià(
funıŒ
 =ğ
NULL
 || 
¬gs
 > 10)

235  
EINVAL
;

239 
	`va_¡¬t
(
­
, 
¬gs
);

240 
i
 = 0; i < 
¬gs
; i++)

242 
¬g
[
i
] = 
	`va_¬g
(
­
, *);

245 
	`va_’d
(
­
);

248 
rv®
 = 
	`Pth»ad_©Œ_£t
(&
©Œ
, 
´iÜ™y
, 
¡acksize
);

249 ià(
rv®
 != 0)

251  
rv®
;

255 
¿w
 = (
±id
 !ğ
NULL
)?…tid:(&
tid
);

256 ià(
¬gs
 <= 1)

258 
rv®
 = 
	`Pth»ad_ü—‹
(
¿w
, &
©Œ
, (
START_ROUTINE
)
funıŒ
, 
¬g
[0]);

262 
FUNC_WRAPPER2
 *
func
;

263 
func
 = (
FUNC_WRAPPER2
 *)
	`m®loc
((FUNC_WRAPPER2));

264 ià(
func
 =ğ
NULL
)

266 (è
	`Pth»ad_©Œ_de¡roy
(&
©Œ
);

267  
ENOMEM
;

270 
¡¬t
 = 
th»adW¿µ”2
;

271 
	`mem£t
((*)
func
, 0, (
FUNC_WRAPPER2
));

272 
func
->
’Œy
 = 
funıŒ
;

273 
i
 = 0; i < 
¬gs
; i++)

275 
func
->
¬g
[
i
] =‡rg[i];

277 
rv®
 = 
	`Pth»ad_ü—‹
(
¿w
, &
©Œ
, 
¡¬t
, (*)
func
);

278 ià(
rv®
 != 0)

280 
	`ä“
((*)
func
);

285 
	`Pth»ad_©Œ_de¡roy
(&
©Œ
);

287  
rv®
;

288 
	}
}

	@osi\pthreadWrap\pthreadAttr.c

11 
	~"±h»adH—d.h
"

20 
	$Pth»ad_©Œ_š™
(
±h»ad_©Œ_t
 *
©Œ
)

22 
rv®
;

24 if(
©Œ
==
NULL
)

29 if((
rv®
 = 
	`±h»ad_©Œ_š™
(
©Œ
)) != 0)

31 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Pthread_attr_init() failed!\n");

34  
rv®
;

35 
	}
}

44 
	$Pth»ad_©Œ_de¡roy
(
±h»ad_©Œ_t
 *
©Œ
)

46 
rv®
;

48 if(
©Œ
==
NULL
)

53 if((
rv®
 = 
	`±h»ad_©Œ_de¡roy
(
©Œ
)) != 0)

55 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_destroy() failed!\n");

58  
rv®
;

59 
	}
}

68 
	$Pth»ad_©Œ_g‘d‘ach¡©e
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
d‘ach¡©e
)

70 
rv®
;

72 if(
©Œ
==
NULL
 || 
d‘ach¡©e
==NULL)

77 if((
rv®
 = 
	`±h»ad_©Œ_g‘d‘ach¡©e
(
©Œ
, 
d‘ach¡©e
)) != 0)

79 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getdetacgstate() failed!\n");

82  
rv®
;

83 
	}
}

95 
	$Pth»ad_©Œ_£td‘ach¡©e
(
±h»ad_©Œ_t
 *
©Œ
, 
d‘ach¡©e
)

97 
rv®
;

99 if(
©Œ
==
NULL
)

104 if((
rv®
 = 
	`±h»ad_©Œ_£td‘ach¡©e
(
©Œ
, 
d‘ach¡©e
)) != 0)

106 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setdetacgstate() failed!\n");

109  
rv®
;

110 
	}
}

119 
	$Pth»ad_©Œ_g‘schedpŞicy
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
pŞicy
)

121 
rv®
;

123 if(
©Œ
==
NULL
 || 
pŞicy
==NULL)

128 if((
rv®
 = 
	`±h»ad_©Œ_g‘schedpŞicy
(
©Œ
, 
pŞicy
)) != 0)

130 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getschedpolicy() failed!\n");

133  
rv®
;

134 
	}
}

147 
	$Pth»ad_©Œ_£tschedpŞicy
(
±h»ad_©Œ_t
 *
©Œ
, 
pŞicy
)

149 
rv®
;

151 if(
©Œ
==
NULL
)

156 if((
rv®
 = 
	`±h»ad_©Œ_£tschedpŞicy
(
©Œ
, 
pŞicy
)) != 0)

158 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setschedpolicy() failed!\n");

161  
rv®
;

162 
	}
}

171 
	$Pth»ad_©Œ_g‘sched·¿m
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
sched_·¿m
 * 
·¿m
)

173 
rv®
;

175 if(
©Œ
==
NULL
 || 
·¿m
==NULL)

180 if((
rv®
 = 
	`±h»ad_©Œ_g‘sched·¿m
(
©Œ
, 
·¿m
)) != 0)

182 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getschedparam() failed!\n");

185  
rv®
;

186 
	}
}

196 
	$Pth»ad_©Œ_£tsched·¿m
(
±h»ad_©Œ_t
 *
©Œ
, cÚ¡ 
sched_·¿m
 *
·¿m
)

198 
rv®
;

200 if(
©Œ
==
NULL
 || 
·¿m
==NULL)

205 if((
rv®
 = 
	`±h»ad_©Œ_£tsched·¿m
(
©Œ
, 
·¿m
)) != 0)

207 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setschedparam() failed!\n");

210  
rv®
;

211 
	}
}

220 
	$Pth»ad_©Œ_g‘šh”™sched
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
šh”™sched
)

222 
rv®
;

224 if(
©Œ
==
NULL
 || 
šh”™sched
==NULL)

229 if((
rv®
 = 
	`±h»ad_©Œ_g‘šh”™sched
(
©Œ
, 
šh”™sched
)) != 0)

231 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getinheritsched() failed!\n");

234  
rv®
;

235 
	}
}

249 
	$Pth»ad_©Œ_£tšh”™sched
(
±h»ad_©Œ_t
 *
©Œ
, 
šh”™sched
)

251 
rv®
;

253 if(
©Œ
==
NULL
)

258 if((
rv®
 = 
	`±h»ad_©Œ_£tšh”™sched
(
©Œ
, 
šh”™sched
)) != 0)

260 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setinheritsched() failed!\n");

263  
rv®
;

264 
	}
}

273 
	$Pth»ad_©Œ_g‘sched´iÜ™y
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
´iÜ™y
)

275 
sched_·¿m
 
·¿ms
;

276 
rv®
;

278 if(
©Œ
==
NULL
 || 
´iÜ™y
==NULL)

283 
rv®
 = 
	`Pth»ad_©Œ_g‘sched·¿m
(
©Œ
, &
·¿ms
);

284 ià(
rv®
 != 0)

286  
rv®
;

289 *
´iÜ™y
 = 
·¿ms
.
sched_´iÜ™y
;

291  
rv®
;

292 
	}
}

302 
	$Pth»ad_g‘_´iÜ™yscİe
(
pŞicy
 , *
mšPriÜ™y
, *
maxPriÜ™y
)

304 
´iÜ™y
;

306 if(
maxPriÜ™y
==
NULL
 || 
mšPriÜ™y
==NULL)

311 if((
´iÜ™y
 = 
	`Sched_g‘_´iÜ™y_mš
(
pŞicy
)) == -1)

317 *
mšPriÜ™y
 = 
´iÜ™y
;

320 if((
´iÜ™y
 = 
	`Sched_g‘_´iÜ™y_max
(
pŞicy
)) == -1)

326 *
maxPriÜ™y
 = 
´iÜ™y
;

330 
	}
}

340 
	$Pth»ad_©Œ_£tsched´iÜ™y
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
)

342 
sched_·¿m
 
·¿ms
;

343 
maxPriÜ™y
, 
mšPriÜ™y
;

344 
rv®
;

346 if(
©Œ
==
NULL
)

352 
rv®
 = 
	`Pth»ad_g‘_´iÜ™yscİe
(
SCHED_RR
, &
mšPriÜ™y
, &
maxPriÜ™y
);

353 ià(
rv®
 != 0)

355  
rv®
;

358 ià(
´iÜ™y
 < 
mšPriÜ™y
)

360 
´iÜ™y
 = 
mšPriÜ™y
;

362 ià(
´iÜ™y
 > 
maxPriÜ™y
)

364 
´iÜ™y
 = 
maxPriÜ™y
;

368 
rv®
 = 
	`Pth»ad_©Œ_g‘sched·¿m
(
©Œ
, &
·¿ms
);

369 ià(
rv®
 != 0)

371  
rv®
;

375 
·¿ms
.
sched_´iÜ™y
 = 
´iÜ™y
;

376 
rv®
 = 
	`Pth»ad_©Œ_£tsched·¿m
(
©Œ
, &
·¿ms
);

377 ià(
rv®
 != 0)

379  
rv®
;

382  
rv®
;

383 
	}
}

392 
	$Pth»ad_©Œ_g‘scİe
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
scİe
)

394 
rv®
;

396 if(
©Œ
==
NULL
 || 
scİe
==NULL)

401 
rv®
 = 
	`±h»ad_©Œ_g‘scİe
(
©Œ
, 
scİe
);

402 ià(
rv®
 != 0)

404 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getcope() failed!\n");

407  
rv®
;

408 
	}
}

420 
	$Pth»ad_©Œ_£tscİe
(
±h»ad_©Œ_t
 *
©Œ
, 
scİe
)

422 
rv®
;

424 if(
©Œ
==
NULL
)

429 
rv®
 = 
	`±h»ad_©Œ_£tscİe
(
©Œ
, 
scİe
);

430 ià(
rv®
 != 0)

432 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setcope() failed!\n");

435  
rv®
;

436 
	}
}

445 
	$Pth»ad_©Œ_g‘¡acksize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
¡acksize
)

447 
rv®
;

449 if(
©Œ
==
NULL
 || 
¡acksize
==NULL)

454 
rv®
 = 
	`±h»ad_©Œ_g‘¡acksize
(
©Œ
, 
¡acksize
);

455 ià(
rv®
 != 0)

457 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getstacksize() failed!\n");

460  
rv®
;

461 
	}
}

472 
	$Pth»ad_©Œ_£t¡acksize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
¡acksize
)

474 
rv®
;

476 if(
©Œ
==
NULL
)

482 ià(
¡acksize
 < 
PTHREAD_STACK_MIN
)

484 
¡acksize
 = 
PTHREAD_STACK_MIN
;

488 
rv®
 = 
	`±h»ad_©Œ_£t¡acksize
(
©Œ
, 
¡acksize
);

489 ià(
rv®
 != 0)

491 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setstacksize() failed!\n");

494  
rv®
;

495 
	}
}

504 
	$Pth»ad_©Œ_g‘¡ackaddr
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, **
¡ackaddr
)

506 
rv®
;

508 if(
©Œ
==
NULL
 || 
¡ackaddr
==NULL)

513 
rv®
 = 
	`±h»ad_©Œ_g‘¡ackaddr
(
©Œ
, 
¡ackaddr
);

514 ià(
rv®
 != 0)

516 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getstackaddr() failed!\n");

519  
rv®
;

520 
	}
}

530 
	$Pth»ad_©Œ_£t¡ackaddr
(
±h»ad_©Œ_t
 *
©Œ
, *
¡ackaddr
)

532 
rv®
;

534 if(
©Œ
==
NULL
)

539 
rv®
 = 
	`±h»ad_©Œ_£t¡ackaddr
(
©Œ
, 
¡ackaddr
);

540 ià(
rv®
 != 0)

542 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setstackaddr() failed!\n");

545  
rv®
;

546 
	}
}

555 
	$Pth»ad_©Œ_g‘gu¬dsize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
gu¬dsize
)

557 
rv®
;

559 if(
©Œ
==
NULL
 || 
gu¬dsize
==NULL)

564 
rv®
 = 
	`±h»ad_©Œ_g‘gu¬dsize
(
©Œ
, 
gu¬dsize
);

565 ià(
rv®
 != 0)

567 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_getguardsize() failed!\n");

570  
rv®
;

571 
	}
}

581 
	$Pth»ad_©Œ_£tgu¬dsize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
gu¬dsize
)

583 
rv®
;

585 if(
©Œ
==
NULL
)

590 
rv®
 = 
	`±h»ad_©Œ_£tgu¬dsize
(
©Œ
, 
gu¬dsize
);

591 ià(
rv®
 != 0)

593 
	`debug_šfo
(
DEBUG_LEVEL_4
,"Pthread_attr_setguardsize() failed!\n");

596  
rv®
;

597 
	}
}

615 
	$Pth»ad_©Œ_£t
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
, 
size_t
 
¡acksize
)

617 
rv®
;

619 if(
©Œ
 =ğ
NULL
)

625 
rv®
 = 
	`Pth»ad_©Œ_š™
(
©Œ
);

626 ià(
rv®
 != 0)

628  
rv®
;

632 
rv®
 = 
	`Pth»ad_©Œ_£tšh”™sched
(
©Œ
, 
PTHREAD_EXPLICIT_SCHED
);

633 ià(
rv®
 != 0)

635 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

636  
rv®
;

640 
rv®
 = 
	`Pth»ad_©Œ_£tscİe
(
©Œ
, 
PTHREAD_SCOPE_SYSTEM
);

641 ià(
rv®
 != 0)

643 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

644  
rv®
;

648 
rv®
 = 
	`Pth»ad_©Œ_£tschedpŞicy
(
©Œ
, 
SCHED_RR
);

649 ià(
rv®
 != 0)

651 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

652  
rv®
;

656 
rv®
 = 
	`Pth»ad_©Œ_£td‘ach¡©e
(
©Œ
, 
PTHREAD_CREATE_DETACHED
);

657 ià(
rv®
 != 0)

659 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

660  
rv®
;

664 
rv®
 = 
	`Pth»ad_©Œ_£tsched´iÜ™y
(
©Œ
, 
´iÜ™y
);

665 ià(
rv®
 != 0)

667 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

668  
rv®
;

672 
rv®
 = 
	`Pth»ad_©Œ_£t¡acksize
(
©Œ
, 
¡acksize
);

673 ià(
rv®
 != 0)

675 
	`Pth»ad_©Œ_de¡roy
(
©Œ
);

676  
rv®
;

680 
	}
}

	@osi\pthreadWrap\pthreadHead.h

11 
	~<lim™s.h
>

12 
	~<¡dlib.h
>

13 
	~<¡dio.h
>

14 
	~<uni¡d.h
>

15 
	~<¡ršg.h
>

16 
	~<¡d¬g.h
>

17 
	~<”ºo.h
>

18 
	~<sys/time.h
>

19 
	~<time.h
>

20 
	~<sigÇl.h
>

21 
	~<±h»ad.h
>

22 
	~<sched.h
>

23 
	~<mqueue.h
>

24 
	~<£m­hÜe.h
>

26 
	~"±h»adW¿p.h
"

27 
	~"debug.h
"

	@osi\pthreadWrap\pthreadSched.c

11 
	~"±h»adH—d.h
"

20 
	$Sched_g‘_´iÜ™y_mš
(
pŞicy
)

22 
mšPriÜ™y
;

24 if((
mšPriÜ™y
 = 
	`sched_g‘_´iÜ™y_mš
(
pŞicy
)) == -1)

26 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_get_priority_min() failed!\n");

29  
mšPriÜ™y
;

30 
	}
}

39 
	$Sched_g‘_´iÜ™y_max
(
pŞicy
)

41 
maxPriÜ™y
;

43 if((
maxPriÜ™y
 = 
	`sched_g‘_´iÜ™y_max
(
pŞicy
)) == -1)

45 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_get_priority_max() failed!\n");

48  
maxPriÜ™y
;

49 
	}
}

58 
	$Sched_g‘scheduËr
(
pid_t
 
pid
)

60 
rv®
;

62 if((
rv®
 = 
	`sched_g‘scheduËr
(
pid
)) != 0)

64 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_getscheduler() failed!\n");

67  
rv®
;

68 
	}
}

77 
	$Sched_£tscheduËr
(
pid_t
 
pid
, 
pŞicy
, 
sched_·¿m
 *
·¿m
)

79 
rv®
;

81 if(
·¿m
 =ğ
NULL
)

86 if((
rv®
 = 
	`sched_£tscheduËr
(
pid
, 
pŞicy
, 
·¿m
)) != 0)

88 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_setscheduler() failed!\n");

91  
rv®
;

92 
	}
}

101 
	$Sched_g‘·¿m
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
)

103 
rv®
;

105 if(
·¿m
 =ğ
NULL
)

110 if((
rv®
 = 
	`sched_g‘·¿m
(
pid
, 
·¿m
)) != 0)

112 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_getparam() failed!\n");

115  
rv®
;

117 
	}
}

127 
	$Sched_£¬am
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
)

129 
rv®
;

131 if(
·¿m
 =ğ
NULL
)

136 if((
rv®
 = 
	`sched_£¬am
(
pid
, 
·¿m
)) != 0)

138 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_setparam() failed!\n");

141  
rv®
;

143 
	}
}

152 
	$Sched_¼_g‘_š‹rv®
(
pid_t
 
pid
, 
time¥ec
 *

)

154 
rv®
;

156 if(

 =ğ
NULL
)

161 if((
rv®
 = 
	`sched_¼_g‘_š‹rv®
(
pid
, 

)) != 0)

163 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Sched_rr_get_interval() failed!\n");

166  
rv®
;

167 
	}
}

	@osi\pthreadWrap\pthreadSync.c

11 
	~"±h»adH—d.h
"

13 
šlše
 
	$g‘Time¥ec
(
wa™_ms
, 
time¥ec
 *

)

15 
time_t
 
£c
, 
t
;

16 
n£c
;

18 
£c
 = 0;

19 ià(
wa™_ms
 =ğ
NO_WAIT
)

21 
n£c
 = 0;

25 
n£c
 = 
wa™_ms
 * 1000000LL;

28 ià(
	`şock_g‘time
(
CLOCK_REALTIME
, 

) == -1)

30 
	`debug_šfo
(
DEBUG_LEVEL_3
, "getTimespec: clock_gettime call fail\n");

31 

->
tv_£c
 = 
	`time
(
NULL
) + 1;

32 

->
tv_n£c
 = 0;

36 
t
 = 
	`time
(
NULL
) + 1;

37 ià(()(

->
tv_£c
 - 
t
) > 30)

39 

->
tv_£c
 = 
t
;

40 

->
tv_n£c
 = 0;

44 
n£c
 +ğ

->
tv_n£c
;

47 ià(
n£c
 >= 1000000000)

49 
£c
 = 
n£c
 / 1000000000;

50 
n£c
 =‚sec % 1000000000;

52 

->
tv_£c
 +ğ
£c
;

53 

->
tv_n£c
 = 
n£c
;

57 
	}
}

69 
	$Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *
mu‹x
)

71 
rv®
;

73 if(
mu‹x
 =ğ
NULL
)

78 if((
rv®
 = 
	`±h»ad_mu‹x_š™
(
mu‹x
, 
NULL
)) != 0)

80 
	`debug_šfo
(
DEBUG_LEVEL_4
, "Pthread_mutex_init() failed!\n");

83  
rv®
;

84 
	}
}

93 
	$Pth»ad_mu‹x_de¡roy
(
±h»ad_mu‹x_t
 *
mu‹x
)

95 
rv®
;

97 if(
mu‹x
 =ğ
NULL
)

102 if((
rv®
 = 
	`±h»ad_mu‹x_de¡roy
(
mu‹x
)) != 0)

104 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_mutex_destroy() failed!\n");

107  
rv®
;

108 
	}
}

118 
	$Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
)

120 
rv®
;

121 
time¥ec
 
timeout
;

123 if(
mu‹x
 =ğ
NULL
)

128 ià(
wa™_ms
 =ğ
NO_WAIT
)

130 if((
rv®
 = 
	`±h»ad_mu‹x_Œylock
(
mu‹x
)) != 0)

132 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_mutex_trylock() failed!\n");

135 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

137 if((
rv®
 = 
	`±h»ad_mu‹x_lock
(
mu‹x
)) != 0)

139 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_mutex_lock() failed!\n");

144 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

145 if((
rv®
 = 
	`±h»ad_mu‹x_timedlock
(
mu‹x
, &
timeout
)) != 0)

147 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_mutex_timedlock() failed!\n");

151  
rv®
;

152 
	}
}

161 
	$Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *
mu‹x
)

163 
rv®
;

165 if(
mu‹x
 =ğ
NULL
)

170 if((
rv®
 = 
	`±h»ad_mu‹x_uÆock
(
mu‹x
)) != 0)

172 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_mutex_unlock() failed!\n");

175  
rv®
;

176 
	}
}

196 
	$Sem_š™
(
£m_t
 *
£m
, 
v®ue
)

198 
rv®
;

200 if(
£m
 =ğ
NULL
)

206 if((
rv®
 = 
	`£m_š™
(
£m
, 0, 
v®ue
)) != 0)

208 
	`debug_šfo
(
DEBUG_LEVEL_4
, "sem_init() failed!\n");

211  
rv®
;

212 
	}
}

221 
	$Sem_de¡roy
(
£m_t
 *
£m
)

223 
rv®
;

225 if(
£m
 =ğ
NULL
)

230 if((
rv®
 = 
	`£m_de¡roy
(
£m
)) != 0)

232 
	`debug_šfo
(
DEBUG_LEVEL_4
, "sem_destroy() failed!\n");

235  
rv®
;

236 
	}
}

245 
	$Sem_po¡
(
£m_t
 *
£m
)

247 
rv®
;

249 if(
£m
 =ğ
NULL
)

254 if((
rv®
 = 
	`£m_po¡
(
£m
)) != 0)

256 
	`debug_šfo
(
DEBUG_LEVEL_4
, "sem_post() failed!\n");

259  
rv®
;

260 
	}
}

270 
	$Sem_wa™
(
£m_t
 *
£m
, 
wa™_ms
)

272 
rv®
;

273 
time¥ec
 
timeout
;

275 if(
£m
 =ğ
NULL
)

280 ià(
wa™_ms
 =ğ
NO_WAIT
)

282 if((
rv®
 = 
	`£m_Œywa™
(
£m
)) != 0)

284 
	`debug_šfo
(
DEBUG_LEVEL_3
, "sem_trywait() failed!\n");

287 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

289 if((
rv®
 = 
	`£m_wa™
(
£m
)) != 0)

291 
	`debug_šfo
(
DEBUG_LEVEL_4
, "sem_wait() failed!\n");

296 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

297 if((
rv®
 = 
	`£m_timedwa™
(
£m
, &
timeout
)) != 0)

303  
rv®
;

304 
	}
}

311 
£m_t
 *
	$Sem_İ’
(cÚ¡ *
Çme
, 
oæag
, ...)

313 
£m_t
 *
rv®
;

314 
va_li¡
 
¬gs
;

316 
	`va_¡¬t
(
¬gs
, 
oæag
);

317 
rv®
 = 
	`£m_İ’
(
Çme
, 
oæag
, 
¬gs
);

318 
	`va_’d
(
¬gs
);

320  
rv®
;

321 
	}
}

323 
	$Sem_uÆšk
(cÚ¡ *
Çme
)

325 
rv®
;

327 
rv®
 = 
	`£m_uÆšk
(
Çme
);

329  
rv®
;

330 
	}
}

332 
	$Sem_şo£
(
£m_t
 *
£m
)

334 
rv®
;

336 
rv®
 = 
	`£m_şo£
(
£m
);

338  
rv®
;

339 
	}
}

354 
	$Pth»ad_rwlock_š™
(
±h»ad_rwlock_t
 *
rwlock
)

356 
rv®
;

358 if(
rwlock
 =ğ
NULL
)

363 if((
rv®
 = 
	`±h»ad_rwlock_š™
(
rwlock
, 
NULL
)) != 0)

365 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_rwlock_init() failed!\n");

368  
rv®
;

369 
	}
}

378 
	$Pth»ad_rwlock_de¡roy
(
±h»ad_rwlock_t
 *
rwlock
)

380 
rv®
;

382 if(
rwlock
 =ğ
NULL
)

387 if((
rv®
 = 
	`±h»ad_rwlock_de¡roy
(
rwlock
)) != 0)

389 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_rwlock_destroy() failed!\n");

392  
rv®
;

393 
	}
}

403 
	$Pth»ad_rwlock_rdlock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
)

405 
rv®
 = 0;

408 if(
rwlock
 =ğ
NULL
)

413 ià(
wa™_ms
 =ğ
NO_WAIT
)

415 if((
rv®
 = 
	`±h»ad_rwlock_Œyrdlock
(
rwlock
)) != 0)

417 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_rwlock_tryrdlock() failed!\n");

420 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

422 if((
rv®
 = 
	`±h»ad_rwlock_rdlock
(
rwlock
)) != 0)

424 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_rwlock_rdlock() failed!\n");

430 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

431 if((
rv®
 = 
	`±h»ad_rwlock_timedrdlock
(
rwlock
, &
timeout
)) != 0)

433 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_rwlock_timedrdlock() failed!\n");

438  
rv®
;

439 
	}
}

449 
	$Pth»ad_rwlock_w¾ock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
)

451 
rv®
 = 0;

454 if(
rwlock
 =ğ
NULL
)

459 ià(
wa™_ms
 =ğ
NO_WAIT
)

461 if((
rv®
 = 
	`±h»ad_rwlock_Œyw¾ock
(
rwlock
)) != 0)

463 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_rwlock_trywrlock() failed!\n");

466 ià(
wa™_ms
 =ğ
WAIT_FOREVER
)

468 if((
rv®
 = 
	`±h»ad_rwlock_w¾ock
(
rwlock
)) != 0)

470 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_rwlock_wrlock() failed!\n");

476 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

477 if((
rv®
 = 
	`±h»ad_rwlock_timedw¾ock
(
rwlock
, &
timeout
)) != 0)

479 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_rwlock_timedwrlock() failed!\n");

484  
rv®
;

485 
	}
}

494 
	$Pth»ad_rwlock_uÆock
(
±h»ad_rwlock_t
 *
rwlock
)

496 
rv®
;

498 if(
rwlock
 =ğ
NULL
)

503 if((
rv®
 = 
	`±h»ad_rwlock_uÆock
(
rwlock
)) != 0)

505 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_rwlock_unlock() failed!\n");

508  
rv®
;

509 
	}
}

523 
	$Pth»ad_cÚd_š™
(
±h»ad_cÚd_t
 *
cÚd
)

525 
rv®
;

527 if(
cÚd
 =ğ
NULL
)

532 if((
rv®
 = 
	`±h»ad_cÚd_š™
(
cÚd
, 
NULL
)) != 0)

534 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_cond_init() failed!\n");

537  
rv®
;

538 
	}
}

547 
	$Pth»ad_cÚd_de¡roy
(
±h»ad_cÚd_t
 *
cÚd
)

549 
rv®
;

551 if(
cÚd
 =ğ
NULL
)

556 if((
rv®
 = 
	`±h»ad_cÚd_de¡roy
(
cÚd
)) != 0)

558 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_cond_destroy() failed!\n");

561  
rv®
;

562 
	}
}

572 
	$Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
)

574 
rv®
;

576 if(
cÚd
 =ğ
NULL
 || 
mu‹x
 == NULL)

581 if((
rv®
 = 
	`±h»ad_cÚd_wa™
(
cÚd
,
mu‹x
)) != 0)

583 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_cond_wait() failed!\n");

586  
rv®
;

587 
	}
}

598 
	$Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
)

600 
rv®
;

601 
time¥ec
 
timeout
;

603 if(
cÚd
 =ğ
NULL
 || 
mu‹x
 == NULL)

608 ià(
wa™_ms
 =ğ
NO_WAIT
)

610 
	`g‘Time¥ec
(0, &
timeout
);

611 if((
rv®
 = 
	`±h»ad_cÚd_timedwa™
(
cÚd
, 
mu‹x
, &
timeout
)) != 0)

613 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_cond_timedwait() failed!\n");

618 
	`g‘Time¥ec
(
wa™_ms
, &
timeout
);

619 if((
rv®
 = 
	`±h»ad_cÚd_timedwa™
(
cÚd
, 
mu‹x
, &
timeout
)) != 0)

621 
	`debug_šfo
(
DEBUG_LEVEL_3
, "pthread_cond_timedwait() failed!\n");

625  
rv®
;

626 
	}
}

635 
	$Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *
cÚd
)

637 
rv®
;

639 if(
cÚd
 =ğ
NULL
)

644 if((
rv®
 = 
	`±h»ad_cÚd_sigÇl
(
cÚd
)) != 0)

646 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_cond_signal() failed!\n");

649  
rv®
;

650 
	}
}

659 
	$Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *
cÚd
)

661 
rv®
;

663 if(
cÚd
 =ğ
NULL
)

668 if((
rv®
 = 
	`±h»ad_cÚd_brßdÿ¡
(
cÚd
)) != 0)

670 
	`debug_šfo
(
DEBUG_LEVEL_4
, "pthread_cond_broadcast() failed!\n");

673  
rv®
;

674 
	}
}

	@osi\pthreadWrap\pthreadSyncAttr.c

	@osi\pthreadWrap\pthreadWrap.h

11 #iâdeà
_PTHREADWRAP_H


12 
	#_PTHREADWRAP_H


	)

14 
	~<¡d¬g.h
>

15 
	~<±h»ad.h
>

16 
	~<mqueue.h
>

17 
	~<£m­hÜe.h
>

19 #ifdeà
__ılu¥lus


27 
	s__±h»ad_©Œ_s


29 
__d‘ach¡©e
;

30 
__schedpŞicy
;

31 
__sched_·¿m
 
__sched·¿m
;

32 
__šh”™sched
;

33 
__scİe
;

34 
size_t
 
__gu¬dsize
;

35 
__¡ackaddr_£t
;

36 *
__¡ackaddr
;

37 
size_t
 
__¡acksize
;

38 } 
	t±h»ad_©Œ_t
;

43 
	ssched_·¿m


45 
	m__sched_´iÜ™y
;

49 
	#NO_WAIT
 0

	)

50 
	#WAIT_FOREVER
 (-1)

	)

53 
±h»adS·wn
(
±h»ad_t
 *
±id
, 
´iÜ™y
, 
size_t
 
¡acksize
, *
funıŒ
, 
¬gs
, ...);

54 
Pth»ad_£lf
();

55 
Pth»ad_equ®
(
±h»ad_t
 
tid1
,…th»ad_ˆ
tid2
);

56 
Pth»ad_ÿnûl
(
±h»ad_t
 
tid
);

57 
Pth»ad_ex™
(*
v®ue
);

58 
Pth»ad_još
(
±h»ad_t
 
th»ad
, **
v®ue
);

60 
	#Pth»ad_ş—nup_push
(
routše
, 
¬gs
è
	`±h»ad_ş—nup_push
((*routše)(*), *¬gs)

	)

61 
	#Pth»ad_ş—nup_pİ
(
execu‹
è
	`±h»ad_ş—nup_pİ
(execu‹)

	)

62 
±h»adIdV”ify
(
±h»ad_t
 
tid
);

65 
Pth»ad_©Œ_£t
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
, 
size_t
 
¡acksize
);

66 
Pth»ad_©Œ_š™
(
±h»ad_©Œ_t
 *
©Œ
);

67 
Pth»ad_©Œ_de¡roy
(
±h»ad_©Œ_t
 *
©Œ
);

68 
Pth»ad_©Œ_g‘d‘ach¡©e
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
d‘ach¡©e
);

69 
Pth»ad_©Œ_£td‘ach¡©e
(
±h»ad_©Œ_t
 *
©Œ
, 
d‘ach¡©e
);

70 
Pth»ad_©Œ_g‘schedpŞicy
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
pŞicy
);

71 
Pth»ad_©Œ_£tschedpŞicy
(
±h»ad_©Œ_t
 *
©Œ
, 
pŞicy
);

72 
Pth»ad_©Œ_g‘sched·¿m
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
sched_·¿m
 * 
·¿m
);

73 
Pth»ad_©Œ_£tsched·¿m
(
±h»ad_©Œ_t
 *
©Œ
, cÚ¡ 
sched_·¿m
 *
·¿m
);

74 
Pth»ad_©Œ_g‘šh”™sched
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
šh”™sched
);

75 
Pth»ad_©Œ_£tšh”™sched
(
±h»ad_©Œ_t
 *
©Œ
, 
šh”™sched
);

76 
Pth»ad_©Œ_g‘sched´iÜ™y
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
´iÜ™y
);

77 
Pth»ad_©Œ_£tsched´iÜ™y
(
±h»ad_©Œ_t
 *
©Œ
, 
´iÜ™y
);

78 
Pth»ad_©Œ_g‘scİe
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, *
scİe
);

79 
Pth»ad_©Œ_£tscİe
(
±h»ad_©Œ_t
 *
©Œ
, 
scİe
);

80 
Pth»ad_©Œ_g‘¡acksize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
¡acksize
);

81 
Pth»ad_©Œ_£t¡acksize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
¡acksize
);

82 
Pth»ad_©Œ_g‘¡ackaddr
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, **
¡ackaddr
);

83 
Pth»ad_©Œ_£t¡ackaddr
(
±h»ad_©Œ_t
 *
©Œ
, *
¡ackaddr
);

84 
Pth»ad_©Œ_g‘gu¬dsize
(cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 *
gu¬dsize
);

85 
Pth»ad_©Œ_£tgu¬dsize
(
±h»ad_©Œ_t
 *
©Œ
, 
size_t
 
gu¬dsize
);

88 
Sched_g‘_´iÜ™y_mš
(
pŞicy
);

89 
Sched_g‘_´iÜ™y_max
(
pŞicy
);

90 
Sched_g‘scheduËr
(
pid_t
 
pid
);

91 
Sched_£tscheduËr
(
pid_t
 
pid
, 
pŞicy
, 
sched_·¿m
 *
·¿m
);

92 
Sched_g‘·¿m
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
);

93 
Sched_£¬am
(
pid_t
 
pid
, 
sched_·¿m
 *
·¿m
);

94 
Sched_¼_g‘_š‹rv®
(
pid_t
 
pid
, 
time¥ec
 *

);

100 
Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *
mu‹x
);

101 
Pth»ad_mu‹x_de¡roy
(
±h»ad_mu‹x_t
 *
mu‹x
);

102 
Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
);

103 
Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *
mu‹x
);

106 
	#SEM_EMPTY
 0

	)

107 
	#SEM_FULL
 1

	)

108 
Sem_š™
(
£m_t
 *
£m
, 
v®ue
);

109 
Sem_de¡roy
(
£m_t
 *
£m
);

110 
Sem_po¡
(
£m_t
 *
£m
);

111 
Sem_wa™
(
£m_t
 *
£m
, 
wa™_ms
);

114 
Pth»ad_rwlock_š™
(
±h»ad_rwlock_t
 *
rwlock
);

115 
Pth»ad_rwlock_de¡roy
(
±h»ad_rwlock_t
 *
rwlock
);

116 
Pth»ad_rwlock_rdlock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
);

117 
Pth»ad_rwlock_w¾ock
(
±h»ad_rwlock_t
 *
rwlock
, 
wa™_ms
);

118 
Pth»ad_rwlock_uÆock
(
±h»ad_rwlock_t
 *
rwlock
);

121 
Pth»ad_cÚd_š™
(
±h»ad_cÚd_t
 *
cÚd
);

122 
Pth»ad_cÚd_de¡roy
(
±h»ad_cÚd_t
 *
cÚd
);

123 
Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
);

124 
Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *
cÚd
, 
±h»ad_mu‹x_t
 *
mu‹x
, 
wa™_ms
);

125 
Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *
cÚd
);

126 
Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *
cÚd
);

130 
mqd_t
 
Mq_İ’
(cÚ¡ *
Çme
, 
oæag
, 
mode_t
 
mode
, 
mq_©Œ
 *
©Œ
);

131 
Mq_£nd
(
mqd_t
 
mqdes
, cÚ¡ *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, 
msg_´io
);

132 
ssize_t
 
Mq_»ûive
(
mqd_t
 
mqdes
, *
msg_±r
, 
size_t
 
msg_Ën
, 
wa™_ms
, *
msg_´io
);

133 
Mq_g‘©Œ
(
mqd_t
 
mqdes
, 
mq_©Œ
 *
mq¡©
);

134 
Mq_£‰r
(
mqd_t
 
mqdes
, cÚ¡ 
mq_©Œ
 *
mq¡©
, mq_©Œ *
omq¡©
);

135 
Mq_uÆšk
(cÚ¡ *
Çme
);

136 
Mq_şo£
(
mqd_t
 
mqdes
);

138 #ifdeà
__ılu¥lus


	@osi\timeApiWrap\debug.h

12 #iâdeà
_DEBUG_H


13 
	#_DEBUG_H


	)

15 #ifdeà 
__ılu¥lus


20 
	#DEBUG_LEVEL_1
 1

21 
	#DEBUG_LEVEL_2
 2

22 
	#DEBUG_LEVEL_3
 3

23 
	#DEBUG_LEVEL_4
 4

24 

	)

25 
debug_šfo
(
debugLev–
, cÚ¡ *
fmt
, ...);

27 #ifdeà
__ılu¥lus


	@osi\timeApiWrap\timeApiWrap.c

11 
	~"timeH—d”.h
"

13 
	$m¦“p
(
ms
)

15  
	`u¦“p
(
ms
*1000);

16 
	}
}

18 
	$g‘SysHZ
()

21 
	}
}

23 
	$g‘SysMsP”Tick
()

25 
tick
;

27 
tick
 = (1/
	`g‘SysHZ
())*1000;

29  
tick
;

30 
	}
}

32 
	$skD–ay
(
ticks
)

34 
msP”tick
;

36 
msP”tick
 = 
	`g‘SysMsP”Tick
();

37 
	`m¦“p
(
msP”tick
*
ticks
);

40 
	}
}

53 
	$Tim”_ü—‹
(
şockid_t
 
şockId
, 
sigev’t
 *
ev’tHªdË
, 
tim”_t
 *
tim”Id
)

55 
rv®
;

57 if((
rv®
 = 
	`tim”_ü—‹
(
şockId
, 
ev’tHªdË
, 
tim”Id
)) != 0)

59 
	`”r_šfo_f
("%s%d:im”_ü—‹ƒ¼Ü!\n", 
__FILE__
, 
__LINE__
);

62  
rv®
;

63 
	}
}

72 
	$Tim”_d–‘e
(
tim”_t
 
tim”
)

74 
rv®
;

76 if((
rv®
 = 
	`tim”_d–‘e
(
tim”
)) != 0)

78 
	`”r_šfo_f
("%s%d:im”_d–‘”rÜ!\n", 
__FILE__
, 
__LINE__
);

81  
rv®
;

82 
	}
}

91 
	$Tim”_g‘ov”run
(
tim”_t
 
tim”Id
)

93 
ov”runs
;

95 if((
ov”runs
 = 
	`tim”_g‘ov”run
(
tim”Id
)è=ğ
EINVAL
)

97 
	`”r_šfo_f
("%s%d:im”_g‘ov”ruÀ”rÜ!\n", 
__FILE__
, 
__LINE__
);

100  
ov”runs
;

101 
	}
}

110 
	$Tim”_g‘time
(
tim”_t
 
tim”Id
, 
™im”¥ec
 *
ov®ue
)

112 
rv®
;

114 if((
rv®
 = 
	`tim”_g‘time
(
tim”Id
, 
ov®ue
)) != 0)

116 
	`”r_šfo_f
("%s%d:im”_g‘tim”rÜ!\n", 
__FILE__
, 
__LINE__
);

119  
rv®
;

120 
	}
}

130 
	$Tim”_£‰ime
(
tim”_t
 
tim”Id
, 
æags
, cÚ¡ 
™im”¥ec
 *
v®ue
, ™im”¥eø*
ov®ue
)

132 
rv®
;

134 if((
rv®
 = 
	`tim”_£‰ime
(
tim”Id
, 
æags
, 
v®ue
, 
ov®ue
)) != 0)

136 
	`”r_šfo_f
("%s%d:im”_£‰im”rÜ!\n", 
__FILE__
, 
__LINE__
);

139  
rv®
;

140 
	}
}

	@osi\timeApiWrap\timeApiWrap.h

11 #iâdeà
_TIME_API_WRAP_H


12 
	#_TIME_API_WRAP_H


	)

15 #ifdeà
__ılu¥lus


22 
m¦“p
(
ms
);

23 
g‘SysMsP”Tick
();

24 
skD–ay
(
ticks
);

29 
Tim”_ü—‹
(
şockid_t
 
şockId
, 
sigev’t
 *
ev’tHªdË
, 
tim”_t
 *
tim”Id
);

30 
Tim”_d–‘e
(
tim”_t
 
tim”
);

31 
Tim”_g‘ov”run
(
tim”_t
 
tim”Id
);

32 
Tim”_g‘time
(
tim”_t
 
tim”Id
, 
™im”¥ec
 *
ov®ue
);

33 
Tim”_£‰ime
(
tim”_t
 
tim”Id
, 
æags
, cÚ¡ 
™im”¥ec
 *
v®ue
, ™im”¥eø*
ov®ue
);

35 #ifdeà
__ılu¥lus


	@osi\timeApiWrap\timeHeader.h

11 
	~<¡dio.h
>

12 
	~<uni¡d.h
>

13 
	~<¡ršg.h
>

14 
	~<”ºo.h
>

15 
	~<sys/time.h
>

16 
	~<sys/ty³s.h
>

20 
	~"debug.h
"

	@osi\unpv13e\unpv13e\advio\daytimetcpcli.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
, 
Å’d
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr_¡Üage
 
ss
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:‡.out <hostname or IPaddress> <service or…ort#>");

14 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

16 
Ën
 = (
ss
);

17 
	`G‘³”Çme
(
sockfd
, (
SA
 *)&
ss
, &
Ën
);

18 
	`´štf
("cÚÃùedØ%s\n", 
	`Sock_Áİ_ho¡
((
SA
 *)&
ss
, 
Ën
));

21 iàĞ(
n
 = 
	`Recv
(
sockfd
, 
»cvlše
, 
MAXLINE
, 
MSG_PEEK
)) == 0)

24 
	`Ioùl
(
sockfd
, 
FIONREAD
, &
Å’d
);

25 
	`´štf
("%d by‹ äom PEEK, %d by‹ ³ndšg\n", 
n
, 
Å’d
);

27 
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
);

28 
»cvlše
[
n
] = 0;

29 
	`Fputs
(
»cvlše
, 
¡dout
);

31 
	`ex™
(0);

32 
	}
}

	@osi\unpv13e\unpv13e\advio\daytimeudpcli3.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
, 
nq
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
§Ën
;

9 
sockaddr
 *
§
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:‡.out <hostname or IPaddress> <service or…ort#>");

14 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

16 
	`´štf
("£ndšgØ%s\n", 
	`Sock_Áİ_ho¡
(
§
, 
§Ën
));

18 
	`S’dto
(
sockfd
, "", 1, 0, 
§
, 
§Ën
);

20 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 
MSG_PEEK
, 
NULL
, NULL);

22 
	`Ioùl
(
sockfd
, 
FIONREAD
, &
nq
);

23 
	`´štf
("%d by‹ äom PEEK, %d by‹ ³ndšg\n", 
n
, 
nq
);

25 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

26 
»cvlše
[
n
] = 0;

27 
	`Fputs
(
»cvlše
, 
¡dout
);

29 
	`ex™
(0);

30 
	}
}

	@osi\unpv13e\unpv13e\advio\daytimeudpcli4.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
, 
nq
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr_¡Üage
 
ss
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:‡.out <hostname or IPaddress> <service or…ort#>");

14 
sockfd
 = 
	`Udp_cÚÃù
(
¬gv
[1],‡rgv[2]);

16 
Ën
 = (
ss
);

17 
	`G‘³”Çme
(
sockfd
, (
SA
 *)&
ss
, &
Ën
);

18 
	`´štf
("cÚÃùedØ%s\n", 
	`Sock_Áİ_ho¡
((
SA
 *)&
ss
, 
Ën
));

20 
	`Wr™e
(
sockfd
, "", 2);

22 
n
 = 
	`Recv
(
sockfd
, 
»cvlše
, 
MAXLINE
, 
MSG_PEEK
);

24 
	`Ioùl
(
sockfd
, 
FIONREAD
, &
nq
);

25 
	`´štf
("%d by‹ äom PEEK, %d by‹ ³ndšg\n", 
n
, 
nq
);

27 
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
);

28 
»cvlše
[
n
] = 0;

29 
	`Fputs
(
»cvlše
, 
¡dout
);

31 
	`ex™
(0);

32 
	}
}

	@osi\unpv13e\unpv13e\advio\dgclitimeo.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

11 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

13 ià(
	`R—dabË_timeo
(
sockfd
, 5) == 0) {

14 
	`årštf
(
¡d”r
, "socketimeout\n");

17 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

19 
»cvlše
[
n
] = 0;

20 
	`Fputs
(
»cvlše
, 
¡dout
);

22 
	}
}

	@osi\unpv13e\unpv13e\advio\dgclitimeo1.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

11 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

13 ià(
	`R—dabË_timeo
(
sockfd
, 5) == 0) {

14 
	`årštf
(
¡d”r
, "socketimeout\n");

16 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

17 
»cvlše
[
n
] = 0;

18 
	`Fputs
(
»cvlše
, 
¡dout
);

21 
	}
}

	@osi\unpv13e\unpv13e\advio\dgclitimeo2.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

8 
timev®
 
tv
;

10 
tv
.
tv_£c
 = 5;

11 
tv
.
tv_u£c
 = 0;

12 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVTIMEO
, &
tv
, (tv));

14 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

16 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

18 
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

19 ià(
n
 < 0) {

20 ià(
”ºo
 =ğ
EWOULDBLOCK
) {

21 
	`årštf
(
¡d”r
, "socketimeout\n");

24 
	`”r_sys
("recvfromƒrror");

27 
»cvlše
[
n
] = 0;

28 
	`Fputs
(
»cvlše
, 
¡dout
);

30 
	}
}

	@osi\unpv13e\unpv13e\advio\dgclitimeo3.c

1 
	~"uÅ.h
"

3 
sig_®rm
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

13 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

17 
	`®¬m
(5);

18 iàĞ(
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL)) < 0) {

19 ià(
”ºo
 =ğ
EINTR
)

20 
	`årštf
(
¡d”r
, "socketimeout\n");

22 
	`”r_sys
("recvfromƒrror");

24 
	`®¬m
(0);

25 
»cvlše
[
n
] = 0;

26 
	`Fputs
(
»cvlše
, 
¡dout
);

29 
	}
}

32 
	$sig_®rm
(
signo
)

35 
	}
}

	@osi\unpv13e\unpv13e\advio\dgechoaddr.c

1 
	~"uÅifi.h
"

3 #undeà
MAXLINE


4 
	#MAXLINE
 20

	)

7 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

9 
æags
;

10 cÚ¡ 
Ú
 = 1;

11 
sockËn_t
 
Ën
;

12 
ssize_t
 
n
;

13 
mesg
[
MAXLINE
], 
¡r
[
INET6_ADDRSTRLEN
],

14 
iâame
[
IFNAMSIZ
];

15 
š_addr
 
š_z”o
;

16 
uÅ_š_pktšfo
 
pktšfo
;

18 #ifdef 
IP_RECVDSTADDR


19 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
, &
Ú
, (on)) < 0)

20 
	`”r_»t
("setsockopt of IP_RECVDSTADDR");

22 #ifdef 
IP_RECVIF


23 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVIF
, &
Ú
, (on)) < 0)

24 
	`”r_»t
("setsockopt of IP_RECVIF");

26 
	`bz”o
(&
š_z”o
, (
š_addr
));

29 
Ën
 = 
ş’
;

30 
æags
 = 0;

31 
n
 = 
	`Recväom_æags
(
sockfd
, 
mesg
, 
MAXLINE
, &
æags
,

32 
pşŸddr
, &
Ën
, &
pktšfo
);

33 
	`´štf
("%d-by‹ d©ag¿m from %s", 
n
, 
	`Sock_Áİ
(
pşŸddr
, 
Ën
));

34 ià(
	`memcmp
(&
pktšfo
.
i_addr
, &
š_z”o
, (in_zero)) != 0)

35 
	`´štf
(",Ø%s", 
	`IÃt_Áİ
(
AF_INET
, &
pktšfo
.
i_addr
,

36 
¡r
, (str)));

37 ià(
pktšfo
.
i_ifšdex
 > 0)

38 
	`´štf
(",„ecv i/f = %s",

39 
	`If_šdextÚame
(
pktšfo
.
i_ifšdex
, 
iâame
));

40 #ifdef 
MSG_TRUNC


41 ià(
æags
 & 
MSG_TRUNC
è
	`´štf
(" (datagramruncated)");

43 #ifdef 
MSG_CTRUNC


44 ià(
æags
 & 
MSG_CTRUNC
è
	`´štf
(" (control inforuncated)");

46 #ifdef 
MSG_BCAST


47 ià(
æags
 & 
MSG_BCAST
è
	`´štf
(" (broadcast)");

49 #ifdef 
MSG_MCAST


50 ià(
æags
 & 
MSG_MCAST
è
	`´štf
(" (multicast)");

52 
	`´štf
("\n");

54 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
pşŸddr
, 
Ën
);

56 
	}
}

	@osi\unpv13e\unpv13e\advio\old\dgechoaddr.c

1 
	~"uÅ.h
"

3 #undeà
MAXLINE


4 
	#MAXLINE
 20

	)

7 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

9 
æags
;

10 cÚ¡ 
Ú
 = 1;

11 
sockËn_t
 
Ën
;

12 
ssize_t
 
n
;

13 
mesg
[
MAXLINE
], 
¡r
[
INET6_ADDRSTRLEN
];

14 
š_addr
 
d¡addr
;

16 #ifdef 
IP_RECVDSTADDR


17 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
, &
Ú
, (on));

21 
Ën
 = 
ş’
;

22 
æags
 = 0;

23 
n
 = 
	`Recväom_æags
(
sockfd
, 
mesg
, 
MAXLINE
, &
æags
,

24 
pşŸddr
, &
Ën
, &
d¡addr
);

25 
	`´štf
("%d-by‹ d©ag¿m from %s", 
n
, 
	`Sock_Áİ
(
pşŸddr
, 
Ën
));

26 ià((
æags
 & 
MSG_CTRUNC
) == 0)

27 
	`´štf
(",Ø%s", 
	`IÃt_Áİ
(
AF_INET
, &
d¡addr
, 
¡r
, (str)));

28 #ifdef 
MSG_TRUNC


29 ià(
æags
 & 
MSG_TRUNC
è
	`´štf
(" (datagramruncated)");

31 #ifdef 
MSG_BCAST


32 ià(
æags
 & 
MSG_BCAST
è
	`´štf
(" (broadcast)");

34 #ifdef 
MSG_MCAST


35 ià(
æags
 & 
MSG_MCAST
è
	`´štf
(" (multicast)");

37 
	`´štf
("\n");

39 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
pşŸddr
, 
ş’
);

41 
	}
}

	@osi\unpv13e\unpv13e\advio\old\recvfromflags.c

1 
	~"uÅ.h
"

3 
ssize_t


4 
	$»cväom_æags
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
æag¥
,

5 
SA
 *
§
, 
sockËn_t
 *
§ËÅŒ
, *
d¡add½
)

7 
msghdr
 
msg
;

8 
iovec
 
iov
[1];

9 
ssize_t
 
n
;

11 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


12 
	#CONTROL_LEN
 ((
cmsghdr
è+ (
š_addr
))

	)

13 
cÚŒŞ
[
CONTROL_LEN
];

15 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ
;

16 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ
);

17 
msg
.
msg_æags
 = 0;

19 
	`bz”o
(&
msg
, (msg));

22 
msg
.
msg_Çme
 = 
§
;

23 
msg
.
msg_Çm–’
 = *
§ËÅŒ
;

24 
iov
[0].
iov_ba£
 = 
±r
;

25 
iov
[0].
iov_Ën
 = 
nby‹s
;

26 
msg
.
msg_iov
 = 
iov
;

27 
msg
.
msg_iovËn
 = 1;

29 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, *
æag¥
)) < 0)

30 (
n
);

32 *
§ËÅŒ
 = 
msg
.
msg_Çm–’
;

33 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


34 *
æag¥
 = 
msg
.
msg_æags
;

44 #ifdef 
IP_RECVDSTADDR


45 ià(
d¡add½
 && 
msg
.
msg_cÚŒŞËn
 > 0 &&

46 (
msg
.
msg_æags
 & 
MSG_CTRUNC
) == 0) {

47 
cmsghdr
 *
cm±r
 = 
	`CMSG_FIRSTHDR
(&
msg
);

49 ià(
cm±r
->
cmsg_Ën
 !ğ
CONTROL_LEN
)

50 
	`”r_qu™
("cÚŒŞ†’gth = %d", 
cm±r
->
cmsg_Ën
);

51 ià(
cm±r
->
cmsg_Ëv–
 !ğ
IPPROTO_IP
)

52 
	`”r_qu™
("control†evel != IPPROTO_IP");

53 ià(
cm±r
->
cmsg_ty³
 !ğ
IP_RECVDSTADDR
)

54 
	`”r_qu™
("controlype != IP_RECVDSTADDR");

55 
	`memıy
(
d¡add½
, 
	`CMSG_DATA
(
cm±r
), (
š_addr
));

58 *
æag¥
 |ğ
MSG_CTRUNC
;

60 *
æag¥
 |ğ
MSG_CTRUNC
;

63 (
n
);

64 
	}
}

66 
ssize_t


67 
	$Recväom_æags
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
æag¥
,

68 
SA
 *
§
, 
sockËn_t
 *
§ËÅŒ
, *
d¡add½
)

70 
ssize_t
 
n
;

72 
n
 = 
	`»cväom_æags
(
fd
, 
±r
, 
nby‹s
, 
æag¥
, 
§
, 
§ËÅŒ
, 
d¡add½
);

73 ià(
n
 < 0)

74 
	`”r_qu™
("recvfrom_flagsƒrror");

76 (
n
);

77 
	}
}

	@osi\unpv13e\unpv13e\advio\old\test01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
æag
;

7 
ssize_t
 
n
;

8 
buff
[
MAXLINE
];

9 cÚ¡ 
Ú
 = 1;

10 
sockËn_t
 
add¾’
, 
Ën
;

11 
sockaddr
 *
şŸddr
;

13 ià(
¬gc
 == 2)

14 
sockfd
 = 
	`Udp_£rv”
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
sockfd
 = 
	`Udp_£rv”
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage:est01 <hostname> <service>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

22 #ifdef 
IP_RECVDSTADDR


23 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
, &
Ú
, (on));

25 
Ën
 = (
æag
);

26 
	`G‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
, &
æag
, &
Ën
);

27 
	`´štf
("IP_RECVDSTADDR o±iÚ = %d, sizğ%d\n", 
æag
, 
Ën
);

29 
	`´štf
("IP_RECVDSTADDR‚ot defined\n");

32 #ifdef 
IP_RECVIF


33 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVIF
, &
Ú
, (on));

35 
Ën
 = (
æag
);

36 
	`G‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVIF
, &
æag
, &
Ën
);

37 
	`´štf
("IP_RECVIF o±iÚ = %d, sizğ%d\n", 
æag
, 
Ën
);

39 
	`´štf
("IP_RECVIF‚ot defined\n");

43 
	#CONTROL_LEN
 ((
cmsghdr
è+ (
š_addr
))

	)

44 
cÚŒŞ
[
CONTROL_LEN
];

46 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ
;

47 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ
);

48 
msg
.
msg_æags
 = 0;

50 
	`bz”o
(&
msg
, (msg));

53 
msg
.
msg_Çme
 = 
§
;

54 
msg
.
msg_Çm–’
 = *
§ËÅŒ
;

55 
iov
[0].
iov_ba£
 = 
±r
;

56 
iov
[0].
iov_Ën
 = 
nby‹s
;

57 
msg
.
msg_iov
 = 
iov
;

58 
msg
.
msg_iovËn
 = 1;

60 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, *
æag¥
)) < 0)

61 (
n
);

63 
Ën
 = 
add¾’
;

64 
n
 = 
	`Recväom
(
sockfd
, 
buff
, 
MAXLINE
, 0, 
şŸddr
, &
Ën
);

65 
	`´štf
("d©ag¿m from %s\n", 
	`Sock_Áİ
(
şŸddr
, 
Ën
));

67 
ticks
 = 
	`time
(
NULL
);

68 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

69 
	`S’dto
(
sockfd
, 
buff
, 
	`¡¾’
(buff), 0, 
şŸddr
, 
Ën
);

71 
	`ex™
(0);

72 
	}
}

	@osi\unpv13e\unpv13e\advio\recvfromflags.c

2 
	~"uÅ.h
"

3 
	~<sys/·¿m.h
>

5 
ssize_t


6 
	$»cväom_æags
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
æag¥
,

7 
SA
 *
§
, 
sockËn_t
 *
§ËÅŒ
, 
uÅ_š_pktšfo
 *
pk
)

9 
msghdr
 
msg
;

10 
iovec
 
iov
[1];

11 
ssize_t
 
n
;

13 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


14 
cmsghdr
 *
cm±r
;

16 
cmsghdr
 
cm
;

17 
cÚŒŞ
[
	`CMSG_SPACE
((
š_addr
)) +

18 
	`CMSG_SPACE
((
uÅ_š_pktšfo
))];

19 } 
cÚŒŞ_un
;

21 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ_un
.
cÚŒŞ
;

22 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ_un
.
cÚŒŞ
);

23 
msg
.
msg_æags
 = 0;

25 
	`bz”o
(&
msg
, (msg));

28 
msg
.
msg_Çme
 = 
§
;

29 
msg
.
msg_Çm–’
 = *
§ËÅŒ
;

30 
iov
[0].
iov_ba£
 = 
±r
;

31 
iov
[0].
iov_Ën
 = 
nby‹s
;

32 
msg
.
msg_iov
 = 
iov
;

33 
msg
.
msg_iovËn
 = 1;

35 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, *
æag¥
)) < 0)

36 (
n
);

38 *
§ËÅŒ
 = 
msg
.
msg_Çm–’
;

39 ià(
pk
)

40 
	`bz”o
(
pk
, (
uÅ_š_pktšfo
));

44 #iâdef 
HAVE_MSGHDR_MSG_CONTROL


45 *
æag¥
 = 0;

46 (
n
);

49 *
æag¥
 = 
msg
.
msg_æags
;

50 ià(
msg
.
msg_cÚŒŞËn
 < (
cmsghdr
) ||

51 (
msg
.
msg_æags
 & 
MSG_CTRUNC
è|| 
pk
 =ğ
NULL
)

52 (
n
);

54 
cm±r
 = 
	`CMSG_FIRSTHDR
(&
msg
); cm±¸!ğ
NULL
;

55 
cm±r
 = 
	`CMSG_NXTHDR
(&
msg
, cmptr)) {

57 #ifdef 
IP_RECVDSTADDR


58 ià(
cm±r
->
cmsg_Ëv–
 =ğ
IPPROTO_IP
 &&

59 
cm±r
->
cmsg_ty³
 =ğ
IP_RECVDSTADDR
) {

61 
	`memıy
(&
pk
->
i_addr
, 
	`CMSG_DATA
(
cm±r
),

62 (
š_addr
));

67 #ifdef 
IP_RECVIF


68 ià(
cm±r
->
cmsg_Ëv–
 =ğ
IPPROTO_IP
 &&

69 
cm±r
->
cmsg_ty³
 =ğ
IP_RECVIF
) {

70 
sockaddr_dl
 *
sdl
;

72 
sdl
 = (
sockaddr_dl
 *è
	`CMSG_DATA
(
cm±r
);

73 
pk
->
i_ifšdex
 = 
sdl
->
sdl_šdex
;

77 
	`”r_qu™
("unknown‡ncillary data,†en = %d,†evel = %d,ype = %d",

78 
cm±r
->
cmsg_Ën
, cm±r->
cmsg_Ëv–
, cm±r->
cmsg_ty³
);

80 (
n
);

82 
	}
}

85 
ssize_t


86 
	$Recväom_æags
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
æag¥
,

87 
SA
 *
§
, 
sockËn_t
 *
§ËÅŒ
, 
uÅ_š_pktšfo
 *
pk
)

89 
ssize_t
 
n
;

91 
n
 = 
	`»cväom_æags
(
fd
, 
±r
, 
nby‹s
, 
æag¥
, 
§
, 
§ËÅŒ
, 
pk
);

92 ià(
n
 < 0)

93 
	`”r_qu™
("recvfrom_flagsƒrror");

95 (
n
);

96 
	}
}

	@osi\unpv13e\unpv13e\advio\sig_chld_waitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0) {

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

13 
	}
}

	@osi\unpv13e\unpv13e\advio\str_cli_kqueue04.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
kq
, 
i
, 
n
, 
Ãv
, 
¡dšeof
 = 0, 
isfe
;

7 
buf
[
MAXLINE
];

8 
kev’t
 
kev
[2];

9 
time¥ec
 
ts
;

10 
¡©
 
¡
;

12 
isfe
 = ((
	`f¡©
(
	`f’o
(
å
), &
¡
) == 0) &&

13 (
¡
.
¡_mode
 & 
S_IFMT
è=ğ
S_IFREG
);

15 
	`EV_SET
(&
kev
[0], 
	`f’o
(
å
), 
EVFILT_READ
, 
EV_ADD
, 0, 0, 
NULL
);

16 
	`EV_SET
(&
kev
[1], 
sockfd
, 
EVFILT_READ
, 
EV_ADD
, 0, 0, 
NULL
);

18 
kq
 = 
	`Kqueue
();

19 
ts
.
tv_£c
 =s.
tv_n£c
 = 0;

20 
	`Kev’t
(
kq
, 
kev
, 2, 
NULL
, 0, &
ts
);

23 
Ãv
 = 
	`Kev’t
(
kq
, 
NULL
, 0, 
kev
, 2, NULL);

25 
i
 = 0; i < 
Ãv
; i++) {

26 ià(
kev
[
i
].
id’t
 =ğ
sockfd
) {

27 iàĞ(
n
 = 
	`R—d
(
sockfd
, 
buf
, 
MAXLINE
)) == 0) {

28 ià(
¡dšeof
 == 1)

31 
	`”r_qu™
("str_cli: servererminated…rematurely");

34 
	`Wr™e
(
	`f’o
(
¡dout
), 
buf
, 
n
);

37 ià(
kev
[
i
].
id’t
 =ğ
	`f’o
(
å
)) {

38 
n
 = 
	`R—d
(
	`f’o
(
å
), 
buf
, 
MAXLINE
);

39 ià(
n
 > 0)

40 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

42 ià(
n
 =ğ0 || (
isfe
 &&‚ =ğ
kev
[
i
].
d©a
)) {

43 
¡dšeof
 = 1;

44 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

45 
kev
[
i
].
æags
 = 
EV_DELETE
;

46 
	`Kev’t
(
kq
, &
kev
[
i
], 1, 
NULL
, 0, &
ts
);

52 
	}
}

	@osi\unpv13e\unpv13e\advio\str_cli_poll03.c

1 
	~"uÅ.h
"

2 
	~<sys/devpŞl.h
>

5 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

7 
¡dšeof
;

8 
buf
[
MAXLINE
];

9 
n
;

10 
wfd
;

11 
pŞlfd
…ollfd[2];

12 
dvpŞl
 
dİŞl
;

13 
i
;

14 
»suÉ
;

16 
wfd
 = 
	`O³n
("/dev/pŞl", 
O_RDWR
, 0);

18 
pŞlfd
[0].
fd
 = 
	`f’o
(
å
);

19 
pŞlfd
[0].
ev’ts
 = 
POLLIN
;

20 
pŞlfd
[0].
»v’ts
 = 0;

22 
pŞlfd
[1].
fd
 = 
sockfd
;

23 
pŞlfd
[1].
ev’ts
 = 
POLLIN
;

24 
pŞlfd
[1].
»v’ts
 = 0;

26 
	`Wr™e
(
wfd
, 
pŞlfd
, (pollfd) * 2);

28 
¡dšeof
 = 0;

31 
dİŞl
.
dp_timeout
 = -1;

32 
dİŞl
.
dp_nfds
 = 2;

33 
dİŞl
.
dp_fds
 = 
pŞlfd
;

34 
»suÉ
 = 
	`Ioùl
(
wfd
, 
DP_POLL
, &
dİŞl
);

37 
i
 = 0; i < 
»suÉ
; i++) {

38 ià(
dİŞl
.
dp_fds
[
i
].
fd
 =ğ
sockfd
) {

40 iàĞ(
n
 = 
	`R—d
(
sockfd
, 
buf
, 
MAXLINE
)) == 0) {

41 ià(
¡dšeof
 == 1)

44 
	`”r_qu™
("str_cli: servererminated…rematurely");

47 
	`Wr™e
(
	`f’o
(
¡dout
), 
buf
, 
n
);

50 iàĞ(
n
 = 
	`R—d
(
	`f’o
(
å
), 
buf
, 
MAXLINE
)) == 0) {

51 
¡dšeof
 = 1;

52 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

56 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

60 
	}
}

	@osi\unpv13e\unpv13e\advio\str_cli_select02.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
maxfdp1
, 
¡dšeof
 = 0;

7 
fd_£t
 
r£t
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

10 
	`FD_ZERO
(&
r£t
);

12 ià(
¡dšeof
 == 0)

13 
	`FD_SET
(
	`f’o
(
å
), &
r£t
);

14 
	`FD_SET
(
sockfd
, &
r£t
);

15 
maxfdp1
 = 
	`max
(
	`f’o
(
å
), 
sockfd
) + 1;

16 
	`S–eù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL);

18 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

19 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0) {

20 ià(
¡dšeof
 == 1)

23 
	`”r_qu™
("str_cli: servererminated…rematurely");

26 
	`Fputs
(
»cvlše
, 
¡dout
);

29 ià(
	`FD_ISSET
(
	`f’o
(
å
), &
r£t
)) {

30 ià(
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è=ğ
NULL
) {

31 
¡dšeof
 = 1;

32 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

33 
	`FD_CLR
(
	`f’o
(
å
), &
r£t
);

37 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

40 
	}
}

	@osi\unpv13e\unpv13e\advio\str_echo_stdio02.c

1 
	~"uÅ.h
"

4 
	$¡r_echo
(
sockfd
)

6 
lše
[
MAXLINE
];

7 
FILE
 *
åš
, *
åout
;

9 
åš
 = 
	`Fdİ’
(
sockfd
, "r");

10 
åout
 = 
	`Fdİ’
(
sockfd
, "w");

12 
	`Fg‘s
(
lše
, 
MAXLINE
, 
åš
è!ğ
NULL
)

13 
	`Fputs
(
lše
, 
åout
);

14 
	}
}

	@osi\unpv13e\unpv13e\advio\tcpcli01.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù_timeo
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr), 10);

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\advio\tcpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\advio\tcpcli03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\advio\tcpcli04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\advio\tcpserv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\advio\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\advio\udpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\advio\udpcli03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\advio\udpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\advio\udpserv03.c

2 
	~"uÅifi.h
"

4 
mydg_echo
(, 
SA
 *, 
sockËn_t
, SA *);

7 
	$maš
(
¬gc
, **
¬gv
)

9 
sockfd
;

10 cÚ¡ 
Ú
 = 1;

11 
pid_t
 
pid
;

12 
ifi_šfo
 *
ifi
, *
ifih—d
;

13 
sockaddr_š
 *
§
, 
şŸddr
, 
wdaddr
;

15 
ifih—d
 = 
ifi
 = 
	`G‘_ifi_šfo
(
AF_INET
, 1);

16 
ifi
 !ğ
NULL
; if˜ğifi->
ifi_Ãxt
) {

19 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

21 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

23 
§
 = (
sockaddr_š
 *è
ifi
->
ifi_addr
;

24 
§
->
sš_çmy
 = 
AF_INET
;

25 
§
->
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

26 
	`Bšd
(
sockfd
, (
SA
 *è
§
, (*sa));

27 
	`´štf
("bound %s\n", 
	`Sock_Áİ
((
SA
 *è
§
, (*sa)));

29 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

30 
	`mydg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (şŸddr), (SA *è
§
);

31 
	`ex™
(0);

35 ià(
ifi
->
ifi_æags
 & 
IFF_BROADCAST
) {

37 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

38 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

40 
§
 = (
sockaddr_š
 *è
ifi
->
ifi_brdaddr
;

41 
§
->
sš_çmy
 = 
AF_INET
;

42 
§
->
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

43 ià(
	`bšd
(
sockfd
, (
SA
 *è
§
, (*sa)) < 0) {

44 ià(
”ºo
 =ğ
EADDRINUSE
) {

45 
	`´štf
("EADDRINUSE: %s\n",

46 
	`Sock_Áİ
((
SA
 *è
§
, (*sa)));

47 
	`Clo£
(
sockfd
);

50 
	`”r_sys
("bindƒrror for %s",

51 
	`Sock_Áİ
((
SA
 *è
§
, (*sa)));

53 
	`´štf
("bound %s\n", 
	`Sock_Áİ
((
SA
 *è
§
, (*sa)));

55 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

56 
	`mydg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr),

57 (
SA
 *è
§
);

58 
	`ex™
(0);

65 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

66 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

68 
	`bz”o
(&
wdaddr
, (wildaddr));

69 
wdaddr
.
sš_çmy
 = 
AF_INET
;

70 
wdaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

71 
wdaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

72 
	`Bšd
(
sockfd
, (
SA
 *è&
wdaddr
, (wildaddr));

73 
	`´štf
("bound %s\n", 
	`Sock_Áİ
((
SA
 *è&
wdaddr
, (wildaddr)));

75 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

76 
	`mydg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (şŸddr), (SA *è
§
);

77 
	`ex™
(0);

79 
	`ex™
(0);

80 
	}
}

85 
	$mydg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
, SA *
myaddr
)

87 
n
;

88 
mesg
[
MAXLINE
];

89 
sockËn_t
 
Ën
;

92 
Ën
 = 
ş’
;

93 
n
 = 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
pşŸddr
, &
Ën
);

94 
	`´štf
("chd %d, d©ag¿m from %s", 
	`g‘pid
(),

95 
	`Sock_Áİ
(
pşŸddr
, 
Ën
));

96 
	`´štf
(",Ø%s\n", 
	`Sock_Áİ
(
myaddr
, 
ş’
));

98 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
pşŸddr
, 
Ën
);

100 
	}
}

	@osi\unpv13e\unpv13e\advio\udpserv04.c

1 
	~"uÅifi.h
"

3 
mydg_echo
(, 
SA
 *, 
sockËn_t
);

6 
	$maš
(
¬gc
, **
¬gv
)

8 
sockfd
, 
çmy
, 
pÜt
;

9 cÚ¡ 
Ú
 = 1;

10 
pid_t
 
pid
;

11 
sockËn_t
 
§Ën
;

12 
sockaddr
 *
§
, *
wd
;

13 
ifi_šfo
 *
ifi
, *
ifih—d
;

15 ià(
¬gc
 == 2)

16 
sockfd
 = 
	`Udp_ş›Á
(
NULL
, 
¬gv
[1], (**è&
§
, &
§Ën
);

17 ià(
¬gc
 == 3)

18 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

20 
	`”r_qu™
("usage: udpserv04 [ <host> ] <service or…ort>");

21 
çmy
 = 
§
->
§_çmy
;

22 
pÜt
 = 
	`sock_g‘_pÜt
(
§
, 
§Ën
);

23 
	`Clo£
(
sockfd
);

25 
ifih—d
 = 
ifi
 = 
	`G‘_ifi_šfo
(
çmy
, 1);

26 
ifi
 !ğ
NULL
; if˜ğifi->
ifi_Ãxt
) {

29 
sockfd
 = 
	`Sock‘
(
çmy
, 
SOCK_DGRAM
, 0);

30 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

32 
	`sock_£t_pÜt
(
ifi
->
ifi_addr
, 
§Ën
, 
pÜt
);

33 
	`Bšd
(
sockfd
, 
ifi
->
ifi_addr
, 
§Ën
);

34 
	`´štf
("bound %s\n", 
	`Sock_Áİ
(
ifi
->
ifi_addr
, 
§Ën
));

36 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

37 
	`mydg_echo
(
sockfd
, 
ifi
->
ifi_addr
, 
§Ën
);

38 
	`ex™
(0);

41 ià(
ifi
->
ifi_æags
 & 
IFF_BROADCAST
) {

43 
sockfd
 = 
	`Sock‘
(
çmy
, 
SOCK_DGRAM
, 0);

44 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

46 
	`sock_£t_pÜt
(
ifi
->
ifi_brdaddr
, 
§Ën
, 
pÜt
);

47 ià(
	`bšd
(
sockfd
, 
ifi
->
ifi_brdaddr
, 
§Ën
) < 0) {

48 ià(
”ºo
 =ğ
EADDRINUSE
) {

49 
	`´štf
("EADDRINUSE: %s\n",

50 
	`Sock_Áİ
(
ifi
->
ifi_brdaddr
, 
§Ën
));

51 
	`Clo£
(
sockfd
);

54 
	`”r_sys
("bindƒrror for %s",

55 
	`Sock_Áİ
(
ifi
->
ifi_brdaddr
, 
§Ën
));

57 
	`´štf
("bound %s\n", 
	`Sock_Áİ
(
ifi
->
ifi_brdaddr
, 
§Ën
));

59 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

60 
	`mydg_echo
(
sockfd
, 
ifi
->
ifi_brdaddr
, 
§Ën
);

61 
	`ex™
(0);

67 
sockfd
 = 
	`Sock‘
(
çmy
, 
SOCK_DGRAM
, 0);

68 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

70 
wd
 = 
	`M®loc
(
§Ën
);

71 
	`memıy
(
wd
, 
§
, 
§Ën
);

72 
	`sock_£t_wd
(
wd
, 
§Ën
);

74 
	`Bšd
(
sockfd
, 
wd
, 
§Ën
);

75 
	`´štf
("bound %s\n", 
	`Sock_Áİ
(
wd
, 
§Ën
));

77 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

78 
	`mydg_echo
(
sockfd
, 
wd
, 
§Ën
);

79 
	`ex™
(0);

81 
	`ex™
(0);

82 
	}
}

85 
	$mydg_echo
(
sockfd
, 
SA
 *
myaddr
, 
sockËn_t
 
§Ën
)

87 
n
;

88 
mesg
[
MAXLINE
];

89 
sockËn_t
 
Ën
;

90 
sockaddr
 *
şi
;

92 
şi
 = 
	`M®loc
(
§Ën
);

95 
Ën
 = 
§Ën
;

96 
n
 = 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
şi
, &
Ën
);

97 
	`´štf
("child %d, datagram from %s",

98 
	`g‘pid
(), 
	`Sock_Áİ
(
şi
, 
Ën
));

99 
	`´štf
(",Ø%s\n", 
	`Sock_Áİ
(
myaddr
, 
§Ën
));

101 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
şi
, 
Ën
);

103 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast1.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 cÚ¡ 
Ú
 = 1;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
sockËn_t
 
Ën
;

12 
sockaddr
 *
´•ly_addr
;

14 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

16 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

18 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

20 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

22 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

24 
	`®¬m
(5);

26 
Ën
 = 
£rvËn
;

27 
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

28 ià(
n
 < 0) {

29 ià(
”ºo
 =ğ
EINTR
)

32 
	`”r_sys
("recvfromƒrror");

34 
»cvlše
[
n
] = 0;

35 
	`´štf
("from %s: %s",

36 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

40 
	`ä“
(
´•ly_addr
);

41 
	}
}

44 
	$»cväom_®¬m
(
signo
)

47 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast2.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 cÚ¡ 
Ú
 = 1;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
sockËn_t
 
Ën
;

12 
sockaddr
 *
´•ly_addr
;

14 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

16 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

18 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

20 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

22 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

24 
	`®¬m
(1);

26 
Ën
 = 
£rvËn
;

27 
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

28 ià(
n
 == -1) {

29 ià(
”ºo
 =ğ
EINTR
)

32 
	`”r_sys
("recvfromƒrror");

34 
»cvlše
[
n
] = 0;

35 
	`¦“p
(1);

36 
	`´štf
("from %s: %s",

37 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

41 
	`ä“
(
´•ly_addr
);

42 
	}
}

45 
	$»cväom_®¬m
(
signo
)

48 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast3.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 cÚ¡ 
Ú
 = 1;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
sig£t_t
 
sig£t_®rm
;

12 
sockËn_t
 
Ën
;

13 
sockaddr
 *
´•ly_addr
;

15 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

17 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

19 
	`Sigem±y£t
(&
sig£t_®rm
);

20 
	`Sigadd£t
(&
sig£t_®rm
, 
SIGALRM
);

22 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

24 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

26 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

28 
	`®¬m
(5);

30 
Ën
 = 
£rvËn
;

31 
	`Sig´ocmask
(
SIG_UNBLOCK
, &
sig£t_®rm
, 
NULL
);

32 
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

33 
	`Sig´ocmask
(
SIG_BLOCK
, &
sig£t_®rm
, 
NULL
);

34 ià(
n
 < 0) {

35 ià(
”ºo
 =ğ
EINTR
)

38 
	`”r_sys
("recvfromƒrror");

40 
»cvlše
[
n
] = 0;

41 
	`´štf
("from %s: %s",

42 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

46 
	`ä“
(
´•ly_addr
);

47 
	}
}

50 
	$»cväom_®¬m
(
signo
)

53 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast4.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 cÚ¡ 
Ú
 = 1;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
fd_£t
 
r£t
;

12 
sig£t_t
 
sig£t_®rm
, 
sig£t_em±y
;

13 
sockËn_t
 
Ën
;

14 
sockaddr
 *
´•ly_addr
;

16 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

18 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

20 
	`FD_ZERO
(&
r£t
);

22 
	`Sigem±y£t
(&
sig£t_em±y
);

23 
	`Sigem±y£t
(&
sig£t_®rm
);

24 
	`Sigadd£t
(&
sig£t_®rm
, 
SIGALRM
);

26 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

28 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

29 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

31 
	`Sig´ocmask
(
SIG_BLOCK
, &
sig£t_®rm
, 
NULL
);

32 
	`®¬m
(5);

34 
	`FD_SET
(
sockfd
, &
r£t
);

35 
n
 = 
	`p£Ëù
(
sockfd
+1, &
r£t
, 
NULL
, NULL, NULL, &
sig£t_em±y
);

36 ià(
n
 < 0) {

37 ià(
”ºo
 =ğ
EINTR
)

40 
	`”r_sys
("pselectƒrror");

41 } ià(
n
 != 1)

42 
	`”r_sys
("p£Ëùƒ¼Ü:„‘uºed %d", 
n
);

44 
Ën
 = 
£rvËn
;

45 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

46 
»cvlše
[
n
] = 0;

47 
	`´štf
("from %s: %s",

48 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

51 
	`ä“
(
´•ly_addr
);

52 
	}
}

55 
	$»cväom_®¬m
(
signo
)

58 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast5.c

1 
	~"uÅ.h
"

2 
	~<£tjmp.h
>

4 
»cväom_®¬m
();

5 
sigjmp_buf
 
	gjmpbuf
;

8 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

10 
n
;

11 cÚ¡ 
Ú
 = 1;

12 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

13 
sockËn_t
 
Ën
;

14 
sockaddr
 *
´•ly_addr
;

16 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

18 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

20 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

22 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

24 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

26 
	`®¬m
(5);

28 ià(
	`sig£tjmp
(
jmpbuf
, 1) != 0)

30 
Ën
 = 
£rvËn
;

31 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

32 
»cvlše
[
n
] = 0;

33 
	`´štf
("from %s: %s",

34 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

37 
	`ä“
(
´•ly_addr
);

38 
	}
}

41 
	$»cväom_®¬m
(
signo
)

43 
	`siglÚgjmp
(
jmpbuf
, 1);

44 
	}
}

	@osi\unpv13e\unpv13e\bcast\dgclibcast6.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

4 
	gpefd
[2];

7 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

9 
n
, 
maxfdp1
;

10 cÚ¡ 
Ú
 = 1;

11 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

12 
fd_£t
 
r£t
;

13 
sockËn_t
 
Ën
;

14 
sockaddr
 *
´•ly_addr
;

16 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

18 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Ú
, (on));

20 
	`Pe
(
pefd
);

21 
maxfdp1
 = 
	`max
(
sockfd
, 
pefd
[0]) + 1;

23 
	`FD_ZERO
(&
r£t
);

25 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

27 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

28 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

30 
	`®¬m
(5);

32 
	`FD_SET
(
sockfd
, &
r£t
);

33 
	`FD_SET
(
pefd
[0], &
r£t
);

34 iàĞ(
n
 = 
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL)) < 0) {

35 ià(
”ºo
 =ğ
EINTR
)

38 
	`”r_sys
("selectƒrror");

41 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

42 
Ën
 = 
£rvËn
;

43 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

44 
»cvlše
[
n
] = 0;

45 
	`´štf
("from %s: %s",

46 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
Ën
), 
»cvlše
);

49 ià(
	`FD_ISSET
(
pefd
[0], &
r£t
)) {

50 
	`R—d
(
pefd
[0], &
n
, 1);

55 
	`ä“
(
´•ly_addr
);

56 
	}
}

59 
	$»cväom_®¬m
(
signo
)

61 
	`Wr™e
(
pefd
[1], "", 1);

63 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli01 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli02 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli03 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli04 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli05.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli05 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\bcast\udpcli06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli02 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\debug\backlog.c

1 
	~"uÅ.h
"

3 
	#PORT
 9999

	)

4 
	#ADDR
 "127.0.0.1"

	)

5 
	#MAXBACKLOG
 100

	)

8 
sockaddr_š
 
	g£rv
;

9 
pid_t
 
	gpid
;

11 
	gpefd
[2];

12 
	#pfd
 
pefd
[1]

	)

13 
	#cfd
 
pefd
[0]

	)

16 
do_·»Á
();

17 
do_chd
();

20 
	$maš
(
¬gc
, **
¬gv
)

22 ià(
¬gc
 != 1)

23 
	`”r_qu™
("usage: backlog");

25 
	`Sock‘·œ
(
AF_UNIX
, 
SOCK_STREAM
, 0, 
pefd
);

27 
	`bz”o
(&
£rv
, (serv));

28 
£rv
.
sš_çmy
 = 
AF_INET
;

29 
£rv
.
sš_pÜt
 = 
	`htÚs
(
PORT
);

30 
	`IÃt_±Ú
(
AF_INET
, 
ADDR
, &
£rv
.
sš_addr
);

32 iàĞ(
pid
 = 
	`FÜk
()) == 0)

33 
	`do_chd
();

35 
	`do_·»Á
();

37 
	`ex™
(0);

38 
	}
}

41 
	$·»Á_®rm
(
signo
)

44 
	}
}

47 
	$do_·»Á
()

49 
backlog
, 
j
, 
k
, 
junk
, 
fd
[
MAXBACKLOG
 + 1];

51 
	`Clo£
(
cfd
);

52 
	`SigÇl
(
SIGALRM
, 
·»Á_®rm
);

54 
backlog
 = 0; backlog <= 14; backlog++) {

55 
	`´štf
("backlog = %d: ", 
backlog
);

56 
	`Wr™e
(
pfd
, &
backlog
, ());

57 
	`R—d
(
pfd
, &
junk
, ());

59 
j
 = 1; j <ğ
MAXBACKLOG
; j++) {

60 
fd
[
j
] = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

61 
	`®¬m
(2);

62 ià(
	`cÚÃù
(
fd
[
j
], (
SA
 * ) &
£rv
, (serv)) < 0) {

63 ià(
”ºo
 !ğ
EINTR
)

64 
	`”r_sys
("cÚÃùƒ¼Ü, j = %d", 
j
);

65 
	`´štf
("timeout, %d cÚÃùiÚ com¶‘ed\n", 
j
-1);

66 
k
 = 1; k <ğ
j
; k++)

67 
	`Clo£
(
fd
[
k
]);

70 
	`®¬m
(0);

72 ià(
j
 > 
MAXBACKLOG
)

73 
	`´štf
("%d cÚÃùiÚs?\n", 
MAXBACKLOG
);

75 
backlog
 = -1;

76 
	`Wr™e
(
pfd
, &
backlog
, ());

77 
	}
}

80 
	$do_chd
()

82 
li¡’fd
, 
backlog
, 
junk
;

83 cÚ¡ 
Ú
 = 1;

85 
	`Clo£
(
pfd
);

87 
	`R—d
(
cfd
, &
backlog
, ());

88 
backlog
 >= 0) {

89 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

90 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

91 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rv
, (serv));

92 
	`Li¡’
(
li¡’fd
, 
backlog
);

94 
	`Wr™e
(
cfd
, &
junk
, ());

96 
	`R—d
(
cfd
, &
backlog
, ());

97 
	`Clo£
(
li¡’fd
);

99 
	}
}

	@osi\unpv13e\unpv13e\debug\qlen.c

1 
	~"uÅxti.h
"

3 
	#PORT
 9999

	)

4 
	#ADDR
 "127.0.0.1"

	)

5 
	#MAXBACKLOG
 100

	)

8 
sockaddr_š
 
	g£rv
;

9 
pid_t
 
	gpid
;

11 
	gpefd
[2];

12 
	#pfd
 
pefd
[1]

	)

13 
	#cfd
 
pefd
[0]

	)

16 
do_·»Á
();

17 
do_chd
();

20 
	$maš
(
¬gc
, **
¬gv
)

22 ià(
¬gc
 != 1)

23 
	`”r_qu™
("usage: qlen");

25 
	`Sock‘·œ
(
AF_UNIX
, 
SOCK_STREAM
, 0, 
pefd
);

27 
	`bz”o
(&
£rv
, (serv));

28 
£rv
.
sš_çmy
 = 
AF_INET
;

29 
£rv
.
sš_pÜt
 = 
	`htÚs
(
PORT
);

30 
	`IÃt_±Ú
(
AF_INET
, 
ADDR
, &
£rv
.
sš_addr
);

32 iàĞ(
pid
 = 
	`FÜk
()) == 0)

33 
	`do_chd
();

35 
	`do_·»Á
();

37 
	`ex™
(0);

38 
	}
}

41 
	$·»Á_®rm
(
signo
)

44 
	}
}

48 
	$do_·»Á
()

50 
qËn
, 
j
, 
k
, 
junk
, 
fd
[
MAXBACKLOG
 + 1];

51 
t_ÿÎ
 
tÿÎ
;

53 
	`Clo£
(
cfd
);

54 
	`SigÇl
(
SIGALRM
, 
·»Á_®rm
);

56 
qËn
 = 0; qlen <= 14; qlen++) {

57 
	`´štf
("qËÀğ%d: ", 
qËn
);

58 
	`Wr™e
(
pfd
, &
qËn
, ());

59 
	`R—d
(
pfd
, &
junk
, ());

61 
j
 = 0; j <ğ
MAXBACKLOG
; j++) {

62 
fd
[
j
] = 
	`T_İ’
(
XTI_TCP
, 
O_RDWR
, 
NULL
);

63 
	`T_bšd
(
fd
[
j
], 
NULL
, NULL);

65 
tÿÎ
.
addr
.
maxËn
 = (
£rv
);

66 
tÿÎ
.
addr
.
Ën
 = (
£rv
);

67 
tÿÎ
.
addr
.
buf
 = &
£rv
;

68 
tÿÎ
.
İt
.
Ën
 = 0;

69 
tÿÎ
.
ud©a
.
Ën
 = 0;

71 
	`®¬m
(2);

72 ià(
	`t_cÚÃù
(
fd
[
j
], &
tÿÎ
, 
NULL
) < 0) {

73 ià(
”ºo
 !ğ
EINTR
)

74 
	`”r_xti
("t_cÚÃùƒ¼Ü, j = %d", 
j
);

75 
	`´štf
("timeout, %d cÚÃùiÚ com¶‘ed\n", 
j
-1);

76 
k
 = 1; k < 
j
; k++)

77 
	`T_şo£
(
fd
[
k
]);

80 
	`®¬m
(0);

82 ià(
j
 > 
MAXBACKLOG
)

83 
	`´štf
("%d cÚÃùiÚs?\n", 
MAXBACKLOG
);

85 
qËn
 = -1;

86 
	`Wr™e
(
pfd
, &
qËn
, ());

87 
	}
}

90 
	$do_chd
()

92 
li¡’fd
, 
qËn
, 
junk
;

93 
t_bšd
 
tbšd
, 
tbšd»t
;

95 
	`Clo£
(
pefd
[1]);

97 
	`R—d
(
cfd
, &
qËn
, ());

98 
qËn
 >= 0) {

99 
li¡’fd
 = 
	`T_İ’
(
XTI_TCP
, 
O_RDWR
, 
NULL
);

101 
tbšd
.
addr
.
maxËn
 = (
£rv
);

102 
tbšd
.
addr
.
Ën
 = (
£rv
);

103 
tbšd
.
addr
.
buf
 = &
£rv
;

104 
tbšd
.
qËn
 = qlen;

106 
tbšd»t
.
addr
.
maxËn
 = 0;

107 
tbšd»t
.
addr
.
Ën
 = 0;

109 
	`T_bšd
(
li¡’fd
, &
tbšd
, &
tbšd»t
);

110 
	`´štf
("»tuºed qËÀğ%d, ", 
tbšd»t
.
qËn
);

111 
	`fæush
(
¡dout
);

113 
	`Wr™e
(
cfd
, &
junk
, ());

115 
	`R—d
(
cfd
, &
qËn
, ());

116 
	`T_şo£
(
li¡’fd
);

118 
	}
}

	@osi\unpv13e\unpv13e\debug\test01.c

1 
	~"uÅxti.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
tfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:est01 <hostname/IPaddress> <service/port#>");

11 
tfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`t_¢d
(
tfd
, "", 1, 
T_EXPEDITED
);

15 
	`ex™
(0);

16 
	}
}

	@osi\unpv13e\unpv13e\debug\test02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
fd
;

7 
fd_£t
 
ex£t
;

9 ià(
¬gc
 != 3)

10 
	`”r_qu™
("usage:est01 <hostname/IPaddress> <service/port#>");

12 
fd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

14 
	`FD_ZERO
(&
ex£t
);

15 
	`FD_SET
(
fd
, &
ex£t
);

16 
	`£Ëù
(
fd
+1, 
NULL
, NULL, &
ex£t
, NULL);

18 
	`ex™
(0);

19 
	}
}

	@osi\unpv13e\unpv13e\debug\test03.c

1 
	~"uÅxti.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
, 
æags
;

7 
buff
[
MAXLINE
];

8 
pŞlfd
 
fds
[1];

10 ià(
¬gc
 == 2)

11 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

12 ià(
¬gc
 == 3)

13 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

15 
	`”r_qu™
("usage: daytimetcpsrv01 [ <host> ] <service or…ort>");

17 
cÚnfd
 = 
	`Xti_acû±
(
li¡’fd
, 
NULL
, 0);

19 
fds
[0].
fd
 = 
cÚnfd
;

20 
fds
[0].
ev’ts
 = 
POLLIN
 | 
POLLRDNORM
 | 
POLLRDBAND
 | 
POLLPRI
;

22 
n
 = 
	`pŞl
(
fds
, 1, 
INFTIM
);

23 
	`´štf
("pŞÈ»tuºed %d,„ev’t ğ0x%x\n", 
n
, 
fds
[0].
»v’ts
);

25 
n
 = 
	`T_rcv
(
cÚnfd
, 
buff
, (buff), &
æags
);

26 
	`´štf
("»ûived %d by‹s, fÏg ğ%d\n", 
n
, 
æags
);

28 
	}
}

	@osi\unpv13e\unpv13e\debug\test04.c

1 
	~"uÅ.h
"

4 
	$sig_®rm
(
signo
)

6 
	}
}

9 
	$maš
(
¬gc
, **
¬gv
)

11 
sockfd
, 
n
;

12 
sockaddr_š
 
£rvaddr
;

13 
™im”v®
 
v®
;

14 
fd_£t
 
r£t
, 
w£t
;

16 ià(
¬gc
 != 2)

17 
	`”r_qu™
("usage:‡.out <IPaddress>");

19 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

20 
	`”r_sys
("socketƒrror");

22 
	`bz”o
(&
£rvaddr
, (servaddr));

23 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

24 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

25 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

28 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

29 
v®
.
™_š‹rv®
.
tv_£c
 = 0;

30 
v®
.
™_š‹rv®
.
tv_u£c
 = 0;

31 
v®
.
™_v®ue
.
tv_£c
 = 0;

32 
v®
.
™_v®ue
.
tv_u£c
 = 50000;

33 ià(
	`£t™im”
(
ITIMER_REAL
, &
v®
, 
NULL
) == -1)

34 
	`”r_sys
("setitimerƒrror");

36 
agaš
:

37 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0) {

38 ià(
”ºo
 =ğ
EINTR
) {

39 #ifdef 
nÙdef


40 
agaš
;

42 #ifdef 
nÙdef


43 
	`´štf
("interrupted system call\n");

44 
	`ex™
(0);

47 
	`”r_sys
("connectƒrror");

50 
	`FD_ZERO
(&
r£t
);

51 
	`FD_SET
(
sockfd
, &
r£t
);

52 
w£t
 = 
r£t
;

53 
	`¦“p
(4);

54 
n
 = 
	`S–eù
(
sockfd
+1, &
r£t
, &
w£t
, 
NULL
, NULL);

55 
	`´štf
("£Ëù„‘uºed %d\n", 
n
);

56 ià(
	`FD_ISSET
(
sockfd
, &
r£t
))

57 
	`´štf
("socket is„eadable\n");

58 ià(
	`FD_ISSET
(
sockfd
, &
w£t
))

59 
	`´štf
("socket is writable\n");

61 
	`¡r_şi
(
¡dš
, 
sockfd
);

63 
	`ex™
(0);

64 
	}
}

	@osi\unpv13e\unpv13e\debug\test05.c

1 
	~"uÅxti.h
"

3 
	gli¡’fd
, 
	gcÚnfd
;

6 
	$sig_pŞl
(
signo
)

8 
n
, 
æags
;

9 
buff
[
MAXLINE
];

11 
	`´štf
("SIGPOLL,ƒv’ˆğ%d\n", 
	`t_look
(
cÚnfd
));

12 
n
 = 
	`T_rcv
(
cÚnfd
, 
buff
, (buff), &
æags
);

13 
	`´štf
("»ûived %d by‹s, fÏg ğ%d\n", 
n
, 
æags
);

14 
	}
}

17 
	$maš
(
¬gc
, **
¬gv
)

19 ià(
¬gc
 == 2)

20 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

21 ià(
¬gc
 == 3)

22 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

24 
	`”r_qu™
("usage:est05 [ <host> ] <service or…ort>");

26 
cÚnfd
 = 
	`Xti_acû±
(
li¡’fd
, 
NULL
, 0);

28 
	`SigÇl
(
SIGPOLL
, 
sig_pŞl
);

29 
	`Ioùl
(
cÚnfd
, 
I_SETSIG
, 
S_RDNORM
);

32 
	`·u£
();

34 
	}
}

	@osi\unpv13e\unpv13e\debug\test06.c

1 
	~"uÅxti.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
fd
;

7 
t_ÿÎ
 *
tÿÎ
;

9 
fd
 = 
	`T_İ’
(
XTI_TCP
, 
O_RDWR
, 
NULL
);

11 
tÿÎ
 = 
	`T_®loc
(
fd
, 
T_CALL
, 
T_ALL
);

12 
	`´štf
("first_alloc OK\n");

14 
tÿÎ
 = 
	`T_®loc
(
fd
, 
T_CALL
, 
T_ADDR
 | 
T_OPT
 | 
T_UDATA
);

15 
	`´štf
("second_alloc OK\n");

17 
	`ex™
(0);

18 
	}
}

	@osi\unpv13e\unpv13e\debug\unpxti.h

2 #iâdef 
__uÅ_xti_h


3 
	#__uÅ_xti_h


	)

5 
	~"uÅ.h
"

7 
	~<xti.h
>

8 #ifdef 
HAVE_XTI_INET_H


9 
	~<xti_š‘.h
>

11 #ifdef 
HAVE_NETCONFIG_H


12 
	~<ÃtcÚfig.h
>

14 #ifdef 
HAVE_NETDIR_H


15 
	~<Ãtdœ.h
>

18 #ifdef 
INFTIM_UNPH


19 #undeà
INFTIM


22 
	~<¡rİts.h
>

27 #iâdef 
T_INET_TCP


28 
	#T_INET_TCP
 
INET_TCP


	)

32 #iâdef 
T_INET_UDP


33 
	#T_INET_UDP
 
INET_UDP


	)

35 #iâdef 
T_INET_IP


36 
	#T_INET_IP
 
INET_IP


	)

38 #iâdef 
T_TCP_NODELAY


39 
	#T_TCP_NODELAY
 
TCP_NODELAY


	)

41 #iâdef 
T_TCP_MAXSEG


42 
	#T_TCP_MAXSEG
 
TCP_MAXSEG


	)

44 #iâdef 
T_TCP_KEEPALIVE


45 
	#T_TCP_KEEPALIVE
 
TCP_KEEPALIVE


	)

47 #iâdef 
T_UDP_CHECKSUM


48 
	#T_UDP_CHECKSUM
 
UDP_CHECKSUM


	)

50 #iâdef 
T_IP_OPTIONS


51 
	#T_IP_OPTIONS
 
IP_OPTIONS


	)

53 #iâdef 
T_IP_TOS


54 
	#T_IP_TOS
 
IP_TOS


	)

56 #iâdef 
T_IP_TTL


57 
	#T_IP_TTL
 
IP_TTL


	)

59 #iâdef 
T_IP_REUSEADDR


60 
	#T_IP_REUSEADDR
 
IP_REUSEADDR


	)

62 #iâdef 
T_IP_DONTROUTE


63 
	#T_IP_DONTROUTE
 
IP_DONTROUTE


	)

66 #iâdef 
T_IP_BROADCAST


67 
	#T_IP_BROADCAST
 
IP_BROADCAST


	)

72 #ifdef 
HAVE_DEV_TCP


73 
	#XTI_TCP
 "/dev/tı"

	)

74 
	#XTI_UDP
 "/dev/udp"

	)

76 #ifdef 
HAVE_DEV_XTI_TCP


77 
	#XTI_TCP
 "/dev/xti/tı"

	)

78 
	#XTI_UDP
 "/dev/xti/udp"

	)

80 #ifdef 
HAVE_DEV_STREAMS_XTISO_TCP


81 
	#XTI_TCP
 "/dev/¡»ams/xtiso/tı+"

	)

82 
	#XTI_UDP
 "/dev/¡»ams/xtiso/udp+"

	)

87 
xti_£rv_dev
[];

90 
”r_xti
(cÚ¡ *
fmt
, ...);

91 
”r_xti_»t
(cÚ¡ *
fmt
, ...);

93 
G‘msg
(, 
¡rbuf
 *, strbuf *, *);

94 
Putmsg
(, cÚ¡ 
¡rbuf
 *, const strbuf *, );

96 #ifdef 
HAVE_NETCONFIG_H


97 *
S‘ÃtcÚfig
();

98 *
S‘Ã©h
();

101 *
T_®loc
(, , );

102 
T_acû±
(, , 
t_ÿÎ
 *);

103 
T_bšd
(, cÚ¡ 
t_bšd
 *, t_bind *);

104 
T_şo£
();

105 
T_cÚÃù
(, cÚ¡ 
t_ÿÎ
 *, t_call *);

106 
T_ä“
(*, );

107 
T_g‘´Ùaddr
(, 
t_bšd
 *, t_bind *);

108 
T_g‘¡©e
();

109 
T_li¡’
(, 
t_ÿÎ
 *);

110 
T_look
();

111 
T_İ’
(cÚ¡ *, , 
t_šfo
 *);

112 
T_İtmgmt
(, cÚ¡ 
t_İtmgmt
 *, t_optmgmt *);

113 
T_rcv
(, *, , *);

114 
T_rcvdis
(, 
t_discÚ
 *);

115 
T_rcv»l
();

116 
T_rcvud©a
(, 
t_un™d©a
 *, *);

117 
T_rcvud”r
(, 
t_ud”r
 *);

118 
T_¢d
(, *, , );

119 
T_¢d»l
();

120 
T_¢dud©a
(, 
t_un™d©a
 *);

122 
xti_acû±
(, 
Ãtbuf
 *, );

123 
xti_g‘İt
(, , , *, 
sockËn_t
 *);

124 *
xti_æags_¡r
();

125 *
xti_ook_¡r
();

126 *
xti_Áİ
(cÚ¡ 
Ãtbuf
 *);

127 *
xti_Áİ_ho¡
(cÚ¡ 
Ãtbuf
 *);

128 
xti_rdwr
();

129 
xti_£tİt
(, , , *, 
sockËn_t
);

131 
Xti_acû±
(, 
Ãtbuf
 *, );

132 
Xti_g‘İt
(, , , *, 
sockËn_t
 *);

133 *
Xti_æags_¡r
();

134 *
Xti_ook_¡r
();

135 *
Xti_Áİ
(cÚ¡ 
Ãtbuf
 *);

136 *
Xti_Áİ_ho¡
(cÚ¡ 
Ãtbuf
 *);

137 
Xti_rdwr
();

138 
Xti_£tİt
(, , , *, 
sockËn_t
);

140 *
xti_¡r_Ënd
(
t_İthdr
 *);

141 *
xti_¡r_usÿÏrd
(
t_İthdr
 *);

142 *
xti_¡r_uch¬d
(
t_İthdr
 *);

143 *
xti_¡r_uch¬x
(
t_İthdr
 *);

144 *
xti_¡r_yn
(
t_usÿÏr_t
);

145 *
xti_¡r_syng
(
t_sÿÏr_t
);

146 *
xti_¡r_uiyn
(
t_İthdr
 *);

147 *
xti_¡r_usyn
(
t_İthdr
 *);

148 *
xti_¡r_lšg”
(
t_İthdr
 *);

149 *
xti_¡r_k·live
(
t_İthdr
 *);

150 *
xti_¡r_æags
(
t_sÿÏr_t
);

	@osi\unpv13e\unpv13e\icmpd\dgcli01.c

2 
	~"uÅicmpd.h
"

5 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

7 
icmpfd
, 
maxfdp1
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
fd_£t
 
r£t
;

10 
ssize_t
 
n
;

11 
timev®
 
tv
;

12 
icmpd_”r
 icmpd_err;

13 
sockaddr_un
 
sun
;

15 
	`Sock_bšd_wd
(
sockfd
, 
p£rvaddr
->
§_çmy
);

17 
icmpfd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_STREAM
, 0);

18 
sun
.
sun_çmy
 = 
AF_LOCAL
;

19 
	`¡rıy
(
sun
.
sun_·th
, 
ICMPD_PATH
);

20 
	`CÚÃù
(
icmpfd
, (
SA
 *)&
sun
, (sun));

21 
	`Wr™e_fd
(
icmpfd
, "1", 1, 
sockfd
);

22 
n
 = 
	`R—d
(
icmpfd
, 
»cvlše
, 1);

23 ià(
n
 !ğ1 || 
»cvlše
[0] != '1')

24 
	`”r_qu™
("error creating icmp socket,‚ = %d, char = %c",

25 
n
, 
»cvlše
[0]);

27 
	`FD_ZERO
(&
r£t
);

28 
maxfdp1
 = 
	`max
(
sockfd
, 
icmpfd
) + 1;

32 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

33 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

35 
tv
.
tv_£c
 = 5;

36 
tv
.
tv_u£c
 = 0;

37 
	`FD_SET
(
sockfd
, &
r£t
);

38 
	`FD_SET
(
icmpfd
, &
r£t
);

39 iàĞ(
n
 = 
	`S–eù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, &
tv
)) == 0) {

40 
	`årštf
(
¡d”r
, "socketimeout\n");

44 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

45 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

46 
»cvlše
[
n
] = 0;

47 
	`Fputs
(
»cvlše
, 
¡dout
);

50 ià(
	`FD_ISSET
(
icmpfd
, &
r£t
)) {

51 iàĞ(
n
 = 
	`R—d
(
icmpfd
, &
icmpd_”r
, (icmpd_err))) == 0)

52 
	`”r_qu™
("ICMP daemonerminated");

53 ià(
n
 !ğ(
icmpd_”r
))

54 
	`”r_qu™
("Àğ%d,ƒx³ùed %d", 
n
, (
icmpd_”r
));

55 
	`´štf
("ICMPƒrror: dest = %s, %s,ype = %d, code = %d\n",

56 
	`Sock_Áİ
(&
icmpd_”r
.
icmpd_de¡
, icmpd_”r.
icmpd_Ën
),

57 
	`¡»¼Ü
(
icmpd_”r
.
icmpd_”ºo
),

58 
icmpd_”r
.
icmpd_ty³
, icmpd_”r.
icmpd_code
);

61 
	}
}

	@osi\unpv13e\unpv13e\icmpd\icmpd.c

2 
	~"icmpd.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
i
, 
sockfd
;

8 
sockaddr_un
 
sun
;

10 ià(
¬gc
 != 1)

11 
	`”r_qu™
("usage: icmpd");

13 
maxi
 = -1;

14 
i
 = 0; i < 
FD_SETSIZE
; i++)

15 
ş›Á
[
i
].
cÚnfd
 = -1;

16 
	`FD_ZERO
(&
®l£t
);

18 
fd4
 = 
	`Sock‘
(
AF_INET
, 
SOCK_RAW
, 
IPPROTO_ICMP
);

19 
	`FD_SET
(
fd4
, &
®l£t
);

20 
maxfd
 = 
fd4
;

22 #ifdef 
IPV6


23 
fd6
 = 
	`Sock‘
(
AF_INET6
, 
SOCK_RAW
, 
IPPROTO_ICMPV6
);

24 
	`FD_SET
(
fd6
, &
®l£t
);

25 
maxfd
 = 
	`max
(maxfd, 
fd6
);

28 
li¡’fd
 = 
	`Sock‘
(
AF_UNIX
, 
SOCK_STREAM
, 0);

29 
sun
.
sun_çmy
 = 
AF_LOCAL
;

30 
	`¡rıy
(
sun
.
sun_·th
, 
ICMPD_PATH
);

31 
	`uÆšk
(
ICMPD_PATH
);

32 
	`Bšd
(
li¡’fd
, (
SA
 *)&
sun
, (sun));

33 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

34 
	`FD_SET
(
li¡’fd
, &
®l£t
);

35 
maxfd
 = 
	`max
(maxfd, 
li¡’fd
);

40 
r£t
 = 
®l£t
;

41 
Ä—dy
 = 
	`S–eù
(
maxfd
+1, &
r£t
, 
NULL
, NULL, NULL);

43 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
))

44 ià(
	`»adabË_li¡’
() <= 0)

47 ià(
	`FD_ISSET
(
fd4
, &
r£t
))

48 ià(
	`»adabË_v4
() <= 0)

51 #ifdef 
IPV6


52 ià(
	`FD_ISSET
(
fd6
, &
r£t
))

53 ià(
	`»adabË_v6
() <= 0)

57 
i
 = 0; i <ğ
maxi
; i++) {

58 iàĞ(
sockfd
 = 
ş›Á
[
i
].
cÚnfd
) < 0)

60 ià(
	`FD_ISSET
(
sockfd
, &
r£t
))

61 ià(
	`»adabË_cÚn
(
i
) <= 0)

65 
	`ex™
(0);

66 
	}
}

	@osi\unpv13e\unpv13e\icmpd\icmpd.h

1 
	~"uÅicmpd.h
"

3 
	sş›Á
 {

4 
	mcÚnfd
;

5 
	mçmy
;

6 
	mÍÜt
;

8 } 
	gş›Á
[
FD_SETSIZE
];

11 
	gfd4
, 
	gfd6
, 
	gli¡’fd
, 
	gmaxi
, 
	gmaxfd
, 
	gÄ—dy
;

12 
fd_£t
 
	gr£t
, 
	g®l£t
;

13 
sockaddr_un
 
	gşŸddr
;

16 
»adabË_cÚn
();

17 
»adabË_li¡’
();

18 
»adabË_v4
();

19 
»adabË_v6
();

	@osi\unpv13e\unpv13e\icmpd\readable_conn.c

2 
	~"icmpd.h
"

5 
	$»adabË_cÚn
(
i
)

7 
unixfd
, 
»cvfd
;

8 
c
;

9 
ssize_t
 
n
;

10 
sockËn_t
 
Ën
;

11 
sockaddr_¡Üage
 
ss
;

13 
unixfd
 = 
ş›Á
[
i
].
cÚnfd
;

14 
»cvfd
 = -1;

15 iàĞ(
n
 = 
	`R—d_fd
(
unixfd
, &
c
, 1, &
»cvfd
)) == 0) {

16 
	`”r_msg
("ş›Á %d”mš©ed,„ecvfd = %d", 
i
, 
»cvfd
);

17 
ş›ÁdÚe
;

21 ià(
»cvfd
 < 0) {

22 
	`”r_msg
("read_fd did‚ot„eturn descriptor");

23 
ş›Á”r
;

28 
Ën
 = (
ss
);

29 ià(
	`g‘sockÇme
(
»cvfd
, (
SA
 *è&
ss
, &
Ën
) < 0) {

30 
	`”r_»t
("getsocknameƒrror");

31 
ş›Á”r
;

34 
ş›Á
[
i
].
çmy
 = 
ss
.
ss_çmy
;

35 iàĞ(
ş›Á
[
i
].
ÍÜt
 = 
	`sock_g‘_pÜt
((
SA
 *)&
ss
, 
Ën
)) == 0) {

36 
ş›Á
[
i
].
ÍÜt
 = 
	`sock_bšd_wd
(
»cvfd
, cl›Á[i].
çmy
);

37 ià(
ş›Á
[
i
].
ÍÜt
 <= 0) {

38 
	`”r_»t
("error bindingƒphemeral…ort");

39 
ş›Á”r
;

42 
	`Wr™e
(
unixfd
, "1", 1);

43 
	`Clo£
(
»cvfd
);

44 (--
Ä—dy
);

46 
ş›Á”r
:

47 
	`Wr™e
(
unixfd
, "0", 1);

48 
ş›ÁdÚe
:

49 
	`Clo£
(
unixfd
);

50 ià(
»cvfd
 >= 0)

51 
	`Clo£
(
»cvfd
);

52 
	`FD_CLR
(
unixfd
, &
®l£t
);

53 
ş›Á
[
i
].
cÚnfd
 = -1;

54 (--
Ä—dy
);

55 
	}
}

	@osi\unpv13e\unpv13e\icmpd\readable_listen.c

1 
	~"icmpd.h
"

4 
	$»adabË_li¡’
()

6 
i
, 
cÚnfd
;

7 
sockËn_t
 
ş’
;

9 
ş’
 = (
şŸddr
);

10 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *)&
şŸddr
, &
ş’
);

13 
i
 = 0; i < 
FD_SETSIZE
; i++)

14 ià(
ş›Á
[
i
].
cÚnfd
 < 0) {

15 
ş›Á
[
i
].
cÚnfd
 = connfd;

18 ià(
i
 =ğ
FD_SETSIZE
) {

19 
	`şo£
(
cÚnfd
);

20 (--
Ä—dy
);

22 
	`´štf
("Ãw cÚÃùiÚ, i = %d, cÚnfd = %d\n", 
i
, 
cÚnfd
);

24 
	`FD_SET
(
cÚnfd
, &
®l£t
);

25 ià(
cÚnfd
 > 
maxfd
)

26 
maxfd
 = 
cÚnfd
;

27 ià(
i
 > 
maxi
)

28 
maxi
 = 
i
;

30 (--
Ä—dy
);

31 
	}
}

	@osi\unpv13e\unpv13e\icmpd\readable_v4.c

2 
	~"icmpd.h
"

3 
	~<Ãtš‘/š_sy¡m.h
>

4 
	~<Ãtš‘/.h
>

5 
	~<Ãtš‘/_icmp.h
>

6 
	~<Ãtš‘/udp.h
>

9 
	$»adabË_v4
()

11 
i
, 
hËn1
, 
hËn2
, 
icm¶’
, 
¥Üt
;

12 
buf
[
MAXLINE
];

13 
¤c¡r
[
INET_ADDRSTRLEN
], 
d¡¡r
[INET_ADDRSTRLEN];

14 
ssize_t
 
n
;

15 
sockËn_t
 
Ën
;

16 

 *, *
h
;

17 
icmp
 *icmp;

18 
udphdr
 *
udp
;

19 
sockaddr_š
 
äom
, 
de¡
;

20 
icmpd_”r
 icmpd_err;

22 
Ën
 = (
äom
);

23 
n
 = 
	`Recväom
(
fd4
, 
buf
, 
MAXLINE
, 0, (
SA
 *è&
äom
, &
Ën
);

25 
	`´štf
("%d bytes ICMPv4 from %s:",

26 
n
, 
	`Sock_Áİ_ho¡
((
SA
 *è&
äom
, 
Ën
));

28 

 = ( *è
buf
;

29 
hËn1
 = 

->
_hl
 << 2;

31 
icmp
 = (icm°*è(
buf
 + 
hËn1
);

32 iàĞ(
icm¶’
 = 
n
 - 
hËn1
) < 8)

33 
	`”r_qu™
("icm¶’ (%dè< 8", 
icm¶’
);

35 
	`´štf
("y³ = %d, codğ%d\n", 
icmp
->
icmp_ty³
, icmp->
icmp_code
);

39 ià(
icmp
->
icmp_ty³
 =ğ
ICMP_UNREACH
 ||

40 
icmp
->
icmp_ty³
 =ğ
ICMP_TIMXCEED
 ||

41 
icmp
->
icmp_ty³
 =ğ
ICMP_SOURCEQUENCH
) {

42 ià(
icm¶’
 < 8 + 20 + 8)

43 
	`”r_qu™
("icm¶’ (%dè< 8 + 20 + 8", 
icm¶’
);

45 
h
 = (

 *è(
buf
 + 
hËn1
 + 8);

46 
hËn2
 = 
h
->
_hl
 << 2;

47 
	`´štf
("\tsrcip = %s, dstip = %s,…roto = %d\n",

48 
	`IÃt_Áİ
(
AF_INET
, &
h
->
_¤c
, 
¤c¡r
, (srcstr)),

49 
	`IÃt_Áİ
(
AF_INET
, &
h
->
_d¡
, 
d¡¡r
, (dststr)),

50 
h
->
_p
);

51 ià(
h
->
_p
 =ğ
IPPROTO_UDP
) {

52 
udp
 = (
udphdr
 *è(
buf
 + 
hËn1
 + 8 + 
hËn2
);

53 
¥Üt
 = 
udp
->
uh_¥Üt
;

56 
i
 = 0; i <ğ
maxi
; i++) {

57 ià(
ş›Á
[
i
].
cÚnfd
 >= 0 &&

58 
ş›Á
[
i
].
çmy
 =ğ
AF_INET
 &&

59 
ş›Á
[
i
].
ÍÜt
 =ğ
¥Üt
) {

61 
	`bz”o
(&
de¡
, (dest));

62 
de¡
.
sš_çmy
 = 
AF_INET
;

63 #ifdef 
HAVE_SOCKADDR_SA_LEN


64 
de¡
.
sš_Ën
 = (dest);

66 
	`memıy
(&
de¡
.
sš_addr
, &
h
->
_d¡
,

67 (
š_addr
));

68 
de¡
.
sš_pÜt
 = 
udp
->
uh_dpÜt
;

70 
icmpd_”r
.
icmpd_ty³
 = 
icmp
->
icmp_ty³
;

71 
icmpd_”r
.
icmpd_code
 = 
icmp
->
icmp_code
;

72 
icmpd_”r
.
icmpd_Ën
 = (
sockaddr_š
);

73 
	`memıy
(&
icmpd_”r
.
icmpd_de¡
, &
de¡
, (dest));

76 
icmpd_”r
.
icmpd_”ºo
 = 
EHOSTUNREACH
;

77 ià(
icmp
->
icmp_ty³
 =ğ
ICMP_UNREACH
) {

78 ià(
icmp
->
icmp_code
 =ğ
ICMP_UNREACH_PORT
)

79 
icmpd_”r
.
icmpd_”ºo
 = 
ECONNREFUSED
;

80 ià(
icmp
->
icmp_code
 =ğ
ICMP_UNREACH_NEEDFRAG
)

81 
icmpd_”r
.
icmpd_”ºo
 = 
EMSGSIZE
;

83 
	`Wr™e
(
ş›Á
[
i
].
cÚnfd
, &
icmpd_”r
, (icmpd_err));

88 (--
Ä—dy
);

89 
	}
}

	@osi\unpv13e\unpv13e\icmpd\readable_v6.c

2 
	~"icmpd.h
"

3 
	~<Ãtš‘/š_sy¡m.h
>

4 
	~<Ãtš‘/.h
>

5 
	~<Ãtš‘/_icmp.h
>

6 
	~<Ãtš‘/udp.h
>

8 #ifdef 
IPV6


9 
	~<Ãtš‘/6.h
>

10 
	~<Ãtš‘/icmp6.h
>

14 
	$»adabË_v6
()

16 #ifdef 
IPV6


17 
i
, 
hËn2
, 
icmp6Ën
, 
¥Üt
;

18 
buf
[
MAXLINE
];

19 
¤c¡r
[
INET6_ADDRSTRLEN
], 
d¡¡r
[INET6_ADDRSTRLEN];

20 
ssize_t
 
n
;

21 
sockËn_t
 
Ën
;

22 
6_hdr
 *
6
, *
h6
;

23 
icmp6_hdr
 *
icmp6
;

24 
udphdr
 *
udp
;

25 
sockaddr_š6
 
äom
, 
de¡
;

26 
icmpd_”r
 icmpd_err;

28 
Ën
 = (
äom
);

29 
n
 = 
	`Recväom
(
fd6
, 
buf
, 
MAXLINE
, 0, (
SA
 *è&
äom
, &
Ën
);

31 
	`´štf
("%d bytes ICMPv6 from %s:",

32 
n
, 
	`Sock_Áİ_ho¡
((
SA
 *è&
äom
, 
Ën
));

34 
icmp6
 = (
icmp6_hdr
 *è
buf
;

35 iàĞ(
icmp6Ën
 = 
n
) < 8)

36 
	`”r_qu™
("icmp6ËÀ(%dè< 8", 
icmp6Ën
);

38 
	`´štf
("y³ = %d, codğ%d\n", 
icmp6
->
icmp6_ty³
, icmp6->
icmp6_code
);

42 ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_DST_UNREACH
 ||

43 
icmp6
->
icmp6_ty³
 =ğ
ICMP6_PACKET_TOO_BIG
 ||

44 
icmp6
->
icmp6_ty³
 =ğ
ICMP6_TIME_EXCEEDED
) {

45 ià(
icmp6Ën
 < 8 + 8)

46 
	`”r_qu™
("icmp6ËÀ(%dè< 8 + 8", 
icmp6Ën
);

48 
h6
 = (
6_hdr
 *è(
buf
 + 8);

49 
hËn2
 = (
6_hdr
);

50 
	`´štf
("\tsrcip = %s, dstip = %s,‚ext hdr = %d\n",

51 
	`IÃt_Áİ
(
AF_INET6
, &
h6
->
6_¤c
, 
¤c¡r
, (srcstr)),

52 
	`IÃt_Áİ
(
AF_INET6
, &
h6
->
6_d¡
, 
d¡¡r
, (dststr)),

53 
h6
->
6_nxt
);

54 ià(
h6
->
6_nxt
 =ğ
IPPROTO_UDP
) {

55 
udp
 = (
udphdr
 *è(
buf
 + 8 + 
hËn2
);

56 
¥Üt
 = 
udp
->
uh_¥Üt
;

59 
i
 = 0; i <ğ
maxi
; i++) {

60 ià(
ş›Á
[
i
].
cÚnfd
 >= 0 &&

61 
ş›Á
[
i
].
çmy
 =ğ
AF_INET6
 &&

62 
ş›Á
[
i
].
ÍÜt
 =ğ
¥Üt
) {

64 
	`bz”o
(&
de¡
, (dest));

65 
de¡
.
sš6_çmy
 = 
AF_INET6
;

66 #ifdef 
HAVE_SOCKADDR_SA_LEN


67 
de¡
.
sš6_Ën
 = (dest);

69 
	`memıy
(&
de¡
.
sš6_addr
, &
h6
->
6_d¡
,

70 (
š6_addr
));

71 
de¡
.
sš6_pÜt
 = 
udp
->
uh_dpÜt
;

73 
icmpd_”r
.
icmpd_ty³
 = 
icmp6
->
icmp6_ty³
;

74 
icmpd_”r
.
icmpd_code
 = 
icmp6
->
icmp6_code
;

75 
icmpd_”r
.
icmpd_Ën
 = (
sockaddr_š6
);

76 
	`memıy
(&
icmpd_”r
.
icmpd_de¡
, &
de¡
, (dest));

79 
icmpd_”r
.
icmpd_”ºo
 = 
EHOSTUNREACH
;

80 ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_DST_UNREACH
 &&

81 
icmp6
->
icmp6_code
 =ğ
ICMP6_DST_UNREACH_NOPORT
)

82 
icmpd_”r
.
icmpd_”ºo
 = 
ECONNREFUSED
;

83 ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_PACKET_TOO_BIG
)

84 
icmpd_”r
.
icmpd_”ºo
 = 
EMSGSIZE
;

85 
	`Wr™e
(
ş›Á
[
i
].
cÚnfd
, &
icmpd_”r
, (icmpd_err));

90 (--
Ä—dy
);

92 
	}
}

	@osi\unpv13e\unpv13e\icmpd\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
§Ën
;

8 
sockaddr
 *
§
;

10 ià(
¬gc
 != 3)

11 
	`”r_qu™
("usage: udpcli01 <hostname> <service>");

13 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], &
§
, &
§Ën
);

15 
	`dg_şi
(
¡dš
, 
sockfd
, 
§
, 
§Ën
);

17 
	`ex™
(0);

18 
	}
}

	@osi\unpv13e\unpv13e\icmpd\unpicmpd.h

1 #iâdef 
__uÅicmp_h


2 
	#__uÅicmp_h


	)

4 
	~"uÅ.h
"

6 
	#ICMPD_PATH
 "/tmp/icmpd"

	)

8 
	sicmpd_”r
 {

9 
	micmpd_”ºo
;

10 
	micmpd_ty³
;

11 
	micmpd_code
;

12 
sockËn_t
 
	micmpd_Ën
;

13 
sockaddr_¡Üage
 
	micmpd_de¡
;

	@osi\unpv13e\unpv13e\inetd\daytimetcpsrv2.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
add¾’
, 
Ën
;

9 
sockaddr
 *
şŸddr
;

10 
buff
[
MAXLINE
];

11 
time_t
 
ticks
;

13 ià(
¬gc
 < 2 ||‡rgc > 3)

14 
	`”r_qu™
("usage: daytimetcpsrv2 [ <host> ] <service or…ort>");

16 
	`d«mÚ_š™
(
¬gv
[0], 0);

18 ià(
¬gc
 == 2)

19 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

21 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

23 
şŸddr
 = 
	`M®loc
(
add¾’
);

26 
Ën
 = 
add¾’
;

27 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

28 
	`”r_msg
("cÚÃùiÚ from %s", 
	`Sock_Áİ
(
şŸddr
, 
Ën
));

30 
ticks
 = 
	`time
(
NULL
);

31 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

32 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

34 
	`Clo£
(
cÚnfd
);

36 
	}
}

	@osi\unpv13e\unpv13e\inetd\daytimetcpsrv3.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockËn_t
 
Ën
;

8 
sockaddr
 *
şŸddr
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

12 
	`d«mÚ_š‘d
(
¬gv
[0], 0);

14 
şŸddr
 = 
	`M®loc
((
sockaddr_¡Üage
));

15 
Ën
 = (
sockaddr_¡Üage
);

16 
	`G‘³”Çme
(0, 
şŸddr
, &
Ën
);

17 
	`”r_msg
("cÚÃùiÚ from %s", 
	`Sock_Áİ
(
şŸddr
, 
Ën
));

19 
ticks
 = 
	`time
(
NULL
);

20 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

21 
	`Wr™e
(0, 
buff
, 
	`¡¾’
(buff));

23 
	`Clo£
(0);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\intro\byteorder.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

7 
s
;

8 
c
[()];

9 } 
un
;

11 
un
.
s
 = 0x0102;

12 
	`´štf
("%s: ", 
CPU_VENDOR_OS
);

14 ià(
un
.
c
[0] == 1 && un.c[1] == 2)

15 
	`´štf
("big-endian\n");

16 ià(
un
.
c
[0] == 2 && un.c[1] == 1)

17 
	`´štf
("little-endian\n");

19 
	`´štf
("unknown\n");

21 
	`´štf
("sizeof(short) = %d\n", ());

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpcli.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out <IPaddress>");

13 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

14 
	`”r_sys
("socketƒrror");

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

19 ià(
	`š‘_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
) <= 0)

20 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¬gv
[1]);

22 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

23 
	`”r_sys
("connectƒrror");

25  (
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

26 
»cvlše
[
n
] = 0;

27 ià(
	`åuts
(
»cvlše
, 
¡dout
è=ğ
EOF
)

28 
	`”r_sys
("fputsƒrror");

30 ià(
n
 < 0)

31 
	`”r_sys
("readƒrror");

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpcli1.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
, 
couÁ”
 = 0;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out <IPaddress>");

13 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

14 
	`”r_sys
("socketƒrror");

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

19 ià(
	`š‘_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
) <= 0)

20 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¬gv
[1]);

22 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

23 
	`”r_sys
("connectƒrror");

25  (
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

26 
couÁ”
++;

27 
»cvlše
[
n
] = 0;

28 ià(
	`åuts
(
»cvlše
, 
¡dout
è=ğ
EOF
)

29 
	`”r_sys
("fputsƒrror");

31 ià(
n
 < 0)

32 
	`”r_sys
("readƒrror");

34 
	`´štf
("couÁ” = %d\n", 
couÁ”
);

35 
	`ex™
(0);

36 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpcli2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
, 
couÁ”
 = 0;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out <IPaddress>");

13 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

14 
	`”r_sys
("socketƒrror");

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(9999);

19 ià(
	`š‘_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
) <= 0)

20 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¬gv
[1]);

22 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

23 
	`”r_sys
("connectƒrror");

25  (
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

26 
couÁ”
++;

27 
»cvlše
[
n
] = 0;

28 ià(
	`åuts
(
»cvlše
, 
¡dout
è=ğ
EOF
)

29 
	`”r_sys
("fputsƒrror");

31 ià(
n
 < 0)

32 
	`”r_sys
("readƒrror");

34 
	`´štf
("couÁ” = %d\n", 
couÁ”
);

35 
	`ex™
(0);

36 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpcli3.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
sockËn_t
 
Ën
;

8 
»cvlše
[
MAXLINE
 + 1];

9 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage:‡.out <IPaddress>");

14 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

15 
	`”r_sys
("socketƒrror");

17 
	`bz”o
(&
£rvaddr
, (servaddr));

18 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

19 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

20 ià(
	`š‘_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
) <= 0)

21 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¬gv
[1]);

23 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

24 
	`”r_sys
("connectƒrror");

26 
Ën
 = (
şŸddr
);

27 
	`G‘sockÇme
(
sockfd
, (
SA
 *è&
şŸddr
, &
Ën
);

28 
	`´štf
("local‡ddr: %s\n",

29 
	`Sock_Áİ
((
SA
 *è&
şŸddr
, (cliaddr)));

31  (
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

32 
»cvlše
[
n
] = 0;

33 ià(
	`åuts
(
»cvlše
, 
¡dout
è=ğ
EOF
)

34 
	`”r_sys
("fputsƒrror");

36 ià(
n
 < 0)

37 
	`”r_sys
("readƒrror");

39 
	`ex™
(0);

40 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpcliv6.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
sockaddr_š6
 
£rvaddr
;

8 
»cvlše
[
MAXLINE
 + 1];

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out <IPaddress>");

13 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET6
, 
SOCK_STREAM
, 0)) < 0)

14 
	`”r_sys
("socketƒrror");

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš6_çmy
 = 
AF_INET6
;

18 
£rvaddr
.
sš6_pÜt
 = 
	`htÚs
(13);

19 ià(
	`š‘_±Ú
(
AF_INET6
, 
¬gv
[1], &
£rvaddr
.
sš6_addr
) <= 0)

20 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¬gv
[1]);

22 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

23 
	`”r_sys
("connectƒrror");

25  (
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

26 
»cvlše
[
n
] = 0;

27 ià(
	`åuts
(
»cvlše
, 
¡dout
è=ğ
EOF
)

28 
	`”r_sys
("fputsƒrror");

30 ià(
n
 < 0)

31 
	`”r_sys
("readƒrror");

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpsrv.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockaddr_š
 
£rvaddr
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è
NULL
, NULL);

26 
ticks
 = 
	`time
(
NULL
);

27 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

28 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

30 
	`Clo£
(
cÚnfd
);

32 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpsrv1.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
Ën
;

9 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

10 
buff
[
MAXLINE
];

11 
time_t
 
ticks
;

13 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

20 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

25 
Ën
 = (
şŸddr
);

26 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
Ën
);

27 
	`´štf
("connection from %s,…ort %d\n",

28 
	`IÃt_Áİ
(
AF_INET
, &
şŸddr
.
sš_addr
, 
buff
, (buff)),

29 
	`Áohs
(
şŸddr
.
sš_pÜt
));

31 
ticks
 = 
	`time
(
NULL
);

32 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

33 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

35 
	`Clo£
(
cÚnfd
);

37 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpsrv2.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
, 
i
;

8 
sockaddr_š
 
£rvaddr
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(9999);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è
NULL
, NULL);

26 
ticks
 = 
	`time
(
NULL
);

27 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

28 
i
 = 0; i < 
	`¡¾’
(
buff
); i++)

29 
	`Wr™e
(
cÚnfd
, &
buff
[
i
], 1);

31 
	`Clo£
(
cÚnfd
);

33 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpsrv3.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
Ën
;

9 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

10 
buff
[
MAXLINE
];

11 
time_t
 
ticks
;

13 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(9999);

20 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

25 
Ën
 = (
şŸddr
);

26 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
Ën
);

27 
	`´štf
("connection from %s,…ort %d\n",

28 
	`IÃt_Áİ
(
AF_INET
, &
şŸddr
.
sš_addr
, 
buff
, (buff)),

29 
	`Áohs
(
şŸddr
.
sš_pÜt
));

31 
ticks
 = 
	`time
(
NULL
);

32 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

33 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

35 
	`Clo£
(
cÚnfd
);

37 
	}
}

	@osi\unpv13e\unpv13e\intro\daytimetcpsrvv6.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
Ën
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

11 
sockaddr_š6
 
£rvaddr
, 
şŸddr
;

13 
li¡’fd
 = 
	`Sock‘
(
AF_INET6
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš6_çmy
 = 
AF_INET6
;

17 
£rvaddr
.
sš6_addr
 = 
š6addr_ªy
;

18 
£rvaddr
.
sš6_pÜt
 = 
	`htÚs
(13);

20 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

25 
Ën
 = (
şŸddr
);

26 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
Ën
);

27 
	`´štf
("connection from %s\n",

28 
	`Sock_Áİ
((
SA
 *è&
şŸddr
, 
Ën
));

30 
ticks
 = 
	`time
(
NULL
);

31 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

32 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

34 
	`Clo£
(
cÚnfd
);

36 
	}
}

	@osi\unpv13e\unpv13e\ioctl\lsif01.c

1 
	~"uÅ.h
"

3 
	~<Ãt/if.h
>

6 
	$maš
(
¬gc
, **
¬gv
)

8 
sockfd
, 
Ën
;

9 *
±r
, 
buf
[2048], 
addr¡r
[
INET_ADDRSTRLEN
];

10 
ifcÚf
 
ifc
;

11 
iäeq
 *
iä
;

12 
sockaddr_š
 *
sš±r
;

14 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

16 
ifc
.
ifc_Ën
 = (
buf
);

17 
ifc
.
ifc_»q
 = (
iäeq
 *è
buf
;

18 
	`Ioùl
(
sockfd
, 
SIOCGIFCONF
, &
ifc
);

20 
±r
 = 
buf
;…Œ < buà+ 
ifc
.
ifc_Ën
; ) {

21 
iä
 = (
iäeq
 *è
±r
;

22 
Ën
 = (
sockaddr
);

23 #ifdef 
HAVE_SOCKADDR_SA_LEN


24 ià(
iä
->
iä_addr
.
§_Ën
 > 
Ën
)

25 
Ën
 = 
iä
->
iä_addr
.
§_Ën
;

27 
±r
 +ğ(
iä
->
iä_Çme
è+ 
Ën
;

29 
iä
->
iä_addr
.
§_çmy
) {

30 
AF_INET
:

31 
sš±r
 = (
sockaddr_š
 *è&
iä
->
iä_addr
;

32 
	`´štf
("%s\t%s\n", 
iä
->
iä_Çme
,

33 
	`IÃt_Áİ
(
AF_INET
, &
sš±r
->
sš_addr
, 
addr¡r
, (addrstr)));

37 
	`´štf
("%s\n", 
iä
->
iä_Çme
);

41 
	`ex™
(0);

42 
	}
}

	@osi\unpv13e\unpv13e\ioctl\lsif02.c

1 
	~"uÅ.h
"

3 
	~<Ãt/if.h
>

4 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


5 
	~<Ãt/if_dl.h
>

6 
	~<Ãt/if_ty³s.h
>

10 
	$maš
(
¬gc
, **
¬gv
)

12 
sockfd
, 
Ën
;

13 *
±r
, 
buf
[2048], 
addr¡r
[
INET_ADDRSTRLEN
];

14 
ifcÚf
 
ifc
;

15 
iäeq
 *
iä
;

16 
sockaddr_š
 *
sš±r
;

18 iàĞ(
sockfd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)) < 0)

19 
	`”r_sys
("socketƒrror");

21 
ifc
.
ifc_Ën
 = (
buf
);

22 
ifc
.
ifc_»q
 = (
iäeq
 *è
buf
;

23 ià(
	`ioùl
(
sockfd
, 
SIOCGIFCONF
, &
ifc
) < 0)

24 
	`”r_sys
("ioctl SIOCGIFCONFƒrror");

26 
±r
 = 
buf
;…Œ < buà+ 
ifc
.
ifc_Ën
; ) {

27 
iä
 = (
iäeq
 *è
±r
;

28 
Ën
 = (
sockaddr
);

29 #ifdef 
HAVE_SOCKADDR_SA_LEN


30 ià(
iä
->
iä_addr
.
§_Ën
 > 
Ën
)

31 
Ën
 = 
iä
->
iä_addr
.
§_Ën
;

33 
±r
 +ğ(
iä
->
iä_Çme
è+ 
Ën
;

35 
iä
->
iä_addr
.
§_çmy
) {

36 
AF_INET
:

37 
sš±r
 = (
sockaddr_š
 *è&
iä
->
iä_addr
;

38 
	`´štf
("%s\t%s\n", 
iä
->
iä_Çme
,

39 
	`IÃt_Áİ
(
AF_INET
, &
sš±r
->
sš_addr
, 
addr¡r
, (addrstr)));

42 #ifdef 
AF_INET6


43 
AF_INET6
: {

44 
sockaddr_š6
 *
sš6±r
;

45 
addr6¡r
[
INET6_ADDRSTRLEN
];

47 
sš6±r
 = (
sockaddr_š6
 *è&
iä
->
iä_addr
;

48 
	`´štf
("%s\t%s\n", 
iä
->
iä_Çme
,

49 
	`IÃt_Áİ
(
AF_INET6
, &
sš6±r
->
sš6_addr
, 
addr6¡r
, (addr6str)));

54 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


55 
AF_LINK
: {

56 
sockaddr_dl
 *
sdÍŒ
;

57 
¡r
[18];

58 *
	`‘h”´št
(cÚ¡ 
u_ch¬
 *, *);

60 
sdÍŒ
 = (
sockaddr_dl
 *è&
iä
->
iä_addr
;

61 
	`´štf
("%s", 
iä
->
iä_Çme
);

62 ià(
sdÍŒ
->
sdl_šdex
)

63 
	`´štf
("\t<lšk %d>", 
sdÍŒ
->
sdl_šdex
);

64 ià(
sdÍŒ
->
sdl_ty³
 =ğ
IFT_ETHER
 && sdÍŒ->
sdl_®’
)

65 
	`´štf
("\t%s", 
	`‘h”´št
((
u_ch¬
 *è
	`LLADDR
(
sdÍŒ
), 
¡r
));

66 
	`putch¬
('\n');

72 
	`´štf
("%s\n", 
iä
->
iä_Çme
);

76 
	`ex™
(0);

77 
	}
}

79 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


81 
‘h”´št
(cÚ¡ 
u_ch¬
 
—ddr
[6], 
¡ršg
[18])

83 
¢´štf
(
¡ršg
, 18, "%02x:%02x:%02x:%02x:%02x:%02x",

84 
—ddr
[0],ƒaddr[1],ƒaddr[2],ƒaddr[3],ƒaddr[4],ƒaddr[5] );

85 
	g¡ršg
[17] = '\0';

86 (
	g¡ršg
);

	@osi\unpv13e\unpv13e\ioctl\prifinfo.c

1 
	~"uÅifi.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
ifi_šfo
 *
ifi
, *
ifih—d
;

7 
sockaddr
 *
§
;

8 
u_ch¬
 *
±r
;

9 
i
, 
çmy
, 
dßlŸ£s
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:…rifinfo <inet4|inet6> <doaliases>");

14 ià(
	`¡rcmp
(
¬gv
[1], "inet4") == 0)

15 
çmy
 = 
AF_INET
;

16 #ifdef 
IPv6


17 ià(
	`¡rcmp
(
¬gv
[1], "inet6") == 0)

18 
çmy
 = 
AF_INET6
;

21 
	`”r_qu™
("invalid <address-family>");

22 
dßlŸ£s
 = 
	`©oi
(
¬gv
[2]);

24 
ifih—d
 = 
ifi
 = 
	`G‘_ifi_šfo
(
çmy
, 
dßlŸ£s
);

25 
ifi
 !ğ
NULL
; if˜ğifi->
ifi_Ãxt
) {

26 
	`´štf
("%s: ", 
ifi
->
ifi_Çme
);

27 ià(
ifi
->
ifi_šdex
 != 0)

28 
	`´štf
("(%dè", 
ifi
->
ifi_šdex
);

29 
	`´štf
("<");

31 ià(
ifi
->
ifi_æags
 & 
IFF_UP
è
	`´štf
("UP ");

32 ià(
ifi
->
ifi_æags
 & 
IFF_BROADCAST
è
	`´štf
("BCAST ");

33 ià(
ifi
->
ifi_æags
 & 
IFF_MULTICAST
è
	`´štf
("MCAST ");

34 ià(
ifi
->
ifi_æags
 & 
IFF_LOOPBACK
è
	`´štf
("LOOP ");

35 ià(
ifi
->
ifi_æags
 & 
IFF_POINTOPOINT
è
	`´štf
("P2P ");

36 
	`´štf
(">\n");

39 iàĞ(
i
 = 
ifi
->
ifi_hËn
) > 0) {

40 
±r
 = 
ifi
->
ifi_haddr
;

42 
	`´štf
("%s%x", (
i
 =ğ
ifi
->
ifi_hËn
è? " " : ":", *
±r
++);

43 } --
i
 > 0);

44 
	`´štf
("\n");

46 ià(
ifi
->
ifi_mtu
 != 0)

47 
	`´štf
(" MTU: %d\n", 
ifi
->
ifi_mtu
);

49 iàĞ(
§
 = 
ifi
->
ifi_addr
è!ğ
NULL
)

50 
	`´štf
(" IP‡ddr: %s\n",

51 
	`Sock_Áİ_ho¡
(
§
, (*sa)));

52 iàĞ(
§
 = 
ifi
->
ifi_brdaddr
è!ğ
NULL
)

53 
	`´štf
(" broadcast‡ddr: %s\n",

54 
	`Sock_Áİ_ho¡
(
§
, (*sa)));

55 iàĞ(
§
 = 
ifi
->
ifi_d¡addr
è!ğ
NULL
)

56 
	`´štf
(" destination‡ddr: %s\n",

57 
	`Sock_Áİ_ho¡
(
§
, (*sa)));

59 
	`ä“_ifi_šfo
(
ifih—d
);

60 
	`ex™
(0);

61 
	}
}

	@osi\unpv13e\unpv13e\ioctl\prmac.c

1 
	~"uÅifi.h
"

2 
	~<Ãt/if_¬p.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
ifi_šfo
 *
ifi
;

9 *
±r
;

10 
¬´eq
‡rpreq;

11 
sockaddr_š
 *
sš
;

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

14 
ifi
 = 
	`g‘_ifi_šfo
(
AF_INET
, 0); if˜!ğ
NULL
; if˜ğifi->
ifi_Ãxt
) {

15 
	`´štf
("%s: ", 
	`Sock_Áİ
(
ifi
->
ifi_addr
, (
sockaddr_š
)));

17 
sš
 = (
sockaddr_š
 *è&
¬´eq
.
¬p_·
;

18 
	`memıy
(
sš
, 
ifi
->
ifi_addr
, (
sockaddr_š
));

20 ià(
	`ioùl
(
sockfd
, 
SIOCGARP
, &
¬´eq
) < 0) {

21 
	`”r_»t
("ioctl SIOCGARP");

25 
±r
 = &
¬´eq
.
¬p_ha
.
§_d©a
[0];

26 
	`´štf
("%x:%x:%x:%x:%x:%x\n", *
±r
, *(ptr+1),

27 *(
±r
+2), *(ptr+3), *(ptr+4), *(ptr+5));

29 
	`ex™
(0);

30 
	}
}

	@osi\unpv13e\unpv13e\ioctl\test1.c

1 
	~"uÅ.h
"

2 
	~<Ãt/if.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
i
, 
sockfd
, 
numif
;

8 
buf
[1024];

10 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

12 
numif
 = 999;

13 
	`Ioùl
(
sockfd
, 
SIOCGIFNUM
, &
numif
);

14 
	`´štf
("numiàğ%d\n", 
numif
);

16 
i
 = 
	`ioùl
(
sockfd
, 
SIOCGHIWAT
, &
buf
);

17 
	`´štf
("˜ğ%d,ƒ¼nØğ%d\n", 
i
, 
”ºo
);

18 
	`ex™
(0);

19 
	}
}

	@osi\unpv13e\unpv13e\ipopts\dgechoprintroute.c

1 
	~"uÅ.h
"

4 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

6 
n
;

7 
mesg
[
MAXLINE
];

8 
Ú
;

9 
cÚŒŞ
[
MAXLINE
];

10 
msghdr
 
msg
;

11 
cmsghdr
 *
cmsg
;

12 
iovec
 
iov
[1];

14 
Ú
 = 1;

15 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_RECVRTHDR
, &
Ú
, (on));

17 
	`bz”o
(&
msg
, (msg));

18 
iov
[0].
iov_ba£
 = 
mesg
;

19 
msg
.
msg_Çme
 = 
pşŸddr
;

20 
msg
.
msg_iov
 = 
iov
;

21 
msg
.
msg_iovËn
 = 1;

22 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ
;

24 
msg
.
msg_Çm–’
 = 
ş’
;

25 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ
);

26 
iov
[0].
iov_Ën
 = 
MAXLINE
;

27 
n
 = 
	`Recvmsg
(
sockfd
, &
msg
, 0);

29 
cmsg
 = 
	`CMSG_FIRSTHDR
(&
msg
); cmsg !ğ
NULL
;

30 
cmsg
 = 
	`CMSG_NXTHDR
(&
msg
, cmsg)) {

31 ià(
cmsg
->
cmsg_Ëv–
 =ğ
IPPROTO_IPV6
 &&

32 
cmsg
->
cmsg_ty³
 =ğ
IPV6_RTHDR
) {

33 
	`š‘6_¤üt_´št
(
	`CMSG_DATA
(
cmsg
));

34 
	`IÃt6_¹h_»v”£
(
	`CMSG_DATA
(
cmsg
), CMSG_DATA(cmsg));

38 
iov
[0].
iov_Ën
 = 
n
;

39 
	`S’dmsg
(
sockfd
, &
msg
, 0);

41 
	}
}

	@osi\unpv13e\unpv13e\ipopts\sigchldwaitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0) {

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

13 
	}
}

	@osi\unpv13e\unpv13e\ipopts\sourceroute.c

2 
	~"uÅ.h
"

3 
	~<Ãtš‘/š_sy¡m.h
>

4 
	~<Ãtš‘/.h
>

6 
u_ch¬
 *
	gİŒ
;

7 
u_ch¬
 *
	gËÅŒ
;

8 
	goút
;

10 
u_ch¬
 *

11 
	$š‘_¤üt_š™
(
ty³
)

13 
İŒ
 = 
	`M®loc
(44);

14 
	`bz”o
(
İŒ
, 44);

15 
oút
 = 0;

16 *
İŒ
++ = 
IPOPT_NOP
;

17 *
İŒ
++ = 
ty³
 ? 
IPOPT_SSRR
 : 
IPOPT_LSRR
;

18 
ËÅŒ
 = 
İŒ
++;

19 *
İŒ
++ = 4;

21 (
İŒ
 - 4);

22 
	}
}

27 
	$š‘_¤üt_add
(*
ho¡±r
)

29 
Ën
;

30 
addršfo
 *
ai
;

31 
sockaddr_š
 *
sš
;

33 ià(
oút
 > 9)

34 
	`”r_qu™
("toØmªy sourû„ou‹ w™h: %s", 
ho¡±r
);

36 
ai
 = 
	`Ho¡_£rv
(
ho¡±r
, 
NULL
, 
AF_INET
, 0);

37 
sš
 = (
sockaddr_š
 *è
ai
->
ai_addr
;

38 
	`memıy
(
İŒ
, &
sš
->
sš_addr
, (
š_addr
));

39 
	`ä“addršfo
(
ai
);

41 
İŒ
 +ğ(
š_addr
);

42 
oút
++;

43 
Ën
 = 3 + (
oút
 * (
š_addr
));

44 *
ËÅŒ
 = 
Ën
;

45 (
Ën
 + 1);

46 
	}
}

51 
	$š‘_¤üt_´št
(
u_ch¬
 *
±r
, 
Ën
)

53 
u_ch¬
 
c
;

54 
¡r
[
INET_ADDRSTRLEN
];

55 
š_addr
 
hİ1
;

57 
	`memıy
(&
hİ1
, 
±r
, (
š_addr
));

58 
±r
 +ğ(
š_addr
);

60  (
c
 = *
±r
++è=ğ
IPOPT_NOP
)

63 ià(
c
 =ğ
IPOPT_LSRR
)

64 
	`´štf
("received LSRR: ");

65 ià(
c
 =ğ
IPOPT_SSRR
)

66 
	`´štf
("received SSRR: ");

68 
	`´štf
("»ûived o±iÚy³ %d\n", 
c
);

71 
	`´štf
("% ", 
	`IÃt_Áİ
(
AF_INET
, &
hİ1
, 
¡r
, (str)));

73 
Ën
 = *
±r
++ - (
š_addr
);

74 
±r
++;

75 
Ën
 > 0) {

76 
	`´štf
("% ", 
	`IÃt_Áİ
(
AF_INET
, 
±r
, 
¡r
, (str)));

77 
±r
 +ğ(
š_addr
);

78 
Ën
 -ğ(
š_addr
);

80 
	`´štf
("\n");

81 
	}
}

	@osi\unpv13e\unpv13e\ipopts\sourceroute6.c

1 
	~"uÅ.h
"

4 
	$š‘6_¤üt_´št
(*
±r
)

6 
i
, 
£gm’ts
;

7 
¡r
[
INET6_ADDRSTRLEN
];

9 
£gm’ts
 = 
	`IÃt6_¹h_£gm’ts
(
±r
);

10 
	`´štf
("received source„oute: ");

11 
i
 = 0; i < 
£gm’ts
; i++)

12 
	`´štf
("% ", 
	`IÃt_Áİ
(
AF_INET6
, 
	`IÃt6_¹h_g‘addr
(
±r
, 
i
),

13 
¡r
, (str)));

14 
	`´štf
("\n");

15 
	}
}

	@osi\unpv13e\unpv13e\ipopts\tcpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
c
, 
sockfd
, 
Ën
 = 0;

7 
u_ch¬
 *
±r
 = 
NULL
;

8 
addršfo
 *
ai
;

10 ià(
¬gc
 < 2)

11 
	`”r_qu™
("usage:cpcli01 [ -[gG] <hostname> ... ] <hostname>");

13 
İ‹¼
 = 0;

14  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "gG")) != -1) {

15 
c
) {

17 ià(
±r
)

18 
	`”r_qu™
("can't use both -g‡nd -G");

19 
±r
 = 
	`š‘_¤üt_š™
(0);

23 ià(
±r
)

24 
	`”r_qu™
("can't use both -g‡nd -G");

25 
±r
 = 
	`š‘_¤üt_š™
(1);

29 
	`”r_qu™
("uÄecognized o±iÚ: %c", 
c
);

33 ià(
±r
)

34 
İtšd
 < 
¬gc
-1)

35 
Ën
 = 
	`š‘_¤üt_add
(
¬gv
[
İtšd
++]);

37 ià(
İtšd
 < 
¬gc
-1)

38 
	`”r_qu™
("need -g or -Go specify„oute");

40 ià(
İtšd
 !ğ
¬gc
-1)

41 
	`”r_qu™
("missing <hostname>");

43 
ai
 = 
	`Ho¡_£rv
(
¬gv
[
İtšd
], 
SERV_PORT_STR
, 
AF_INET
, 
SOCK_STREAM
);

45 
sockfd
 = 
	`Sock‘
(
ai
->
ai_çmy
,‡i->
ai_sockty³
,‡i->
ai_´ÙocŞ
);

47 ià(
±r
) {

48 
Ën
 = 
	`š‘_¤üt_add
(
¬gv
[
İtšd
]);

49 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_OPTIONS
, 
±r
, 
Ën
);

50 
	`ä“
(
±r
);

53 
	`CÚÃù
(
sockfd
, 
ai
->
ai_addr
,‡i->
ai_add¾’
);

55 
	`¡r_şi
(
¡dš
, 
sockfd
);

57 
	`ex™
(0);

58 
	}
}

	@osi\unpv13e\unpv13e\ipopts\tcpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
u_ch¬
 *
İts
;

8 
pid_t
 
chdpid
;

9 
sockËn_t
 
ş’
, 
Ën
;

10 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

11 
	`sig_chld
();

13 
İts
 = 
	`M®loc
(44);

15 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

17 
	`bz”o
(&
£rvaddr
, (servaddr));

18 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

19 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

20 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

22 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

24 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

26 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

29 
ş’
 = (
şŸddr
);

30 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

31 ià(
”ºo
 =ğ
EINTR
)

34 
	`”r_sys
("acceptƒrror");

37 
Ën
 = 44;

38 
	`G‘sockİt
(
cÚnfd
, 
IPPROTO_IP
, 
IP_OPTIONS
, 
İts
, &
Ën
);

39 ià(
Ën
 > 0) {

40 
	`´štf
("»ûived IP o±iÚs,†’ = %d\n", 
Ën
);

41 
	`š‘_¤üt_´št
(
İts
, 
Ën
);

44 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

45 
	`Clo£
(
li¡’fd
);

46 
	`¡r_echo
(
cÚnfd
);

47 
	`ex™
(0);

49 
	`Clo£
(
cÚnfd
);

51 
	}
}

	@osi\unpv13e\unpv13e\ipopts\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
c
, 
sockfd
, 
Ën
 = 0;

7 
u_ch¬
 *
±r
 = 
NULL
;

8 *
¹h
;

9 
addršfo
 *
ai
;

11 ià(
¬gc
 < 2)

12 
	`”r_qu™
("usage: udpcli01 [ <hostname> ... ] <hostname>");

14 ià(
¬gc
 > 2) {

15 
i
;

17 
Ën
 = 
	`IÃt6_¹h_¥aû
(
IPV6_RTHDR_TYPE_0
, 
¬gc
-2);

18 
±r
 = 
	`M®loc
(
Ën
);

19 
	`IÃt6_¹h_š™
(
±r
, 
Ën
, 
IPV6_RTHDR_TYPE_0
, 
¬gc
-2);

20 
i
 = 1; i < 
¬gc
-1; i++) {

21 
ai
 = 
	`Ho¡_£rv
(
¬gv
[
i
], 
NULL
, 
AF_INET6
, 0);

22 
	`IÃt6_¹h_add
(
±r
, &((
sockaddr_š6
 *)
ai
->
ai_addr
)->
sš6_addr
);

26 
ai
 = 
	`Ho¡_£rv
(
¬gv
[
¬gc
-1], 
SERV_PORT_STR
, 
AF_INET6
, 
SOCK_DGRAM
);

28 
sockfd
 = 
	`Sock‘
(
ai
->
ai_çmy
,‡i->
ai_sockty³
,‡i->
ai_´ÙocŞ
);

30 ià(
±r
) {

31 
	`S‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_RTHDR
, 
±r
, 
Ën
);

32 
	`ä“
(
±r
);

35 
	`dg_şi
(
¡dš
, 
sockfd
, 
ai
->
ai_addr
,‡i->
ai_add¾’
);

37 
	`ex™
(0);

38 
	}
}

	@osi\unpv13e\unpv13e\ipopts\udpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š6
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET6
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš6_çmy
 = 
AF_INET6
;

13 
£rvaddr
.
sš6_addr
 = 
š6addr_ªy
;

14 
£rvaddr
.
sš6_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\key\add.c

1 
	~"uÅ.h
"

2 
	~<Ãt/pfkeyv2.h
>

5 
	$§Ën
(
sockaddr
 *
§
)

7 #ifdeà
HAVE_SOCKADDR_SA_LEN


8  
§
->
§_Ën
;

10 
§
->
§_çmy
) {

11 
AF_INET
:

12  (
sockaddr_š
);

13 #ifdeà
IPV6


14 
AF_INET6
:

15  (
sockaddr_š6
);

21 
	}
}

24 
	$´efix_®l
(
sockaddr
 *
§
)

26 
§
->
§_çmy
) {

27 
AF_INET
:

29 #ifdeà
IPV6


30 
AF_INET6
:

36 
	}
}

40 
	$§db_add
(
sockaddr
 *
¤c
, sockadd¸*
d¡
, 
ty³
, 
®g
,

41 
¥i
, 
keyb™s
, *
keyd©a
)

43 
s
;

44 
buf
[4096], *
p
;

45 
§db_msg
 *
msg
;

46 
§db_§
 *
§ext
;

47 
§db_add»ss
 *
add»xt
;

48 
§db_key
 *
keyext
;

49 
Ën
;

50 
mypid
;

52 
s
 = 
	`Sock‘
(
PF_KEY
, 
SOCK_RAW
, 
PF_KEY_V2
);

54 
mypid
 = 
	`g‘pid
();

57 
	`bz”o
(&
buf
, (buf));

58 
p
 = 
buf
;

59 
msg
 = (
§db_msg
 *)
p
;

60 
msg
->
§db_msg_v”siÚ
 = 
PF_KEY_V2
;

61 
msg
->
§db_msg_ty³
 = 
SADB_ADD
;

62 
msg
->
§db_msg_§ty³
 = 
ty³
;

63 
msg
->
§db_msg_pid
 = 
	`g‘pid
();

64 
Ën
 = (*
msg
);

65 
p
 +ğ(*
msg
);

67 
§ext
 = (
§db_§
 *)
p
;

68 
§ext
->
§db_§_Ën
 = (*saext) / 8;

69 
§ext
->
§db_§_ex‰y³
 = 
SADB_EXT_SA
;

70 
§ext
->
§db_§_¥i
 = 
	`htÚl
(
¥i
);

71 
§ext
->
§db_§_»¶ay
 = 0;

72 
§ext
->
§db_§_¡©e
 = 
SADB_SASTATE_MATURE
;

73 
§ext
->
§db_§_auth
 = 
®g
;

74 
§ext
->
§db_§_’üy±
 = 
SADB_EALG_NONE
;

75 
§ext
->
§db_§_æags
 = 0;

76 
Ën
 +ğ
§ext
->
§db_§_Ën
 * 8;

77 
p
 +ğ
§ext
->
§db_§_Ën
 * 8;

79 
add»xt
 = (
§db_add»ss
 *)
p
;

80 
add»xt
->
§db_add»ss_Ën
 = ((*add»xtè+ 
	`§Ën
(
¤c
) + 7) / 8;

81 
add»xt
->
§db_add»ss_ex‰y³
 = 
SADB_EXT_ADDRESS_SRC
;

82 
add»xt
->
§db_add»ss_´Ùo
 = 0;

83 
add»xt
->
§db_add»ss_´efixËn
 = 
	`´efix_®l
(
¤c
);

84 
add»xt
->
§db_add»ss_»£rved
 = 0;

85 
	`memıy
(
add»xt
 + 1, 
¤c
, 
	`§Ën
(src));

86 
Ën
 +ğ
add»xt
->
§db_add»ss_Ën
 * 8;

87 
p
 +ğ
add»xt
->
§db_add»ss_Ën
 * 8;

89 
add»xt
 = (
§db_add»ss
 *)
p
;

90 
add»xt
->
§db_add»ss_Ën
 = ((*add»xtè+ 
	`§Ën
(
d¡
) + 7) / 8;

91 
add»xt
->
§db_add»ss_ex‰y³
 = 
SADB_EXT_ADDRESS_DST
;

92 
add»xt
->
§db_add»ss_´Ùo
 = 0;

93 
add»xt
->
§db_add»ss_´efixËn
 = 
	`´efix_®l
(
d¡
);

94 
add»xt
->
§db_add»ss_»£rved
 = 0;

95 
	`memıy
(
add»xt
 + 1, 
d¡
, 
	`§Ën
(dst));

96 
Ën
 +ğ
add»xt
->
§db_add»ss_Ën
 * 8;

97 
p
 +ğ
add»xt
->
§db_add»ss_Ën
 * 8;

99 
keyext
 = (
§db_key
 *)
p
;

101 
keyext
->
§db_key_Ën
 = ((*keyextè+ (
keyb™s
 / 8) + 7) / 8;

102 
keyext
->
§db_key_ex‰y³
 = 
SADB_EXT_KEY_AUTH
;

103 
keyext
->
§db_key_b™s
 = 
keyb™s
;

104 
keyext
->
§db_key_»£rved
 = 0;

105 
	`memıy
(
keyext
 + 1, 
keyd©a
, 
keyb™s
 / 8);

106 
Ën
 +ğ
keyext
->
§db_key_Ën
 * 8;

107 
p
 +ğ
keyext
->
§db_key_Ën
 * 8;

109 
msg
->
§db_msg_Ën
 = 
Ën
 / 8;

110 
	`´štf
("Sending‡dd message:\n");

111 
	`´št_§db_msg
(
buf
, 
Ën
);

112 
	`Wr™e
(
s
, 
buf
, 
Ën
);

114 
	`´štf
("\nReply„eturned:\n");

117 
msgËn
;

118 
§db_msg
 *
msgp
;

120 
msgËn
 = 
	`R—d
(
s
, &
buf
, (buf));

121 
msgp
 = (
§db_msg
 *)&
buf
;

122 ià(
msgp
->
§db_msg_pid
 =ğ
mypid
 &&

123 
msgp
->
§db_msg_ty³
 =ğ
SADB_ADD
) {

124 
	`´št_§db_msg
(
msgp
, 
msgËn
);

128 
	`şo£
(
s
);

129 
	}
}

133 
	$maš
(
¬gc
, **
¬gv
)

135 
addršfo
 
hšts
, *
¤c
, *
d¡
;

136 *
p
, *
keyd©a
, *
kp
;

137 *
•
;

138 
»t
, 
Ën
, 
i
;

139 
§ty³
, 
®g
, 
keyb™s
;

141 
	`bz”o
(&
hšts
, (hints));

142 ià((
»t
 = 
	`g‘addršfo
(
¬gv
[1], 
NULL
, &
hšts
, &
¤c
)) != 0) {

143 
	`”r_qu™
("%s: %s\n", 
¬gv
[1], 
	`gai_¡»¼Ü
(
»t
));

145 ià((
»t
 = 
	`g‘addršfo
(
¬gv
[2], 
NULL
, &
hšts
, &
d¡
)) != 0) {

146 
	`”r_qu™
("%s: %s\n", 
¬gv
[2], 
	`gai_¡»¼Ü
(
»t
));

148 ià(
¤c
->
ai_çmy
 !ğ
d¡
->ai_family) {

149 
	`”r_qu™
("% ªd % nÙ samadd¸çmy\n", 
¬gv
[1],‡rgv[2]);

151 
§ty³
 = 
SADB_SATYPE_AH
;

152 ià((
®g
 = 
	`g‘§®gbyÇme
(
§ty³
, 
¬gv
[3])) < 0) {

153 
	`”r_qu™
("UnknowÀSAy³ /‡lgÜ™hm…aœ‡h/%s\n", 
¬gv
[3]);

155 
keyb™s
 = 
	`¡¹oul
(
¬gv
[4], &
•
, 0);

156 ià(
•
 =ğ
¬gv
[4] || *• !ğ'\0' || (
keyb™s
 % 8) != 0) {

157 
	`”r_qu™
("Inv®id‚umb” oàb™ %s\n", 
¬gv
[4]);

159 
p
 = 
¬gv
[5];

160 ià(
p
[0] == '0' && (p[1] == 'x' ||…[1] == 'X'))

161 
p
 += 2;

162 
Ën
 = 
	`¡¾’
(
p
);

163 
kp
 = 
keyd©a
 = 
	`m®loc
(
keyb™s
 / 8);

164 
i
 = 0; i < 
keyb™s
; i += 8) {

165 
c
;

167 ià(
Ën
 < 2) {

168 
	`”r_qu™
("%s:‚Ùƒnough by‹ Óx³ùed %d)\n", 
¬gv
[5], 
keyb™s
 / 8);

170 ià(
	`ssÿnf
(
p
, "%2x", &
c
) != 1) {

171 
	`”r_qu™
("% cÚš šv®id hex dig™\n", 
¬gv
[5]);

173 *
kp
++ = 
c
;

174 
p
 += 2;

175 
Ën
 -= 2;

177 ià(
Ën
 > 0) {

178 
	`”r_qu™
("%s:oØmªy by‹ Óx³ùed %d)\n", 
¬gv
[5], 
keyb™s
 / 8);

180 
	`§db_add
(
¤c
->
ai_addr
, 
d¡
->ai_addr, 
§ty³
, 
®g
, 0x9876, 
keyb™s
, 
keyd©a
);

181 
	}
}

	@osi\unpv13e\unpv13e\key\dump.c

1 
	~"uÅ.h
"

2 
	~<Ãt/pfkeyv2.h
>

6 
	$§db_dump
(
ty³
)

8 
s
;

9 
buf
[4096];

10 
§db_msg
 
msg
;

11 
gÙeof
;

13 
s
 = 
	`Sock‘
(
PF_KEY
, 
SOCK_RAW
, 
PF_KEY_V2
);

16 
	`bz”o
(&
msg
, (msg));

17 
msg
.
§db_msg_v”siÚ
 = 
PF_KEY_V2
;

18 
msg
.
§db_msg_ty³
 = 
SADB_DUMP
;

19 
msg
.
§db_msg_§ty³
 = 
ty³
;

20 
msg
.
§db_msg_Ën
 = (msg) / 8;

21 
msg
.
§db_msg_pid
 = 
	`g‘pid
();

22 
	`´štf
("Sending dump message:\n");

23 
	`´št_§db_msg
(&
msg
, (msg));

24 
	`Wr™e
(
s
, &
msg
, (msg));

26 
	`´štf
("\nMessages„eturned:\n");

28 
gÙeof
 = 0;

29 
gÙeof
 == 0) {

30 
msgËn
;

31 
§db_msg
 *
msgp
;

33 
msgËn
 = 
	`R—d
(
s
, &
buf
, (buf));

34 
msgp
 = (
§db_msg
 *)&
buf
;

35 
	`´št_§db_msg
(
msgp
, 
msgËn
);

36 ià(
msgp
->
§db_msg_£q
 == 0)

37 
gÙeof
 = 1;

39 
	`şo£
(
s
);

40 
	}
}

43 
	$maš
(
¬gc
, **
¬gv
)

45 
§ty³
 = 
SADB_SATYPE_UNSPEC
;

46 
c
;

48 
İ‹¼
 = 0;

49  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "t:")) != -1) {

50 
c
) {

52 ià((
§ty³
 = 
	`g‘§ty³byÇme
(
İrg
)) == -1)

53 
	`”r_qu™
("šv®id -ˆİtiÚ %s", 
İrg
);

57 
	`”r_qu™
("uÄecognized o±iÚ: %c", 
c
);

61 
	`§db_dump
(
§ty³
);

62 
	}
}

	@osi\unpv13e\unpv13e\key\name.c

1 
	~"uÅ.h
"

2 
	~<Ãt/pfkeyv2.h
>

4 
	sidli¡
 {

5 
	mv®
;

6 cÚ¡ *
	mÇme
;

9 
idli¡
 
	g§ty³
[] = {

10 { 
SADB_SATYPE_UNSPEC
, "unspec" },

11 { 
SADB_SATYPE_AH
, "ah" },

12 { 
SADB_SATYPE_ESP
, "esp" },

13 { 
SADB_SATYPE_RSVP
, "rsvp" },

14 { 
SADB_SATYPE_OSPFV2
, "ospfv2" },

15 { 
SADB_SATYPE_RIPV2
, "ripv2" },

16 { 
SADB_SATYPE_MIP
, "mip" },

17 { 0, 
NULL
 } };

19 
idli¡
 
	gah®g
[] = {

20 { 
SADB_AALG_NONE
, "none" },

21 { 
SADB_AALG_MD5HMAC
, "HMAC-MD5-96" },

22 { 
SADB_AALG_SHA1HMAC
, "HMAC-SHA-1-96" },

23 { 0, 
NULL
 } };

25 
idli¡
 
	ge¥®g
[] = {

26 { 
SADB_EALG_NONE
, "none" },

27 { 
SADB_EALG_DESCBC
, "DES-CBC" },

28 { 
SADB_EALG_3DESCBC
, "3DES-CBC" },

29 { 
SADB_EALG_NULL
, "NULL" },

30 { 0, 
NULL
 } };

33 
	$idli¡lookup
(*
Çme
, 
idli¡
 *

)

35 ; 

->
Çme
 !ğ
NULL
; il++) {

36 ià(
	`¡rcmp
(
Çme
, 

->name) == 0)

37  

->
v®
;

40 
	}
}

43 
	$g‘§ty³byÇme
(*
Çme
)

45  
	`idli¡lookup
(
Çme
, 
§ty³
);

46 
	}
}

49 
	$g‘§®gbyÇme
(
ty³
, *
Çme
)

51 
ty³
) {

52 
SADB_SATYPE_AH
:

53  
	`idli¡lookup
(
Çme
, 
ah®g
);

54 
SADB_SATYPE_ESP
:

55  
	`idli¡lookup
(
Çme
, 
e¥®g
);

59 
	}
}

	@osi\unpv13e\unpv13e\key\printsadbmsg.c

1 
	~"uÅ.h
"

2 
	~<Ãt/pfkeyv2.h
>

5 
	$g‘_§db_msg_ty³
(
ty³
)

7 
buf
[100];

8 
ty³
) {

9 
SADB_RESERVED
:  "Reserved";

10 
SADB_GETSPI
:  "Get SPI";

11 
SADB_UPDATE
:  "Update";

12 
SADB_ADD
:  "Add";

13 
SADB_DELETE
:  "Delete";

14 
SADB_GET
:  "Get";

15 
SADB_ACQUIRE
:  "Acquire";

16 
SADB_REGISTER
:  "Register";

17 
SADB_EXPIRE
:  "Expire";

18 
SADB_FLUSH
:  "Flush";

19 
SADB_DUMP
:  "Dump";

20 : 
	`¥rštf
(
buf
, "[UnknowÀty³ %d]", 
ty³
);

21  
buf
;

23 
	}
}

26 
	$g‘_§db_§ty³
(
ty³
)

28 
buf
[100];

29 
ty³
) {

30 
SADB_SATYPE_UNSPEC
:  "Unspecified";

31 
SADB_SATYPE_AH
:  "IPsec AH";

32 
SADB_SATYPE_ESP
:  "IPsec ESP";

33 
SADB_SATYPE_RSVP
:  "RSVP";

34 
SADB_SATYPE_OSPFV2
:  "OSPFv2";

35 
SADB_SATYPE_RIPV2
:  "RIPv2";

36 
SADB_SATYPE_MIP
:  "Mobile IP";

37 : 
	`¥rštf
(
buf
, "[UnknowÀ§ty³ %d]", 
ty³
);

38  
buf
;

40 
	}
}

43 
	$g‘_auth_®g
(
®g
)

45 
buf
[100];

46 
®g
) {

47 
SADB_AALG_NONE
:  "None";

48 
SADB_AALG_MD5HMAC
:  "HMAC-MD5";

49 
SADB_AALG_SHA1HMAC
:  "HMAC-SHA-1";

50 #ifdeà
SADB_X_AALG_MD5


51 
SADB_X_AALG_MD5
:  "Keyed MD5";

53 #ifdeà
SADB_X_AALG_SHA


54 
SADB_X_AALG_SHA
:  "Keyed SHA-1";

56 #ifdeà
SADB_X_AALG_NULL


57 
SADB_X_AALG_NULL
:  "Null";

59 #ifdeà
SADB_X_AALG_SHA2_256


60 
SADB_X_AALG_SHA2_256
:  "SHA2-256";

62 #ifdeà
SADB_X_AALG_SHA2_384


63 
SADB_X_AALG_SHA2_384
:  "SHA2-384";

65 #ifdeà
SADB_X_AALG_SHA2_512


66 
SADB_X_AALG_SHA2_512
:  "SHA2-512";

68 : 
	`¥rštf
(
buf
, "[UnknowÀauth’tiÿtiÚ‡lgÜ™hm %d]", 
®g
);

69  
buf
;

71 
	}
}

74 
	$g‘_’üy±_®g
(
®g
)

76 
buf
[100];

77 
®g
) {

78 
SADB_EALG_NONE
:  "None";

79 
SADB_EALG_DESCBC
:  "DES-CBC";

80 
SADB_EALG_3DESCBC
:  "3DES-CBC";

81 
SADB_EALG_NULL
:  "Null";

82 #ifdeà
SADB_X_EALG_CAST128CBC


83 
SADB_X_EALG_CAST128CBC
:  "CAST128-CBC";

85 #ifdeà
SADB_X_EALG_BLOWFISHCBC


86 
SADB_X_EALG_BLOWFISHCBC
:  "Blowfish-CBC";

88 #ifdeà
SADB_X_EALG_AES


89 
SADB_X_EALG_AES
:  "AES";

91 : 
	`¥rštf
(
buf
, "[UnknowÀ’üy±iÚ‡lgÜ™hm %d]", 
®g
);

92  
buf
;

94 
	}
}

97 
	$g‘_§_¡©e
(
¡©e
)

99 
buf
[100];

100 
¡©e
) {

101 
SADB_SASTATE_LARVAL
:  "Larval";

102 
SADB_SASTATE_MATURE
:  "Mature";

103 
SADB_SASTATE_DYING
:  "Dying";

104 
SADB_SASTATE_DEAD
:  "Dead";

105 : 
	`¥rštf
(
buf
, "[UnknowÀSA s‹ %d]", 
¡©e
);

106  
buf
;

108 
	}
}

111 
	$g‘_§db_®g_ty³
(
®g
, 
auth’c
)

113 ià(
auth’c
 =ğ
SADB_EXT_SUPPORTED_AUTH
) {

114  
	`g‘_auth_®g
(
®g
);

116  
	`g‘_’üy±_®g
(
®g
);

118 
	}
}

121 
	$§_´št
(
§db_ext
 *
ext
)

123 
§db_§
 *
§
 = (§db_§ *)
ext
;

124 
	`´štf
(" SA: SPI=%d Replay Window=%d State=%s\n",

125 
§
->
§db_§_¥i
, sa->
§db_§_»¶ay
,

126 
	`g‘_§_¡©e
(
§
->
§db_§_¡©e
));

127 
	`´štf
(" Authentication Algorithm: %s\n",

128 
	`g‘_auth_®g
(
§
->
§db_§_auth
));

129 
	`´štf
(" Encryption Algorithm: %s\n",

130 
	`g‘_’üy±_®g
(
§
->
§db_§_’üy±
));

131 ià(
§
->
§db_§_æags
 & 
SADB_SAFLAGS_PFS
)

132 
	`´štf
(" Perfect Forward Secrecy\n");

133 
	}
}

136 
	$suµÜ‹d_´št
(
§db_ext
 *
ext
)

138 
§db_suµÜ‹d
 *
sup
 = (§db_suµÜ‹d *)
ext
;

139 
§db_®g
 *
®g
;

140 
Ën
;

142 
	`´štf
(" Supported %s‡lgorithms:\n",

143 
sup
->
§db_suµÜ‹d_ex‰y³
 =ğ
SADB_EXT_SUPPORTED_AUTH
 ?

146 
Ën
 = 
sup
->
§db_suµÜ‹d_Ën
 * 8;

147 
Ën
 -ğ(*
sup
);

148 ià(
Ën
 == 0) {

149 
	`´štf
(" None\n");

152 
®g
 = (
§db_®g
 *)(
sup
 + 1); 
Ën
>0;†en -= (*alg),‡lg++) {

153 
	`´štf
(" %s ivlen %d bits %d-%d\n",

154 
	`g‘_§db_®g_ty³
(
®g
->
§db_®g_id
, 
sup
->
§db_suµÜ‹d_ex‰y³
),

155 
®g
->
§db_®g_ivËn
,‡lg->
§db_®g_mšb™s
,‡lg->
§db_®g_maxb™s
);

157 
	}
}

160 
	$liãtime_´št
(
§db_ext
 *
ext
)

162 
§db_liãtime
 *
liã
 = (§db_liãtim*)
ext
;

164 
	`´štf
(" %s†ifetime:\n",

165 
liã
->
§db_liãtime_ex‰y³
 =ğ
SADB_EXT_LIFETIME_CURRENT
 ?

167 
liã
->
§db_liãtime_ex‰y³
 =ğ
SADB_EXT_LIFETIME_HARD
 ?

170 
	`´štf
(" %d‡ÎoÿtiÚs, %d by‹s", 
liã
->
§db_liãtime_®loÿtiÚs
,

171 
liã
->
§db_liãtime_by‹s
);

172 ià(
liã
->
§db_liãtime_ex‰y³
 =ğ
SADB_EXT_LIFETIME_CURRENT
) {

173 
time_t
 
t
;

174 
tmp
 *
tm
;

175 
buf
[100];

178 
t
 = 
liã
->
§db_liãtime_addtime
;

179 
tm
 = 
	`loÿÉime
(&
t
);

180 
	`¡ráime
(
buf
, (buf), "%c", 
tm
);

181 
	`´štf
("\À‡dded‡ˆ%s, ", 
buf
);

182 ià(
liã
->
§db_liãtime_u£time
 == 0) {

183 
	`´štf
("never used\n");

185 
t
 = 
liã
->
§db_liãtime_u£time
;

186 
tm
 = 
	`loÿÉime
(&
t
);

187 
	`¡ráime
(
buf
, (buf), "%c", 
tm
);

188 
	`´štf
("fœ¡ u£d‡ˆ%s\n", 
buf
);

191 
	`´štf
("%d‡ddtime, %d u£time\n", 
liã
->
§db_liãtime_addtime
,

192 
liã
->
§db_liãtime_u£time
);

194 
	}
}

197 
	$add»ss_´št
(
§db_ext
 *
ext
)

199 
§db_add»ss
 *
addr
 = (§db_add»s *)
ext
;

200 
sockaddr
 *
§
;

202 
	`´štf
(" %s‡ddress: ",

203 
addr
->
§db_add»ss_ex‰y³
 =ğ
SADB_EXT_ADDRESS_SRC
 ?

205 
addr
->
§db_add»ss_ex‰y³
 =ğ
SADB_EXT_ADDRESS_DST
 ?

208 
§
 = (
sockaddr
 *)(
addr
 + 1);

209 
	`´štf
(" %s", 
	`sock_Áİ
(
§
, 
addr
->
§db_add»ss_Ën
 * 8 - (*addr)));

210 ià(
addr
->
§db_add»ss_´efixËn
 == 0)

211 
	`´štf
(" ");

213 
	`´štf
("/%d ", 
addr
->
§db_add»ss_´efixËn
);

214 
addr
->
§db_add»ss_´Ùo
) {

215 
IPPROTO_UDP
: 
	`´štf
("(UDP)"); ;

216 
IPPROTO_TCP
: 
	`´štf
("(TCP)"); ;

218 : 
	`´štf
("(IP…rÙØ%d)", 
addr
->
§db_add»ss_´Ùo
);

221 
	`´štf
("\n");

222 
	}
}

225 
	$key_´št
(
§db_ext
 *
ext
)

227 
§db_key
 *
key
 = (§db_key *)
ext
;

228 
b™s
;

229 *
p
;

231 
	`´štf
(" %s key, %d bits: 0x",

232 
key
->
§db_key_ex‰y³
 =ğ
SADB_EXT_KEY_AUTH
 ?

234 
key
->
§db_key_b™s
);

235 
p
 = (*)(
key
 + 1), 
b™s
 = key->
§db_key_b™s
;

236 
b™s
 > 0; 
p
++, bits -= 8)

237 
	`´štf
("%02x", *
p
);

238 
	`´štf
("\n");

239 
	}
}

242 
	$´št_§db_msg
(
§db_msg
 *
msg
, 
msgËn
)

244 
§db_ext
 *
ext
;

246 ià(
msgËn
 !ğ
msg
->
§db_msg_Ën
 * 8) {

247 
	`”r_msg
("SADB Message†ength (%d) doesn't match msglen (%d)\n",

248 
msg
->
§db_msg_Ën
 * 8, 
msgËn
);

251 ià(
msg
->
§db_msg_v”siÚ
 !ğ
PF_KEY_V2
) {

252 
	`”r_msg
("SADB Message version‚ot PF_KEY_V2\n");

255 
	`´štf
("SADB Message %s,ƒrrno %d, satype %s, seq %d,…id %d\n",

256 
	`g‘_§db_msg_ty³
(
msg
->
§db_msg_ty³
), msg->
§db_msg_”ºo
,

257 
	`g‘_§db_§ty³
(
msg
->
§db_msg_§ty³
), msg->
§db_msg_£q
,

258 
msg
->
§db_msg_pid
);

259 ià(
msg
->
§db_msg_”ºo
 != 0)

260 
	`´štf
("ƒ¼nØ%s\n", 
	`¡»¼Ü
(
msg
->
§db_msg_”ºo
));

261 ià(
msgËn
 =ğ(
§db_msg
))

263 
msgËn
 -ğ(
§db_msg
);

264 
ext
 = (
§db_ext
 *)(
msg
 + 1);

265 
msgËn
 > 0) {

266 
ext
->
§db_ext_ty³
) {

267 
SADB_EXT_RESERVED
: 
	`´štf
(" Reserved Extension\n"); ;

268 
SADB_EXT_SA
: 
	`§_´št
(
ext
); ;

269 
SADB_EXT_LIFETIME_CURRENT
:

270 
SADB_EXT_LIFETIME_HARD
:

271 
SADB_EXT_LIFETIME_SOFT
:

272 
	`liãtime_´št
(
ext
); ;

273 
SADB_EXT_ADDRESS_SRC
:

274 
SADB_EXT_ADDRESS_DST
:

275 
SADB_EXT_ADDRESS_PROXY
:

276 
	`add»ss_´št
(
ext
); ;

277 
SADB_EXT_KEY_AUTH
:

278 
SADB_EXT_KEY_ENCRYPT
:

279 
	`key_´št
(
ext
); ;

280 
SADB_EXT_IDENTITY_SRC
:

281 
SADB_EXT_IDENTITY_DST
:

282 
	`´štf
(" [identity...]\n"); ;

283 
SADB_EXT_SENSITIVITY
:

284 
	`´štf
(" [sensitivity...]\n"); ;

285 
SADB_EXT_PROPOSAL
:

286 
	`´štf
(" [proposal...]\n"); ;

287 
SADB_EXT_SUPPORTED_AUTH
:

288 
SADB_EXT_SUPPORTED_ENCRYPT
:

289 
	`suµÜ‹d_´št
(
ext
); ;

290 
SADB_EXT_SPIRANGE
:

291 
	`´štf
(" [spirange...]\n"); ;

292 : 
	`´štf
(" [unknowÀex‹nsiÚ %d]\n", 
ext
->
§db_ext_ty³
);

294 
msgËn
 -ğ
ext
->
§db_ext_Ën
 << 3;

295 
ext
 = (*ëxˆ+ (ext->
§db_ext_Ën
 << 3);

297 
	}
}

	@osi\unpv13e\unpv13e\key\register.c

1 
	~"uÅ.h
"

2 
	~<Ãt/pfkeyv2.h
>

6 
	$§db_»gi¡”
(
ty³
)

8 
s
;

9 
buf
[4096];

10 
§db_msg
 
msg
;

11 
gÙeof
;

12 
mypid
;

14 
s
 = 
	`Sock‘
(
PF_KEY
, 
SOCK_RAW
, 
PF_KEY_V2
);

16 
mypid
 = 
	`g‘pid
();

19 
	`bz”o
(&
msg
, (msg));

20 
msg
.
§db_msg_v”siÚ
 = 
PF_KEY_V2
;

21 
msg
.
§db_msg_ty³
 = 
SADB_REGISTER
;

22 
msg
.
§db_msg_§ty³
 = 
ty³
;

23 
msg
.
§db_msg_Ën
 = (msg) / 8;

24 
msg
.
§db_msg_pid
 = 
mypid
;

25 
	`´štf
("Sending„egister message:\n");

26 
	`´št_§db_msg
(&
msg
, (msg));

27 
	`Wr™e
(
s
, &
msg
, (msg));

29 
	`´štf
("\nReply„eturned:\n");

32 
msgËn
;

33 
§db_msg
 *
msgp
;

35 
msgËn
 = 
	`R—d
(
s
, &
buf
, (buf));

36 
msgp
 = (
§db_msg
 *)&
buf
;

37 ià(
msgp
->
§db_msg_pid
 =ğ
mypid
 &&

38 
msgp
->
§db_msg_ty³
 =ğ
SADB_REGISTER
) {

39 
	`´št_§db_msg
(
msgp
, 
msgËn
);

43 
	`şo£
(
s
);

44 
	}
}

48 
	$maš
(
¬gc
, **
¬gv
)

50 
§ty³
 = 
SADB_SATYPE_UNSPEC
;

51 
c
;

53 
İ‹¼
 = 0;

54  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "t:")) != -1) {

55 
c
) {

57 ià((
§ty³
 = 
	`g‘§ty³byÇme
(
İrg
)) == -1)

58 
	`”r_qu™
("šv®id -ˆİtiÚ %s", 
İrg
);

62 
	`”r_qu™
("uÄecognized o±iÚ: %c", 
c
);

66 ià(
§ty³
 =ğ
SADB_SATYPE_UNSPEC
) {

67 
	`”r_qu™
("must specify SAype");

70 
	`§db_»gi¡”
(
§ty³
);

71 
	}
}

	@osi\unpv13e\unpv13e\key\unp.h

4 #iâdef 
__uÅ_h


5 
	#__uÅ_h


	)

7 
	~"../cÚfig.h
"

13 
	~<sys/ty³s.h
>

14 
	~<sys/sock‘.h
>

15 
	~<sys/time.h
>

16 
	~<time.h
>

17 
	~<Ãtš‘/š.h
>

18 
	~<¬·/š‘.h
>

19 
	~<”ºo.h
>

20 
	~<fú.h
>

21 
	~<Ãtdb.h
>

22 
	~<sigÇl.h
>

23 
	~<¡dio.h
>

24 
	~<¡dlib.h
>

25 
	~<¡ršg.h
>

26 
	~<sys/¡©.h
>

27 
	~<sys/uio.h
>

28 
	~<uni¡d.h
>

29 
	~<sys/wa™.h
>

30 
	~<sys/un.h
>

32 #ifdef 
HAVE_SYS_SELECT_H


33 
	~<sys/£Ëù.h
>

36 #ifdef 
HAVE_SYS_SYSCTL_H


37 
	~<sys/sysùl.h
>

40 #ifdef 
HAVE_POLL_H


41 
	~<pŞl.h
>

44 #ifdef 
HAVE_STRINGS_H


45 
	~<¡ršgs.h
>

51 #ifdef 
HAVE_SYS_IOCTL_H


52 
	~<sys/ioùl.h
>

54 #ifdef 
HAVE_SYS_FILIO_H


55 
	~<sys/fio.h
>

57 #ifdef 
HAVE_SYS_SOCKIO_H


58 
	~<sys/sockio.h
>

61 #ifdef 
HAVE_PTHREAD_H


62 
	~<±h»ad.h
>

65 #ifdeà
HAVE_NET_IF_DL_H


66 
	~<Ãt/if_dl.h
>

70 #ifdef 
__osf__


71 #undeà
»cv


72 #undeà
£nd


73 
	#»cv
(
a
,
b
,
c
,
d
è
	`»cväom
×,b,c,d,0,0)

	)

74 
	#£nd
(
a
,
b
,
c
,
d
è
	`£ndto
×,b,c,d,0,0)

	)

77 #iâdef 
INADDR_NONE


79 
	#INADDR_NONE
 0xfffffffà

	)

82 #iâdef 
SHUT_RD


83 
	#SHUT_RD
 0

	)

84 
	#SHUT_WR
 1

	)

85 
	#SHUT_RDWR
 2

	)

92 #iâdeà
INET_ADDRSTRLEN


94 
	#INET_ADDRSTRLEN
 16

	)

100 #iâdeà
INET6_ADDRSTRLEN


102 
	#INET6_ADDRSTRLEN
 46

	)

110 #iâdef 
HAVE_BZERO


111 
	#bz”o
(
±r
,
n
è
	`mem£t
ÕŒ, 0,‚)

	)

117 #iâdef 
HAVE_GETHOSTBYNAME2


118 
	#g‘ho¡byÇme2
(
ho¡
,
çmy
è
	`g‘ho¡byÇme
((ho¡))

	)

122 
	sš_pktšfo
 {

123 
š_addr
 
	mi_addr
;

124 
	mi_ifšdex
;

133 #iâdef 
CMSG_LEN


135 
	#CMSG_LEN
(
size
è((
cmsghdr
è+ (size))

	)

137 #iâdef 
CMSG_SPACE


139 
	#CMSG_SPACE
(
size
è((
cmsghdr
è+ (size))

	)

145 #iâdef 
SUN_LEN


147 
	#SUN_LEN
(
su
) \

148 ((*(
su
)è- ((su)->
sun_·th
è+ 
	`¡¾’
((su)->sun_·th))

	)

153 #iâdef 
AF_LOCAL


154 
	#AF_LOCAL
 
AF_UNIX


	)

156 #iâdef 
PF_LOCAL


157 
	#PF_LOCAL
 
PF_UNIX


	)

164 #iâdeà
INFTIM


165 
	#INFTIM
 (-1è

	)

167 #ifdef 
HAVE_POLL_H


168 
	#INFTIM_UNPH


	)

174 
	#LISTENQ
 1024

	)

177 
	#MAXLINE
 4096

	)

178 
	#MAXSOCKADDR
 128

	)

179 
	#BUFFSIZE
 8192

	)

182 
	#SERV_PORT
 9877

	)

183 
	#SERV_PORT_STR
 "9877"

	)

184 
	#UNIXSTR_PATH
 "/tmp/unix.¡r"

	)

185 
	#UNIXDG_PATH
 "/tmp/unix.dg"

	)

195 
	#SA
 
sockaddr


	)

197 
	#FILE_MODE
 (
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
)

	)

199 
	#DIR_MODE
 (
FILE_MODE
 | 
S_IXUSR
 | 
S_IXGRP
 | 
S_IXOTH
)

	)

202 
	tSigfunc
();

204 
	#mš
(
a
,
b
è(×è< (bè? (aè: (b))

	)

205 
	#max
(
a
,
b
è(×è> (bè? (aè: (b))

	)

207 #iâdef 
HAVE_ADDRINFO_STRUCT


208 
	~"../lib/addršfo.h
"

211 #iâdef 
HAVE_IF_NAMEINDEX_STRUCT


212 
	sif_Çmešdex
 {

213 
	mif_šdex
;

214 *
	mif_Çme
;

221 #iâdef 
HAVE_TIMESPEC_STRUCT


222 
	stime¥ec
 {

223 
time_t
 
	mtv_£c
;

224 
	mtv_n£c
;

233 
cÚÃù_nÚb
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

234 
cÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

235 
d«mÚ_š™
(const *, );

236 
d«mÚ_š‘d
(const *, );

237 
dg_şi
(
FILE
 *, , cÚ¡ 
SA
 *, 
sockËn_t
);

238 
dg_echo
(, 
SA
 *, 
sockËn_t
);

239 
çmy_to_Ëv–
();

240 *
gf_time
();

241 
h—¹b—t_şi
(, , );

242 
h—¹b—t_£rv
(, , );

243 
addršfo
 *
ho¡_£rv
(const *, const *, , );

244 
š‘_¤üt_add
(*, );

245 
u_ch¬
 *
š‘_¤üt_š™
();

246 
š‘_¤üt_´št
(
u_ch¬
 *, );

247 **
my_addrs
(*);

248 
»adabË_timeo
(, );

249 
ssize_t
 
»adlše
(, *, 
size_t
);

250 
ssize_t
 
»adn
(, *, 
size_t
);

251 
ssize_t
 
»ad_fd
(, *, 
size_t
, *);

252 
ssize_t
 
»cväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

253 
š_pktšfo
 *);

254 
Sigfunc
 *
sigÇl_šŒ
(, Sigfunc *);

255 
sock_bšd_wd
(, );

256 
sock_cmp_addr
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

257 
sock_cmp_pÜt
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

258 
sock_g‘_pÜt
(cÚ¡ 
SA
 *, 
sockËn_t
);

259 
sock_£t_addr
(
SA
 *, 
sockËn_t
, const *);

260 
sock_£t_pÜt
(
SA
 *, 
sockËn_t
, );

261 
sock_£t_wd
(
SA
 *, 
sockËn_t
);

262 *
sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

263 *
sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

264 
sockfd_to_çmy
();

265 
¡r_echo
();

266 
¡r_şi
(
FILE
 *, );

267 
tı_cÚÃù
(const *, const *);

268 
tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

269 
tv_sub
(
timev®
 *, timeval *);

270 
udp_ş›Á
(cÚ¡ *, cÚ¡ *, **, 
sockËn_t
 *);

271 
udp_cÚÃù
(const *, const *);

272 
udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

273 
wr™abË_timeo
(, );

274 
ssize_t
 
wr™’
(, cÚ¡ *, 
size_t
);

275 
ssize_t
 
wr™e_fd
(, *, 
size_t
, );

277 #ifdef 
MCAST


278 
mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

279 
mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

280 
mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

281 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

282 
mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

283 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

284 cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

285 
mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

286 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

287 
mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

288 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

289 
mÿ¡_g‘_if
();

290 
mÿ¡_g‘_loİ
();

291 
mÿ¡_g‘_‰l
();

292 
mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

293 
mÿ¡_£t_loİ
(, );

294 
mÿ¡_£t_‰l
(, );

296 
Mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

297 
Mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

298 
Mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

299 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

300 
Mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

301 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

302 cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

303 
Mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

304 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

305 
Mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

306 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

307 
Mÿ¡_g‘_if
();

308 
Mÿ¡_g‘_loİ
();

309 
Mÿ¡_g‘_‰l
();

310 
Mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

311 
Mÿ¡_£t_loİ
(, );

312 
Mÿ¡_£t_‰l
(, );

315 
š_cksum
(*, );

317 #iâdef 
HAVE_GETADDRINFO_PROTO


318 
g‘addršfo
(cÚ¡ *, cÚ¡ *, cÚ¡ 
addršfo
 *,

319 
addršfo
 **);

320 
ä“addršfo
(
addršfo
 *);

321 *
gai_¡»¼Ü
();

324 #iâdef 
HAVE_GETNAMEINFO_PROTO


325 
g‘Çmešfo
(cÚ¡ 
SA
 *, 
sockËn_t
, *, 
size_t
, *, size_t, );

328 #iâdef 
HAVE_GETHOSTNAME_PROTO


329 
g‘ho¡Çme
(*, );

332 #iâdef 
HAVE_HSTRERROR_PROTO


333 cÚ¡ *
h¡»¼Ü
();

336 #iâdef 
HAVE_IF_NAMETOINDEX_PROTO


337 
if_Çm‘ošdex
(const *);

338 *
if_šdextÚame
(, *);

339 
if_ä“Çmešdex
(
if_Çmešdex
 *);

340 
if_Çmešdex
 *if_nameindex();

343 #iâdef 
HAVE_INET_PTON_PROTO


344 
š‘_±Ú
(, const *, *);

345 cÚ¡ *
š‘_Áİ
(, cÚ¡ *, *, 
size_t
);

348 #iâdef 
HAVE_INET_ATON_PROTO


349 
š‘_©Ú
(cÚ¡ *, 
š_addr
 *);

352 #iâdef 
HAVE_ISFDTYPE_PROTO


353 
isfdty³
(, );

356 #iâdef 
HAVE_PSELECT_PROTO


357 
p£Ëù
(, 
fd_£t
 *, fd_set *, fd_set *,

358 cÚ¡ 
time¥ec
 *, cÚ¡ 
sig£t_t
 *);

361 #iâdef 
HAVE_SOCKATMARK_PROTO


362 
sock©m¬k
();

365 #iâdef 
HAVE_SNPRINTF_PROTO


366 
¢´štf
(*, 
size_t
, const *, ...);

370 
CÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

371 
Famy_to_Ëv–
();

372 
addršfo
 *
Ho¡_£rv
(const *, const *, , );

373 cÚ¡ *
IÃt_Áİ
(, cÚ¡ *, *, 
size_t
);

374 
IÃt_±Ú
(, const *, *);

375 *
If_šdextÚame
(, *);

376 
If_Çm‘ošdex
(const *);

377 
if_Çmešdex
 *
If_Çmešdex
();

378 **
My_addrs
(*);

379 
ssize_t
 
R—d_fd
(, *, 
size_t
, *);

380 
R—dabË_timeo
(, );

381 
ssize_t
 
Recväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

382 
š_pktšfo
 *);

383 
Sigfunc
 *
SigÇl
(, Sigfunc *);

384 
Sigfunc
 *
SigÇl_šŒ
(, Sigfunc *);

385 
Sock_bšd_wd
(, );

386 *
Sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

387 *
Sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

388 
Sockfd_to_çmy
();

389 
Tı_cÚÃù
(const *, const *);

390 
Tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

391 
Udp_ş›Á
(cÚ¡ *, cÚ¡ *, **, 
sockËn_t
 *);

392 
Udp_cÚÃù
(const *, const *);

393 
Udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

394 
ssize_t
 
Wr™e_fd
(, *, 
size_t
, );

395 
Wr™abË_timeo
(, );

398 *
C®loc
(
size_t
, size_t);

399 
Clo£
();

400 
Dup2
(, );

401 
Fú
(, , );

402 
G‘timeofday
(
timev®
 *, *);

403 
Ioùl
(, , *);

404 
pid_t
 
FÜk
();

405 *
M®loc
(
size_t
);

406 
Mk¡emp
(*);

407 *
Mm­
(*, 
size_t
, , , , 
off_t
);

408 
O³n
(cÚ¡ *, , 
mode_t
);

409 
Pe
(*
fds
);

410 
ssize_t
 
R—d
(, *, 
size_t
);

411 
Sigadd£t
(
sig£t_t
 *, );

412 
Sigd–£t
(
sig£t_t
 *, );

413 
Sigem±y£t
(
sig£t_t
 *);

414 
Sigfl£t
(
sig£t_t
 *);

415 
Sigismemb”
(cÚ¡ 
sig£t_t
 *, );

416 
Sig³ndšg
(
sig£t_t
 *);

417 
Sig´ocmask
(, cÚ¡ 
sig£t_t
 *, sigset_t *);

418 *
SŒdup
(const *);

419 
SyscÚf
();

420 
Sysùl
(*, 
u_št
, *, 
size_t
 *, *, size_t);

421 
UÆšk
(const *);

422 
pid_t
 
Wa™
(*);

423 
pid_t
 
Wa™pid
(pid_t, *, );

424 
Wr™e
(, *, 
size_t
);

427 
Fşo£
(
FILE
 *);

428 
FILE
 *
Fdİ’
(, const *);

429 *
Fg‘s
(*, , 
FILE
 *);

430 
FILE
 *
Fİ’
(const *, const *);

431 
Fputs
(cÚ¡ *, 
FILE
 *);

434 
Acû±
(, 
SA
 *, 
sockËn_t
 *);

435 
Bšd
(, cÚ¡ 
SA
 *, 
sockËn_t
);

436 
CÚÃù
(, cÚ¡ 
SA
 *, 
sockËn_t
);

437 
G‘³”Çme
(, 
SA
 *, 
sockËn_t
 *);

438 
G‘sockÇme
(, 
SA
 *, 
sockËn_t
 *);

439 
G‘sockİt
(, , , *, 
sockËn_t
 *);

440 
Isfdty³
(, );

441 
Li¡’
(, );

442 #ifdef 
HAVE_POLL


443 
PŞl
(
pŞlfd
 *, , );

445 
ssize_t
 
R—dlše
(, *, 
size_t
);

446 
ssize_t
 
R—dn
(, *, 
size_t
);

447 
ssize_t
 
Recv
(, *, 
size_t
, );

448 
ssize_t
 
Recväom
(, *, 
size_t
, , 
SA
 *, 
sockËn_t
 *);

449 
ssize_t
 
Recvmsg
(, 
msghdr
 *, );

450 
S–eù
(, 
fd_£t
 *, fd_£ˆ*, fd_£ˆ*, 
timev®
 *);

451 
S’d
(, cÚ¡ *, 
size_t
, );

452 
S’dto
(, cÚ¡ *, 
size_t
, , cÚ¡ 
SA
 *, 
sockËn_t
);

453 
S’dmsg
(, cÚ¡ 
msghdr
 *, );

454 
S‘sockİt
(, , , cÚ¡ *, 
sockËn_t
);

455 
Shutdown
(, );

456 
Sock©m¬k
();

457 
Sock‘
(, , );

458 
Sock‘·œ
(, , , *);

459 
Wr™’
(, *, 
size_t
);

461 
”r_dump
(const *, ...);

462 
”r_msg
(const *, ...);

463 
”r_qu™
(const *, ...);

464 
”r_»t
(const *, ...);

465 
”r_sys
(const *, ...);

	@osi\unpv13e\unpv13e\lib\addrinfo.h

1 #iâdef 
__addršfo_h


2 
	#__addršfo_h


	)

10 
	saddršfo
 {

11 
	mai_æags
;

12 
	mai_çmy
;

13 
	mai_sockty³
;

14 
	mai_´ÙocŞ
;

15 
size_t
 
	mai_add¾’
;

16 *
	mai_ÿnÚÇme
;

17 
sockaddr
 *
	mai_addr
;

18 
addršfo
 *
	mai_Ãxt
;

22 
	#AI_PASSIVE
 1

	)

23 
	#AI_CANONNAME
 2

	)

26 
	#NI_MAXHOST
 1025

	)

27 
	#NI_MAXSERV
 32

	)

29 
	#NI_NOFQDN
 1

	)

30 
	#NI_NUMERICHOST
 2

	)

31 
	#NI_NAMEREQD
 4

	)

32 
	#NI_NUMERICSERV
 8

	)

33 
	#NI_DGRAM
 16

	)

36 
	#EAI_ADDRFAMILY
 1

	)

37 
	#EAI_AGAIN
 2

	)

38 
	#EAI_BADFLAGS
 3

	)

39 
	#EAI_FAIL
 4

	)

40 
	#EAI_FAMILY
 5

	)

41 
	#EAI_MEMORY
 6

	)

42 
	#EAI_NODATA
 7

	)

43 
	#EAI_NONAME
 8

	)

44 
	#EAI_SERVICE
 9

	)

45 
	#EAI_SOCKTYPE
 10

	)

46 
	#EAI_SYSTEM
 11

	)

	@osi\unpv13e\unpv13e\lib\connect_nonb.c

1 
	~"uÅ.h
"

4 
	$cÚÃù_nÚb
(
sockfd
, cÚ¡ 
SA
 *
§±r
, 
sockËn_t
 
§Ën
, 
n£c
)

6 
æags
, 
n
, 
”rÜ
;

7 
sockËn_t
 
Ën
;

8 
fd_£t
 
r£t
, 
w£t
;

9 
timev®
 
tv®
;

11 
æags
 = 
	`Fú
(
sockfd
, 
F_GETFL
, 0);

12 
	`Fú
(
sockfd
, 
F_SETFL
, 
æags
 | 
O_NONBLOCK
);

14 
”rÜ
 = 0;

15 iàĞ(
n
 = 
	`cÚÃù
(
sockfd
, 
§±r
, 
§Ën
)) < 0)

16 ià(
”ºo
 !ğ
EINPROGRESS
)

21 ià(
n
 == 0)

22 
dÚe
;

24 
	`FD_ZERO
(&
r£t
);

25 
	`FD_SET
(
sockfd
, &
r£t
);

26 
w£t
 = 
r£t
;

27 
tv®
.
tv_£c
 = 
n£c
;

28 
tv®
.
tv_u£c
 = 0;

30 iàĞ(
n
 = 
	`S–eù
(
sockfd
+1, &
r£t
, &
w£t
, 
NULL
,

31 
n£c
 ? &
tv®
 : 
NULL
)) == 0) {

32 
	`şo£
(
sockfd
);

33 
”ºo
 = 
ETIMEDOUT
;

37 ià(
	`FD_ISSET
(
sockfd
, &
r£t
è|| FD_ISSET(sockfd, &
w£t
)) {

38 
Ën
 = (
”rÜ
);

39 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_ERROR
, &
”rÜ
, &
Ën
) < 0)

42 
	`”r_qu™
("selectƒrror: sockfd‚ot set");

44 
dÚe
:

45 
	`Fú
(
sockfd
, 
F_SETFL
, 
æags
);

47 ià(
”rÜ
) {

48 
	`şo£
(
sockfd
);

49 
”ºo
 = 
”rÜ
;

53 
	}
}

	@osi\unpv13e\unpv13e\lib\connect_timeo.c

2 
	~"uÅ.h
"

4 
cÚÃù_®¬m
();

7 
	$cÚÃù_timeo
(
sockfd
, cÚ¡ 
SA
 *
§±r
, 
sockËn_t
 
§Ën
, 
n£c
)

9 
Sigfunc
 *
sigfunc
;

10 
n
;

12 
sigfunc
 = 
	`SigÇl
(
SIGALRM
, 
cÚÃù_®¬m
);

13 ià(
	`®¬m
(
n£c
) != 0)

14 
	`”r_msg
("connect_timeo:‡larm was‡lready set");

16 iàĞ(
n
 = 
	`cÚÃù
(
sockfd
, 
§±r
, 
§Ën
)) < 0) {

17 
	`şo£
(
sockfd
);

18 ià(
”ºo
 =ğ
EINTR
)

19 
”ºo
 = 
ETIMEDOUT
;

21 
	`®¬m
(0);

22 
	`SigÇl
(
SIGALRM
, 
sigfunc
);

24 (
n
);

25 
	}
}

28 
	$cÚÃù_®¬m
(
signo
)

31 
	}
}

35 
	$CÚÃù_timeo
(
fd
, cÚ¡ 
SA
 *
§
, 
sockËn_t
 
§Ën
, 
£c
)

37 ià(
	`cÚÃù_timeo
(
fd
, 
§
, 
§Ën
, 
£c
) < 0)

38 
	`”r_sys
("connect_timeoƒrror");

39 
	}
}

	@osi\unpv13e\unpv13e\lib\daemon_inetd.c

1 
	~"uÅ.h
"

2 
	~<sy¦og.h
>

4 
d«mÚ_´oc
;

7 
	$d«mÚ_š‘d
(cÚ¡ *
²ame
, 
çc™y
)

9 
d«mÚ_´oc
 = 1;

10 
	`İ’log
(
²ame
, 
LOG_PID
, 
çc™y
);

11 
	}
}

	@osi\unpv13e\unpv13e\lib\daemon_init.c

1 
	~"uÅ.h
"

2 
	~<sy¦og.h
>

4 
	#MAXFD
 64

	)

6 
d«mÚ_´oc
;

9 
	$d«mÚ_š™
(cÚ¡ *
²ame
, 
çc™y
)

11 
i
;

12 
pid_t
 
pid
;

14 iàĞ(
pid
 = 
	`FÜk
()) < 0)

16 ià(
pid
)

17 
	`_ex™
(0);

21 ià(
	`£tsid
() < 0)

24 
	`SigÇl
(
SIGHUP
, 
SIG_IGN
);

25 iàĞ(
pid
 = 
	`FÜk
()) < 0)

27 ià(
pid
)

28 
	`_ex™
(0);

32 
d«mÚ_´oc
 = 1;

34 
	`chdœ
("/");

37 
i
 = 0; i < 
MAXFD
; i++)

38 
	`şo£
(
i
);

41 
	`İ’
("/dev/nuÎ", 
O_RDONLY
);

42 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

43 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

45 
	`İ’log
(
²ame
, 
LOG_PID
, 
çc™y
);

48 
	}
}

	@osi\unpv13e\unpv13e\lib\dg_cli.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

11 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

13 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

15 
»cvlše
[
n
] = 0;

16 
	`Fputs
(
»cvlše
, 
¡dout
);

18 
	}
}

	@osi\unpv13e\unpv13e\lib\dg_echo.c

1 
	~"uÅ.h
"

4 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

6 
n
;

7 
sockËn_t
 
Ën
;

8 
mesg
[
MAXLINE
];

11 
Ën
 = 
ş’
;

12 
n
 = 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
pşŸddr
, &
Ën
);

14 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
pşŸddr
, 
Ën
);

16 
	}
}

	@osi\unpv13e\unpv13e\lib\error.c

1 
	~"uÅ.h
"

3 
	~<¡d¬g.h
>

4 
	~<sy¦og.h
>

6 
	gd«mÚ_´oc
;

8 
”r_do™
(, , cÚ¡ *, 
va_li¡
);

14 
	$”r_»t
(cÚ¡ *
fmt
, ...)

16 
va_li¡
 
­
;

18 
	`va_¡¬t
(
­
, 
fmt
);

19 
	`”r_do™
(1, 
LOG_INFO
, 
fmt
, 
­
);

20 
	`va_’d
(
­
);

22 
	}
}

28 
	$”r_sys
(cÚ¡ *
fmt
, ...)

30 
va_li¡
 
­
;

32 
	`va_¡¬t
(
­
, 
fmt
);

33 
	`”r_do™
(1, 
LOG_ERR
, 
fmt
, 
­
);

34 
	`va_’d
(
­
);

35 
	`ex™
(1);

36 
	}
}

42 
	$”r_dump
(cÚ¡ *
fmt
, ...)

44 
va_li¡
 
­
;

46 
	`va_¡¬t
(
­
, 
fmt
);

47 
	`”r_do™
(1, 
LOG_ERR
, 
fmt
, 
­
);

48 
	`va_’d
(
­
);

49 
	`abÜt
();

50 
	`ex™
(1);

51 
	}
}

57 
	$”r_msg
(cÚ¡ *
fmt
, ...)

59 
va_li¡
 
­
;

61 
	`va_¡¬t
(
­
, 
fmt
);

62 
	`”r_do™
(0, 
LOG_INFO
, 
fmt
, 
­
);

63 
	`va_’d
(
­
);

65 
	}
}

71 
	$”r_qu™
(cÚ¡ *
fmt
, ...)

73 
va_li¡
 
­
;

75 
	`va_¡¬t
(
­
, 
fmt
);

76 
	`”r_do™
(0, 
LOG_ERR
, 
fmt
, 
­
);

77 
	`va_’d
(
­
);

78 
	`ex™
(1);

79 
	}
}

85 
	$”r_do™
(
”ºoæag
, 
Ëv–
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

87 
”ºo_§ve
, 
n
;

88 
buf
[
MAXLINE
 + 1];

90 
”ºo_§ve
 = 
”ºo
;

91 #ifdef 
HAVE_VSNPRINTF


92 
	`v¢´štf
(
buf
, 
MAXLINE
, 
fmt
, 
­
);

94 
	`v¥rštf
(
buf
, 
fmt
, 
­
);

96 
n
 = 
	`¡¾’
(
buf
);

97 ià(
”ºoæag
)

98 
	`¢´štf
(
buf
 + 
n
, 
MAXLINE
 -‚, ": %s", 
	`¡»¼Ü
(
”ºo_§ve
));

99 
	`¡rÿt
(
buf
, "\n");

101 ià(
d«mÚ_´oc
) {

102 
	`sy¦og
(
Ëv–
, 
buf
);

104 
	`fæush
(
¡dout
);

105 
	`åuts
(
buf
, 
¡d”r
);

106 
	`fæush
(
¡d”r
);

109 
	}
}

	@osi\unpv13e\unpv13e\lib\family_to_level.c

1 
	~"uÅ.h
"

3 
	$çmy_to_Ëv–
(
çmy
)

5 
çmy
) {

6 
AF_INET
:

7  
IPPROTO_IP
;

8 
AF_INET6
:

9  
IPPROTO_IPV6
;

13 
	}
}

15 
	$Famy_to_Ëv–
(
çmy
)

17 
rc
;

19 iàĞ(
rc
 = 
	`çmy_to_Ëv–
(
çmy
)) < 0)

20 
	`”r_sys
("family_to_levelƒrror");

22 (
rc
);

23 
	}
}

	@osi\unpv13e\unpv13e\lib\get_ifi_info.c

2 
	~"uÅifi.h
"

4 
ifi_šfo
 *

5 
	$g‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)

7 
ifi_šfo
 *
ifi
, *
ifih—d
, **
ifÃxt
;

8 
sockfd
, 
Ën
, 
Ï¡Ën
, 
æags
, 
myæags
, 
idx
 = 0, 
hËn
 = 0;

9 *
±r
, *
buf
, 
Ï¡Çme
[
IFNAMSIZ
], *
ıŒ
, *
haddr
, *
sdÊame
;

10 
ifcÚf
 
ifc
;

11 
iäeq
 *
iä
, 
iäcİy
;

12 
sockaddr_š
 *
sš±r
;

13 
sockaddr_š6
 *
sš6±r
;

15 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

17 
Ï¡Ën
 = 0;

18 
Ën
 = 100 * (
iäeq
);

20 
buf
 = 
	`M®loc
(
Ën
);

21 
ifc
.
ifc_Ën
 = 
Ën
;

22 
ifc
.
ifc_buf
 = 
buf
;

23 ià(
	`ioùl
(
sockfd
, 
SIOCGIFCONF
, &
ifc
) < 0) {

24 ià(
”ºo
 !ğ
EINVAL
 || 
Ï¡Ën
 != 0)

25 
	`”r_sys
("ioctlƒrror");

27 ià(
ifc
.
ifc_Ën
 =ğ
Ï¡Ën
)

29 
Ï¡Ën
 = 
ifc
.
ifc_Ën
;

31 
Ën
 +ğ10 * (
iäeq
);

32 
	`ä“
(
buf
);

34 
ifih—d
 = 
NULL
;

35 
ifÃxt
 = &
ifih—d
;

36 
Ï¡Çme
[0] = 0;

37 
sdÊame
 = 
NULL
;

41 
±r
 = 
buf
;…Œ < buà+ 
ifc
.
ifc_Ën
; ) {

42 
iä
 = (
iäeq
 *è
±r
;

44 #ifdef 
HAVE_SOCKADDR_SA_LEN


45 
Ën
 = 
	`max
((
sockaddr
), 
iä
->
iä_addr
.
§_Ën
);

47 
iä
->
iä_addr
.
§_çmy
) {

48 #ifdef 
IPV6


49 
AF_INET6
:

50 
Ën
 = (
sockaddr_š6
);

53 
AF_INET
:

55 
Ën
 = (
sockaddr
);

59 
±r
 +ğ(
iä
->
iä_Çme
è+ 
Ën
;

61 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


63 ià(
iä
->
iä_addr
.
§_çmy
 =ğ
AF_LINK
) {

64 
sockaddr_dl
 *
sdl
 = (sockaddr_dÈ*)&
iä
->
iä_addr
;

65 
sdÊame
 = 
iä
->
iä_Çme
;

66 
idx
 = 
sdl
->
sdl_šdex
;

67 
haddr
 = 
sdl
->
sdl_d©a
 + sdl->
sdl_Æ’
;

68 
hËn
 = 
sdl
->
sdl_®’
;

72 ià(
iä
->
iä_addr
.
§_çmy
 !ğ
çmy
)

75 
myæags
 = 0;

76 iàĞ(
ıŒ
 = 
	`¡rchr
(
iä
->
iä_Çme
, ':')è!ğ
NULL
)

77 *
ıŒ
 = 0;

78 ià(
	`¡ºcmp
(
Ï¡Çme
, 
iä
->
iä_Çme
, 
IFNAMSIZ
) == 0) {

79 ià(
dßlŸ£s
 == 0)

81 
myæags
 = 
IFI_ALIAS
;

83 
	`memıy
(
Ï¡Çme
, 
iä
->
iä_Çme
, 
IFNAMSIZ
);

85 
iäcİy
 = *
iä
;

86 
	`Ioùl
(
sockfd
, 
SIOCGIFFLAGS
, &
iäcİy
);

87 
æags
 = 
iäcİy
.
iä_æags
;

88 ià((
æags
 & 
IFF_UP
) == 0)

93 
ifi
 = 
	`C®loc
(1, (
ifi_šfo
));

94 *
ifÃxt
 = 
ifi
;

95 
ifÃxt
 = &
ifi
->
ifi_Ãxt
;

97 
ifi
->
ifi_æags
 = 
æags
;

98 
ifi
->
ifi_myæags
 = 
myæags
;

99 #ià
	`defšed
(
SIOCGIFMTU
è&& defšed(
HAVE_STRUCT_IFREQ_IFR_MTU
)

100 
	`Ioùl
(
sockfd
, 
SIOCGIFMTU
, &
iäcİy
);

101 
ifi
->
ifi_mtu
 = 
iäcİy
.
iä_mtu
;

103 
ifi
->
ifi_mtu
 = 0;

105 
	`memıy
(
ifi
->
ifi_Çme
, 
iä
->
iä_Çme
, 
IFI_NAME
);

106 
ifi
->
ifi_Çme
[
IFI_NAME
-1] = '\0';

108 ià(
sdÊame
 =ğ
NULL
 || 
	`¡rcmp
(sdÊame, 
iä
->
iä_Çme
) != 0)

109 
idx
 = 
hËn
 = 0;

110 
ifi
->
ifi_šdex
 = 
idx
;

111 
ifi
->
ifi_hËn
 = 
hËn
;

112 ià(
ifi
->
ifi_hËn
 > 
IFI_HADDR
)

113 
ifi
->
ifi_hËn
 = 
IFI_HADDR
;

114 ià(
hËn
)

115 
	`memıy
(
ifi
->
ifi_haddr
, 
haddr
, ifi->
ifi_hËn
);

118 
iä
->
iä_addr
.
§_çmy
) {

119 
AF_INET
:

120 
sš±r
 = (
sockaddr_š
 *è&
iä
->
iä_addr
;

121 
ifi
->
ifi_addr
 = 
	`C®loc
(1, (
sockaddr_š
));

122 
	`memıy
(
ifi
->
ifi_addr
, 
sš±r
, (
sockaddr_š
));

124 #ifdef 
SIOCGIFBRDADDR


125 ià(
æags
 & 
IFF_BROADCAST
) {

126 
	`Ioùl
(
sockfd
, 
SIOCGIFBRDADDR
, &
iäcİy
);

127 
sš±r
 = (
sockaddr_š
 *è&
iäcİy
.
iä_brßdaddr
;

128 
ifi
->
ifi_brdaddr
 = 
	`C®loc
(1, (
sockaddr_š
));

129 
	`memıy
(
ifi
->
ifi_brdaddr
, 
sš±r
, (
sockaddr_š
));

133 #ifdef 
SIOCGIFDSTADDR


134 ià(
æags
 & 
IFF_POINTOPOINT
) {

135 
	`Ioùl
(
sockfd
, 
SIOCGIFDSTADDR
, &
iäcİy
);

136 
sš±r
 = (
sockaddr_š
 *è&
iäcİy
.
iä_d¡addr
;

137 
ifi
->
ifi_d¡addr
 = 
	`C®loc
(1, (
sockaddr_š
));

138 
	`memıy
(
ifi
->
ifi_d¡addr
, 
sš±r
, (
sockaddr_š
));

143 
AF_INET6
:

144 
sš6±r
 = (
sockaddr_š6
 *è&
iä
->
iä_addr
;

145 
ifi
->
ifi_addr
 = 
	`C®loc
(1, (
sockaddr_š6
));

146 
	`memıy
(
ifi
->
ifi_addr
, 
sš6±r
, (
sockaddr_š6
));

148 #ifdef 
SIOCGIFDSTADDR


149 ià(
æags
 & 
IFF_POINTOPOINT
) {

150 
	`Ioùl
(
sockfd
, 
SIOCGIFDSTADDR
, &
iäcİy
);

151 
sš6±r
 = (
sockaddr_š6
 *è&
iäcİy
.
iä_d¡addr
;

152 
ifi
->
ifi_d¡addr
 = 
	`C®loc
(1, (
sockaddr_š6
));

153 
	`memıy
(
ifi
->
ifi_d¡addr
, 
sš6±r
, (
sockaddr_š6
));

162 
	`ä“
(
buf
);

163 (
ifih—d
);

164 
	}
}

169 
	$ä“_ifi_šfo
(
ifi_šfo
 *
ifih—d
)

171 
ifi_šfo
 *
ifi
, *
ifšext
;

173 
ifi
 = 
ifih—d
; if˜!ğ
NULL
; if˜ğ
ifšext
) {

174 ià(
ifi
->
ifi_addr
 !ğ
NULL
)

175 
	`ä“
(
ifi
->
ifi_addr
);

176 ià(
ifi
->
ifi_brdaddr
 !ğ
NULL
)

177 
	`ä“
(
ifi
->
ifi_brdaddr
);

178 ià(
ifi
->
ifi_d¡addr
 !ğ
NULL
)

179 
	`ä“
(
ifi
->
ifi_d¡addr
);

180 
ifšext
 = 
ifi
->
ifi_Ãxt
;

181 
	`ä“
(
ifi
);

183 
	}
}

186 
ifi_šfo
 *

187 
	$G‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)

189 
ifi_šfo
 *
ifi
;

191 iàĞ(
ifi
 = 
	`g‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)è=ğ
NULL
)

192 
	`”r_qu™
("get_ifi_infoƒrror");

193 (
ifi
);

194 
	}
}

	@osi\unpv13e\unpv13e\lib\gf_time.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$gf_time
()

7 
timev®
 
tv
;

8 
time_t
 
t
;

9 
¡r
[30];

10 *
±r
;

12 ià(
	`g‘timeofday
(&
tv
, 
NULL
) < 0)

13 
	`”r_sys
("gettimeofdayƒrror");

15 
t
 = 
tv
.
tv_£c
;

16 
±r
 = 
	`ùime
(&
t
);

17 
	`¡rıy
(
¡r
, &
±r
[11]);

20 
	`¢´štf
(
¡r
+8, (¡r)-8, ".%06ld", 
tv
.
tv_u£c
);

22 (
¡r
);

23 
	}
}

	@osi\unpv13e\unpv13e\lib\host_serv.c

2 
	~"uÅ.h
"

4 
addršfo
 *

5 
	$ho¡_£rv
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
çmy
, 
sockty³
)

7 
n
;

8 
addršfo
 
hšts
, *
»s
;

10 
	`bz”o
(&
hšts
, (
addršfo
));

11 
hšts
.
ai_æags
 = 
AI_CANONNAME
;

12 
hšts
.
ai_çmy
 = 
çmy
;

13 
hšts
.
ai_sockty³
 = 
sockty³
;

15 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

16 (
NULL
);

18 (
»s
);

19 
	}
}

29 
addršfo
 *

30 
	$Ho¡_£rv
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
çmy
, 
sockty³
)

32 
n
;

33 
addršfo
 
hšts
, *
»s
;

35 
	`bz”o
(&
hšts
, (
addršfo
));

36 
hšts
.
ai_æags
 = 
AI_CANONNAME
;

37 
hšts
.
ai_çmy
 = 
çmy
;

38 
hšts
.
ai_sockty³
 = 
sockty³
;

40 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

41 
	`”r_qu™
("host_servƒrror for %s, %s: %s",

42 (
ho¡
 =ğ
NULL
) ? "(no hostname)" : host,

43 (
£rv
 =ğ
NULL
) ? "(no service‚ame)" : serv,

44 
	`gai_¡»¼Ü
(
n
));

46 (
»s
);

47 
	}
}

	@osi\unpv13e\unpv13e\lib\hstrerror.c

9 
	~"uÅ.h
"

12 
	$h¡»¼Ü
(
”r
)

14 ià(
”r
 == 0)

17 ià(
”r
 =ğ
HOST_NOT_FOUND
)

20 ià(
”r
 =ğ
TRY_AGAIN
)

23 ià(
”r
 =ğ
NO_RECOVERY
)

26 ià(
”r
 =ğ
NO_DATA
)

30 
	}
}

	@osi\unpv13e\unpv13e\lib\if_indextoname.c

1 
	~"uÅ.h
"

10 
	$if_šdextÚame
(
šdex
, *
Çme
)

12 (
NULL
);

13 
	}
}

16 
	$If_šdextÚame
(
šdex
, *
Çme
)

18 *
±r
;

20 iàĞ(
±r
 = 
	`if_šdextÚame
(
šdex
, 
Çme
)è=ğ
NULL
)

21 
	`”r_qu™
("if_šdextÚam”rÜ fÜ %d", 
šdex
);

22 (
±r
);

23 
	}
}

	@osi\unpv13e\unpv13e\lib\if_nameindex.c

1 
	~"uÅ.h
"

9 
if_Çmešdex
 *

10 
	$if_Çmešdex
()

12 (
NULL
);

13 
	}
}

16 
	$if_ä“Çmešdex
(
if_Çmešdex
 *
±r
)

18 
	}
}

20 
if_Çmešdex
 *

21 
	$If_Çmešdex
()

23 
if_Çmešdex
 *
iåŒ
;

25 iàĞ(
iåŒ
 = 
	`if_Çmešdex
()è=ğ
NULL
)

26 
	`”r_qu™
("if_nameindexƒrror");

27 (
iåŒ
);

28 
	}
}

	@osi\unpv13e\unpv13e\lib\if_nametoindex.c

1 
	~"uÅ.h
"

10 
	$if_Çm‘ošdex
(cÚ¡ *
Çme
)

13 
	}
}

16 
	$If_Çm‘ošdex
(cÚ¡ *
Çme
)

18 
šdex
;

20 iàĞ(
šdex
 = 
	`if_Çm‘ošdex
(
Çme
)) == 0)

21 
	`”r_qu™
("if_Çm‘ošdexƒ¼Ü fÜ %s", 
Çme
);

22 (
šdex
);

23 
	}
}

	@osi\unpv13e\unpv13e\lib\in6addr_any.c

1 
	~"uÅ.h
"

3 #ifdef 
IPV6


4 cÚ¡ 
š6_addr
 
	gš6addr_ªy
;

	@osi\unpv13e\unpv13e\lib\mcast_get_if.c

1 
	~"uÅ.h
"

4 
	$mÿ¡_g‘_if
(
sockfd
)

6 
	`sockfd_to_çmy
(
sockfd
)) {

7 
AF_INET
: {

12 #ifdef 
IPV6


13 
AF_INET6
: {

14 
u_št
 
idx
;

15 
sockËn_t
 
Ën
;

17 
Ën
 = (
idx
);

18 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_IF
,

19 &
idx
, &
Ën
) < 0)

21 (
idx
);

26 
”ºo
 = 
EAFNOSUPPORT
;

29 
	}
}

32 
	$Mÿ¡_g‘_if
(
sockfd
)

34 
rc
;

36 iàĞ(
rc
 = 
	`mÿ¡_g‘_if
(
sockfd
)) < 0)

37 
	`”r_sys
("mcast_get_ifƒrror");

38 (
rc
);

39 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_get_loop.c

1 
	~"uÅ.h
"

4 
	$mÿ¡_g‘_loİ
(
sockfd
)

6 
	`sockfd_to_çmy
(
sockfd
)) {

7 
AF_INET
: {

8 
u_ch¬
 
æag
;

9 
sockËn_t
 
Ën
;

11 
Ën
 = (
æag
);

12 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
,

13 &
æag
, &
Ën
) < 0)

15 (
æag
);

18 #ifdef 
IPV6


19 
AF_INET6
: {

20 
u_št
 
æag
;

21 
sockËn_t
 
Ën
;

23 
Ën
 = (
æag
);

24 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_LOOP
,

25 &
æag
, &
Ën
) < 0)

27 (
æag
);

32 
”ºo
 = 
EAFNOSUPPORT
;

35 
	}
}

38 
	$Mÿ¡_g‘_loİ
(
sockfd
)

40 
rc
;

42 iàĞ(
rc
 = 
	`mÿ¡_g‘_loİ
(
sockfd
)) < 0)

43 
	`”r_sys
("mcast_get_loopƒrror");

44 (
rc
);

45 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_get_ttl.c

1 
	~"uÅ.h
"

4 
	$mÿ¡_g‘_‰l
(
sockfd
)

6 
	`sockfd_to_çmy
(
sockfd
)) {

7 
AF_INET
: {

8 
u_ch¬
 
‰l
;

9 
sockËn_t
 
Ën
;

11 
Ën
 = (
‰l
);

12 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

13 &
‰l
, &
Ën
) < 0)

15 (
‰l
);

18 #ifdef 
IPV6


19 
AF_INET6
: {

20 
hİ
;

21 
sockËn_t
 
Ën
;

23 
Ën
 = (
hİ
);

24 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_HOPS
,

25 &
hİ
, &
Ën
) < 0)

27 (
hİ
);

32 
”ºo
 = 
EAFNOSUPPORT
;

35 
	}
}

38 
	$Mÿ¡_g‘_‰l
(
sockfd
)

40 
rc
;

42 iàĞ(
rc
 = 
	`mÿ¡_g‘_‰l
(
sockfd
)) < 0)

43 
	`”r_sys
("mcast_get_ttlƒrror");

44 (
rc
);

45 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_join.c

2 
	~"uÅ.h
"

3 
	~<Ãt/if.h
>

6 
	$mÿ¡_još
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

7 cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

9 #ifdeà
MCAST_JOIN_GROUP


10 
group_»q
 
»q
;

11 ià(
ifšdex
 > 0) {

12 
»q
.
gr_š‹rçû
 = 
ifšdex
;

13 } ià(
iâame
 !ğ
NULL
) {

14 iàĞ(
»q
.
gr_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0) {

15 
”ºo
 = 
ENXIO
;

19 
»q
.
gr_š‹rçû
 = 0;

20 ià(
g½Ën
 > (
»q
.
gr_group
)) {

21 
”ºo
 = 
EINVAL
;

24 
	`memıy
(&
»q
.
gr_group
, 
g½
, 
g½Ën
);

25  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

26 
MCAST_JOIN_GROUP
, &
»q
, (req)));

31 
g½
->
§_çmy
) {

32 
AF_INET
: {

33 
_m»q
 
m»q
;

34 
iäeq
 ifreq;

36 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

37 &((cÚ¡ 
sockaddr_š
 *è
g½
)->
sš_addr
,

38 (
š_addr
));

40 ià(
ifšdex
 > 0) {

41 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
) {

42 
”ºo
 = 
ENXIO
;

45 
doioùl
;

46 } ià(
iâame
 !ğ
NULL
) {

47 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

48 
doioùl
:

49 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

51 
	`memıy
(&
m»q
.
imr_š‹rçû
,

52 &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
,

53 (
š_addr
));

55 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

57 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
,

58 &
m»q
, (mreq)));

63 #ifdef 
IPV6


64 #iâdef 
IPV6_JOIN_GROUP


65 
	#IPV6_JOIN_GROUP
 
IPV6_ADD_MEMBERSHIP


	)

67 
AF_INET6
: {

68 
v6_m»q
 
m»q6
;

70 
	`memıy
(&
m»q6
.
v6mr_muÉŸddr
,

71 &((cÚ¡ 
sockaddr_š6
 *è
g½
)->
sš6_addr
,

72 (
š6_addr
));

74 ià(
ifšdex
 > 0) {

75 
m»q6
.
v6mr_š‹rçû
 = 
ifšdex
;

76 } ià(
iâame
 !ğ
NULL
) {

77 iàĞ(
m»q6
.
v6mr_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0) {

78 
”ºo
 = 
ENXIO
;

82 
m»q6
.
v6mr_š‹rçû
 = 0;

84 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_JOIN_GROUP
,

85 &
m»q6
, (mreq6)));

90 
”ºo
 = 
EAFNOSUPPORT
;

94 
	}
}

98 
	$Mÿ¡_još
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

99 cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

101 ià(
	`mÿ¡_još
(
sockfd
, 
g½
, 
g½Ën
, 
iâame
, 
ifšdex
) < 0)

102 
	`”r_sys
("mcast_joinƒrror");

103 
	}
}

106 
	$mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

107 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

108 cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

110 #ifdeà
MCAST_JOIN_SOURCE_GROUP


111 
group_sourû_»q
 
»q
;

112 ià(
ifšdex
 > 0) {

113 
»q
.
g¤_š‹rçû
 = 
ifšdex
;

114 } ià(
iâame
 !ğ
NULL
) {

115 iàĞ(
»q
.
g¤_š‹rçû
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0) {

116 
”ºo
 = 
ENXIO
;

120 
»q
.
g¤_š‹rçû
 = 0;

121 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
)) {

122 
”ºo
 = 
EINVAL
;

125 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

126 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

127  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

128 
MCAST_JOIN_SOURCE_GROUP
, &
»q
, (req)));

130 
g½
->
§_çmy
) {

131 #ifdeà
IP_ADD_SOURCE_MEMBERSHIP


132 
AF_INET
: {

133 
_m»q_sourû
 
m»q
;

134 
iäeq
 ifreq;

136 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

137 &((
sockaddr_š
 *è
g½
)->
sš_addr
,

138 (
š_addr
));

139 
	`memıy
(&
m»q
.
imr_sourûaddr
,

140 &((
sockaddr_š
 *è
¤c
)->
sš_addr
,

141 (
š_addr
));

143 ià(
ifšdex
 > 0) {

144 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
) {

145 
”ºo
 = 
ENXIO
;

148 
doioùl
;

149 } ià(
iâame
 !ğ
NULL
) {

150 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

151 
doioùl
:

152 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

154 
	`memıy
(&
m»q
.
imr_š‹rçû
,

155 &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
,

156 (
š_addr
));

158 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

160 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ADD_SOURCE_MEMBERSHIP
,

161 &
m»q
, (mreq)));

165 #ifdef 
IPV6


166 
AF_INET6
:

169 
”ºo
 = 
EAFNOSUPPORT
;

173 
	}
}

176 
	$Mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

177 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

178 cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

180 ià(
	`mÿ¡_još_sourû_group
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
,

181 
iâame
, 
ifšdex
) < 0)

182 
	`”r_sys
("mcast_join_source_groupƒrror");

183 
	}
}

186 
	$mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

187 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

189 #ifdeà
MCAST_BLOCK_SOURCE


190 
group_sourû_»q
 
»q
;

191 
»q
.
g¤_š‹rçû
 = 0;

192 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
)) {

193 
”ºo
 = 
EINVAL
;

196 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

197 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

198  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

199 
MCAST_BLOCK_SOURCE
, &
»q
, (req)));

201 
g½
->
§_çmy
) {

202 #ifdeà
IP_BLOCK_SOURCE


203 
AF_INET
: {

204 
_m»q_sourû
 
m»q
;

206 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

207 &((
sockaddr_š
 *è
g½
)->
sš_addr
,

208 (
š_addr
));

209 
	`memıy
(&
m»q
.
imr_sourûaddr
,

210 &((
sockaddr_š
 *è
¤c
)->
sš_addr
,

211 (
š_addr
));

212 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

214 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_BLOCK_SOURCE
,

215 &
m»q
, (mreq)));

219 #ifdef 
IPV6


220 
AF_INET6
:

223 
”ºo
 = 
EAFNOSUPPORT
;

227 
	}
}

230 
	$Mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

231 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

233 ià(
	`mÿ¡_block_sourû
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
) < 0)

234 
	`”r_sys
("mcast_block_sourceƒrror");

235 
	}
}

238 
	$mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

239 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

241 #ifdeà
MCAST_UNBLOCK_SOURCE


242 
group_sourû_»q
 
»q
;

243 
»q
.
g¤_š‹rçû
 = 0;

244 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
)) {

245 
”ºo
 = 
EINVAL
;

248 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

249 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

250  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

251 
MCAST_UNBLOCK_SOURCE
, &
»q
, (req)));

253 
g½
->
§_çmy
) {

254 #ifdeà
IP_UNBLOCK_SOURCE


255 
AF_INET
: {

256 
_m»q_sourû
 
m»q
;

258 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

259 &((
sockaddr_š
 *è
g½
)->
sš_addr
,

260 (
š_addr
));

261 
	`memıy
(&
m»q
.
imr_sourûaddr
,

262 &((
sockaddr_š
 *è
¤c
)->
sš_addr
,

263 (
š_addr
));

264 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

266 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_UNBLOCK_SOURCE
,

267 &
m»q
, (mreq)));

271 #ifdef 
IPV6


272 
AF_INET6
:

275 
”ºo
 = 
EAFNOSUPPORT
;

279 
	}
}

282 
	$Mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

283 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

285 ià(
	`mÿ¡_unblock_sourû
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
) < 0)

286 
	`”r_sys
("mcast_unblock_sourceƒrror");

287 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_leave.c

1 
	~"uÅ.h
"

4 
	$mÿ¡_Ëave
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

6 #ifdeà
MCAST_JOIN_GROUP


7 
group_»q
 
»q
;

8 
»q
.
gr_š‹rçû
 = 0;

9 ià(
g½Ën
 > (
»q
.
gr_group
)) {

10 
”ºo
 = 
EINVAL
;

13 
	`memıy
(&
»q
.
gr_group
, 
g½
, 
g½Ën
);

14  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

15 
MCAST_LEAVE_GROUP
, &
»q
, (req)));

17 
g½
->
§_çmy
) {

18 
AF_INET
: {

19 
_m»q
 
m»q
;

21 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

22 &((cÚ¡ 
sockaddr_š
 *è
g½
)->
sš_addr
,

23 (
š_addr
));

24 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

25 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_DROP_MEMBERSHIP
,

26 &
m»q
, (mreq)));

29 #ifdef 
IPV6


30 #iâdef 
IPV6_LEAVE_GROUP


31 
	#IPV6_LEAVE_GROUP
 
IPV6_DROP_MEMBERSHIP


	)

33 
AF_INET6
: {

34 
v6_m»q
 
m»q6
;

36 
	`memıy
(&
m»q6
.
v6mr_muÉŸddr
,

37 &((cÚ¡ 
sockaddr_š6
 *è
g½
)->
sš6_addr
,

38 (
š6_addr
));

39 
m»q6
.
v6mr_š‹rçû
 = 0;

40 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_LEAVE_GROUP
,

41 &
m»q6
, (mreq6)));

46 
”ºo
 = 
EAFNOSUPPORT
;

50 
	}
}

53 
	$Mÿ¡_Ëave
(
sockfd
, cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

55 ià(
	`mÿ¡_Ëave
(
sockfd
, 
g½
, 
g½Ën
) < 0)

56 
	`”r_sys
("mcast_leaveƒrror");

57 
	}
}

60 
	$mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

61 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

63 #ifdeà
MCAST_LEAVE_SOURCE_GROUP


64 
group_sourû_»q
 
»q
;

65 
»q
.
g¤_š‹rçû
 = 0;

66 ià(
g½Ën
 > (
»q
.
g¤_group
è|| 
¤ş’
 > Ôeq.
g¤_sourû
)) {

67 
”ºo
 = 
EINVAL
;

70 
	`memıy
(&
»q
.
g¤_group
, 
g½
, 
g½Ën
);

71 
	`memıy
(&
»q
.
g¤_sourû
, 
¤c
, 
¤ş’
);

72  (
	`£tsockİt
(
sockfd
, 
	`çmy_to_Ëv–
(
g½
->
§_çmy
),

73 
MCAST_LEAVE_SOURCE_GROUP
, &
»q
, (req)));

75 
g½
->
§_çmy
) {

76 #ifdeà
IP_DROP_SOURCE_MEMBERSHIP


77 
AF_INET
: {

78 
_m»q_sourû
 
m»q
;

80 
	`memıy
(&
m»q
.
imr_muÉŸddr
,

81 &((
sockaddr_š
 *è
g½
)->
sš_addr
,

82 (
š_addr
));

83 
	`memıy
(&
m»q
.
imr_sourûaddr
,

84 &((
sockaddr_š
 *è
¤c
)->
sš_addr
,

85 (
š_addr
));

86 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

88 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_DROP_SOURCE_MEMBERSHIP
,

89 &
m»q
, (mreq)));

93 #ifdef 
IPV6


94 
AF_INET6
:

97 
”ºo
 = 
EAFNOSUPPORT
;

101 
	}
}

104 
	$Mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

105 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
)

107 ià(
	`mÿ¡_Ëave_sourû_group
(
sockfd
, 
¤c
, 
¤ş’
, 
g½
, 
g½Ën
) < 0)

108 
	`”r_sys
("mcast_leave_source_groupƒrror");

109 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_set_if.c

1 
	~"uÅ.h
"

2 
	~<Ãt/if.h
>

5 
	$mÿ¡_£t_if
(
sockfd
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

7 
	`sockfd_to_çmy
(
sockfd
)) {

8 
AF_INET
: {

9 
š_addr
 
šaddr
;

10 
iäeq
 ifreq;

12 ià(
ifšdex
 > 0) {

13 ià(
	`if_šdextÚame
(
ifšdex
, 
iäeq
.
iä_Çme
è=ğ
NULL
) {

14 
”ºo
 = 
ENXIO
;

17 
doioùl
;

18 } ià(
iâame
 !ğ
NULL
) {

19 
	`¡ºıy
(
iäeq
.
iä_Çme
, 
iâame
, 
IFNAMSIZ
);

20 
doioùl
:

21 ià(
	`ioùl
(
sockfd
, 
SIOCGIFADDR
, &
iäeq
) < 0)

23 
	`memıy
(&
šaddr
,

24 &((
sockaddr_š
 *è&
iäeq
.
iä_addr
)->
sš_addr
,

25 (
š_addr
));

27 
šaddr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

29 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_IF
,

30 &
šaddr
, (
š_addr
)));

33 #ifdef 
IPV6


34 
AF_INET6
: {

35 
u_št
 
idx
;

37 iàĞ(
idx
 = 
ifšdex
) == 0) {

38 ià(
iâame
 =ğ
NULL
) {

39 
”ºo
 = 
EINVAL
;

42 iàĞ(
idx
 = 
	`if_Çm‘ošdex
(
iâame
)) == 0) {

43 
”ºo
 = 
ENXIO
;

47 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_IF
,

48 &
idx
, (idx)));

53 
”ºo
 = 
EAFNOSUPPORT
;

56 
	}
}

59 
	$Mÿ¡_£t_if
(
sockfd
, cÚ¡ *
iâame
, 
u_št
 
ifšdex
)

61 ià(
	`mÿ¡_£t_if
(
sockfd
, 
iâame
, 
ifšdex
) < 0)

62 
	`”r_sys
("mcast_set_ifƒrror");

63 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_set_loop.c

2 
	~"uÅ.h
"

5 
	$mÿ¡_£t_loİ
(
sockfd
, 
Úoff
)

7 
	`sockfd_to_çmy
(
sockfd
)) {

8 
AF_INET
: {

9 
u_ch¬
 
æag
;

11 
æag
 = 
Úoff
;

12 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
,

13 &
æag
, (flag)));

16 #ifdef 
IPV6


17 
AF_INET6
: {

18 
u_št
 
æag
;

20 
æag
 = 
Úoff
;

21 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_LOOP
,

22 &
æag
, (flag)));

27 
”ºo
 = 
EAFNOSUPPORT
;

30 
	}
}

34 
	$Mÿ¡_£t_loİ
(
sockfd
, 
Úoff
)

36 ià(
	`mÿ¡_£t_loİ
(
sockfd
, 
Úoff
) < 0)

37 
	`”r_sys
("mcast_set_loopƒrror");

38 
	}
}

	@osi\unpv13e\unpv13e\lib\mcast_set_ttl.c

1 
	~"uÅ.h
"

4 
	$mÿ¡_£t_‰l
(
sockfd
, 
v®
)

6 
	`sockfd_to_çmy
(
sockfd
)) {

7 
AF_INET
: {

8 
u_ch¬
 
‰l
;

10 
‰l
 = 
v®
;

11 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

12 &
‰l
, (ttl)));

15 #ifdef 
IPV6


16 
AF_INET6
: {

17 
hİ
;

19 
hİ
 = 
v®
;

20 (
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_MULTICAST_HOPS
,

21 &
hİ
, (hop)));

26 
”ºo
 = 
EAFNOSUPPORT
;

29 
	}
}

32 
	$Mÿ¡_£t_‰l
(
sockfd
, 
v®
)

34 ià(
	`mÿ¡_£t_‰l
(
sockfd
, 
v®
) < 0)

35 
	`”r_sys
("mcast_set_ttlƒrror");

36 
	}
}

	@osi\unpv13e\unpv13e\lib\my_addrs.c

2 
	~"uÅ.h
"

3 
	~<sys/ut¢ame.h
>

6 
	$my_addrs
(*
add¹y³
)

8 
ho¡’t
 *
h±r
;

9 
ut¢ame
 
myÇme
;

11 ià(
	`uÇme
(&
myÇme
) < 0)

12 (
NULL
);

14 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
myÇme
.
nod’ame
)è=ğ
NULL
)

15 (
NULL
);

17 *
add¹y³
 = 
h±r
->
h_add¹y³
;

18 (
h±r
->
h_addr_li¡
);

19 
	}
}

23 
	$My_addrs
(*
pçmy
)

25 **
µŒ
;

27 iàĞ(
µŒ
 = 
	`my_addrs
(
pçmy
)è=ğ
NULL
)

28 
	`”r_sys
("my_addrsƒrror");

29 (
µŒ
);

30 
	}
}

	@osi\unpv13e\unpv13e\lib\pselect.c

10 
	~"uÅ.h
"

13 
	$p£Ëù
(
nfds
, 
fd_£t
 *
r£t
, fd_£ˆ*
w£t
, fd_£ˆ*
x£t
,

14 cÚ¡ 
time¥ec
 *
ts
, cÚ¡ 
sig£t_t
 *
sigmask
)

16 
n
;

17 
timev®
 
tv
;

18 
sig£t_t
 
§vemask
;

20 ià(
ts
 !ğ
NULL
) {

21 
tv
.
tv_£c
 = 
ts
->tv_sec;

22 
tv
.
tv_u£c
 = 
ts
->
tv_n£c
 / 1000;

25 
	`sig´ocmask
(
SIG_SETMASK
, 
sigmask
, &
§vemask
);

26 
n
 = 
	`£Ëù
(
nfds
, 
r£t
, 
w£t
, 
x£t
, (
ts
 =ğ
NULL
è? NULL : &
tv
);

27 
	`sig´ocmask
(
SIG_SETMASK
, &
§vemask
, 
NULL
);

29 (
n
);

30 
	}
}

	@osi\unpv13e\unpv13e\lib\read_fd.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$»ad_fd
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
»cvfd
)

7 
msghdr
 
msg
;

8 
iovec
 
iov
[1];

9 
ssize_t
 
n
;

11 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


13 
cmsghdr
 
cm
;

14 
cÚŒŞ
[
	`CMSG_SPACE
(())];

15 } 
cÚŒŞ_un
;

16 
cmsghdr
 *
cm±r
;

18 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ_un
.
cÚŒŞ
;

19 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ_un
.
cÚŒŞ
);

21 
Ãwfd
;

23 
msg
.
msg_acüights
 = (
ÿddr_t
è&
Ãwfd
;

24 
msg
.
msg_acüight¦’
 = ();

27 
msg
.
msg_Çme
 = 
NULL
;

28 
msg
.
msg_Çm–’
 = 0;

30 
iov
[0].
iov_ba£
 = 
±r
;

31 
iov
[0].
iov_Ën
 = 
nby‹s
;

32 
msg
.
msg_iov
 = 
iov
;

33 
msg
.
msg_iovËn
 = 1;

35 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, 0)) <= 0)

36 (
n
);

38 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


39 iàĞ(
cm±r
 = 
	`CMSG_FIRSTHDR
(&
msg
)è!ğ
NULL
 &&

40 
cm±r
->
cmsg_Ën
 =ğ
	`CMSG_LEN
(())) {

41 ià(
cm±r
->
cmsg_Ëv–
 !ğ
SOL_SOCKET
)

42 
	`”r_qu™
("control†evel != SOL_SOCKET");

43 ià(
cm±r
->
cmsg_ty³
 !ğ
SCM_RIGHTS
)

44 
	`”r_qu™
("controlype != SCM_RIGHTS");

45 *
»cvfd
 = *((*è
	`CMSG_DATA
(
cm±r
));

47 *
»cvfd
 = -1;

50 ià(
msg
.
msg_acüight¦’
 == ())

51 *
»cvfd
 = 
Ãwfd
;

53 *
»cvfd
 = -1;

57 (
n
);

58 
	}
}

61 
ssize_t


62 
	$R—d_fd
(
fd
, *
±r
, 
size_t
 
nby‹s
, *
»cvfd
)

64 
ssize_t
 
n
;

66 iàĞ(
n
 = 
	`»ad_fd
(
fd
, 
±r
, 
nby‹s
, 
»cvfd
)) < 0)

67 
	`”r_sys
("read_fdƒrror");

69 (
n
);

70 
	}
}

	@osi\unpv13e\unpv13e\lib\readable_timeo.c

2 
	~"uÅ.h
"

5 
	$»adabË_timeo
(
fd
, 
£c
)

7 
fd_£t
 
r£t
;

8 
timev®
 
tv
;

10 
	`FD_ZERO
(&
r£t
);

11 
	`FD_SET
(
fd
, &
r£t
);

13 
tv
.
tv_£c
 = 
£c
;

14 
tv
.
tv_u£c
 = 0;

16 (
	`£Ëù
(
fd
+1, &
r£t
, 
NULL
, NULL, &
tv
));

18 
	}
}

22 
	$R—dabË_timeo
(
fd
, 
£c
)

24 
n
;

26 iàĞ(
n
 = 
	`»adabË_timeo
(
fd
, 
£c
)) < 0)

27 
	`”r_sys
("readable_timeoƒrror");

28 (
n
);

29 
	}
}

	@osi\unpv13e\unpv13e\lib\readline.c

2 
	~"uÅ.h
"

4 
	g»ad_út
;

5 *
	g»ad_±r
;

6 
	g»ad_buf
[
MAXLINE
];

8 
ssize_t


9 
	$my_»ad
(
fd
, *
±r
)

12 ià(
»ad_út
 <= 0) {

13 
agaš
:

14 iàĞ(
»ad_út
 = 
	`»ad
(
fd
, 
»ad_buf
, (read_buf))) < 0) {

15 ià(
”ºo
 =ğ
EINTR
)

16 
agaš
;

18 } ià(
»ad_út
 == 0)

20 
»ad_±r
 = 
»ad_buf
;

23 
»ad_út
--;

24 *
±r
 = *
»ad_±r
++;

26 
	}
}

28 
ssize_t


29 
	$»adlše
(
fd
, *
v±r
, 
size_t
 
maxËn
)

31 
ssize_t
 
n
, 
rc
;

32 
c
, *
±r
;

34 
±r
 = 
v±r
;

35 
n
 = 1;‚ < 
maxËn
;‚++) {

36 iàĞ(
rc
 = 
	`my_»ad
(
fd
, &
c
)) == 1) {

37 *
±r
++ = 
c
;

38 ià(
c
 == '\n')

40 } ià(
rc
 == 0) {

41 *
±r
 = 0;

42 (
n
 - 1);

47 *
±r
 = 0;

48 (
n
);

49 
	}
}

51 
ssize_t


52 
	$»adlšebuf
(**
v±½Œ
)

54 ià(
»ad_út
)

55 *
v±½Œ
 = 
»ad_±r
;

56 (
»ad_út
);

57 
	}
}

60 
ssize_t


61 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

63 
ssize_t
 
n
;

65 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) < 0)

66 
	`”r_sys
("readlineƒrror");

67 (
n
);

68 
	}
}

	@osi\unpv13e\unpv13e\lib\readn.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$»adn
(
fd
, *
v±r
, 
size_t
 
n
)

7 
size_t
 
Æeá
;

8 
ssize_t
 
Ä—d
;

9 *
±r
;

11 
±r
 = 
v±r
;

12 
Æeá
 = 
n
;

13 
Æeá
 > 0) {

14 iàĞ(
Ä—d
 = 
	`»ad
(
fd
, 
±r
, 
Æeá
)) < 0) {

15 ià(
”ºo
 =ğ
EINTR
)

16 
Ä—d
 = 0;

19 } ià(
Ä—d
 == 0)

22 
Æeá
 -ğ
Ä—d
;

23 
±r
 +ğ
Ä—d
;

25 (
n
 - 
Æeá
);

26 
	}
}

29 
ssize_t


30 
	$R—dn
(
fd
, *
±r
, 
size_t
 
nby‹s
)

32 
ssize_t
 
n
;

34 iàĞ(
n
 = 
	`»adn
(
fd
, 
±r
, 
nby‹s
)) < 0)

35 
	`”r_sys
("readnƒrror");

36 (
n
);

37 
	}
}

	@osi\unpv13e\unpv13e\lib\rtt.c

2 
	~"uÅ¹t.h
"

4 
	g¹t_d_æag
 = 0;

10 
	#RTT_RTOCALC
(
±r
è(ÕŒ)->
¹t_¤‰
 + (4.0 * (±r)->
¹t_¹tv¬
))

	)

13 
	$¹t_mšmax
(
¹o
)

15 ià(
¹o
 < 
RTT_RXTMIN
)

16 
¹o
 = 
RTT_RXTMIN
;

17 ià(
¹o
 > 
RTT_RXTMAX
)

18 
¹o
 = 
RTT_RXTMAX
;

19 (
¹o
);

20 
	}
}

23 
	$¹t_š™
(
¹t_šfo
 *
±r
)

25 
timev®
 
tv
;

27 
	`G‘timeofday
(&
tv
, 
NULL
);

28 
±r
->
¹t_ba£
 = 
tv
.
tv_£c
;

30 
±r
->
¹t_¹t
 = 0;

31 
±r
->
¹t_¤‰
 = 0;

32 
±r
->
¹t_¹tv¬
 = 0.75;

33 
±r
->
¹t_¹o
 = 
	`¹t_mšmax
(
	`RTT_RTOCALC
(ptr));

35 
	}
}

45 
ušt32_t


46 
	$¹t_ts
(
¹t_šfo
 *
±r
)

48 
ušt32_t
 
ts
;

49 
timev®
 
tv
;

51 
	`G‘timeofday
(&
tv
, 
NULL
);

52 
ts
 = ((
tv
.
tv_£c
 - 
±r
->
¹t_ba£
è* 1000è+ (tv.
tv_u£c
 / 1000);

53 (
ts
);

54 
	}
}

57 
	$¹t_Ãw·ck
(
¹t_šfo
 *
±r
)

59 
±r
->
¹t_Äexmt
 = 0;

60 
	}
}

63 
	$¹t_¡¬t
(
¹t_šfo
 *
±r
)

65 ((è(
±r
->
¹t_¹o
 + 0.5));

67 
	}
}

81 
	$¹t_¡İ
(
¹t_šfo
 *
±r
, 
ušt32_t
 
ms
)

83 
d–
;

85 
±r
->
¹t_¹t
 = 
ms
 / 1000.0;

93 
d–
 = 
±r
->
¹t_¹t
 -…Œ->
¹t_¤‰
;

94 
±r
->
¹t_¤‰
 +ğ
d–
 / 8;

96 ià(
d–
 < 0.0)

97 
d–
 = -delta;

99 
±r
->
¹t_¹tv¬
 +ğ(
d–
 -…tr->rtt_rttvar) / 4;

101 
±r
->
¹t_¹o
 = 
	`¹t_mšmax
(
	`RTT_RTOCALC
(ptr));

102 
	}
}

112 
	$¹t_timeout
(
¹t_šfo
 *
±r
)

114 
±r
->
¹t_¹o
 *= 2;

116 ià(++
±r
->
¹t_Äexmt
 > 
RTT_MAXNREXMT
)

119 
	}
}

127 
	$¹t_debug
(
¹t_šfo
 *
±r
)

129 ià(
¹t_d_æag
 == 0)

132 
	`årštf
(
¡d”r
, "rtt = %.3f, srtt = %.3f,„ttvar = %.3f,„to = %.3f\n",

133 
±r
->
¹t_¹t
,…Œ->
¹t_¤‰
,…Œ->
¹t_¹tv¬
,…Œ->
¹t_¹o
);

134 
	`fæush
(
¡d”r
);

135 
	}
}

	@osi\unpv13e\unpv13e\lib\signal.c

2 
	~"uÅ.h
"

4 
Sigfunc
 *

5 
	$sigÇl
(
signo
, 
Sigfunc
 *
func
)

7 
sigaùiÚ
 
aù
, 
ßù
;

9 
aù
.
§_hªdËr
 = 
func
;

10 
	`sigem±y£t
(&
aù
.
§_mask
);

11 
aù
.
§_æags
 = 0;

12 ià(
signo
 =ğ
SIGALRM
) {

13 #ifdef 
SA_INTERRUPT


14 
aù
.
§_æags
 |ğ
SA_INTERRUPT
;

17 #ifdef 
SA_RESTART


18 
aù
.
§_æags
 |ğ
SA_RESTART
;

21 ià(
	`sigaùiÚ
(
signo
, &
aù
, &
ßù
) < 0)

22 (
SIG_ERR
);

23 (
ßù
.
§_hªdËr
);

24 
	}
}

27 
Sigfunc
 *

28 
	$SigÇl
(
signo
, 
Sigfunc
 *
func
)

30 
Sigfunc
 *
sigfunc
;

32 iàĞ(
sigfunc
 = 
	`sigÇl
(
signo
, 
func
)è=ğ
SIG_ERR
)

33 
	`”r_sys
("signalƒrror");

34 (
sigfunc
);

35 
	}
}

	@osi\unpv13e\unpv13e\lib\signal_intr.c

2 
	~"uÅ.h
"

4 
Sigfunc
 *

5 
	$sigÇl_šŒ
(
signo
, 
Sigfunc
 *
func
)

7 
sigaùiÚ
 
aù
, 
ßù
;

9 
aù
.
§_hªdËr
 = 
func
;

10 
	`sigem±y£t
(&
aù
.
§_mask
);

11 
aù
.
§_æags
 = 0;

12 #ifdef 
SA_INTERRUPT


13 
aù
.
§_æags
 |ğ
SA_INTERRUPT
;

15 ià(
	`sigaùiÚ
(
signo
, &
aù
, &
ßù
) < 0)

16 (
SIG_ERR
);

17 (
ßù
.
§_hªdËr
);

18 
	}
}

21 
Sigfunc
 *

22 
	$SigÇl_šŒ
(
signo
, 
Sigfunc
 *
func
)

24 
Sigfunc
 *
sigfunc
;

26 iàĞ(
sigfunc
 = 
	`sigÇl_šŒ
(
signo
, 
func
)è=ğ
SIG_ERR
)

27 
	`”r_sys
("signal_intrƒrror");

28 (
sigfunc
);

29 
	}
}

	@osi\unpv13e\unpv13e\lib\snprintf.c

10 
	~"uÅ.h
"

12 
	~<¡d¬g.h
>

15 
	$¢´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, ...)

17 
n
;

18 
va_li¡
 
­
;

20 
	`va_¡¬t
(
­
, 
fmt
);

21 
	`v¥rštf
(
buf
, 
fmt
, 
­
);

22 
n
 = 
	`¡¾’
(
buf
);

23 
	`va_’d
(
­
);

24 ià(
n
 >ğ
size
)

25 
	`”r_qu™
("¢´štf: '%s' ov”æowed‡¼ay", 
fmt
);

26 (
n
);

27 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_bind_wild.c

1 
	~"uÅ.h
"

4 
	$sock_bšd_wd
(
sockfd
, 
çmy
)

6 
sockËn_t
 
Ën
;

8 
çmy
) {

9 
AF_INET
: {

10 
sockaddr_š
 
sš
;

12 
	`bz”o
(&
sš
, (sin));

13 
sš
.
sš_çmy
 = 
AF_INET
;

14 
sš
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

15 
sš
.
sš_pÜt
 = 
	`htÚs
(0);

17 ià(
	`bšd
(
sockfd
, (
SA
 *è&
sš
, (sin)) < 0)

19 
Ën
 = (
sš
);

20 ià(
	`g‘sockÇme
(
sockfd
, (
SA
 *è&
sš
, &
Ën
) < 0)

22 (
sš
.
sš_pÜt
);

25 #ifdef 
IPV6


26 
AF_INET6
: {

27 
sockaddr_š6
 
sš6
;

29 
	`bz”o
(&
sš6
, (sin6));

30 
sš6
.
sš6_çmy
 = 
AF_INET6
;

31 
sš6
.
sš6_addr
 = 
š6addr_ªy
;

32 
sš6
.
sš6_pÜt
 = 
	`htÚs
(0);

34 ià(
	`bšd
(
sockfd
, (
SA
 *è&
sš6
, (sin6)) < 0)

36 
Ën
 = (
sš6
);

37 ià(
	`g‘sockÇme
(
sockfd
, (
SA
 *è&
sš6
, &
Ën
) < 0)

39 (
sš6
.
sš6_pÜt
);

44 
	}
}

47 
	$Sock_bšd_wd
(
sockfd
, 
çmy
)

49 
pÜt
;

51 iàĞ(
pÜt
 = 
	`sock_bšd_wd
(
sockfd
, 
çmy
)) < 0)

52 
	`”r_sys
("sock_bind_wildƒrror");

54 (
pÜt
);

55 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_cmp_addr.c

1 
	~"uÅ.h
"

3 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


4 
	~<Ãt/if_dl.h
>

8 
	$sock_cmp_addr
(cÚ¡ 
sockaddr
 *
§1
, cÚ¡ sockadd¸*
§2
,

9 
sockËn_t
 
§Ën
)

11 ià(
§1
->
§_çmy
 !ğ
§2
->sa_family)

14 
§1
->
§_çmy
) {

15 
AF_INET
: {

16 (
	`memcmp
Ğ&((
sockaddr_š
 *è
§1
)->
sš_addr
,

17 &((
sockaddr_š
 *è
§2
)->
sš_addr
,

18 (
š_addr
)));

21 #ifdef 
IPV6


22 
AF_INET6
: {

23 (
	`memcmp
Ğ&((
sockaddr_š6
 *è
§1
)->
sš6_addr
,

24 &((
sockaddr_š6
 *è
§2
)->
sš6_addr
,

25 (
š6_addr
)));

29 #ifdef 
AF_UNIX


30 
AF_UNIX
: {

31 (
	`¡rcmp
Ğ((
sockaddr_un
 *è
§1
)->
sun_·th
,

32 ((
sockaddr_un
 *è
§2
)->
sun_·th
));

36 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


37 
AF_LINK
: {

43 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_cmp_port.c

1 
	~"uÅ.h
"

3 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


4 
	~<Ãt/if_dl.h
>

8 
	$sock_cmp_pÜt
(cÚ¡ 
sockaddr
 *
§1
, cÚ¡ sockadd¸*
§2
,

9 
sockËn_t
 
§Ën
)

11 ià(
§1
->
§_çmy
 !ğ
§2
->sa_family)

14 
§1
->
§_çmy
) {

15 
AF_INET
: {

16 Ğ((
sockaddr_š
 *è
§1
)->
sš_pÜt
 ==

17 ((
sockaddr_š
 *è
§2
)->
sš_pÜt
);

20 #ifdef 
IPV6


21 
AF_INET6
: {

22 Ğ((
sockaddr_š6
 *è
§1
)->
sš6_pÜt
 ==

23 ((
sockaddr_š6
 *è
§2
)->
sš6_pÜt
);

29 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_get_port.c

1 
	~"uÅ.h
"

4 
	$sock_g‘_pÜt
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

6 
§
->
§_çmy
) {

7 
AF_INET
: {

8 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

10 (
sš
->
sš_pÜt
);

13 #ifdef 
IPV6


14 
AF_INET6
: {

15 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

17 (
sš6
->
sš6_pÜt
);

23 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_ntop.c

1 
	~"uÅ.h
"

3 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


4 
	~<Ãt/if_dl.h
>

9 
	$sock_Áİ
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

11 
pÜt¡r
[8];

12 
¡r
[128];

14 
§
->
§_çmy
) {

15 
AF_INET
: {

16 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

18 ià(
	`š‘_Áİ
(
AF_INET
, &
sš
->
sš_addr
, 
¡r
, (¡r)è=ğ
NULL
)

19 (
NULL
);

20 ià(
	`Áohs
(
sš
->
sš_pÜt
) != 0) {

21 
	`¢´štf
(
pÜt¡r
, ÕÜt¡r), ":%d", 
	`Áohs
(
sš
->
sš_pÜt
));

22 
	`¡rÿt
(
¡r
, 
pÜt¡r
);

24 (
¡r
);

28 #ifdef 
IPV6


29 
AF_INET6
: {

30 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

32 
¡r
[0] = '[';

33 ià(
	`š‘_Áİ
(
AF_INET6
, &
sš6
->
sš6_addr
, 
¡r
 + 1, (¡rè- 1è=ğ
NULL
)

34 (
NULL
);

35 ià(
	`Áohs
(
sš6
->
sš6_pÜt
) != 0) {

36 
	`¢´štf
(
pÜt¡r
, ÕÜt¡r), "]:%d", 
	`Áohs
(
sš6
->
sš6_pÜt
));

37 
	`¡rÿt
(
¡r
, 
pÜt¡r
);

38 (
¡r
);

40  (
¡r
 + 1);

44 #ifdef 
AF_UNIX


45 
AF_UNIX
: {

46 
sockaddr_un
 *
uÅ
 = (sockaddr_uÀ*è
§
;

50 ià(
uÅ
->
sun_·th
[0] == 0)

51 
	`¡rıy
(
¡r
, "(no…athname bound)");

53 
	`¢´štf
(
¡r
, (¡r), "%s", 
uÅ
->
sun_·th
);

54 (
¡r
);

58 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


59 
AF_LINK
: {

60 
sockaddr_dl
 *
sdl
 = (sockaddr_dÈ*è
§
;

62 ià(
sdl
->
sdl_Æ’
 > 0)

63 
	`¢´štf
(
¡r
, (str), "%*s (index %d)",

64 
sdl
->
sdl_Æ’
, &sdl->
sdl_d©a
[0], sdl->
sdl_šdex
);

66 
	`¢´štf
(
¡r
, (¡r), "AF_LINK, index=%d", 
sdl
->
sdl_šdex
);

67 (
¡r
);

71 
	`¢´štf
(
¡r
, (str), "sock_ntop: unknown AF_xxx: %d,†en %d",

72 
§
->
§_çmy
, 
§Ën
);

73 (
¡r
);

75  (
NULL
);

76 
	}
}

79 
	$Sock_Áİ
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

81 *
±r
;

83 iàĞ(
±r
 = 
	`sock_Áİ
(
§
, 
§Ën
)è=ğ
NULL
)

84 
	`”r_sys
("sock_ntopƒrror");

85 (
±r
);

86 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_ntop_host.c

1 
	~"uÅ.h
"

3 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


4 
	~<Ãt/if_dl.h
>

8 
	$sock_Áİ_ho¡
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

10 
¡r
[128];

12 
§
->
§_çmy
) {

13 
AF_INET
: {

14 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

16 ià(
	`š‘_Áİ
(
AF_INET
, &
sš
->
sš_addr
, 
¡r
, (¡r)è=ğ
NULL
)

17 (
NULL
);

18 (
¡r
);

21 #ifdef 
IPV6


22 
AF_INET6
: {

23 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

25 ià(
	`š‘_Áİ
(
AF_INET6
, &
sš6
->
sš6_addr
, 
¡r
, (¡r)è=ğ
NULL
)

26 (
NULL
);

27 (
¡r
);

31 #ifdef 
AF_UNIX


32 
AF_UNIX
: {

33 
sockaddr_un
 *
uÅ
 = (sockaddr_uÀ*è
§
;

37 ià(
uÅ
->
sun_·th
[0] == 0)

38 
	`¡rıy
(
¡r
, "(no…athname bound)");

40 
	`¢´štf
(
¡r
, (¡r), "%s", 
uÅ
->
sun_·th
);

41 (
¡r
);

45 #ifdef 
HAVE_SOCKADDR_DL_STRUCT


46 
AF_LINK
: {

47 
sockaddr_dl
 *
sdl
 = (sockaddr_dÈ*è
§
;

49 ià(
sdl
->
sdl_Æ’
 > 0)

50 
	`¢´štf
(
¡r
, (str), "%*s",

51 
sdl
->
sdl_Æ’
, &sdl->
sdl_d©a
[0]);

53 
	`¢´štf
(
¡r
, (¡r), "AF_LINK, index=%d", 
sdl
->
sdl_šdex
);

54 (
¡r
);

58 
	`¢´štf
(
¡r
, (str), "sock_ntop_host: unknown AF_xxx: %d,†en %d",

59 
§
->
§_çmy
, 
§Ën
);

60 (
¡r
);

62  (
NULL
);

63 
	}
}

66 
	$Sock_Áİ_ho¡
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

68 *
±r
;

70 iàĞ(
±r
 = 
	`sock_Áİ_ho¡
(
§
, 
§Ën
)è=ğ
NULL
)

71 
	`”r_sys
("sock_ntop_hostƒrror");

72 (
±r
);

73 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_set_addr.c

1 
	~"uÅ.h
"

4 
	$sock_£t_addr
(
sockaddr
 *
§
, 
sockËn_t
 
§Ën
, cÚ¡ *
addr
)

6 
§
->
§_çmy
) {

7 
AF_INET
: {

8 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

10 
	`memıy
(&
sš
->
sš_addr
, 
addr
, (
š_addr
));

14 #ifdef 
IPV6


15 
AF_INET6
: {

16 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

18 
	`memıy
(&
sš6
->
sš6_addr
, 
addr
, (
š6_addr
));

25 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_set_port.c

1 
	~"uÅ.h
"

4 
	$sock_£t_pÜt
(
sockaddr
 *
§
, 
sockËn_t
 
§Ën
, 
pÜt
)

6 
§
->
§_çmy
) {

7 
AF_INET
: {

8 
sockaddr_š
 *
sš
 = (sockaddr_š *è
§
;

10 
sš
->
sš_pÜt
 = 
pÜt
;

14 #ifdef 
IPV6


15 
AF_INET6
: {

16 
sockaddr_š6
 *
sš6
 = (sockaddr_š6 *è
§
;

18 
sš6
->
sš6_pÜt
 = 
pÜt
;

25 
	}
}

	@osi\unpv13e\unpv13e\lib\sock_set_wild.c

1 
	~"uÅ.h
"

4 
	$sock_£t_wd
(
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

6 cÚ¡ *
wd±r
;

8 
§
->
§_çmy
) {

9 
AF_INET
: {

10 
š_addr
 
š4addr_ªy
;

12 
š4addr_ªy
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

13 
wd±r
 = &
š4addr_ªy
;

17 #ifdef 
IPV6


18 
AF_INET6
: {

19 
wd±r
 = &
š6addr_ªy
;

27 
	`sock_£t_addr
(
§
, 
§Ën
, 
wd±r
);

29 
	}
}

	@osi\unpv13e\unpv13e\lib\sockatmark.c

1 
	~"uÅ.h
"

4 
	$sock©m¬k
(
fd
)

6 
æag
;

8 ià(
	`ioùl
(
fd
, 
SIOCATMARK
, &
æag
) < 0)

10 (
æag
 != 0);

11 
	}
}

	@osi\unpv13e\unpv13e\lib\sockfd_to_family.c

2 
	~"uÅ.h
"

5 
	$sockfd_to_çmy
(
sockfd
)

7 
sockaddr_¡Üage
 
ss
;

8 
sockËn_t
 
Ën
;

10 
Ën
 = (
ss
);

11 ià(
	`g‘sockÇme
(
sockfd
, (
SA
 *è&
ss
, &
Ën
) < 0)

13 (
ss
.
ss_çmy
);

14 
	}
}

18 
	$Sockfd_to_çmy
(
sockfd
)

20 
rc
;

22 iàĞ(
rc
 = 
	`sockfd_to_çmy
(
sockfd
)) < 0)

23 
	`”r_sys
("sockfd_to_familyƒrror");

25 (
rc
);

26 
	}
}

	@osi\unpv13e\unpv13e\lib\str_cli.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

8 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

10 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

12 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0)

13 
	`”r_qu™
("str_cli: servererminated…rematurely");

15 
	`Fputs
(
»cvlše
, 
¡dout
);

17 
	}
}

	@osi\unpv13e\unpv13e\lib\str_echo.c

1 
	~"uÅ.h
"

4 
	$¡r_echo
(
sockfd
)

6 
ssize_t
 
n
;

7 
buf
[
MAXLINE
];

9 
agaš
:

10  (
n
 = 
	`»ad
(
sockfd
, 
buf
, 
MAXLINE
)) > 0)

11 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

13 ià(
n
 < 0 && 
”ºo
 =ğ
EINTR
)

14 
agaš
;

15 ià(
n
 < 0)

16 
	`”r_sys
("str_echo:„eadƒrror");

17 
	}
}

	@osi\unpv13e\unpv13e\lib\tcp_connect.c

2 
	~"uÅ.h
"

5 
	$tı_cÚÃù
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
)

7 
sockfd
, 
n
;

8 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

10 
	`bz”o
(&
hšts
, (
addršfo
));

11 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

12 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

14 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

15 
	`”r_qu™
("tcp_connectƒrror for %s, %s: %s",

16 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

17 
»s§ve
 = 
»s
;

20 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

21 ià(
sockfd
 < 0)

24 ià(
	`cÚÃù
(
sockfd
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

27 
	`Clo£
(
sockfd
);

28 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

30 ià(
»s
 =ğ
NULL
)

31 
	`”r_sys
("tı_cÚÃùƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

33 
	`ä“addršfo
(
»s§ve
);

35 (
sockfd
);

36 
	}
}

46 
	$Tı_cÚÃù
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
)

48 (
	`tı_cÚÃù
(
ho¡
, 
£rv
));

49 
	}
}

	@osi\unpv13e\unpv13e\lib\tcp_listen.c

2 
	~"uÅ.h
"

5 
	$tı_li¡’
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

7 
li¡’fd
, 
n
;

8 cÚ¡ 
Ú
 = 1;

9 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

11 
	`bz”o
(&
hšts
, (
addršfo
));

12 
hšts
.
ai_æags
 = 
AI_PASSIVE
;

13 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

14 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

16 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

17 
	`”r_qu™
("tcp_listenƒrror for %s, %s: %s",

18 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

19 
»s§ve
 = 
»s
;

22 
li¡’fd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

23 ià(
li¡’fd
 < 0)

26 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

27 ià(
	`bšd
(
li¡’fd
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

30 
	`Clo£
(
li¡’fd
);

31 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

33 ià(
»s
 =ğ
NULL
)

34 
	`”r_sys
("tı_li¡’ƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

36 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

38 ià(
add¾’p
)

39 *
add¾’p
 = 
»s
->
ai_add¾’
;

41 
	`ä“addršfo
(
»s§ve
);

43 (
li¡’fd
);

44 
	}
}

54 
	$Tı_li¡’
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

56 (
	`tı_li¡’
(
ho¡
, 
£rv
, 
add¾’p
));

57 
	}
}

	@osi\unpv13e\unpv13e\lib\tv_sub.c

1 
	~"uÅ.h
"

4 
	$tv_sub
(
timev®
 *
out
, timev® *
š
)

6 iàĞ(
out
->
tv_u£c
 -ğ
š
->tv_usec) < 0) {

7 --
out
->
tv_£c
;

8 
out
->
tv_u£c
 += 1000000;

10 
out
->
tv_£c
 -ğ
š
->tv_sec;

11 
	}
}

	@osi\unpv13e\unpv13e\lib\udp_client.c

2 
	~"uÅ.h
"

5 
	$udp_ş›Á
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
SA
 **
§±r
, 
sockËn_t
 *
ËÅ
)

7 
sockfd
, 
n
;

8 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

10 
	`bz”o
(&
hšts
, (
addršfo
));

11 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

12 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

14 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

15 
	`”r_qu™
("udp_clientƒrror for %s, %s: %s",

16 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

17 
»s§ve
 = 
»s
;

20 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

21 ià(
sockfd
 >= 0)

23 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

25 ià(
»s
 =ğ
NULL
)

26 
	`”r_sys
("udp_ş›Áƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

28 *
§±r
 = 
	`M®loc
(
»s
->
ai_add¾’
);

29 
	`memıy
(*
§±r
, 
»s
->
ai_addr
,„es->
ai_add¾’
);

30 *
ËÅ
 = 
»s
->
ai_add¾’
;

32 
	`ä“addršfo
(
»s§ve
);

34 (
sockfd
);

35 
	}
}

39 
	$Udp_ş›Á
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
SA
 **
§±r
, 
sockËn_t
 *
ËÅŒ
)

41 (
	`udp_ş›Á
(
ho¡
, 
£rv
, 
§±r
, 
ËÅŒ
));

42 
	}
}

	@osi\unpv13e\unpv13e\lib\udp_connect.c

2 
	~"uÅ.h
"

5 
	$udp_cÚÃù
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
)

7 
sockfd
, 
n
;

8 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

10 
	`bz”o
(&
hšts
, (
addršfo
));

11 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

12 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

14 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

15 
	`”r_qu™
("udp_connectƒrror for %s, %s: %s",

16 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

17 
»s§ve
 = 
»s
;

20 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

21 ià(
sockfd
 < 0)

24 ià(
	`cÚÃù
(
sockfd
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

27 
	`Clo£
(
sockfd
);

28 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

30 ià(
»s
 =ğ
NULL
)

31 
	`”r_sys
("udp_cÚÃùƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

33 
	`ä“addršfo
(
»s§ve
);

35 (
sockfd
);

36 
	}
}

40 
	$Udp_cÚÃù
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
)

42 
n
;

44 iàĞ(
n
 = 
	`udp_cÚÃù
(
ho¡
, 
£rv
)) < 0) {

45 
	`”r_qu™
("udp_connectƒrror for %s, %s: %s",

46 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(-
n
));

48 (
n
);

49 
	}
}

	@osi\unpv13e\unpv13e\lib\udp_server.c

2 
	~"uÅ.h
"

5 
	$udp_£rv”
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

7 
sockfd
, 
n
;

8 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

10 
	`bz”o
(&
hšts
, (
addršfo
));

11 
hšts
.
ai_æags
 = 
AI_PASSIVE
;

12 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

13 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

15 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

16 
	`”r_qu™
("udp_serverƒrror for %s, %s: %s",

17 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

18 
»s§ve
 = 
»s
;

21 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

22 ià(
sockfd
 < 0)

25 ià(
	`bšd
(
sockfd
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

28 
	`Clo£
(
sockfd
);

29 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

31 ià(
»s
 =ğ
NULL
)

32 
	`”r_sys
("udp_£rv”ƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

34 ià(
add¾’p
)

35 *
add¾’p
 = 
»s
->
ai_add¾’
;

37 
	`ä“addršfo
(
»s§ve
);

39 (
sockfd
);

40 
	}
}

44 
	$Udp_£rv”
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

46 (
	`udp_£rv”
(
ho¡
, 
£rv
, 
add¾’p
));

47 
	}
}

	@osi\unpv13e\unpv13e\lib\unp.h

4 #iâdef 
__uÅ_h


5 
	#__uÅ_h


	)

7 
	~"../cÚfig.h
"

13 
	~<sys/ty³s.h
>

14 
	~<sys/sock‘.h
>

15 #ià
TIME_WITH_SYS_TIME


16 
	~<sys/time.h
>

17 
	~<time.h
>

19 #ià
HAVE_SYS_TIME_H


20 
	~<sys/time.h
>

22 
	~<time.h
>

25 
	~<Ãtš‘/š.h
>

26 
	~<¬·/š‘.h
>

27 
	~<”ºo.h
>

28 
	~<fú.h
>

29 
	~<Ãtdb.h
>

30 
	~<sigÇl.h
>

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

34 
	~<sys/¡©.h
>

35 
	~<sys/uio.h
>

36 
	~<uni¡d.h
>

37 
	~<sys/wa™.h
>

38 
	~<sys/un.h
>

40 #ifdef 
HAVE_SYS_SELECT_H


41 
	~<sys/£Ëù.h
>

44 #ifdef 
HAVE_SYS_SYSCTL_H


45 #ifdef 
HAVE_SYS_PARAM_H


46 
	~<sys/·¿m.h
>

48 
	~<sys/sysùl.h
>

51 #ifdef 
HAVE_POLL_H


52 
	~<pŞl.h
>

55 #ifdef 
HAVE_SYS_EVENT_H


56 
	~<sys/ev’t.h
>

59 #ifdef 
HAVE_STRINGS_H


60 
	~<¡ršgs.h
>

66 #ifdef 
HAVE_SYS_IOCTL_H


67 
	~<sys/ioùl.h
>

69 #ifdef 
HAVE_SYS_FILIO_H


70 
	~<sys/fio.h
>

72 #ifdef 
HAVE_SYS_SOCKIO_H


73 
	~<sys/sockio.h
>

76 #ifdef 
HAVE_PTHREAD_H


77 
	~<±h»ad.h
>

80 #ifdeà
HAVE_NET_IF_DL_H


81 
	~<Ãt/if_dl.h
>

84 #ifdeà
HAVE_NETINET_SCTP_H


85 
	~<Ãtš‘/sùp.h
>

89 #ifdef 
__osf__


90 #undeà
»cv


91 #undeà
£nd


92 
	#»cv
(
a
,
b
,
c
,
d
è
	`»cväom
×,b,c,d,0,0)

	)

93 
	#£nd
(
a
,
b
,
c
,
d
è
	`£ndto
×,b,c,d,0,0)

	)

96 #iâdef 
INADDR_NONE


98 
	#INADDR_NONE
 0xfffffffà

	)

101 #iâdef 
SHUT_RD


102 
	#SHUT_RD
 0

	)

103 
	#SHUT_WR
 1

	)

104 
	#SHUT_RDWR
 2

	)

111 #iâdeà
INET_ADDRSTRLEN


113 
	#INET_ADDRSTRLEN
 16

	)

119 #iâdeà
INET6_ADDRSTRLEN


121 
	#INET6_ADDRSTRLEN
 46

	)

129 #iâdef 
HAVE_BZERO


130 
	#bz”o
(
±r
,
n
è
	`mem£t
ÕŒ, 0,‚)

	)

136 #iâdef 
HAVE_GETHOSTBYNAME2


137 
	#g‘ho¡byÇme2
(
ho¡
,
çmy
è
	`g‘ho¡byÇme
((ho¡))

	)

141 
	suÅ_š_pktšfo
 {

142 
š_addr
 
	mi_addr
;

143 
	mi_ifšdex
;

152 #iâdef 
CMSG_LEN


154 
	#CMSG_LEN
(
size
è((
cmsghdr
è+ (size))

	)

156 #iâdef 
CMSG_SPACE


158 
	#CMSG_SPACE
(
size
è((
cmsghdr
è+ (size))

	)

164 #iâdef 
SUN_LEN


166 
	#SUN_LEN
(
su
) \

167 ((*(
su
)è- ((su)->
sun_·th
è+ 
	`¡¾’
((su)->sun_·th))

	)

172 #iâdef 
AF_LOCAL


173 
	#AF_LOCAL
 
AF_UNIX


	)

175 #iâdef 
PF_LOCAL


176 
	#PF_LOCAL
 
PF_UNIX


	)

183 #iâdeà
INFTIM


184 
	#INFTIM
 (-1è

	)

186 #ifdef 
HAVE_POLL_H


187 
	#INFTIM_UNPH


	)

193 
	#LISTENQ
 1024

	)

196 
	#MAXLINE
 4096

	)

197 
	#BUFFSIZE
 8192

	)

200 
	#SERV_PORT
 9877

	)

201 
	#SERV_PORT_STR
 "9877"

	)

202 
	#UNIXSTR_PATH
 "/tmp/unix.¡r"

	)

203 
	#UNIXDG_PATH
 "/tmp/unix.dg"

	)

212 
	#SA
 
sockaddr


	)

214 #iâdeà
HAVE_STRUCT_SOCKADDR_STORAGE


218 
	#__SS_MAXSIZE
 128

	)

219 
	#__SS_ALIGNSIZE
 ((
št64_t
))

	)

220 #ifdeà
HAVE_SOCKADDR_SA_LEN


221 
	#__SS_PAD1SIZE
 (
__SS_ALIGNSIZE
 - (
u_ch¬
è- (
§_çmy_t
))

	)

223 
	#__SS_PAD1SIZE
 (
__SS_ALIGNSIZE
 - (
§_çmy_t
))

	)

225 
	#__SS_PAD2SIZE
 (
__SS_MAXSIZE
 - 2*
__SS_ALIGNSIZE
)

	)

227 
	ssockaddr_¡Üage
 {

228 #ifdeà
HAVE_SOCKADDR_SA_LEN


229 
u_ch¬
 
	mss_Ën
;

231 
§_çmy_t
 
	mss_çmy
;

232 
	m__ss_·d1
[
__SS_PAD1SIZE
];

233 
št64_t
 
	m__ss_®ign
;

234 
	m__ss_·d2
[
__SS_PAD2SIZE
];

238 
	#FILE_MODE
 (
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
)

	)

240 
	#DIR_MODE
 (
FILE_MODE
 | 
S_IXUSR
 | 
S_IXGRP
 | 
S_IXOTH
)

	)

243 
	tSigfunc
();

245 
	#mš
(
a
,
b
è(×è< (bè? (aè: (b))

	)

246 
	#max
(
a
,
b
è(×è> (bè? (aè: (b))

	)

248 #iâdef 
HAVE_ADDRINFO_STRUCT


249 
	~"../lib/addršfo.h
"

252 #iâdef 
HAVE_IF_NAMEINDEX_STRUCT


253 
	sif_Çmešdex
 {

254 
	mif_šdex
;

255 *
	mif_Çme
;

262 #iâdef 
HAVE_TIMESPEC_STRUCT


263 
	stime¥ec
 {

264 
time_t
 
	mtv_£c
;

265 
	mtv_n£c
;

274 
cÚÃù_nÚb
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

275 
cÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

276 
d«mÚ_š™
(const *, );

277 
d«mÚ_š‘d
(const *, );

278 
dg_şi
(
FILE
 *, , cÚ¡ 
SA
 *, 
sockËn_t
);

279 
dg_echo
(, 
SA
 *, 
sockËn_t
);

280 
çmy_to_Ëv–
();

281 *
gf_time
();

282 
h—¹b—t_şi
(, , );

283 
h—¹b—t_£rv
(, , );

284 
addršfo
 *
ho¡_£rv
(const *, const *, , );

285 
š‘_¤üt_add
(*);

286 
u_ch¬
 *
š‘_¤üt_š™
();

287 
š‘_¤üt_´št
(
u_ch¬
 *, );

288 
š‘6_¤üt_´št
(*);

289 **
my_addrs
(*);

290 
»adabË_timeo
(, );

291 
ssize_t
 
»adlše
(, *, 
size_t
);

292 
ssize_t
 
»adn
(, *, 
size_t
);

293 
ssize_t
 
»ad_fd
(, *, 
size_t
, *);

294 
ssize_t
 
»cväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

295 
uÅ_š_pktšfo
 *);

296 
Sigfunc
 *
sigÇl_šŒ
(, Sigfunc *);

297 
sock_bšd_wd
(, );

298 
sock_cmp_addr
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

299 
sock_cmp_pÜt
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

300 
sock_g‘_pÜt
(cÚ¡ 
SA
 *, 
sockËn_t
);

301 
sock_£t_addr
(
SA
 *, 
sockËn_t
, const *);

302 
sock_£t_pÜt
(
SA
 *, 
sockËn_t
, );

303 
sock_£t_wd
(
SA
 *, 
sockËn_t
);

304 *
sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

305 *
sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

306 
sockfd_to_çmy
();

307 
¡r_echo
();

308 
¡r_şi
(
FILE
 *, );

309 
tı_cÚÃù
(const *, const *);

310 
tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

311 
tv_sub
(
timev®
 *, timeval *);

312 
udp_ş›Á
(cÚ¡ *, cÚ¡ *, 
SA
 **, 
sockËn_t
 *);

313 
udp_cÚÃù
(const *, const *);

314 
udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

315 
wr™abË_timeo
(, );

316 
ssize_t
 
wr™’
(, cÚ¡ *, 
size_t
);

317 
ssize_t
 
wr™e_fd
(, *, 
size_t
, );

319 #ifdef 
MCAST


320 
mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

321 
mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

322 
mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

323 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

324 
mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

325 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

326 cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

327 
mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

328 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

329 
mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

330 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

331 
mÿ¡_g‘_if
();

332 
mÿ¡_g‘_loİ
();

333 
mÿ¡_g‘_‰l
();

334 
mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

335 
mÿ¡_£t_loİ
(, );

336 
mÿ¡_£t_‰l
(, );

338 
Mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

339 
Mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

340 
Mÿ¡_Ëave_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

341 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

342 
Mÿ¡_još_sourû_group
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

343 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
,

344 cÚ¡ *
iâame
, 
u_št
 
ifšdex
);

345 
Mÿ¡_block_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

346 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

347 
Mÿ¡_unblock_sourû
(
sockfd
, cÚ¡ 
SA
 *
¤c
, 
sockËn_t
 
¤ş’
,

348 cÚ¡ 
SA
 *
g½
, 
sockËn_t
 
g½Ën
);

349 
Mÿ¡_g‘_if
();

350 
Mÿ¡_g‘_loİ
();

351 
Mÿ¡_g‘_‰l
();

352 
Mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

353 
Mÿ¡_£t_loİ
(, );

354 
Mÿ¡_£t_‰l
(, );

357 
ušt16_t
 
š_cksum
(uint16_t *, );

359 #iâdef 
HAVE_GETADDRINFO_PROTO


360 
g‘addršfo
(cÚ¡ *, cÚ¡ *, cÚ¡ 
addršfo
 *,

361 
addršfo
 **);

362 
ä“addršfo
(
addršfo
 *);

363 *
gai_¡»¼Ü
();

366 #iâdef 
HAVE_GETNAMEINFO_PROTO


367 
g‘Çmešfo
(cÚ¡ 
SA
 *, 
sockËn_t
, *, 
size_t
, *, size_t, );

370 #iâdef 
HAVE_GETHOSTNAME_PROTO


371 
g‘ho¡Çme
(*, );

374 #iâdef 
HAVE_HSTRERROR_PROTO


375 cÚ¡ *
h¡»¼Ü
();

378 #iâdef 
HAVE_IF_NAMETOINDEX_PROTO


379 
if_Çm‘ošdex
(const *);

380 *
if_šdextÚame
(, *);

381 
if_ä“Çmešdex
(
if_Çmešdex
 *);

382 
if_Çmešdex
 *if_nameindex();

385 #iâdef 
HAVE_INET_PTON_PROTO


386 
š‘_±Ú
(, const *, *);

387 cÚ¡ *
š‘_Áİ
(, cÚ¡ *, *, 
size_t
);

390 #iâdef 
HAVE_INET_ATON_PROTO


391 
š‘_©Ú
(cÚ¡ *, 
š_addr
 *);

394 #iâdef 
HAVE_PSELECT_PROTO


395 
p£Ëù
(, 
fd_£t
 *, fd_set *, fd_set *,

396 cÚ¡ 
time¥ec
 *, cÚ¡ 
sig£t_t
 *);

399 #iâdef 
HAVE_SOCKATMARK_PROTO


400 
sock©m¬k
();

403 #iâdef 
HAVE_SNPRINTF_PROTO


404 
¢´štf
(*, 
size_t
, const *, ...);

408 
CÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

409 
Famy_to_Ëv–
();

410 
addršfo
 *
Ho¡_£rv
(const *, const *, , );

411 cÚ¡ *
IÃt_Áİ
(, cÚ¡ *, *, 
size_t
);

412 
IÃt_±Ú
(, const *, *);

413 *
If_šdextÚame
(, *);

414 
If_Çm‘ošdex
(const *);

415 
if_Çmešdex
 *
If_Çmešdex
();

416 **
My_addrs
(*);

417 
ssize_t
 
R—d_fd
(, *, 
size_t
, *);

418 
R—dabË_timeo
(, );

419 
ssize_t
 
Recväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

420 
uÅ_š_pktšfo
 *);

421 
Sigfunc
 *
SigÇl
(, Sigfunc *);

422 
Sigfunc
 *
SigÇl_šŒ
(, Sigfunc *);

423 
Sock_bšd_wd
(, );

424 *
Sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

425 *
Sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

426 
Sockfd_to_çmy
();

427 
Tı_cÚÃù
(const *, const *);

428 
Tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

429 
Udp_ş›Á
(cÚ¡ *, cÚ¡ *, 
SA
 **, 
sockËn_t
 *);

430 
Udp_cÚÃù
(const *, const *);

431 
Udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

432 
ssize_t
 
Wr™e_fd
(, *, 
size_t
, );

433 
Wr™abË_timeo
(, );

436 *
C®loc
(
size_t
, size_t);

437 
Clo£
();

438 
Dup2
(, );

439 
Fú
(, , );

440 
G‘timeofday
(
timev®
 *, *);

441 
Ioùl
(, , *);

442 
pid_t
 
FÜk
();

443 *
M®loc
(
size_t
);

444 
Mk¡emp
(*);

445 *
Mm­
(*, 
size_t
, , , , 
off_t
);

446 
O³n
(cÚ¡ *, , 
mode_t
);

447 
Pe
(*
fds
);

448 
ssize_t
 
R—d
(, *, 
size_t
);

449 
Sigadd£t
(
sig£t_t
 *, );

450 
Sigd–£t
(
sig£t_t
 *, );

451 
Sigem±y£t
(
sig£t_t
 *);

452 
Sigfl£t
(
sig£t_t
 *);

453 
Sigismemb”
(cÚ¡ 
sig£t_t
 *, );

454 
Sig³ndšg
(
sig£t_t
 *);

455 
Sig´ocmask
(, cÚ¡ 
sig£t_t
 *, sigset_t *);

456 *
SŒdup
(const *);

457 
SyscÚf
();

458 
Sysùl
(*, 
u_št
, *, 
size_t
 *, *, size_t);

459 
UÆšk
(const *);

460 
pid_t
 
Wa™
(*);

461 
pid_t
 
Wa™pid
(pid_t, *, );

462 
Wr™e
(, *, 
size_t
);

465 
Fşo£
(
FILE
 *);

466 
FILE
 *
Fdİ’
(, const *);

467 *
Fg‘s
(*, , 
FILE
 *);

468 
FILE
 *
Fİ’
(const *, const *);

469 
Fputs
(cÚ¡ *, 
FILE
 *);

472 
Acû±
(, 
SA
 *, 
sockËn_t
 *);

473 
Bšd
(, cÚ¡ 
SA
 *, 
sockËn_t
);

474 
CÚÃù
(, cÚ¡ 
SA
 *, 
sockËn_t
);

475 
G‘³”Çme
(, 
SA
 *, 
sockËn_t
 *);

476 
G‘sockÇme
(, 
SA
 *, 
sockËn_t
 *);

477 
G‘sockİt
(, , , *, 
sockËn_t
 *);

478 #ifdef 
HAVE_INET6_RTH_INIT


479 
IÃt6_¹h_¥aû
(, );

480 *
IÃt6_¹h_š™
(*, 
sockËn_t
, , );

481 
IÃt6_¹h_add
(*, cÚ¡ 
š6_addr
 *);

482 
IÃt6_¹h_»v”£
(const *, *);

483 
IÃt6_¹h_£gm’ts
(const *);

484 
š6_addr
 *
IÃt6_¹h_g‘addr
(const *, );

486 #ifdef 
HAVE_KQUEUE


487 
Kqueue
();

488 
Kev’t
(, cÚ¡ 
kev’t
 *, ,

489 
kev’t
 *, , cÚ¡ 
time¥ec
 *);

491 
Li¡’
(, );

492 #ifdef 
HAVE_POLL


493 
PŞl
(
pŞlfd
 *, , );

495 
ssize_t
 
R—dlše
(, *, 
size_t
);

496 
ssize_t
 
R—dn
(, *, 
size_t
);

497 
ssize_t
 
Recv
(, *, 
size_t
, );

498 
ssize_t
 
Recväom
(, *, 
size_t
, , 
SA
 *, 
sockËn_t
 *);

499 
ssize_t
 
Recvmsg
(, 
msghdr
 *, );

500 
S–eù
(, 
fd_£t
 *, fd_£ˆ*, fd_£ˆ*, 
timev®
 *);

501 
S’d
(, cÚ¡ *, 
size_t
, );

502 
S’dto
(, cÚ¡ *, 
size_t
, , cÚ¡ 
SA
 *, 
sockËn_t
);

503 
S’dmsg
(, cÚ¡ 
msghdr
 *, );

504 
S‘sockİt
(, , , cÚ¡ *, 
sockËn_t
);

505 
Shutdown
(, );

506 
Sock©m¬k
();

507 
Sock‘
(, , );

508 
Sock‘·œ
(, , , *);

509 
Wr™’
(, *, 
size_t
);

511 
”r_dump
(const *, ...);

512 
”r_msg
(const *, ...);

513 
”r_qu™
(const *, ...);

514 
”r_»t
(const *, ...);

515 
”r_sys
(const *, ...);

	@osi\unpv13e\unpv13e\lib\unpifi.h

4 #iâdef 
__uÅ_ifi_h


5 
	#__uÅ_ifi_h


	)

7 
	~"uÅ.h
"

8 
	~<Ãt/if.h
>

10 
	#IFI_NAME
 16

	)

11 
	#IFI_HADDR
 8

	)

13 
	sifi_šfo
 {

14 
	mifi_Çme
[
IFI_NAME
];

15 
	mifi_šdex
;

16 
	mifi_mtu
;

17 
u_ch¬
 
	mifi_haddr
[
IFI_HADDR
];

18 
u_shÜt
 
	mifi_hËn
;

19 
	mifi_æags
;

20 
	mifi_myæags
;

21 
sockaddr
 *
	mifi_addr
;

22 
sockaddr
 *
	mifi_brdaddr
;

23 
sockaddr
 *
	mifi_d¡addr
;

24 
ifi_šfo
 *
	mifi_Ãxt
;

27 
	#IFI_ALIAS
 1

	)

30 
ifi_šfo
 *
g‘_ifi_šfo
(, );

31 
ifi_šfo
 *
G‘_ifi_šfo
(, );

32 
ä“_ifi_šfo
(
ifi_šfo
 *);

	@osi\unpv13e\unpv13e\lib\unprtt.h

1 #iâdef 
__uÅ_¹t_h


2 
	#__uÅ_¹t_h


	)

4 
	~"uÅ.h
"

6 
	s¹t_šfo
 {

7 
	m¹t_¹t
;

8 
	m¹t_¤‰
;

9 
	m¹t_¹tv¬
;

10 
	m¹t_¹o
;

11 
	m¹t_Äexmt
;

12 
ušt32_t
 
	m¹t_ba£
;

15 
	#RTT_RXTMIN
 2

	)

16 
	#RTT_RXTMAX
 60

	)

17 
	#RTT_MAXNREXMT
 3

	)

20 
¹t_debug
(
¹t_šfo
 *);

21 
¹t_š™
(
¹t_šfo
 *);

22 
¹t_Ãw·ck
(
¹t_šfo
 *);

23 
¹t_¡¬t
(
¹t_šfo
 *);

24 
¹t_¡İ
(
¹t_šfo
 *, 
ušt32_t
);

25 
¹t_timeout
(
¹t_šfo
 *);

26 
ušt32_t
 
¹t_ts
(
¹t_šfo
 *);

28 
¹t_d_æag
;

	@osi\unpv13e\unpv13e\lib\unpthread.h

4 #iâdef 
__uÅ_±h»ad_h


5 
	#__uÅ_±h»ad_h


	)

7 
	~"uÅ.h
"

9 
Pth»ad_ü—‹
(
±h»ad_t
 *, cÚ¡ 
±h»ad_©Œ_t
 *,

11 
Pth»ad_još
(
±h»ad_t
, **);

12 
Pth»ad_d‘ach
(
±h»ad_t
);

13 
Pth»ad_kl
(
±h»ad_t
, );

15 
Pth»ad_mu‹x©Œ_š™
(
±h»ad_mu‹x©Œ_t
 *);

16 
Pth»ad_mu‹x©Œ_£sh¬ed
(
±h»ad_mu‹x©Œ_t
 *, );

17 
Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *, 
±h»ad_mu‹x©Œ_t
 *);

18 
Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *);

19 
Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *);

21 
Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *);

22 
Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *);

23 
Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *);

24 
Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *,

25 cÚ¡ 
time¥ec
 *);

27 
Pth»ad_key_ü—‹
(
±h»ad_key_t
 *, (*)(*));

28 
	`Pth»ad_£t¥ecific
(
±h»ad_key_t
, const *);

29 
	`Pth»ad_Úû
(
±h»ad_Úû_t
 *, (*)());

	@osi\unpv13e\unpv13e\lib\wraplib.c

6 
	~"uÅ.h
"

9 
	$IÃt_Áİ
(
çmy
, cÚ¡ *
add½Œ
, *
¡½Œ
, 
size_t
 
Ën
)

11 cÚ¡ *
±r
;

13 ià(
¡½Œ
 =ğ
NULL
)

14 
	`”r_qu™
("NULL 3rd‡rgumento inet_ntop");

15 iàĞ(
±r
 = 
	`š‘_Áİ
(
çmy
, 
add½Œ
, 
¡½Œ
, 
Ën
)è=ğ
NULL
)

16 
	`”r_sys
("inet_ntopƒrror");

17 (
±r
);

18 
	}
}

21 
	$IÃt_±Ú
(
çmy
, cÚ¡ *
¡½Œ
, *
add½Œ
)

23 
n
;

25 iàĞ(
n
 = 
	`š‘_±Ú
(
çmy
, 
¡½Œ
, 
add½Œ
)) < 0)

26 
	`”r_sys
("š‘_±Úƒ¼Ü fÜ %s", 
¡½Œ
);

27 ià(
n
 == 0)

28 
	`”r_qu™
("š‘_±Úƒ¼Ü fÜ %s", 
¡½Œ
);

31 
	}
}

	@osi\unpv13e\unpv13e\lib\wrappthread.c

5 
	~"uÅ.h
"

6 
	~"uÅth»ad.h
"

9 
Pth»ad_ü—‹
(
±h»ad_t
 *
tid
, cÚ¡ 
±h»ad_©Œ_t
 *
©Œ
,

10 * (*
func
)(*), *
¬g
)

12 
	gn
;

14 iàĞ(
	gn
 = 
±h»ad_ü—‹
(
tid
, 
©Œ
, 
func
, 
¬g
)) == 0)

16 
	g”ºo
 = 
n
;

17 
”r_sys
("pthread_createƒrror");

21 
	$Pth»ad_još
(
±h»ad_t
 
tid
, **
¡©us
)

23 
n
;

25 iàĞ(
n
 = 
	`±h»ad_još
(
tid
, 
¡©us
)) == 0)

27 
”ºo
 = 
n
;

28 
	`”r_sys
("pthread_joinƒrror");

29 
	}
}

32 
	$Pth»ad_d‘ach
(
±h»ad_t
 
tid
)

34 
n
;

36 iàĞ(
n
 = 
	`±h»ad_d‘ach
(
tid
)) == 0)

38 
”ºo
 = 
n
;

39 
	`”r_sys
("pthread_detachƒrror");

40 
	}
}

43 
	$Pth»ad_kl
(
±h»ad_t
 
tid
, 
signo
)

45 
n
;

47 iàĞ(
n
 = 
	`±h»ad_kl
(
tid
, 
signo
)) == 0)

49 
”ºo
 = 
n
;

50 
	`”r_sys
("pthread_killƒrror");

51 
	}
}

54 
	$Pth»ad_mu‹x©Œ_š™
(
±h»ad_mu‹x©Œ_t
 *
©Œ
)

56 
n
;

58 iàĞ(
n
 = 
	`±h»ad_mu‹x©Œ_š™
(
©Œ
)) == 0)

60 
”ºo
 = 
n
;

61 
	`”r_sys
("pthread_mutexattr_initƒrror");

62 
	}
}

64 #ifdef 
_POSIX_THREAD_PROCESS_SHARED


66 
	$Pth»ad_mu‹x©Œ_£sh¬ed
(
±h»ad_mu‹x©Œ_t
 *
©Œ
, 
æag
)

68 
n
;

70 iàĞ(
n
 = 
	`±h»ad_mu‹x©Œ_£sh¬ed
(
©Œ
, 
æag
)) == 0)

72 
”ºo
 = 
n
;

73 
	`”r_sys
("pthread_mutexattr_setpsharedƒrror");

74 
	}
}

78 
	$Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *
m±r
, 
±h»ad_mu‹x©Œ_t
 *
©Œ
)

80 
n
;

82 iàĞ(
n
 = 
	`±h»ad_mu‹x_š™
(
m±r
, 
©Œ
)) == 0)

84 
”ºo
 = 
n
;

85 
	`”r_sys
("pthread_mutex_initƒrror");

86 
	}
}

90 
	$Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *
m±r
)

92 
n
;

94 iàĞ(
n
 = 
	`±h»ad_mu‹x_lock
(
m±r
)) == 0)

96 
”ºo
 = 
n
;

97 
	`”r_sys
("pthread_mutex_lockƒrror");

98 
	}
}

102 
	$Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *
m±r
)

104 
n
;

106 iàĞ(
n
 = 
	`±h»ad_mu‹x_uÆock
(
m±r
)) == 0)

108 
”ºo
 = 
n
;

109 
	`”r_sys
("pthread_mutex_unlockƒrror");

110 
	}
}

113 
	$Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *
ıŒ
)

115 
n
;

117 iàĞ(
n
 = 
	`±h»ad_cÚd_brßdÿ¡
(
ıŒ
)) == 0)

119 
”ºo
 = 
n
;

120 
	`”r_sys
("pthread_cond_broadcastƒrror");

121 
	}
}

124 
	$Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *
ıŒ
)

126 
n
;

128 iàĞ(
n
 = 
	`±h»ad_cÚd_sigÇl
(
ıŒ
)) == 0)

130 
”ºo
 = 
n
;

131 
	`”r_sys
("pthread_cond_signalƒrror");

132 
	}
}

135 
	$Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *
ıŒ
, 
±h»ad_mu‹x_t
 *
m±r
)

137 
n
;

139 iàĞ(
n
 = 
	`±h»ad_cÚd_wa™
(
ıŒ
, 
m±r
)) == 0)

141 
”ºo
 = 
n
;

142 
	`”r_sys
("pthread_cond_waitƒrror");

143 
	}
}

146 
	$Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *
ıŒ
, 
±h»ad_mu‹x_t
 *
m±r
,

147 cÚ¡ 
time¥ec
 *
t¥Œ
)

149 
n
;

151 iàĞ(
n
 = 
	`±h»ad_cÚd_timedwa™
(
ıŒ
, 
m±r
, 
t¥Œ
)) == 0)

153 
”ºo
 = 
n
;

154 
	`”r_sys
("pthread_cond_timedwaitƒrror");

155 
	}
}

158 
Pth»ad_Úû
(
±h»ad_Úû_t
 *
±r
, (*
func
)())

160 
n
;

162 iàĞ(
n
 = 
	`±h»ad_Úû
(
±r
, 
func
)) == 0)

164 
”ºo
 = 
n
;

165 
	`”r_sys
("pthread_onceƒrror");

166 
	}
}

169 
Pth»ad_key_ü—‹
(
±h»ad_key_t
 *
key
, (*
func
)(*))

171 
n
;

173 iàĞ(
n
 = 
	`±h»ad_key_ü—‹
(
key
, 
func
)) == 0)

175 
”ºo
 = 
n
;

176 
	`”r_sys
("pthread_key_createƒrror");

177 
	}
}

180 
	$Pth»ad_£t¥ecific
(
±h»ad_key_t
 
key
, cÚ¡ *
v®ue
)

182 
n
;

184 iàĞ(
n
 = 
	`±h»ad_£t¥ecific
(
key
, 
v®ue
)) == 0)

186 
”ºo
 = 
n
;

187 
	`”r_sys
("pthread_setspecificƒrror");

188 
	}
}

	@osi\unpv13e\unpv13e\lib\wrapsock.c

19 
	~"uÅ.h
"

22 
	$Acû±
(
fd
, 
sockaddr
 *
§
, 
sockËn_t
 *
§ËÅŒ
)

24 
n
;

26 
agaš
:

27 iàĞ(
n
 = 
	`acû±
(
fd
, 
§
, 
§ËÅŒ
)) < 0) {

28 #ifdef 
EPROTO


29 ià(
”ºo
 =ğ
EPROTO
 ||ƒ¼nØ=ğ
ECONNABORTED
)

31 ià(
”ºo
 =ğ
ECONNABORTED
)

33 
agaš
;

35 
	`”r_sys
("acceptƒrror");

37 (
n
);

38 
	}
}

41 
	$Bšd
(
fd
, cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

43 ià(
	`bšd
(
fd
, 
§
, 
§Ën
) < 0)

44 
	`”r_sys
("bindƒrror");

45 
	}
}

48 
	$CÚÃù
(
fd
, cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

50 ià(
	`cÚÃù
(
fd
, 
§
, 
§Ën
) < 0)

51 
	`”r_sys
("connectƒrror");

52 
	}
}

55 
	$G‘³”Çme
(
fd
, 
sockaddr
 *
§
, 
sockËn_t
 *
§ËÅŒ
)

57 ià(
	`g‘³”Çme
(
fd
, 
§
, 
§ËÅŒ
) < 0)

58 
	`”r_sys
("getpeernameƒrror");

59 
	}
}

62 
	$G‘sockÇme
(
fd
, 
sockaddr
 *
§
, 
sockËn_t
 *
§ËÅŒ
)

64 ià(
	`g‘sockÇme
(
fd
, 
§
, 
§ËÅŒ
) < 0)

65 
	`”r_sys
("getsocknameƒrror");

66 
	}
}

69 
	$G‘sockİt
(
fd
, 
Ëv–
, 
İŠame
, *
İtv®
, 
sockËn_t
 *
İ’±r
)

71 ià(
	`g‘sockİt
(
fd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’±r
) < 0)

72 
	`”r_sys
("getsockoptƒrror");

73 
	}
}

75 #ifdef 
HAVE_INET6_RTH_INIT


77 
	$IÃt6_¹h_¥aû
(
ty³
, 
£gm’ts
)

79 
»t
;

81 
»t
 = 
	`š‘6_¹h_¥aû
(
ty³
, 
£gm’ts
);

82 ià(
»t
 < 0)

83 
	`”r_qu™
("inet6_rth_spaceƒrror");

85  
»t
;

86 
	}
}

89 
	$IÃt6_¹h_š™
(*
¹hbuf
, 
sockËn_t
 
¹hËn
, 
ty³
, 
£gm’ts
)

91 *
»t
;

93 
»t
 = 
	`š‘6_¹h_š™
(
¹hbuf
, 
¹hËn
, 
ty³
, 
£gm’ts
);

94 ià(
»t
 =ğ
NULL
)

95 
	`”r_qu™
("inet6_rth_initƒrror");

97  
»t
;

98 
	}
}

101 
	$IÃt6_¹h_add
(*
¹hbuf
, cÚ¡ 
š6_addr
 *
addr
)

103 ià(
	`š‘6_¹h_add
(
¹hbuf
, 
addr
) < 0)

104 
	`”r_qu™
("inet6_rth_addƒrror");

105 
	}
}

108 
	$IÃt6_¹h_»v”£
(cÚ¡ *
š
, *
out
)

110 ià(
	`š‘6_¹h_»v”£
(
š
, 
out
) < 0)

111 
	`”r_qu™
("inet6_rth_reverseƒrror");

112 
	}
}

115 
	$IÃt6_¹h_£gm’ts
(cÚ¡ *
¹hbuf
)

117 
»t
;

119 
»t
 = 
	`š‘6_¹h_£gm’ts
(
¹hbuf
);

120 ià(
»t
 < 0)

121 
	`”r_qu™
("inet6_rth_segmentsƒrror");

123  
»t
;

124 
	}
}

126 
š6_addr
 *

127 
	$IÃt6_¹h_g‘addr
(cÚ¡ *
¹hbuf
, 
idx
)

129 
š6_addr
 *
»t
;

131 
»t
 = 
	`š‘6_¹h_g‘addr
(
¹hbuf
, 
idx
);

132 ià(
»t
 =ğ
NULL
)

133 
	`”r_qu™
("inet6_rth_getaddrƒrror");

135  
»t
;

136 
	}
}

139 #ifdeà
HAVE_KQUEUE


141 
	$Kqueue
()

143 
»t
;

145 ià((
»t
 = 
	`kqueue
()) < 0)

146 
	`”r_sys
("kqueueƒrror");

147  
»t
;

148 
	}
}

151 
	$Kev’t
(
kq
, cÚ¡ 
kev’t
 *
chªg–i¡
, 
nchªges
,

152 
kev’t
 *
ev’i¡
, 
Ãv’ts
, cÚ¡ 
time¥ec
 *
timeout
)

154 
»t
;

156 ià((
»t
 = 
	`kev’t
(
kq
, 
chªg–i¡
, 
nchªges
,

157 
ev’i¡
, 
Ãv’ts
, 
timeout
)) < 0)

158 
	`”r_sys
("keventƒrror");

159  
»t
;

160 
	}
}

166 
	$Li¡’
(
fd
, 
backlog
)

168 *
±r
;

171 iàĞ(
±r
 = 
	`g‘’v
("LISTENQ")è!ğ
NULL
)

172 
backlog
 = 
	`©oi
(
±r
);

174 ià(
	`li¡’
(
fd
, 
backlog
) < 0)

175 
	`”r_sys
("listenƒrror");

176 
	}
}

179 #ifdef 
HAVE_POLL


181 
	$PŞl
(
pŞlfd
 *
fd¬¿y
, 
nfds
, 
timeout
)

183 
n
;

185 iàĞ(
n
 = 
	`pŞl
(
fd¬¿y
, 
nfds
, 
timeout
)) < 0)

186 
	`”r_sys
("pollƒrror");

188 (
n
);

189 
	}
}

192 
ssize_t


193 
	$Recv
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
æags
)

195 
ssize_t
 
n
;

197 iàĞ(
n
 = 
	`»cv
(
fd
, 
±r
, 
nby‹s
, 
æags
)) < 0)

198 
	`”r_sys
("recvƒrror");

199 (
n
);

200 
	}
}

202 
ssize_t


203 
	$Recväom
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
æags
,

204 
sockaddr
 *
§
, 
sockËn_t
 *
§ËÅŒ
)

206 
ssize_t
 
n
;

208 iàĞ(
n
 = 
	`»cväom
(
fd
, 
±r
, 
nby‹s
, 
æags
, 
§
, 
§ËÅŒ
)) < 0)

209 
	`”r_sys
("recvfromƒrror");

210 (
n
);

211 
	}
}

213 
ssize_t


214 
	$Recvmsg
(
fd
, 
msghdr
 *
msg
, 
æags
)

216 
ssize_t
 
n
;

218 iàĞ(
n
 = 
	`»cvmsg
(
fd
, 
msg
, 
æags
)) < 0)

219 
	`”r_sys
("recvmsgƒrror");

220 (
n
);

221 
	}
}

224 
	$S–eù
(
nfds
, 
fd_£t
 *
»adfds
, fd_£ˆ*
wr™efds
, fd_£ˆ*
exû±fds
,

225 
timev®
 *
timeout
)

227 
n
;

229 iàĞ(
n
 = 
	`£Ëù
(
nfds
, 
»adfds
, 
wr™efds
, 
exû±fds
, 
timeout
)) < 0)

230 
	`”r_sys
("selectƒrror");

231 (
n
);

232 
	}
}

235 
	$S’d
(
fd
, cÚ¡ *
±r
, 
size_t
 
nby‹s
, 
æags
)

237 ià(
	`£nd
(
fd
, 
±r
, 
nby‹s
, 
æags
è!ğ(
ssize_t
)nbytes)

238 
	`”r_sys
("sendƒrror");

239 
	}
}

242 
	$S’dto
(
fd
, cÚ¡ *
±r
, 
size_t
 
nby‹s
, 
æags
,

243 cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

245 ià(
	`£ndto
(
fd
, 
±r
, 
nby‹s
, 
æags
, 
§
, 
§Ën
è!ğ(
ssize_t
)nbytes)

246 
	`”r_sys
("sendtoƒrror");

247 
	}
}

250 
	$S’dmsg
(
fd
, cÚ¡ 
msghdr
 *
msg
, 
æags
)

252 
i
;

253 
ssize_t
 
nby‹s
;

255 
nby‹s
 = 0;

256 
i
 = 0; i < 
msg
->
msg_iovËn
; i++)

257 
nby‹s
 +ğ
msg
->
msg_iov
[
i
].
iov_Ën
;

259 ià(
	`£ndmsg
(
fd
, 
msg
, 
æags
è!ğ
nby‹s
)

260 
	`”r_sys
("sendmsgƒrror");

261 
	}
}

264 
	$S‘sockİt
(
fd
, 
Ëv–
, 
İŠame
, cÚ¡ *
İtv®
, 
sockËn_t
 
İ’
)

266 ià(
	`£tsockİt
(
fd
, 
Ëv–
, 
İŠame
, 
İtv®
, 
İ’
) < 0)

267 
	`”r_sys
("setsockoptƒrror");

268 
	}
}

271 
	$Shutdown
(
fd
, 
how
)

273 ià(
	`shutdown
(
fd
, 
how
) < 0)

274 
	`”r_sys
("shutdownƒrror");

275 
	}
}

278 
	$Sock©m¬k
(
fd
)

280 
n
;

282 iàĞ(
n
 = 
	`sock©m¬k
(
fd
)) < 0)

283 
	`”r_sys
("sockatmarkƒrror");

284 (
n
);

285 
	}
}

289 
	$Sock‘
(
çmy
, 
ty³
, 
´ÙocŞ
)

291 
n
;

293 iàĞ(
n
 = 
	`sock‘
(
çmy
, 
ty³
, 
´ÙocŞ
)) < 0)

294 
	`”r_sys
("socketƒrror");

295 (
n
);

296 
	}
}

300 
	$Sock‘·œ
(
çmy
, 
ty³
, 
´ÙocŞ
, *
fd
)

302 
n
;

304 iàĞ(
n
 = 
	`sock‘·œ
(
çmy
, 
ty³
, 
´ÙocŞ
, 
fd
)) < 0)

305 
	`”r_sys
("socketpairƒrror");

306 
	}
}

	@osi\unpv13e\unpv13e\lib\wrapstdio.c

5 
	~"uÅ.h
"

8 
	$Fşo£
(
FILE
 *
å
)

10 ià(
	`fşo£
(
å
) != 0)

11 
	`”r_sys
("fcloseƒrror");

12 
	}
}

14 
FILE
 *

15 
	$Fdİ’
(
fd
, cÚ¡ *
ty³
)

17 
FILE
 *
å
;

19 iàĞ(
å
 = 
	`fdİ’
(
fd
, 
ty³
)è=ğ
NULL
)

20 
	`”r_sys
("fdopenƒrror");

22 (
å
);

23 
	}
}

26 
	$Fg‘s
(*
±r
, 
n
, 
FILE
 *
¡»am
)

28 *
½Œ
;

30 iàĞ(
½Œ
 = 
	`fg‘s
(
±r
, 
n
, 
¡»am
)è=ğ
NULL
 && 
	`ã¼Ü
(stream))

31 
	`”r_sys
("fgetsƒrror");

33  (
½Œ
);

34 
	}
}

36 
FILE
 *

37 
	$Fİ’
(cÚ¡ *
f’ame
, cÚ¡ *
mode
)

39 
FILE
 *
å
;

41 iàĞ(
å
 = 
	`fİ’
(
f’ame
, 
mode
)è=ğ
NULL
)

42 
	`”r_sys
("fopenƒrror");

44 (
å
);

45 
	}
}

48 
	$Fputs
(cÚ¡ *
±r
, 
FILE
 *
¡»am
)

50 ià(
	`åuts
(
±r
, 
¡»am
è=ğ
EOF
)

51 
	`”r_sys
("fputsƒrror");

52 
	}
}

	@osi\unpv13e\unpv13e\lib\wrapunix.c

19 
	~"uÅ.h
"

22 
	$C®loc
(
size_t
 
n
, size_ˆ
size
)

24 *
±r
;

26 iàĞ(
±r
 = 
	`ÿÎoc
(
n
, 
size
)è=ğ
NULL
)

27 
	`”r_sys
("callocƒrror");

28 (
±r
);

29 
	}
}

32 
	$Clo£
(
fd
)

34 ià(
	`şo£
(
fd
) == -1)

35 
	`”r_sys
("closeƒrror");

36 
	}
}

39 
	$Dup2
(
fd1
, 
fd2
)

41 ià(
	`dup2
(
fd1
, 
fd2
) == -1)

42 
	`”r_sys
("dup2ƒrror");

43 
	}
}

46 
	$Fú
(
fd
, 
cmd
, 
¬g
)

48 
n
;

50 iàĞ(
n
 = 
	`fú
(
fd
, 
cmd
, 
¬g
)) == -1)

51 
	`”r_sys
("fcntlƒrror");

52 (
n
);

53 
	}
}

56 
	$G‘timeofday
(
timev®
 *
tv
, *
foo
)

58 ià(
	`g‘timeofday
(
tv
, 
foo
) == -1)

59 
	`”r_sys
("gettimeofdayƒrror");

61 
	}
}

64 
	$Ioùl
(
fd
, 
»que¡
, *
¬g
)

66 
n
;

68 iàĞ(
n
 = 
	`ioùl
(
fd
, 
»que¡
, 
¬g
)) == -1)

69 
	`”r_sys
("ioctlƒrror");

70 (
n
);

71 
	}
}

73 
pid_t


74 
	$FÜk
()

76 
pid_t
 
pid
;

78 iàĞ(
pid
 = 
	`fÜk
()) == -1)

79 
	`”r_sys
("forkƒrror");

80 (
pid
);

81 
	}
}

84 
	$M®loc
(
size_t
 
size
)

86 *
±r
;

88 iàĞ(
±r
 = 
	`m®loc
(
size
)è=ğ
NULL
)

89 
	`”r_sys
("mallocƒrror");

90 (
±r
);

91 
	}
}

94 
	$Mk¡emp
(*
‹m¶©e
)

96 
i
;

98 #ifdeà
HAVE_MKSTEMP


99 ià((
i
 = 
	`mk¡emp
(
‹m¶©e
)) < 0)

100 
	`”r_qu™
("mkstempƒrror");

102 ià(
	`mk‹mp
(
‹m¶©e
è=ğ
NULL
 ||emplate[0] == 0)

103 
	`”r_qu™
("mktempƒrror");

104 
i
 = 
	`O³n
(
‹m¶©e
, 
O_CREAT
 | 
O_WRONLY
, 
FILE_MODE
);

107  
i
;

108 
	}
}

110 
	~<sys/mmª.h
>

113 
	$Mm­
(*
addr
, 
size_t
 
Ën
, 
´Ù
, 
æags
, 
fd
, 
off_t
 
off£t
)

115 *
±r
;

117 iàĞ(
±r
 = 
	`mm­
(
addr
, 
Ën
, 
´Ù
, 
æags
, 
fd
, 
off£t
)) == ((*) -1))

118 
	`”r_sys
("mmapƒrror");

119 (
±r
);

120 
	}
}

123 
	$O³n
(cÚ¡ *
·thÇme
, 
oæag
, 
mode_t
 
mode
)

125 
fd
;

127 iàĞ(
fd
 = 
	`İ’
(
·thÇme
, 
oæag
, 
mode
)) == -1)

128 
	`”r_sys
("İ’ƒ¼Ü fÜ %s", 
·thÇme
);

129 (
fd
);

130 
	}
}

133 
	$Pe
(*
fds
)

135 ià(
	`pe
(
fds
) < 0)

136 
	`”r_sys
("pipeƒrror");

137 
	}
}

139 
ssize_t


140 
	$R—d
(
fd
, *
±r
, 
size_t
 
nby‹s
)

142 
ssize_t
 
n
;

144 iàĞ(
n
 = 
	`»ad
(
fd
, 
±r
, 
nby‹s
)) == -1)

145 
	`”r_sys
("readƒrror");

146 (
n
);

147 
	}
}

150 
	$Sigadd£t
(
sig£t_t
 *
£t
, 
signo
)

152 ià(
	`sigadd£t
(
£t
, 
signo
) == -1)

153 
	`”r_sys
("sigaddsetƒrror");

154 
	}
}

157 
	$Sigd–£t
(
sig£t_t
 *
£t
, 
signo
)

159 ià(
	`sigd–£t
(
£t
, 
signo
) == -1)

160 
	`”r_sys
("sigdelsetƒrror");

161 
	}
}

164 
	$Sigem±y£t
(
sig£t_t
 *
£t
)

166 ià(
	`sigem±y£t
(
£t
) == -1)

167 
	`”r_sys
("sigemptysetƒrror");

168 
	}
}

171 
	$Sigfl£t
(
sig£t_t
 *
£t
)

173 ià(
	`sigfl£t
(
£t
) == -1)

174 
	`”r_sys
("sigfillsetƒrror");

175 
	}
}

178 
	$Sigismemb”
(cÚ¡ 
sig£t_t
 *
£t
, 
signo
)

180 
n
;

182 iàĞ(
n
 = 
	`sigismemb”
(
£t
, 
signo
)) == -1)

183 
	`”r_sys
("sigismemberƒrror");

184 (
n
);

185 
	}
}

188 
	$Sig³ndšg
(
sig£t_t
 *
£t
)

190 ià(
	`sig³ndšg
(
£t
) == -1)

191 
	`”r_sys
("sigpendingƒrror");

192 
	}
}

195 
	$Sig´ocmask
(
how
, cÚ¡ 
sig£t_t
 *
£t
, sig£t_ˆ*
o£t
)

197 ià(
	`sig´ocmask
(
how
, 
£t
, 
o£t
) == -1)

198 
	`”r_sys
("sigprocmaskƒrror");

199 
	}
}

202 
	$SŒdup
(cÚ¡ *
¡r
)

204 *
±r
;

206 iàĞ(
±r
 = 
	`¡rdup
(
¡r
)è=ğ
NULL
)

207 
	`”r_sys
("strdupƒrror");

208 (
±r
);

209 
	}
}

212 
	$SyscÚf
(
Çme
)

214 
v®
;

216 
”ºo
 = 0;

217 iàĞ(
v®
 = 
	`syscÚf
(
Çme
)) == -1)

218 
	`”r_sys
("sysconfƒrror");

219 (
v®
);

220 
	}
}

222 #ifdef 
HAVE_SYS_SYSCTL_H


224 
	$Sysùl
(*
Çme
, 
u_št
 
Çm–’
, *
Şdp
, 
size_t
 *
ŞdËÅ
,

225 *
Ãwp
, 
size_t
 
ÃwËn
)

227 ià(
	`sysùl
(
Çme
, 
Çm–’
, 
Şdp
, 
ŞdËÅ
, 
Ãwp
, 
ÃwËn
) == -1)

228 
	`”r_sys
("sysctlƒrror");

229 
	}
}

233 
	$UÆšk
(cÚ¡ *
·thÇme
)

235 ià(
	`uÆšk
(
·thÇme
) == -1)

236 
	`”r_sys
("uÆškƒ¼Ü fÜ %s", 
·thÇme
);

237 
	}
}

239 
pid_t


240 
	$Wa™
(*
Œ
)

242 
pid_t
 
pid
;

244 iàĞ(
pid
 = 
	`wa™
(
Œ
)) == -1)

245 
	`”r_sys
("waitƒrror");

246 (
pid
);

247 
	}
}

249 
pid_t


250 
	$Wa™pid
(
pid_t
 
pid
, *
Œ
, 
İtiÚs
)

252 
pid_t
 
»id
;

254 iàĞ(
»id
 = 
	`wa™pid
(
pid
, 
Œ
, 
İtiÚs
)) == -1)

255 
	`”r_sys
("waitpidƒrror");

256 (
»id
);

257 
	}
}

260 
	$Wr™e
(
fd
, *
±r
, 
size_t
 
nby‹s
)

262 ià(
	`wr™e
(
fd
, 
±r
, 
nby‹s
) !=‚bytes)

263 
	`”r_sys
("writeƒrror");

264 
	}
}

	@osi\unpv13e\unpv13e\lib\writable_timeo.c

2 
	~"uÅ.h
"

5 
	$wr™abË_timeo
(
fd
, 
£c
)

7 
fd_£t
 
w£t
;

8 
timev®
 
tv
;

10 
	`FD_ZERO
(&
w£t
);

11 
	`FD_SET
(
fd
, &
w£t
);

13 
tv
.
tv_£c
 = 
£c
;

14 
tv
.
tv_u£c
 = 0;

16 (
	`£Ëù
(
fd
+1, 
NULL
, &
w£t
, NULL, &
tv
));

18 
	}
}

22 
	$Wr™abË_timeo
(
fd
, 
£c
)

24 
n
;

26 iàĞ(
n
 = 
	`wr™abË_timeo
(
fd
, 
£c
)) < 0)

27 
	`”r_sys
("writable_timeoƒrror");

28 (
n
);

29 
	}
}

	@osi\unpv13e\unpv13e\lib\write_fd.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$wr™e_fd
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
£ndfd
)

7 
msghdr
 
msg
;

8 
iovec
 
iov
[1];

10 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


12 
cmsghdr
 
cm
;

13 
cÚŒŞ
[
	`CMSG_SPACE
(())];

14 } 
cÚŒŞ_un
;

15 
cmsghdr
 *
cm±r
;

17 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ_un
.
cÚŒŞ
;

18 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ_un
.
cÚŒŞ
);

20 
cm±r
 = 
	`CMSG_FIRSTHDR
(&
msg
);

21 
cm±r
->
cmsg_Ën
 = 
	`CMSG_LEN
(());

22 
cm±r
->
cmsg_Ëv–
 = 
SOL_SOCKET
;

23 
cm±r
->
cmsg_ty³
 = 
SCM_RIGHTS
;

24 *((*è
	`CMSG_DATA
(
cm±r
)èğ
£ndfd
;

26 
msg
.
msg_acüights
 = (
ÿddr_t
è&
£ndfd
;

27 
msg
.
msg_acüight¦’
 = ();

30 
msg
.
msg_Çme
 = 
NULL
;

31 
msg
.
msg_Çm–’
 = 0;

33 
iov
[0].
iov_ba£
 = 
±r
;

34 
iov
[0].
iov_Ën
 = 
nby‹s
;

35 
msg
.
msg_iov
 = 
iov
;

36 
msg
.
msg_iovËn
 = 1;

38 (
	`£ndmsg
(
fd
, &
msg
, 0));

39 
	}
}

42 
ssize_t


43 
	$Wr™e_fd
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
£ndfd
)

45 
ssize_t
 
n
;

47 iàĞ(
n
 = 
	`wr™e_fd
(
fd
, 
±r
, 
nby‹s
, 
£ndfd
)) < 0)

48 
	`”r_sys
("write_fdƒrror");

50 (
n
);

51 
	}
}

	@osi\unpv13e\unpv13e\lib\writen.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$wr™’
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
)

7 
size_t
 
Æeá
;

8 
ssize_t
 
nwr™‹n
;

9 cÚ¡ *
±r
;

11 
±r
 = 
v±r
;

12 
Æeá
 = 
n
;

13 
Æeá
 > 0) {

14 iàĞ(
nwr™‹n
 = 
	`wr™e
(
fd
, 
±r
, 
Æeá
)) <= 0) {

15 ià(
nwr™‹n
 < 0 && 
”ºo
 =ğ
EINTR
)

16 
nwr™‹n
 = 0;

21 
Æeá
 -ğ
nwr™‹n
;

22 
±r
 +ğ
nwr™‹n
;

24 (
n
);

25 
	}
}

29 
	$Wr™’
(
fd
, *
±r
, 
size_t
 
nby‹s
)

31 ià(
	`wr™’
(
fd
, 
±r
, 
nby‹s
) !=‚bytes)

32 
	`”r_sys
("writenƒrror");

33 
	}
}

	@osi\unpv13e\unpv13e\libfree\addrinfo.h

1 #iâdef 
__addršfo_h


2 
	#__addršfo_h


	)

10 
	saddršfo
 {

11 
	mai_æags
;

12 
	mai_çmy
;

13 
	mai_sockty³
;

14 
	mai_´ÙocŞ
;

15 
size_t
 
	mai_add¾’
;

16 *
	mai_ÿnÚÇme
;

17 
sockaddr
 *
	mai_addr
;

18 
addršfo
 *
	mai_Ãxt
;

22 
	#AI_PASSIVE
 1

	)

23 
	#AI_CANONNAME
 2

	)

26 
	#NI_MAXHOST
 1025

	)

27 
	#NI_MAXSERV
 32

	)

29 
	#NI_NOFQDN
 1

	)

30 
	#NI_NUMERICHOST
 2

	)

31 
	#NI_NAMEREQD
 4

	)

32 
	#NI_NUMERICSERV
 8

	)

33 
	#NI_DGRAM
 16

	)

36 
	#EAI_ADDRFAMILY
 1

	)

37 
	#EAI_AGAIN
 2

	)

38 
	#EAI_BADFLAGS
 3

	)

39 
	#EAI_FAIL
 4

	)

40 
	#EAI_FAMILY
 5

	)

41 
	#EAI_MEMORY
 6

	)

42 
	#EAI_NODATA
 7

	)

43 
	#EAI_NONAME
 8

	)

44 
	#EAI_SERVICE
 9

	)

45 
	#EAI_SOCKTYPE
 10

	)

46 
	#EAI_SYSTEM
 11

	)

	@osi\unpv13e\unpv13e\libfree\getaddrinfo.c

21 #ifdef 
__osf__


22 
	#_SOCKADDR_LEN


	)

23 
	#INET6


	)

26 
	~<sys/ty³s.h
>

27 
	~<sys/sock‘.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<ùy³.h
>

30 
	~<Ãtdb.h
>

31 
	~<¬·/š‘.h
>

32 
	~<¬·/Çme£r.h
>

33 
	~<»sŞv.h
>

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

36 
	~<uni¡d.h
>

37 
	~<sys/un.h
>

39 #iâdef 
__osf__


40 
	~"addršfo.h
"

52 #ifdef 
AF_INET


53 
	#IPV4


	)

57 #if 
defšed
(
IPV6ADDR_ANY_INIT
)

58 
	#IPV6


	)

59 #–if 
defšed
(
IPV6_FLOWINFO_FLOWLABEL
)

60 
	#IPV6


	)

67 #ifdef 
AF_UNIX


68 
	#LOCAL


	)

70 #iâdef 
AF_LOCAL


71 
	#AF_LOCAL
 
AF_UNIX


	)

73 #iâdef 
PF_LOCAL


74 
	#PF_LOCAL
 
PF_UNIX


	)

113 
š‘_±Ú
(, const *, *);

115 
	#HENTBUFSIZ
 8*1024

	)

116 
	#HENTMAXADDR
 32

	)

119 
	#AI_CLONE
 4

	)

122 
g‘addršfo_ho¡
(cÚ¡ *, 
ho¡’t
 *,

123 
ho¡’t
 **, *, , );

124 
g‘addršfo_£rv
(
addršfo
 *,

125 cÚ¡ 
addršfo
 *, const *,

126 
£rv’t
 *, *, );

127 
g‘addršfo_pÜt
(
addršfo
 *, , );

128 
addršfo_loÿl
(cÚ¡ *, 
addršfo
 *,

129 
addršfo
 **);

130 
addršfo
 *
g‘addršfo_şÚe
(addrinfo *);

134 
addršfo
 
	ghšts_deçuÉ
;

137 
	$g‘addršfo
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
,

138 cÚ¡ 
addršfo
 *
hšt¥Œ
, addršfØ**
»suÉ
)

140 
rc
, 
”rÜ
;

141 
ho¡’t
 *
h±r
, 
h’t
;

142 
£rv’t
 
£Á
;

143 
h’tbuf
[
HENTBUFSIZ
], 
h’t_addr
[
HENTMAXADDR
];

144 *
h’t_®Ÿ£s
[1], *
h’t_addr_li¡
[2];

145 **
­
;

146 
addršfo
 
hšts
, *
ai
, *
aih—d
, **
aÃxt
;

148 #ifdef 
IPV4


149 
sockaddr_š
 *
sš±r
;

152 #ifdef 
IPV6


153 
sockaddr_š6
 *
sš6±r
;

158 
	#”rÜ
(
e
è{ 
”rÜ
 = (e); 
bad
; }

	)

168 ià(
hšt¥Œ
 =ğ
NULL
) {

169 
hšts_deçuÉ
.
ai_çmy
 = 
AF_UNSPEC
;

170 
hšts
 = 
hšts_deçuÉ
;

172 
hšts
 = *
hšt¥Œ
;

177 ià(
hšts
.
ai_æags
 & ~(
AI_PASSIVE
 | 
AI_CANONNAME
))

178 
	`”rÜ
(
EAI_BADFLAGS
);

184 ià(
hšts
.
ai_çmy
 != 0) {

185 
hšts
.
ai_çmy
) {

186 
AF_UNSPEC
: ;

189 #ifdef 
IPV4


190 
AF_INET
:

191 ià(
hšts
.
ai_sockty³
 != 0 &&

192 (
hšts
.
ai_sockty³
 !ğ
SOCK_STREAM
 &&

193 
hšts
.
ai_sockty³
 !ğ
SOCK_DGRAM
 &&

194 
hšts
.
ai_sockty³
 !ğ
SOCK_RAW
))

195 
	`”rÜ
(
EAI_SOCKTYPE
);

198 #ifdef 
IPV6


199 
AF_INET6
:

200 ià(
hšts
.
ai_sockty³
 != 0 &&

201 (
hšts
.
ai_sockty³
 !ğ
SOCK_STREAM
 &&

202 
hšts
.
ai_sockty³
 !ğ
SOCK_DGRAM
 &&

203 
hšts
.
ai_sockty³
 !ğ
SOCK_RAW
))

204 
	`”rÜ
(
EAI_SOCKTYPE
);

207 #ifdef 
LOCAL


208 
AF_LOCAL
:

209 ià(
hšts
.
ai_sockty³
 != 0 &&

210 (
hšts
.
ai_sockty³
 !ğ
SOCK_STREAM
 &&

211 
hšts
.
ai_sockty³
 !ğ
SOCK_DGRAM
))

212 
	`”rÜ
(
EAI_SOCKTYPE
);

216 
	`”rÜ
(
EAI_FAMILY
);

220 ià(
ho¡
 =ğ
NULL
 || host[0] == '\0') {

221 ià(
£rv
 =ğ
NULL
 || serv[0] == '\0')

222 
	`”rÜ
(
EAI_NONAME
);

224 ià(
hšts
.
ai_æags
 & 
AI_PASSIVE
) {

229 
hšts
.
ai_çmy
) {

230 #ifdef 
IPV4


231 
AF_INET
: 
ho¡
 = "0.0.0.0"; ;

233 #ifdef 
IPV6


234 
AF_INET6
: 
ho¡
 = "0::0"; ;

236 #ifdef 
LOCAL


237 
AF_LOCAL
:

238 ià(
£rv
[0] != '/')

239 
	`”rÜ
(
EAI_ADDRFAMILY
);

242 0: 
	`”rÜ
(
EAI_ADDRFAMILY
);

252 
ho¡
 = "localhost";

254 } ià(
hšts
.
ai_çmy
 == 0) {

267 
‹mp
[16];

269 #ifdef 
IPV4


270 ià(
	`š‘_±Ú
(
AF_INET
, 
ho¡
, 
‹mp
) == 1)

271 
hšts
.
ai_çmy
 = 
AF_INET
;

273 #ifdef 
IPV6


274 ià(
	`š‘_±Ú
(
AF_INET6
, 
ho¡
, 
‹mp
) == 1)

275 
hšts
.
ai_çmy
 = 
AF_INET6
;

284 #ifdef 
LOCAL


300 ià((
ho¡
 !ğ
NULL
 && host[0] == '/'))

301 (
	`addršfo_loÿl
(
ho¡
, &
hšts
, 
»suÉ
));

303 ià((
£rv
 !ğ
NULL
 && serv[0] == '/'))

304 (
	`addršfo_loÿl
(
£rv
, &
hšts
, 
»suÉ
));

316 
h’t
.
h_Çme
 = 
h’tbuf
;

317 
h’t
.
h_®Ÿ£s
 = 
h’t_®Ÿ£s
;

318 
h’t_®Ÿ£s
[0] = 
NULL
;

319 
h’t
.
h_addr_li¡
 = 
h’t_addr_li¡
;

320 
h’t_addr_li¡
[0] = 
h’t_addr
;

321 
h’t_addr_li¡
[1] = 
NULL
;

322 
h±r
 = &
h’t
;

324 iàĞ(
rc
 = 
	`g‘addršfo_ho¡
(
ho¡
, &
h’t
, &
h±r
, 
h’tbuf
, 
HENTBUFSIZ
,

325 
hšts
.
ai_çmy
)) != 0)

326 
	`”rÜ
(
rc
);

341 ià(
hšts
.
ai_çmy
 !ğ
AF_UNSPEC
 && hšts.ai_çmy !ğ
h±r
->
h_add¹y³
)

342 
	`”rÜ
(
EAI_ADDRFAMILY
);

350 
aih—d
 = 
NULL
;

351 
aÃxt
 = &
aih—d
;

352 
­
 = 
h±r
->
h_addr_li¡
; *­ !ğ
NULL
;‡p++) {

353 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

354 
	`”rÜ
(
EAI_MEMORY
);

355 *
aÃxt
 = 
ai
;

356 
aÃxt
 = &
ai
->
ai_Ãxt
;

359 iàĞ(
ai
->
ai_sockty³
 = 
hšts
.ai_socktype) == 0)

360 
ai
->
ai_æags
 |ğ
AI_CLONE
;

361 
ai
->
ai_´ÙocŞ
 = 
hšts
.ai_protocol;

363 
ai
->
ai_çmy
 = 
h±r
->
h_add¹y³
;

364 
ai
->
ai_çmy
) {

370 #ifdef 
IPV4


371 
AF_INET
:

372 iàĞ(
sš±r
 = 
	`ÿÎoc
(1, (
sockaddr_š
))è=ğ
NULL
)

373 
	`”rÜ
(
EAI_MEMORY
);

374 #ifdef 
SIN_LEN


375 
sš±r
->
sš_Ën
 = (
sockaddr_š
);

377 
sš±r
->
sš_çmy
 = 
AF_INET
;

378 
	`memıy
(&
sš±r
->
sš_addr
, *
­
, (
š_addr
));

379 
ai
->
ai_addr
 = (
sockaddr
 *è
sš±r
;

380 
ai
->
ai_add¾’
 = (
sockaddr_š
);

384 #ifdef 
IPV6


385 
AF_INET6
:

386 iàĞ(
sš6±r
 = 
	`ÿÎoc
(1, (
sockaddr_š6
))è=ğ
NULL
)

387 
	`”rÜ
(
EAI_MEMORY
);

388 #ifdef 
SIN6_LEN


389 
sš6±r
->
sš6_Ën
 = (
sockaddr_š6
);

391 
sš6±r
->
sš6_çmy
 = 
AF_INET6
;

392 
	`memıy
(&
sš6±r
->
sš6_addr
, *
­
, (
š6_addr
));

393 
ai
->
ai_addr
 = (
sockaddr
 *è
sš6±r
;

394 
ai
->
ai_add¾’
 = (
sockaddr_š6
);

401 ià(
hšts
.
ai_æags
 & 
AI_CANONNAME
) {

407 ià(
h±r
->
h_Çme
 !ğ
NULL
) {

408 iàĞ(
aih—d
->
ai_ÿnÚÇme
 = 
	`¡rdup
(
h±r
->
h_Çme
)è=ğ
NULL
)

409 
	`”rÜ
(
EAI_MEMORY
);

416 iàĞ(
aih—d
->
ai_ÿnÚÇme
 = 
	`¡rdup
(
ho¡
)è=ğ
NULL
)

417 
	`”rÜ
(
EAI_MEMORY
);

424 ià(
£rv
 !ğ
NULL
 && serv[0] != '\0') {

425 iàĞ(
rc
 = 
	`g‘addršfo_£rv
(
aih—d
, &
hšts
, 
£rv
, &
£Á
,

426 
h’tbuf
, 
HENTBUFSIZ
)) != 0)

427 
	`”rÜ
(
rc
);

430 *
»suÉ
 = 
aih—d
;

433 
bad
:

434 
	`ä“addršfo
(
aih—d
);

435 (
”rÜ
);

436 
	}
}

443 
	$g‘addršfo_ho¡
(cÚ¡ *
ho¡
,

444 
ho¡’t
 *
h±r
, ho¡’ˆ**
h±½Œ
,

445 *
buf
, 
bufsiz
, 
çmy
)

448 #ifdef 
REENTRANT


449 
h_”ºo
;

452 #ifdef 
IPV4


460 ià(
	`isdig™
(
ho¡
[0])) {

461 ià(
	`š‘_±Ú
(
AF_INET
, 
ho¡
, 
h±r
->
h_addr_li¡
[0]) == 1) {

464 
	`¡ºıy
(
h±r
->
h_Çme
, 
ho¡
, 
bufsiz
-1);

465 
buf
[
bufsiz
-1] = '\0';

466 
h±r
->
h_add¹y³
 = 
AF_INET
;

467 
h±r
->
h_Ëngth
 = (
š_addr
);

473 #ifdef 
IPV6


477 ià(
	`isxdig™
(
ho¡
[0]) || host[0] == ':') {

478 ià(
	`š‘_±Ú
(
AF_INET6
, 
ho¡
, 
h±r
->
h_addr_li¡
[0]) == 1) {

481 
	`¡ºıy
(
buf
, 
ho¡
, 
bufsiz
-1);

482 
buf
[
bufsiz
-1] = '\0';

483 
h±r
->
h_add¹y³
 = 
AF_INET6
;

484 
h±r
->
h_Ëngth
 = (
š6_addr
);

495 ià((
_»s
.
İtiÚs
 & 
RES_INIT
) == 0)

496 
	`»s_š™
();

498 #ifdef 
IPV6


506 #iâdef 
RES_USE_INET6


509 
	#RES_USE_INET6
 0x00002000

	)

511 ià(
çmy
 =ğ
AF_INET6
)

512 
_»s
.
İtiÚs
 |ğ
RES_USE_INET6
;

515 #ifdef 
REENTRANT


516 
h±r
 = 
	`g‘ho¡byÇme_r
(
ho¡
, h±r, 
buf
, 
bufsiz
, &
h_”ºo
);

518 
h±r
 = 
	`g‘ho¡byÇme
(
ho¡
);

520 ià(
h±r
 =ğ
NULL
) {

521 
h_”ºo
) {

522 
HOST_NOT_FOUND
: (
EAI_NONAME
);

523 
TRY_AGAIN
: (
EAI_AGAIN
);

524 
NO_RECOVERY
: (
EAI_FAIL
);

525 
NO_DATA
: (
EAI_NODATA
);

526 : (
EAI_NONAME
);

529 *
h±½Œ
 = 
h±r
;

531 
	}
}

538 
	$g‘addršfo_£rv
(
addršfo
 *
aih—d
,

539 cÚ¡ 
addršfo
 *
hšt¥Œ
, cÚ¡ *
£rv
,

540 
£rv’t
 *
¥Œ¬g
, *
buf
, 
bufsiz
)

542 
pÜt
, 
rc
;

543 
nfound
 = 0;

544 
£rv’t
 *
¥Œ
;

554 ià(
	`isdig™
(
£rv
[0]è&& 
hšt¥Œ
->
ai_sockty³
 != 0) {

555 
pÜt
 = 
	`htÚs
(
	`©oi
(
£rv
));

556 iàĞ(
rc
 = 
	`g‘addršfo_pÜt
(
aih—d
, 
pÜt
, 
hšt¥Œ
->
ai_sockty³
)) == 0)

557 (
EAI_NONAME
);

558 ià(
rc
 < 0)

559 (
EAI_MEMORY
);

569 ià(
hšt¥Œ
->
ai_sockty³
 =ğ0 || hšt¥Œ->ai_sockty³ =ğ
SOCK_STREAM
) {

570 #ifdef 
REENTRANT


571 
¥Œ
 = 
	`g‘£rvbyÇme_r
(
£rv
, "tı", 
¥Œ¬g
, 
buf
, 
bufsiz
);

573 
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "tcp");

575 ià(
¥Œ
 !ğ
NULL
) {

576 
rc
 = 
	`g‘addršfo_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_STREAM
);

577 ià(
rc
 < 0)

578 (
EAI_MEMORY
);

579 
nfound
 +ğ
rc
;

586 ià(
hšt¥Œ
->
ai_sockty³
 =ğ0 || hšt¥Œ->ai_sockty³ =ğ
SOCK_DGRAM
) {

587 #ifdef 
REENTRANT


588 
¥Œ
 = 
	`g‘£rvbyÇme_r
(
£rv
, "udp", 
¥Œ¬g
, 
buf
, 
bufsiz
);

590 
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "udp");

592 ià(
¥Œ
 !ğ
NULL
) {

593 
rc
 = 
	`g‘addršfo_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_DGRAM
);

594 ià(
rc
 < 0)

595 (
EAI_MEMORY
);

596 
nfound
 +ğ
rc
;

600 ià(
nfound
 == 0) {

605 ià(
hšt¥Œ
->
ai_sockty³
 == 0)

606 (
EAI_NONAME
);

608 (
EAI_SERVICE
);

611 
	}
}

640 
	$g‘addršfo_pÜt
(
addršfo
 *
aih—d
, 
pÜt
, 
sockty³
)

643 
nfound
 = 0;

644 
addršfo
 *
ai
;

646 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğai->
ai_Ãxt
) {

656 ià(
ai
->
ai_æags
 & 
AI_CLONE
) {

657 ià(
ai
->
ai_sockty³
 != 0) {

658 iàĞ(
ai
 = 
	`g‘addršfo_şÚe
×i)è=ğ
NULL
)

662 } ià(
ai
->
ai_sockty³
 !ğ
sockty³
)

665 
ai
->
ai_sockty³
 = 
sockty³
;

667 
ai
->
ai_çmy
) {

668 #ifdef 
IPV4


669 
AF_INET
:

670 ((
sockaddr_š
 *è
ai
->
ai_addr
)->
sš_pÜt
 = 
pÜt
;

671 
nfound
++;

674 #ifdef 
IPV6


675 
AF_INET6
:

676 ((
sockaddr_š6
 *è
ai
->
ai_addr
)->
sš6_pÜt
 = 
pÜt
;

677 
nfound
++;

682 (
nfound
);

683 
	}
}

689 
addršfo
 *

690 
	$g‘addršfo_şÚe
(
addršfo
 *
ai
)

692 
addršfo
 *
Ãw
;

694 iàĞ(
Ãw
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

695 (
NULL
);

697 
Ãw
->
ai_Ãxt
 = 
ai
->ai_next;

698 
ai
->
ai_Ãxt
 = 
Ãw
;

700 
Ãw
->
ai_æags
 = 0;

701 
Ãw
->
ai_çmy
 = 
ai
->ai_family;

702 
Ãw
->
ai_sockty³
 = 
ai
->ai_socktype;

703 
Ãw
->
ai_´ÙocŞ
 = 
ai
->ai_protocol;

704 
Ãw
->
ai_ÿnÚÇme
 = 
NULL
;

705 
Ãw
->
ai_add¾’
 = 
ai
->ai_addrlen;

706 iàĞ(
Ãw
->
ai_addr
 = 
	`m®loc
(
ai
->
ai_add¾’
)è=ğ
NULL
)

707 (
NULL
);

708 
	`memıy
(
Ãw
->
ai_addr
, 
ai
->ai_addr,‡i->
ai_add¾’
);

710 (
Ãw
);

711 
	}
}

713 #ifdef 
LOCAL


720 
	$addršfo_loÿl
(cÚ¡ *
·th
, 
addršfo
 *
hšts
,

721 
addršfo
 **
»suÉ
)

723 
addršfo
 *
ai
;

724 
sockaddr_un
 *
uÅ
;

726 ià(
hšts
->
ai_sockty³
 == 0)

727 (
EAI_SOCKTYPE
);

729 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

730 (
NULL
);

732 
ai
->
ai_æags
 = 0;

733 
ai
->
ai_çmy
 = 
AF_LOCAL
;

734 
ai
->
ai_sockty³
 = 
hšts
->ai_socktype;

735 
ai
->
ai_´ÙocŞ
 = 0;

738 
ai
->
ai_add¾’
 = (
sockaddr_un
);

739 iàĞ(
ai
->
ai_addr
 = 
	`m®loc
×i->
ai_add¾’
)è=ğ
NULL
)

740 (
EAI_MEMORY
);

741 
uÅ
 = (
sockaddr_un
 *è
ai
->
ai_addr
;

742 
uÅ
->
sun_çmy
 = 
AF_UNIX
;

743 
	`¡ºıy
(
uÅ
->
sun_·th
, 
·th
, (unp->sun_path));

745 
ai
->
ai_ÿnÚÇme
 = 
NULL
;

746 
ai
->
ai_Ãxt
 = 
NULL
;

747 *
»suÉ
 = 
ai
;

749 ià(
hšts
->
ai_æags
 & 
AI_PASSIVE
)

750 
	`uÆšk
(
·th
);

753 
	}
}

757 
	$ä“addršfo
(
addršfo
 *
aih—d
)

759 
addršfo
 *
ai
, *
ašext
;

761 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğ
ašext
) {

762 ià(
ai
->
ai_addr
 !ğ
NULL
)

763 
	`ä“
(
ai
->
ai_addr
);

764 ià(
ai
->
ai_ÿnÚÇme
 !ğ
NULL
)

765 
	`ä“
(
ai
->
ai_ÿnÚÇme
);

766 
ašext
 = 
ai
->
ai_Ãxt
;

767 
	`ä“
(
ai
);

769 
	}
}

	@osi\unpv13e\unpv13e\libfree\getnameinfo.c

20 
	~<sys/ty³s.h
>

21 
	~<sys/sock‘.h
>

22 
	~<Ãtš‘/š.h
>

23 
	~<Ãtdb.h
>

24 
	~<¡ršg.h
>

29 #ifdef 
AF_INET


30 
	#IPV4


	)

32 #ifdef 
IPV6ADDR_ANY_INIT


33 
	#IPV6


	)

42 
	#HENTBUFSIZ
 8*1024

	)

45 
do_v46
(*, 
size_t
, *, size_t,

46 *, 
size_t
, , );

49 
	$g‘Çmešfo
(cÚ¡ 
sockaddr
 *
§
, 
size_t
 
§Ën
,

50 *
ho¡
, 
size_t
 
ho¡Ën
, *
£rv
, size_ˆ
£rvËn
)

53 
§
->
§_çmy
) {

54 #ifdef 
IPV4


55 
AF_INET
: {

56 
sockaddr_š
 *
§š
 = (sockaddr_š *è
§
;

58 (
	`do_v46
(
ho¡
, 
ho¡Ën
, 
£rv
, 
£rvËn
,

59 &
§š
->
sš_addr
, (
š_addr
), 
AF_INET
,

60 
§š
->
sš_pÜt
));

64 #ifdef 
IPV6


65 
AF_INET6
: {

66 
sockaddr_š6
 *
§š
 = (sockaddr_š6 *è
§
;

68 (
	`do_v46
(
ho¡
, 
ho¡Ën
, 
£rv
, 
£rvËn
,

69 &
§š
->
sš6_addr
, (
š6_addr
), 
AF_INET6
,

70 
§š
->
sš6_pÜt
));

77 
	}
}

84 
	$do_v46
(*
ho¡
, 
size_t
 
ho¡Ën
, *
£rv
, size_ˆ
£rvËn
,

85 *
­Œ
, 
size_t
 
®’
, 
çmy
, 
pÜt
)

87 
ho¡’t
 *
h±r
, 
h’t
;

88 
£rv’t
 *
¥Œ
, 
£Á
;

89 
h’tbuf
[
HENTBUFSIZ
];

91 ià(
ho¡Ën
 > 0) {

92 #ifdef 
REENTRANT


93 
h±r
 = 
	`g‘ho¡byaddr_r
(
­Œ
, 
®’
, 
çmy
,

94 &
h’t
, 
h’tbuf
, 
HENTBUFSIZ
, &
h_”ºo
);

96 
h±r
 = 
	`g‘ho¡byaddr
(
­Œ
, 
®’
, 
çmy
);

98 ià(
h±r
 !ğ
NULL
 && h±r->
h_Çme
 != NULL)

99 
	`¡ºıy
(
ho¡
, 
h±r
->
h_Çme
, 
ho¡Ën
);

104 ià(
£rvËn
 > 0) {

110 #ifdef 
REENTRANT


111 
¥Œ
 = 
	`g‘£rvbypÜt_r
(
pÜt
, 
NULL
,

112 &
£Á
, 
h’tbuf
, 
HENTBUFSIZ
);

114 
¥Œ
 = 
	`g‘£rvbypÜt
(
pÜt
, 
NULL
);

116 ià(
¥Œ
 !ğ
NULL
 && s±r->
s_Çme
 != NULL)

117 
	`¡ºıy
(
£rv
, 
¥Œ
->
s_Çme
, 
£rvËn
);

122 
	}
}

	@osi\unpv13e\unpv13e\libfree\in_cksum.c

1 
	~"uÅ.h
"

3 
ušt16_t


4 
	$š_cksum
(
ušt16_t
 *
addr
, 
Ën
)

6 
Æeá
 = 
Ën
;

7 
ušt32_t
 
sum
 = 0;

8 
ušt16_t
 *
w
 = 
addr
;

9 
ušt16_t
 
ªsw”
 = 0;

16 
Æeá
 > 1) {

17 
sum
 +ğ*
w
++;

18 
Æeá
 -= 2;

22 ià(
Æeá
 == 1) {

23 *(*)(&
ªsw”
èğ*(*)
w
 ;

24 
sum
 +ğ
ªsw”
;

28 
sum
 = (sum >> 16) + (sum & 0xffff);

29 
sum
 += (sum >> 16);

30 
ªsw”
 = ~
sum
;

31 (
ªsw”
);

32 
	}
}

	@osi\unpv13e\unpv13e\libfree\inet_aton.c

11 
	~<sys/ty³s.h
>

12 
	~<Ãtš‘/š.h
>

23 
	$š‘_©Ú
(cÚ¡ *
ı
, 
š_addr
 *
­
)

25 
dÙs
 = 0;

26 
u_lÚg
 
acc
 = 0, 
addr
 = 0;

29 
cc
 = *
ı
;

31 
cc
) {

42 
acc
 =‡cø* 10 + (
cc
 - '0');

46 ià(++
dÙs
 > 3) {

52 ià(
acc
 > 255) {

55 
addr
 =‡dd¸<< 8 | 
acc
;

56 
acc
 = 0;

62 } *
ı
++) ;

65 ià(
dÙs
 < 3) {

66 
addr
 <<ğ8 * (3 - 
dÙs
) ;

70 ià(
­
) {

71 
­
->
s_addr
 = 
	`htÚl
(
addr
);

75 
	}
}

	@osi\unpv13e\unpv13e\libfree\inet_ntop.c

19 #ià
defšed
(
LIBC_SCCS
è&& !defšed(
lšt
)

20 
	grcsid
[] = "$Id: inet_ntop.c,v 1.1.1.1 2002/11/14 03:33:35 fenner Exp $";

23 
	~<sys/·¿m.h
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/sock‘.h
>

26 
	~<Ãtš‘/š.h
>

27 
	~<¬·/š‘.h
>

28 
	~<¡ršg.h
>

29 
	~<”ºo.h
>

30 
	~<¡dio.h
>

32 
	#IN6ADDRSZ
 16

	)

33 
	#INT16SZ
 2

	)

35 #iâdef 
AF_INET6


36 
	#AF_INET6
 
AF_MAX
+1

	)

44 cÚ¡ *
š‘_Áİ4
(cÚ¡ 
u_ch¬
 *
¤c
, *
d¡
, 
size_t
 
size
);

45 cÚ¡ *
š‘_Áİ6
(cÚ¡ 
u_ch¬
 *
¤c
, *
d¡
, 
size_t
 
size
);

56 
	$š‘_Áİ
(
af
, 
¤c
, 
d¡
, 
size
)

57 
af
;

58 cÚ¡ *
¤c
;

59 *
d¡
;

60 
size_t
 
size
;

62 
af
) {

63 
AF_INET
:

64  (
	`š‘_Áİ4
(
¤c
, 
d¡
, 
size
));

65 
AF_INET6
:

66  (
	`š‘_Áİ6
(
¤c
, 
d¡
, 
size
));

68 
”ºo
 = 
EAFNOSUPPORT
;

69  (
NULL
);

72 
	}
}

86 
	$š‘_Áİ4
(
¤c
, 
d¡
, 
size
)

87 cÚ¡ 
u_ch¬
 *
¤c
;

88 *
d¡
;

89 
size_t
 
size
;

91 cÚ¡ 
fmt
[] = "%u.%u.%u.%u";

92 
tmp
[ "255.255.255.255"];

94 
	`¥rštf
(
tmp
, 
fmt
, 
¤c
[0], src[1], src[2], src[3]);

95 ià(
	`¡¾’
(
tmp
è> 
size
) {

96 
”ºo
 = 
ENOSPC
;

97  (
NULL
);

99 
	`¡rıy
(
d¡
, 
tmp
);

100  (
d¡
);

101 
	}
}

110 
	$š‘_Áİ6
(
¤c
, 
d¡
, 
size
)

111 cÚ¡ 
u_ch¬
 *
¤c
;

112 *
d¡
;

113 
size_t
 
size
;

122 
tmp
[ "ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255"], *

;

123 ¡ruù { 
ba£
, 
Ën
; } 
be¡
, 
cur
;

124 
u_št
 
wÜds
[
IN6ADDRSZ
 / 
INT16SZ
];

125 
i
;

132 
	`mem£t
(
wÜds
, 0,  words);

133 
i
 = 0; i < 
IN6ADDRSZ
; i++)

134 
wÜds
[
i
 / 2] |ğ(
¤c
[i] << ((1 - (i % 2)) << 3));

135 
be¡
.
ba£
 = -1;

136 
cur
.
ba£
 = -1;

137 
i
 = 0; i < (
IN6ADDRSZ
 / 
INT16SZ
); i++) {

138 ià(
wÜds
[
i
] == 0) {

139 ià(
cur
.
ba£
 == -1)

140 
cur
.
ba£
 = 
i
, cur.
Ën
 = 1;

142 
cur
.
Ën
++;

144 ià(
cur
.
ba£
 != -1) {

145 ià(
be¡
.
ba£
 =ğ-1 || 
cur
.
Ën
 > best.len)

146 
be¡
 = 
cur
;

147 
cur
.
ba£
 = -1;

151 ià(
cur
.
ba£
 != -1) {

152 ià(
be¡
.
ba£
 =ğ-1 || 
cur
.
Ën
 > best.len)

153 
be¡
 = 
cur
;

155 ià(
be¡
.
ba£
 !ğ-1 && be¡.
Ën
 < 2)

156 
be¡
.
ba£
 = -1;

161 

 = 
tmp
;

162 
i
 = 0; i < (
IN6ADDRSZ
 / 
INT16SZ
); i++) {

164 ià(
be¡
.
ba£
 !ğ-1 && 
i
 >= best.base &&

165 
i
 < (
be¡
.
ba£
 + be¡.
Ën
)) {

166 ià(
i
 =ğ
be¡
.
ba£
)

167 *

++ = ':';

171 ià(
i
 != 0)

172 *

++ = ':';

174 ià(
i
 =ğ6 && 
be¡
.
ba£
 == 0 &&

175 (
be¡
.
Ën
 =ğ6 || (be¡.ËÀ=ğ5 && 
wÜds
[5] == 0xffff))) {

176 ià(!
	`š‘_Áİ4
(
¤c
+12, 

,  
tmp
 - (tp -mp)))

177  (
NULL
);

178 

 +ğ
	`¡¾’
(tp);

181 
	`¥rštf
(

, "%x", 
wÜds
[
i
]);

182 

 +ğ
	`¡¾’
(tp);

185 ià(
be¡
.
ba£
 !ğ-1 && (be¡.ba£ + be¡.
Ën
è=ğ(
IN6ADDRSZ
 / 
INT16SZ
))

186 *

++ = ':';

187 *

++ = '\0';

192 ià((

 - 
tmp
è> 
size
) {

193 
”ºo
 = 
ENOSPC
;

194  (
NULL
);

196 
	`¡rıy
(
d¡
, 
tmp
);

197  (
d¡
);

198 
	}
}

	@osi\unpv13e\unpv13e\libfree\inet_ntop_ipv4.c

1 
	~<sys/ty³s.h
>

2 
	~<sys/sock‘.h
>

3 
	~<”ºo.h
>

4 
	~<¡dio.h
>

6 #iâdef 
INET_ADDRSTRLEN


7 
	#INET_ADDRSTRLEN
 16

	)

12 
	$š‘_Áİ
(
çmy
, cÚ¡ *
add½Œ
, *
¡½Œ
, 
size_t
 
Ën
)

14 cÚ¡ 
u_ch¬
 *
p
 = (cÚ¡ u_ch¬ *è
add½Œ
;

16 ià(
çmy
 =ğ
AF_INET
) {

17 
‹mp
[
INET_ADDRSTRLEN
];

19 
	`¢´štf
(
‹mp
, (temp), "%d.%d.%d.%d",

20 
p
[0],…[1],…[2],…[3]);

21 ià(
	`¡¾’
(
‹mp
è>ğ
Ën
) {

22 
”ºo
 = 
ENOSPC
;

23  (
NULL
);

25 
	`¡rıy
(
¡½Œ
, 
‹mp
);

26  (
¡½Œ
);

28 
”ºo
 = 
EAFNOSUPPORT
;

29  (
NULL
);

30 
	}
}

	@osi\unpv13e\unpv13e\libfree\inet_pton.c

19 #ià
defšed
(
LIBC_SCCS
è&& !defšed(
lšt
)

20 
	grcsid
[] = "$Id: inet_pton.c,v 1.1.1.1 2002/11/14 03:33:35 fenner Exp $";

23 
	~<sys/·¿m.h
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/sock‘.h
>

26 
	~<Ãtš‘/š.h
>

27 
	~<¬·/š‘.h
>

28 
	~<¡ršg.h
>

29 
	~<”ºo.h
>

31 
	#IN6ADDRSZ
 16

	)

32 
	#INADDRSZ
 4

	)

33 
	#INT16SZ
 2

	)

35 #iâdef 
AF_INET6


36 
	#AF_INET6
 
AF_MAX
+1

	)

44 
š‘_±Ú4
(cÚ¡ *
¤c
, 
u_ch¬
 *
d¡
);

45 
š‘_±Ú6
(cÚ¡ *
¤c
, 
u_ch¬
 *
d¡
);

59 
	$š‘_±Ú
(
af
, 
¤c
, 
d¡
)

60 
af
;

61 cÚ¡ *
¤c
;

62 *
d¡
;

64 
af
) {

65 
AF_INET
:

66  (
	`š‘_±Ú4
(
¤c
, 
d¡
));

67 
AF_INET6
:

68  (
	`š‘_±Ú6
(
¤c
, 
d¡
));

70 
”ºo
 = 
EAFNOSUPPORT
;

74 
	}
}

87 
	$š‘_±Ú4
(
¤c
, 
d¡
)

88 cÚ¡ *
¤c
;

89 
u_ch¬
 *
d¡
;

91 cÚ¡ 
dig™s
[] = "0123456789";

92 
§w_dig™
, 
où‘s
, 
ch
;

93 
u_ch¬
 
tmp
[
INADDRSZ
], *

;

95 
§w_dig™
 = 0;

96 
où‘s
 = 0;

97 *(

 = 
tmp
) = 0;

98 (
ch
 = *
¤c
++) != '\0') {

99 cÚ¡ *
pch
;

101 ià((
pch
 = 
	`¡rchr
(
dig™s
, 
ch
)è!ğ
NULL
) {

102 
u_št
 
Ãw
 = *

 * 10 + (
pch
 - 
dig™s
);

104 ià(
Ãw
 > 255)

106 *

 = 
Ãw
;

107 ià(! 
§w_dig™
) {

108 ià(++
où‘s
 > 4)

110 
§w_dig™
 = 1;

112 } ià(
ch
 =ğ'.' && 
§w_dig™
) {

113 ià(
où‘s
 == 4)

115 *++

 = 0;

116 
§w_dig™
 = 0;

120 ià(
où‘s
 < 4)

123 
	`memıy
(
d¡
, 
tmp
, 
INADDRSZ
);

125 
	}
}

141 
	$š‘_±Ú6
(
¤c
, 
d¡
)

142 cÚ¡ *
¤c
;

143 
u_ch¬
 *
d¡
;

145 cÚ¡ 
xdig™s_l
[] = "0123456789abcdef",

146 
xdig™s_u
[] = "0123456789ABCDEF";

147 
u_ch¬
 
tmp
[
IN6ADDRSZ
], *

, *
’dp
, *
cŞÚp
;

148 cÚ¡ *
xdig™s
, *
cu¹ok
;

149 
ch
, 
§w_xdig™
;

150 
u_št
 
v®
;

152 
	`mem£t
((

 = 
tmp
), 0, 
IN6ADDRSZ
);

153 
’dp
 = 

 + 
IN6ADDRSZ
;

154 
cŞÚp
 = 
NULL
;

156 ià(*
¤c
 == ':')

157 ià(*++
¤c
 != ':')

159 
cu¹ok
 = 
¤c
;

160 
§w_xdig™
 = 0;

161 
v®
 = 0;

162 (
ch
 = *
¤c
++) != '\0') {

163 cÚ¡ *
pch
;

165 ià((
pch
 = 
	`¡rchr
((
xdig™s
 = 
xdig™s_l
), 
ch
)è=ğ
NULL
)

166 
pch
 = 
	`¡rchr
((
xdig™s
 = 
xdig™s_u
), 
ch
);

167 ià(
pch
 !ğ
NULL
) {

168 
v®
 <<= 4;

169 
v®
 |ğ(
pch
 - 
xdig™s
);

170 ià(
v®
 > 0xffff)

172 
§w_xdig™
 = 1;

175 ià(
ch
 == ':') {

176 
cu¹ok
 = 
¤c
;

177 ià(!
§w_xdig™
) {

178 ià(
cŞÚp
)

180 
cŞÚp
 = 

;

183 ià(

 + 
INT16SZ
 > 
’dp
)

185 *

++ = (
u_ch¬
è(
v®
 >> 8) & 0xff;

186 *

++ = (
u_ch¬
è
v®
 & 0xff;

187 
§w_xdig™
 = 0;

188 
v®
 = 0;

191 ià(
ch
 =ğ'.' && ((

 + 
INADDRSZ
è<ğ
’dp
) &&

192 
	`š‘_±Ú4
(
cu¹ok
, 

) > 0) {

193 

 +ğ
INADDRSZ
;

194 
§w_xdig™
 = 0;

199 ià(
§w_xdig™
) {

200 ià(

 + 
INT16SZ
 > 
’dp
)

202 *

++ = (
u_ch¬
è(
v®
 >> 8) & 0xff;

203 *

++ = (
u_ch¬
è
v®
 & 0xff;

205 ià(
cŞÚp
 !ğ
NULL
) {

210 cÚ¡ 
n
 = 

 - 
cŞÚp
;

211 
i
;

213 
i
 = 1; i <ğ
n
; i++) {

214 
’dp
[- 
i
] = 
cŞÚp
[
n
 - i];

215 
cŞÚp
[
n
 - 
i
] = 0;

217 

 = 
’dp
;

219 ià(

 !ğ
’dp
)

222 
	`memıy
(
d¡
, 
tmp
, 
IN6ADDRSZ
);

224 
	}
}

	@osi\unpv13e\unpv13e\libfree\inet_pton_ipv4.c

1 
	~<sys/ty³s.h
>

2 
	~<sys/sock‘.h
>

3 
	~<Ãtš‘/š.h
>

4 
	~<¬·/š‘.h
>

5 
	~<”ºo.h
>

6 
	~<¡ršg.h
>

10 
š‘_©Ú
(cÚ¡ *, 
š_addr
 *);

14 
	$š‘_±Ú
(
çmy
, cÚ¡ *
¡½Œ
, *
add½Œ
)

16 ià(
çmy
 =ğ
AF_INET
) {

17 
š_addr
 
š_v®
;

19 ià(
	`š‘_©Ú
(
¡½Œ
, &
š_v®
)) {

20 
	`memıy
(
add½Œ
, &
š_v®
, (
š_addr
));

25 
”ºo
 = 
EAFNOSUPPORT
;

27 
	}
}

	@osi\unpv13e\unpv13e\libfree\test_ascii2addr.c

1 
	~<sys/ty³s.h
>

2 
	~<sys/sock‘.h
>

3 
	~<Ãtš‘/š.h
>

4 
	~<Ãtdb.h
>

5 
	~<¡dio.h
>

7 
	$maš
()

9 
š6_addr
 
foo
;

11 
	`´štf
("ascii2addr„eturned %d\n",

12 
	`ascii2addr
(
AF_INET6
, "::140.252.13.36", &
foo
));

14 
	`ex™
(0);

15 
	}
}

	@osi\unpv13e\unpv13e\libfree\test_getservbyname_r.c

1 
	~<Ãtdb.h
>

3 
	$maš
()

5 
buf
[8192];

6 
£rv’t
 
£Á
, *
¥Œ
;

8 
¥Œ
 = 
	`g‘£rvbyÇme_r
("táp", "tı", &
£Á
, 
buf
, (buf));

9 
	`´štf
("TCP, s±¸ğ%p\n", 
¥Œ
);

11 
¥Œ
 = 
	`g‘£rvbyÇme_r
("táp", "udp", &
£Á
, 
buf
, (buf));

12 
	`´štf
("UDP, s±¸ğ%p\n", 
¥Œ
);

14 
¥Œ
 = 
	`g‘£rvbyÇme_r
("táp", "tı", &
£Á
, 
buf
, (buf));

15 
	`´štf
("TCP, s±¸ğ%p\n", 
¥Œ
);

17 
¥Œ
 = 
	`g‘£rvbyÇme_r
("táp", "udp", &
£Á
, 
buf
, (buf));

18 
	`´štf
("UDP, s±¸ğ%p\n", 
¥Œ
);

20 
	`ex™
(0);

21 
	}
}

	@osi\unpv13e\unpv13e\libfree\test_inet_pton.c

1 
	~"../lib/uÅ.h
"

3 #iâdef 
AF_INET6


4 
	#AF_INET6
 
AF_MAX
+1

	)

7 
š‘_±Ú
(, const *, *);

10 
	$maš
(
¬gc
, **
¬gv
)

12 
i
;

13 
buff
[100];

26 iàĞ(
i
 = 
	`š‘_±Ú
(
AF_INET
, "0.0.0.0", 
buff
)) != 1)

27 
	`´štf
("AF_INET, 0.0.0.0„‘uºed: %d\n", 
i
);

28 iàĞ(
i
 = 
	`š‘_±Ú
(
AF_INET6
, "0.0.0.0", 
buff
)) != 0)

29 
	`´štf
("AF_INET6, 0.0.0.0„‘uºed: %d\n", 
i
);

31 iàĞ(
i
 = 
	`š‘_±Ú
(
AF_INET6
, "0::0", 
buff
)) != 1)

32 
	`´štf
("AF_INET6, 0::0„‘uºed: %d\n", 
i
);

33 iàĞ(
i
 = 
	`š‘_±Ú
(
AF_INET
, "0::0", 
buff
)) != 0)

34 
	`´štf
("AF_INET, 0::0„‘uºed: %d\n", 
i
);

36 
	`´štf
("inet_pton(AF_INET6, \"1.2.3.4\", buff)„eturns %d\n",

37 
	`š‘_±Ú
(
AF_INET6
, "1.2.3.4", 
buff
));

38 
	`´štf
("inet_pton(AF_INET6, \"::1.2.3.4\", buff)„eturns %d\n",

39 
	`š‘_±Ú
(
AF_INET6
, "::1.2.3.4", 
buff
));

41 
	`ex™
(0);

42 
	}
}

	@osi\unpv13e\unpv13e\libgai\addrinfo.h

1 #iâdef 
__addršfo_h


2 
	#__addršfo_h


	)

10 
	saddršfo
 {

11 
	mai_æags
;

12 
	mai_çmy
;

13 
	mai_sockty³
;

14 
	mai_´ÙocŞ
;

15 
size_t
 
	mai_add¾’
;

16 *
	mai_ÿnÚÇme
;

17 
sockaddr
 *
	mai_addr
;

18 
addršfo
 *
	mai_Ãxt
;

22 
	#AI_PASSIVE
 1

	)

23 
	#AI_CANONNAME
 2

	)

26 
	#NI_MAXHOST
 1025

	)

27 
	#NI_MAXSERV
 32

	)

29 
	#NI_NOFQDN
 1

	)

30 
	#NI_NUMERICHOST
 2

	)

31 
	#NI_NAMEREQD
 4

	)

32 
	#NI_NUMERICSERV
 8

	)

33 
	#NI_DGRAM
 16

	)

36 
	#EAI_ADDRFAMILY
 1

	)

37 
	#EAI_AGAIN
 2

	)

38 
	#EAI_BADFLAGS
 3

	)

39 
	#EAI_FAIL
 4

	)

40 
	#EAI_FAMILY
 5

	)

41 
	#EAI_MEMORY
 6

	)

42 
	#EAI_NODATA
 7

	)

43 
	#EAI_NONAME
 8

	)

44 
	#EAI_SERVICE
 9

	)

45 
	#EAI_SOCKTYPE
 10

	)

46 
	#EAI_SYSTEM
 11

	)

	@osi\unpv13e\unpv13e\libgai\freeaddrinfo.c

1 
	~"gai_hdr.h
"

5 
	$ä“addršfo
(
addršfo
 *
aih—d
)

7 
addršfo
 *
ai
, *
ašext
;

9 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğ
ašext
) {

10 ià(
ai
->
ai_addr
 !ğ
NULL
)

11 
	`ä“
(
ai
->
ai_addr
);

13 ià(
ai
->
ai_ÿnÚÇme
 !ğ
NULL
)

14 
	`ä“
(
ai
->
ai_ÿnÚÇme
);

16 
ašext
 = 
ai
->
ai_Ãxt
;

17 
	`ä“
(
ai
);

19 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_aistruct.c

1 
	~"gai_hdr.h
"

9 
	$ga_ai¡ruù
(
addršfo
 ***
·Ãxt
, cÚ¡ addršfØ*
hšt¥
,

10 cÚ¡ *
addr
, 
çmy
)

12 
addršfo
 *
ai
;

14 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

15 (
EAI_MEMORY
);

16 
ai
->
ai_Ãxt
 = 
NULL
;

17 
ai
->
ai_ÿnÚÇme
 = 
NULL
;

18 **
·Ãxt
 = 
ai
;

19 *
·Ãxt
 = &
ai
->
ai_Ãxt
;

21 iàĞ(
ai
->
ai_sockty³
 = 
hšt¥
->ai_socktype) == 0)

22 
ai
->
ai_æags
 |ğ
AI_CLONE
;

24 
ai
->
ai_´ÙocŞ
 = 
hšt¥
->ai_protocol;

28 (
ai
->
ai_çmy
 = 
çmy
)) {

29 #ifdef 
IPv4


30 
AF_INET
: {

31 
sockaddr_š
 *
sš±r
;

34 iàĞ(
sš±r
 = 
	`ÿÎoc
(1, (
sockaddr_š
))è=ğ
NULL
)

35 (
EAI_MEMORY
);

36 #ifdef 
HAVE_SOCKADDR_SA_LEN


37 
sš±r
->
sš_Ën
 = (
sockaddr_š
);

39 
sš±r
->
sš_çmy
 = 
AF_INET
;

40 
	`memıy
(&
sš±r
->
sš_addr
, 
addr
, (
š_addr
));

41 
ai
->
ai_addr
 = (
sockaddr
 *è
sš±r
;

42 
ai
->
ai_add¾’
 = (
sockaddr_š
);

46 #ifdef 
IPv6


47 
AF_INET6
: {

48 
sockaddr_š6
 *
sš6±r
;

51 iàĞ(
sš6±r
 = 
	`ÿÎoc
(1, (
sockaddr_š6
))è=ğ
NULL
)

52 (
EAI_MEMORY
);

53 #ifdef 
HAVE_SOCKADDR_SA_LEN


54 
sš6±r
->
sš6_Ën
 = (
sockaddr_š6
);

56 
sš6±r
->
sš6_çmy
 = 
AF_INET6
;

57 
	`memıy
(&
sš6±r
->
sš6_addr
, 
addr
, (
š6_addr
));

58 
ai
->
ai_addr
 = (
sockaddr
 *è
sš6±r
;

59 
ai
->
ai_add¾’
 = (
sockaddr_š6
);

63 #ifdef 
UNIXdomaš


64 
AF_LOCAL
: {

65 
sockaddr_un
 *
uÅ
;

69 ià(
	`¡¾’
(
addr
è>ğ(
uÅ
->
sun_·th
))

70 (
EAI_SERVICE
);

71 iàĞ(
uÅ
 = 
	`ÿÎoc
(1, (
sockaddr_un
))è=ğ
NULL
)

72 (
EAI_MEMORY
);

74 
uÅ
->
sun_çmy
 = 
AF_LOCAL
;

75 
	`¡rıy
(
uÅ
->
sun_·th
, 
addr
);

76 #ifdef 
HAVE_SOCKADDR_SA_LEN


77 
uÅ
->
sun_Ën
 = 
	`SUN_LEN
(unp);

79 
ai
->
ai_addr
 = (
sockaddr
 *è
uÅ
;

80 
ai
->
ai_add¾’
 = (
sockaddr_un
);

81 ià(
hšt¥
->
ai_æags
 & 
AI_PASSIVE
)

82 
	`uÆšk
(
uÅ
->
sun_·th
);

88 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_clone.c

1 
	~"gai_hdr.h
"

8 
addršfo
 *

9 
	$ga_şÚe
(
addršfo
 *
ai
)

11 
addršfo
 *
Ãw
;

13 iàĞ(
Ãw
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

14 (
NULL
);

16 
Ãw
->
ai_Ãxt
 = 
ai
->ai_next;

17 
ai
->
ai_Ãxt
 = 
Ãw
;

19 
Ãw
->
ai_æags
 = 0;

20 
Ãw
->
ai_çmy
 = 
ai
->ai_family;

21 
Ãw
->
ai_sockty³
 = 
ai
->ai_socktype;

22 
Ãw
->
ai_´ÙocŞ
 = 
ai
->ai_protocol;

23 
Ãw
->
ai_ÿnÚÇme
 = 
NULL
;

24 
Ãw
->
ai_add¾’
 = 
ai
->ai_addrlen;

25 iàĞ(
Ãw
->
ai_addr
 = 
	`m®loc
(
ai
->
ai_add¾’
)è=ğ
NULL
)

26 (
NULL
);

27 
	`memıy
(
Ãw
->
ai_addr
, 
ai
->ai_addr,‡i->
ai_add¾’
);

29 (
Ãw
);

30 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_echeck.c

1 
	~"gai_hdr.h
"

9 
	$ga_echeck
(cÚ¡ *
ho¡Çme
, cÚ¡ *
£rvÇme
,

10 
æags
, 
çmy
, 
sockty³
, 
´ÙocŞ
)

12 ià(
æags
 & ~(
AI_PASSIVE
 | 
AI_CANONNAME
))

13 (
EAI_BADFLAGS
);

15 ià(
ho¡Çme
 =ğ
NULL
 || hostname[0] == '\0') {

16 ià(
£rvÇme
 =ğ
NULL
 || servname[0] == '\0')

17 (
EAI_NONAME
);

20 
çmy
) {

21 
AF_UNSPEC
:

23 #ifdef 
IPv4


24 
AF_INET
:

25 ià(
sockty³
 != 0 &&

26 (
sockty³
 !ğ
SOCK_STREAM
 &&

27 
sockty³
 !ğ
SOCK_DGRAM
 &&

28 
sockty³
 !ğ
SOCK_RAW
))

29 (
EAI_SOCKTYPE
);

32 #ifdef 
IPv6


33 
AF_INET6
:

34 ià(
sockty³
 != 0 &&

35 (
sockty³
 !ğ
SOCK_STREAM
 &&

36 
sockty³
 !ğ
SOCK_DGRAM
 &&

37 
sockty³
 !ğ
SOCK_RAW
))

38 (
EAI_SOCKTYPE
);

41 #ifdef 
UNIXdomaš


42 
AF_LOCAL
:

43 ià(
sockty³
 != 0 &&

44 (
sockty³
 !ğ
SOCK_STREAM
 &&

45 
sockty³
 !ğ
SOCK_DGRAM
))

46 (
EAI_SOCKTYPE
);

50 (
EAI_FAMILY
);

53 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_nsearch.c

1 
	~"gai_hdr.h
"

10 
	$ga_n£¬ch
(cÚ¡ *
ho¡Çme
, cÚ¡ 
addršfo
 *
hšt¥
,

11 
£¬ch
 *search)

13 
n£¬ch
 = 0;

15 ià(
ho¡Çme
 =ğ
NULL
 || hostname[0] == '\0') {

16 ià(
hšt¥
->
ai_æags
 & 
AI_PASSIVE
) {

18 
hšt¥
->
ai_çmy
) {

19 #ifdef 
IPv4


20 
AF_INET
:

21 
£¬ch
[
n£¬ch
].
ho¡
 = "0.0.0.0";

22 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

23 
n£¬ch
++;

26 #ifdef 
IPv6


27 
AF_INET6
:

28 
£¬ch
[
n£¬ch
].
ho¡
 = "0::0";

29 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

30 
n£¬ch
++;

33 
AF_UNSPEC
:

34 #ifdef 
IPv6


35 
£¬ch
[
n£¬ch
].
ho¡
 = "0::0";

36 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

37 
n£¬ch
++;

39 #ifdef 
IPv4


40 
£¬ch
[
n£¬ch
].
ho¡
 = "0.0.0.0";

41 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

42 
n£¬ch
++;

50 
hšt¥
->
ai_çmy
) {

51 #ifdef 
IPv4


52 
AF_INET
:

53 
£¬ch
[
n£¬ch
].
ho¡
 = "localhost";

54 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

55 
n£¬ch
++;

58 #ifdef 
IPv6


59 
AF_INET6
:

60 
£¬ch
[
n£¬ch
].
ho¡
 = "0::1";

61 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

62 
n£¬ch
++;

65 
AF_UNSPEC
:

66 #ifdef 
IPv6


67 
£¬ch
[
n£¬ch
].
ho¡
 = "0::1";

68 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

69 
n£¬ch
++;

71 #ifdef 
IPv4


72 
£¬ch
[
n£¬ch
].
ho¡
 = "localhost";

73 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

74 
n£¬ch
++;

82 
hšt¥
->
ai_çmy
) {

83 #ifdef 
IPv4


84 
AF_INET
:

85 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

86 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

87 
n£¬ch
++;

90 #ifdef 
IPv6


91 
AF_INET6
:

92 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

93 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

94 
n£¬ch
++;

97 
AF_UNSPEC
:

98 #ifdef 
IPv6


99 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

100 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

101 
n£¬ch
++;

103 #ifdef 
IPv4


104 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

105 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

106 
n£¬ch
++;

111 ià(
n£¬ch
 < 1 ||‚search > 2)

112 
	`”r_qu™
("n£¬ch = %d", 
n£¬ch
);

113 (
n£¬ch
);

114 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_port.c

1 
	~"gai_hdr.h
"

31 
	$ga_pÜt
(
addršfo
 *
aih—d
, 
pÜt
, 
sockty³
)

34 
nfound
 = 0;

35 
addršfo
 *
ai
;

37 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğai->
ai_Ãxt
) {

38 ià(
ai
->
ai_æags
 & 
AI_CLONE
) {

39 ià(
ai
->
ai_sockty³
 != 0) {

40 iàĞ(
ai
 = 
	`ga_şÚe
×i)è=ğ
NULL
)

44 } ià(
ai
->
ai_sockty³
 !ğ
sockty³
)

47 
ai
->
ai_sockty³
 = 
sockty³
;

49 
ai
->
ai_çmy
) {

50 #ifdef 
IPv4


51 
AF_INET
:

52 ((
sockaddr_š
 *è
ai
->
ai_addr
)->
sš_pÜt
 = 
pÜt
;

53 
nfound
++;

56 #ifdef 
IPv6


57 
AF_INET6
:

58 ((
sockaddr_š6
 *è
ai
->
ai_addr
)->
sš6_pÜt
 = 
pÜt
;

59 
nfound
++;

64 (
nfound
);

65 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_serv.c

1 
	~"gai_hdr.h
"

9 
	$ga_£rv
(
addršfo
 *
aih—d
, cÚ¡ addršfØ*
hšt¥
,

10 cÚ¡ *
£rv
)

12 
pÜt
, 
rc
, 
nfound
;

13 
£rv’t
 *
¥Œ
;

15 
nfound
 = 0;

16 ià(
	`isdig™
(
£rv
[0])) {

17 
pÜt
 = 
	`htÚs
(
	`©oi
(
£rv
));

18 ià(
hšt¥
->
ai_sockty³
) {

20 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
pÜt
, 
hšt¥
->
ai_sockty³
)) < 0)

21 (
EAI_MEMORY
);

22 
nfound
 +ğ
rc
;

25 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
pÜt
, 
SOCK_STREAM
)) < 0)

26 (
EAI_MEMORY
);

27 
nfound
 +ğ
rc
;

28 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
pÜt
, 
SOCK_DGRAM
)) < 0)

29 (
EAI_MEMORY
);

30 
nfound
 +ğ
rc
;

34 ià(
hšt¥
->
ai_sockty³
 =ğ0 || hšt¥->ai_sockty³ =ğ
SOCK_STREAM
) {

35 iàĞ(
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "tı")è!ğ
NULL
) {

36 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_STREAM
)) < 0)

37 (
EAI_MEMORY
);

38 
nfound
 +ğ
rc
;

41 ià(
hšt¥
->
ai_sockty³
 =ğ0 || hšt¥->ai_sockty³ =ğ
SOCK_DGRAM
) {

42 iàĞ(
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "udp")è!ğ
NULL
) {

43 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_DGRAM
)) < 0)

44 (
EAI_MEMORY
);

45 
nfound
 +ğ
rc
;

50 ià(
nfound
 == 0) {

51 ià(
hšt¥
->
ai_sockty³
 == 0)

52 (
EAI_NONAME
);

54 (
EAI_SERVICE
);

57 
	}
}

	@osi\unpv13e\unpv13e\libgai\ga_unix.c

1 
	~"gai_hdr.h
"

2 
	~<sys/ut¢ame.h
>

4 #ifdef 
UNIXdomaš


7 
	$ga_unix
(cÚ¡ *
·th
, 
addršfo
 *
hšt¥
, addršfØ**
»suÉ
)

9 
rc
;

10 
addršfo
 *
aih—d
, **
aÃxt
;

12 
aih—d
 = 
NULL
;

13 
aÃxt
 = &
aih—d
;

15 ià(
hšt¥
->
ai_çmy
 !ğ
AF_UNSPEC
 && hšt¥->ai_çmy !ğ
AF_LOCAL
)

16 (
EAI_ADDRFAMILY
);

18 ià(
hšt¥
->
ai_sockty³
 == 0) {

20 
hšt¥
->
ai_sockty³
 = 
SOCK_STREAM
;

21 iàĞ(
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, 
hšt¥
, 
·th
, 
AF_LOCAL
)) != 0)

22 (
rc
);

23 
hšt¥
->
ai_sockty³
 = 
SOCK_DGRAM
;

26 iàĞ(
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, 
hšt¥
, 
·th
, 
AF_LOCAL
)) != 0)

27 (
rc
);

29 ià(
hšt¥
->
ai_æags
 & 
AI_CANONNAME
) {

30 
ut¢ame
 
myÇme
;

32 ià(
	`uÇme
(&
myÇme
) < 0)

33 (
EAI_SYSTEM
);

34 iàĞ(
aih—d
->
ai_ÿnÚÇme
 = 
	`¡rdup
(
myÇme
.
nod’ame
)è=ğ
NULL
)

35 (
EAI_MEMORY
);

38 *
»suÉ
 = 
aih—d
;

40 
	}
}

	@osi\unpv13e\unpv13e\libgai\gai_hdr.h

1 
	~"uÅ.h
"

2 
	~<ùy³.h
>

5 
	#AI_CLONE
 4

	)

7 
	s£¬ch
 {

8 cÚ¡ *
	mho¡
;

9 
	mçmy
;

13 
ga_ai¡ruù
(
addršfo
 ***, const addrinfo *,

15 
addršfo
 *
ga_şÚe
(addrinfo *);

16 
ga_echeck
(const *, const *, , , , );

17 
ga_n£¬ch
(cÚ¡ *, cÚ¡ 
addršfo
 *, 
£¬ch
 *);

18 
ga_pÜt
(
addršfo
 *, , );

19 
ga_£rv
(
addršfo
 *, const addrinfo *, const *);

20 
ga_unix
(cÚ¡ *, 
addršfo
 *, addrinfo **);

22 
gn_v46
(*, 
size_t
, *, size_t, *, size_t,

	@osi\unpv13e\unpv13e\libgai\gai_strerror.c

6 
	~<sys/ty³s.h
>

7 
	~"addršfo.h
"

10 
	$gai_¡»¼Ü
(
”r
)

12 
”r
) {

13 
EAI_ADDRFAMILY
:("address family for host‚ot supported");

14 
EAI_AGAIN
: ("temporary failure in‚ame„esolution");

15 
EAI_BADFLAGS
: ("invalid flags value");

16 
EAI_FAIL
: ("non-recoverable failure in‚ame„esolution");

17 
EAI_FAMILY
: ("address family‚ot supported");

18 
EAI_MEMORY
: ("memory‡llocation failure");

19 
EAI_NODATA
: ("no‡ddress‡ssociated with host");

20 
EAI_NONAME
: ("host‚or service…rovided, or‚ot known");

21 
EAI_SERVICE
: ("service‚ot supported for socketype");

22 
EAI_SOCKTYPE
: ("socketype‚ot supported");

23 
EAI_SYSTEM
: ("systemƒrror");

26 
	}
}

	@osi\unpv13e\unpv13e\libgai\getaddrinfo.c

2 
	~"gai_hdr.h
"

3 
	~<¬·/Çme£r.h
>

4 
	~<»sŞv.h
>

7 
	$g‘addršfo
(cÚ¡ *
ho¡Çme
, cÚ¡ *
£rvÇme
,

8 cÚ¡ 
addršfo
 *
hšt¥
, addršfØ**
»suÉ
)

10 
rc
, 
”rÜ
, 
n£¬ch
;

11 **
­
, *
ÿnÚ
;

12 
ho¡’t
 *
h±r
;

13 
£¬ch
 s—rch[3], *
¥Œ
;

14 
addršfo
 
hšts
, *
aih—d
, **
aÃxt
;

20 
	#”rÜ
(
e
è{ 
”rÜ
 = (e); 
bad
; }

	)

22 
aih—d
 = 
NULL
;

23 
aÃxt
 = &
aih—d
;

24 
ÿnÚ
 = 
NULL
;

26 ià(
hšt¥
 =ğ
NULL
) {

27 
	`bz”o
(&
hšts
, (hints));

28 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

30 
hšts
 = *
hšt¥
;

33 iàĞ(
rc
 = 
	`ga_echeck
(
ho¡Çme
, 
£rvÇme
, 
hšts
.
ai_æags
, hšts.
ai_çmy
,

34 
hšts
.
ai_sockty³
, hšts.
ai_´ÙocŞ
)) != 0)

35 
	`”rÜ
(
rc
);

37 #ifdef 
UNIXdomaš


39 ià(
ho¡Çme
 !ğ
NULL
 &&

40 (
	`¡rcmp
(
ho¡Çme
, "/local") == 0 || strcmp(hostname, "/unix") == 0) &&

41 (
£rvÇme
 !ğ
NULL
 && servname[0] == '/'))

42 (
	`ga_unix
(
£rvÇme
, &
hšts
, 
»suÉ
));

48 
n£¬ch
 = 
	`ga_n£¬ch
(
ho¡Çme
, &
hšts
, &
£¬ch
[0]);

49 
¥Œ
 = &
£¬ch
[0]; s±¸< &£¬ch[
n£¬ch
]; sptr++) {

50 #ifdef 
IPv4


52 ià(
	`isdig™
(
¥Œ
->
ho¡
[0])) {

53 
š_addr
 
šaddr
;

55 ià(
	`š‘_±Ú
(
AF_INET
, 
¥Œ
->
ho¡
, &
šaddr
) == 1) {

56 ià(
hšts
.
ai_çmy
 !ğ
AF_UNSPEC
 &&

57 
hšts
.
ai_çmy
 !ğ
AF_INET
)

58 
	`”rÜ
(
EAI_ADDRFAMILY
);

59 ià(
¥Œ
->
çmy
 !ğ
AF_INET
)

61 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, &
šaddr
, 
AF_INET
);

62 ià(
rc
 != 0)

63 
	`”rÜ
(
rc
);

69 #ifdef 
IPv6


71 ià((
	`isxdig™
(
¥Œ
->
ho¡
[0]) || sptr->host[0] == ':') &&

72 (
	`¡rchr
(
¥Œ
->
ho¡
, ':'è!ğ
NULL
)) {

73 
š6_addr
 
š6addr
;

75 ià(
	`š‘_±Ú
(
AF_INET6
, 
¥Œ
->
ho¡
, &
š6addr
) == 1) {

76 ià(
hšts
.
ai_çmy
 !ğ
AF_UNSPEC
 &&

77 
hšts
.
ai_çmy
 !ğ
AF_INET6
)

78 
	`”rÜ
(
EAI_ADDRFAMILY
);

79 ià(
¥Œ
->
çmy
 !ğ
AF_INET6
)

81 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, &
š6addr
, 
AF_INET6
);

82 ià(
rc
 != 0)

83 
	`”rÜ
(
rc
);

91 ià((
_»s
.
İtiÚs
 & 
RES_INIT
) == 0)

92 
	`»s_š™
();

94 ià(
n£¬ch
 == 2) {

95 #ifdef 
IPv6


96 
_»s
.
İtiÚs
 &ğ~
RES_USE_INET6
;

98 
h±r
 = 
	`g‘ho¡byÇme2
(
¥Œ
->
ho¡
, s±r->
çmy
);

100 #ifdeà 
IPv6


101 ià(
¥Œ
->
çmy
 =ğ
AF_INET6
)

102 
_»s
.
İtiÚs
 |ğ
RES_USE_INET6
;

104 
_»s
.
İtiÚs
 &ğ~
RES_USE_INET6
;

106 
h±r
 = 
	`g‘ho¡byÇme
(
¥Œ
->
ho¡
);

108 ià(
h±r
 =ğ
NULL
) {

109 ià(
n£¬ch
 == 2)

112 
h_”ºo
) {

113 
HOST_NOT_FOUND
: 
	`”rÜ
(
EAI_NONAME
);

114 
TRY_AGAIN
: 
	`”rÜ
(
EAI_AGAIN
);

115 
NO_RECOVERY
: 
	`”rÜ
(
EAI_FAIL
);

116 
NO_DATA
: 
	`”rÜ
(
EAI_NODATA
);

117 : 
	`”rÜ
(
EAI_NONAME
);

122 ià(
hšts
.
ai_çmy
 !ğ
AF_UNSPEC
 && hšts.ai_çmy !ğ
h±r
->
h_add¹y³
)

123 
	`”rÜ
(
EAI_ADDRFAMILY
);

126 ià(
ho¡Çme
 !ğ
NULL
 && hostname[0] != '\0' &&

127 (
hšts
.
ai_æags
 & 
AI_CANONNAME
è&& 
ÿnÚ
 =ğ
NULL
) {

128 iàĞ(
ÿnÚ
 = 
	`¡rdup
(
h±r
->
h_Çme
)è=ğ
NULL
)

129 
	`”rÜ
(
EAI_MEMORY
);

133 
­
 = 
h±r
->
h_addr_li¡
; *­ !ğ
NULL
;‡p++) {

134 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, *
­
, 
h±r
->
h_add¹y³
);

135 ià(
rc
 != 0)

136 
	`”rÜ
(
rc
);

139 ià(
aih—d
 =ğ
NULL
)

140 
	`”rÜ
(
EAI_NONAME
);

145 ià(
ho¡Çme
 !ğ
NULL
 && hostname[0] != '\0' &&

146 
hšts
.
ai_æags
 & 
AI_CANONNAME
) {

147 ià(
ÿnÚ
 !ğ
NULL
)

148 
aih—d
->
ai_ÿnÚÇme
 = 
ÿnÚ
;

150 iàĞ(
aih—d
->
ai_ÿnÚÇme
 = 
	`¡rdup
(
£¬ch
[0].
ho¡
)è=ğ
NULL
)

151 
	`”rÜ
(
EAI_MEMORY
);

156 ià(
£rvÇme
 !ğ
NULL
 && servname[0] != '\0') {

157 iàĞ(
rc
 = 
	`ga_£rv
(
aih—d
, &
hšts
, 
£rvÇme
)) != 0)

158 
	`”rÜ
(
rc
);

161 *
»suÉ
 = 
aih—d
;

164 
bad
:

165 
	`ä“addršfo
(
aih—d
);

166 (
”rÜ
);

167 
	}
}

	@osi\unpv13e\unpv13e\libgai\getnameinfo.c

1 
	~"gai_hdr.h
"

5 
	$g‘Çmešfo
(cÚ¡ 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
,

6 *
ho¡
, 
size_t
 
ho¡Ën
,

7 *
£rv
, 
size_t
 
£rvËn
, 
æags
)

10 
§
->
§_çmy
) {

11 #ifdef 
IPv4


12 
AF_INET
: {

13 
sockaddr_š
 *
§š
 = (sockaddr_š *è
§
;

15 (
	`gn_v46
(
ho¡
, 
ho¡Ën
, 
£rv
, 
£rvËn
,

16 &
§š
->
sš_addr
, (
š_addr
),

17 
AF_INET
, 
§š
->
sš_pÜt
, 
æags
));

21 #ifdef 
IPv6


22 
AF_INET6
: {

23 
sockaddr_š6
 *
§š
 = (sockaddr_š6 *è
§
;

25 (
	`gn_v46
(
ho¡
, 
ho¡Ën
, 
£rv
, 
£rvËn
,

26 &
§š
->
sš6_addr
, (
š6_addr
),

27 
AF_INET6
, 
§š
->
sš6_pÜt
, 
æags
));

31 #ifdef 
UNIXdomaš


32 
AF_LOCAL
: {

33 
sockaddr_un
 *
un
 = (sockaddr_uÀ*è
§
;

35 ià(
ho¡Ën
 > 0)

36 
	`¢´štf
(
ho¡
, 
ho¡Ën
, "%s", "/local");

37 ià(
£rvËn
 > 0)

38 
	`¢´štf
(
£rv
, 
£rvËn
, "%s", 
un
->
sun_·th
);

46 
	}
}

	@osi\unpv13e\unpv13e\libgai\gn_ipv46.c

1 
	~"gai_hdr.h
"

9 
	$gn_v46
(*
ho¡
, 
size_t
 
ho¡Ën
, *
£rv
, size_ˆ
£rvËn
,

10 *
­Œ
, 
size_t
 
®’
, 
çmy
, 
pÜt
, 
æags
)

12 *
±r
;

13 
ho¡’t
 *
h±r
;

14 
£rv’t
 *
¥Œ
;

16 ià(
ho¡Ën
 > 0) {

17 ià(
æags
 & 
NI_NUMERICHOST
) {

18 ià(
	`š‘_Áİ
(
çmy
, 
­Œ
, 
ho¡
, 
ho¡Ën
è=ğ
NULL
)

21 
h±r
 = 
	`g‘ho¡byaddr
(
­Œ
, 
®’
, 
çmy
);

22 ià(
h±r
 !ğ
NULL
 && h±r->
h_Çme
 != NULL) {

23 ià(
æags
 & 
NI_NOFQDN
) {

24 iàĞ(
±r
 = 
	`¡rchr
(
h±r
->
h_Çme
, '.')è!ğ
NULL
)

25 *
±r
 = 0;

27 
	`¢´štf
(
ho¡
, 
ho¡Ën
, "%s", 
h±r
->
h_Çme
);

29 ià(
æags
 & 
NI_NAMEREQD
)

31 ià(
	`š‘_Áİ
(
çmy
, 
­Œ
, 
ho¡
, 
ho¡Ën
è=ğ
NULL
)

37 ià(
£rvËn
 > 0) {

38 ià(
æags
 & 
NI_NUMERICSERV
) {

39 
	`¢´štf
(
£rv
, 
£rvËn
, "%d", 
	`Áohs
(
pÜt
));

41 
¥Œ
 = 
	`g‘£rvbypÜt
(
pÜt
, (
æags
 & 
NI_DGRAM
è? "udp" : 
NULL
);

42 ià(
¥Œ
 !ğ
NULL
 && s±r->
s_Çme
 != NULL)

43 
	`¢´štf
(
£rv
, 
£rvËn
, "%s", 
¥Œ
->
s_Çme
);

45 
	`¢´štf
(
£rv
, 
£rvËn
, "%d", 
	`Áohs
(
pÜt
));

49 
	}
}

	@osi\unpv13e\unpv13e\libgai\old\ga_unixstruct.c

1 
	~"gai_hdr.h
"

3 #ifdef 
UNIXDOMAIN


5 
	$ga_unix¡ruù
(cÚ¡ *
·th
, 
addršfo
 *
hšt¥
,

6 
addršfo
 **
»suÉ
, 
sockty³
)

8 
addršfo
 *
ai
;

9 
sockaddr_un
 *
uÅ
;

11 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

12 (
EAI_MEMORY
);

14 
ai
->
ai_æags
 = 0;

15 
ai
->
ai_çmy
 = 
AF_LOCAL
;

16 
ai
->
ai_sockty³
 = 
sockty³
;

17 
ai
->
ai_´ÙocŞ
 = 0;

20 
ai
->
ai_add¾’
 = (
sockaddr_un
);

21 iàĞ(
ai
->
ai_addr
 = 
	`m®loc
×i->
ai_add¾’
)è=ğ
NULL
)

22 (
EAI_MEMORY
);

23 
uÅ
 = (
sockaddr_un
 *è
ai
->
ai_addr
;

24 
uÅ
->
sun_çmy
 = 
AF_UNIX
;

25 
	`¡ºıy
(
uÅ
->
sun_·th
, 
·th
, (unp->sun_path));

27 
ai
->
ai_ÿnÚÇme
 = 
NULL
;

28 
ai
->
ai_Ãxt
 = 
NULL
;

29 *
»suÉ
 = 
ai
;

31 ià(
hšt¥
->
ai_æags
 & 
AI_PASSIVE
)

32 
	`uÆšk
(
·th
);

35 
	}
}

	@osi\unpv13e\unpv13e\libgai\old\savecopy.c

1 
	~"uÅ.h
"

2 
	~<ùy³.h
>

3 
	~<¬·/Çme£r.h
>

4 
	~<»sŞv.h
>

7 
	#AI_CLONE
 4

	)

9 
	s£¬ch
 {

10 cÚ¡ *
	mho¡
;

11 
	mçmy
;

15 
ga_echeck
(cÚ¡ *, cÚ¡ *, cÚ¡ 
addršfo
 *);

16 
ga_n£¬ch
(cÚ¡ *, cÚ¡ 
addršfo
 *,

17 
£¬ch
 *);

18 
ga_ai¡ruù
(
addršfo
 ***, const addrinfo *,

20 
ga_£rv
(
addršfo
 *, const addrinfo *, const *);

21 
ga_pÜt
(
addršfo
 *, , );

22 
ga_unix
(cÚ¡ *, 
addršfo
 *, addrinfo **);

23 
addršfo
 *
ga_şÚe
(addrinfo *);

27 
addršfo
 
	ghšts_deçuÉ
;

30 
	$g‘addršfo
(cÚ¡ *
ho¡Çme
, cÚ¡ *
£rvÇme
,

31 cÚ¡ 
addršfo
 *
hšt¥
, addršfØ**
»suÉ
)

33 
rc
, 
”rÜ
, 
n£¬ch
;

34 **
­
;

35 
ho¡’t
 *
h±r
;

36 
£¬ch
 s—rch[3], *
¥Œ
;

37 
addršfo
 
hšts
, *
ai
, *
aih—d
, **
aÃxt
;

43 
	#”rÜ
(
e
è{ 
”rÜ
 = (e); 
bad
; }

	)

45 ià(
hšt¥
 =ğ
NULL
) {

46 
hšts
 = 
hšts_deçuÉ
;

47 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

49 
hšts
 = *
hšt¥
;

52 iàĞ(
rc
 = 
	`ga_echeck
(
ho¡Çme
, 
£rvÇme
, &
hšts
)) != 0)

53 
	`”rÜ
(
rc
);

55 #ifdef 
UNIXDOMAIN


60 ià(
ho¡Çme
 !ğ
NULL
 && hostname[0] == '/' &&

61 (
£rvÇme
 =ğ
NULL
 || servname[0] == '\0'))

62 (
	`ga_unix
(
ho¡Çme
, &
hšts
, 
»suÉ
));

64 ià(
£rvÇme
 !ğ
NULL
 && servname[0] == '/' &&

65 (
ho¡Çme
 =ğ
NULL
 || hostname[0] == '\0'))

66 (
	`ga_unix
(
£rvÇme
, &
hšts
, 
»suÉ
));

69 
n£¬ch
 = 
	`ga_n£¬ch
(
ho¡Çme
, &
hšts
, &
£¬ch
[0]);

71 
aih—d
 = 
NULL
;

72 
aÃxt
 = &
aih—d
;

73 
¥Œ
 = &
£¬ch
[0]; s±¸< &£¬ch[
n£¬ch
]; sptr++) {

74 #ifdef 
IPV4


76 ià(
	`isdig™
(
¥Œ
->
ho¡
[0])) {

77 
š_addr
 
šaddr
;

79 ià(
	`š‘_±Ú
(
AF_INET
, 
¥Œ
->
ho¡
, &
šaddr
) == 1) {

80 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, &
šaddr
, 
AF_INET
);

81 ià(
rc
 != 0)

82 
	`”rÜ
(
rc
);

88 #ifdef 
IPV6


90 ià(
	`isxdig™
(
¥Œ
->
ho¡
[0]) || sptr->host[0] == ':') {

91 
š6_addr
 
š6addr
;

93 ià(
	`š‘_±Ú
(
AF_INET6
, 
¥Œ
->
ho¡
, &
š6addr
) == 1) {

94 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, &
š6addr
, 
AF_INET6
);

95 ià(
rc
 != 0)

96 
	`”rÜ
(
rc
);

102 ià((
_»s
.
İtiÚs
 & 
RES_INIT
) == 0)

103 
	`»s_š™
();

105 ià(
n£¬ch
 == 2)

106 
h±r
 = 
	`g‘ho¡byÇme2
(
¥Œ
->
ho¡
, s±r->
çmy
);

108 #ifdef 
IPV6


109 ià(
¥Œ
->
çmy
 =ğ
AF_INET6
)

110 
_»s
.
İtiÚs
 |ğ
RES_USE_INET6
;

112 
_»s
.
İtiÚs
 &ğ~
RES_USE_INET6
;

114 
h±r
 = 
	`g‘ho¡byÇme
(
¥Œ
->
ho¡
);

116 ià(
h±r
 =ğ
NULL
) {

117 
h_”ºo
) {

118 
HOST_NOT_FOUND
: 
	`”rÜ
(
EAI_NONAME
);

119 
TRY_AGAIN
: 
	`”rÜ
(
EAI_AGAIN
);

120 
NO_RECOVERY
: 
	`”rÜ
(
EAI_FAIL
);

121 
NO_DATA
: 
	`”rÜ
(
EAI_NODATA
);

122 : 
	`”rÜ
(
EAI_NONAME
);

127 ià(
hšts
.
ai_çmy
 !ğ
AF_UNSPEC
 && hšts.ai_çmy !ğ
h±r
->
h_add¹y³
)

128 
	`”rÜ
(
EAI_ADDRFAMILY
);

131 
­
 = 
h±r
->
h_addr_li¡
; *­ !ğ
NULL
;‡p++) {

132 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

133 
	`”rÜ
(
EAI_MEMORY
);

134 *
aÃxt
 = 
ai
;

135 
aÃxt
 = &
ai
->
ai_Ãxt
;

136 
rc
 = 
	`ga_ai¡ruù
(&
aÃxt
, &
hšts
, *
­
, 
h±r
->
h_add¹y³
);

137 ià(
rc
 != 0)

138 
	`”rÜ
(
rc
);

143 ià(
ho¡Çme
 !ğ
NULL
 && hostname[0] != '\0' &&

144 
hšts
.
ai_æags
 & 
AI_CANONNAME
) {

145 
aih—d
->
ai_ÿnÚÇme
 = 
	`¡rdup
(
h±r
->
h_Çme
 !ğ
NULL
 ?

146 
h±r
->
h_Çme
 : 
£¬ch
[0].
ho¡
);

147 ià(
aih—d
->
ai_ÿnÚÇme
 =ğ
NULL
)

148 
	`”rÜ
(
EAI_MEMORY
);

152 ià(
£rvÇme
 !ğ
NULL
 && servname[0] != '\0') {

153 iàĞ(
rc
 = 
	`ga_£rv
(
aih—d
, &
hšts
, 
£rvÇme
)) != 0)

154 
	`”rÜ
(
rc
);

157 *
»suÉ
 = 
aih—d
;

160 
bad
:

161 
	`ä“addršfo
(
aih—d
);

162 (
”rÜ
);

163 
	}
}

170 
	$ga_echeck
(cÚ¡ *
ho¡Çme
, cÚ¡ *
£rvÇme
,

171 cÚ¡ 
addršfo
 *
hšt¥
)

173 ià(
hšt¥
->
ai_æags
 & ~(
AI_PASSIVE
 | 
AI_CANONNAME
))

174 (
EAI_BADFLAGS
);

176 ià(
ho¡Çme
 =ğ
NULL
 || hostname[0] == '\0') {

177 ià(
£rvÇme
 =ğ
NULL
 || servname[0] == '\0')

178 (
EAI_NONAME
);

181 
hšt¥
->
ai_çmy
) {

182 
AF_UNSPEC
:

184 #ifdef 
IPV4


185 
AF_INET
:

186 ià(
hšt¥
->
ai_sockty³
 != 0 &&

187 (
hšt¥
->
ai_sockty³
 !ğ
SOCK_STREAM
 &&

188 
hšt¥
->
ai_sockty³
 !ğ
SOCK_DGRAM
 &&

189 
hšt¥
->
ai_sockty³
 !ğ
SOCK_RAW
))

190 (
EAI_SOCKTYPE
);

193 #ifdef 
IPV6


194 
AF_INET6
:

195 ià(
hšt¥
->
ai_sockty³
 != 0 &&

196 (
hšt¥
->
ai_sockty³
 !ğ
SOCK_STREAM
 &&

197 
hšt¥
->
ai_sockty³
 !ğ
SOCK_DGRAM
 &&

198 
hšt¥
->
ai_sockty³
 !ğ
SOCK_RAW
))

199 (
EAI_SOCKTYPE
);

202 #ifdef 
UNIXDOMAIN


203 
AF_LOCAL
:

204 ià(
hšt¥
->
ai_sockty³
 != 0 &&

205 (
hšt¥
->
ai_sockty³
 !ğ
SOCK_STREAM
 &&

206 
hšt¥
->
ai_sockty³
 !ğ
SOCK_DGRAM
))

207 (
EAI_SOCKTYPE
);

211 (
EAI_FAMILY
);

214 
	}
}

222 
	$ga_n£¬ch
(cÚ¡ *
ho¡Çme
, cÚ¡ 
addršfo
 *
hšt¥
,

223 
£¬ch
 *search)

225 
n£¬ch
 = 0;

227 ià(
ho¡Çme
 =ğ
NULL
 || hostname[0] == '\0') {

228 ià(
hšt¥
->
ai_æags
 & 
AI_PASSIVE
) {

230 
hšt¥
->
ai_çmy
) {

231 #ifdef 
IPV4


232 
AF_INET
:

233 
£¬ch
[
n£¬ch
].
ho¡
 = "0.0.0.0";

234 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

235 
n£¬ch
++;

238 #ifdef 
IPV6


239 
AF_INET6
:

240 
£¬ch
[
n£¬ch
].
ho¡
 = "0::0";

241 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

242 
n£¬ch
++;

245 
AF_UNSPEC
:

246 #ifdef 
IPV6


247 
£¬ch
[
n£¬ch
].
ho¡
 = "0::0";

248 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

249 
n£¬ch
++;

251 #ifdef 
IPV4


252 
£¬ch
[
n£¬ch
].
ho¡
 = "0.0.0.0";

253 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

254 
n£¬ch
++;

260 
hšt¥
->
ai_çmy
) {

261 #ifdef 
IPV4


262 
AF_INET
:

263 
£¬ch
[
n£¬ch
].
ho¡
 = "localhost";

264 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

265 
n£¬ch
++;

268 #ifdef 
IPV6


269 
AF_INET6
:

270 
£¬ch
[
n£¬ch
].
ho¡
 = "0::1";

271 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

272 
n£¬ch
++;

275 
AF_UNSPEC
:

276 #ifdef 
IPV6


277 
£¬ch
[
n£¬ch
].
ho¡
 = "0::1";

278 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

279 
n£¬ch
++;

281 #ifdef 
IPV4


282 
£¬ch
[
n£¬ch
].
ho¡
 = "localhost";

283 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

284 
n£¬ch
++;

290 
hšt¥
->
ai_çmy
) {

291 #ifdef 
IPV4


292 
AF_INET
:

293 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

294 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

295 
n£¬ch
++;

298 #ifdef 
IPV6


299 
AF_INET6
:

300 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

301 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

302 
n£¬ch
++;

305 
AF_UNSPEC
:

306 #ifdef 
IPV6


307 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

308 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET6
;

309 
n£¬ch
++;

311 #ifdef 
IPV4


312 
£¬ch
[
n£¬ch
].
ho¡
 = 
ho¡Çme
;

313 
£¬ch
[
n£¬ch
].
çmy
 = 
AF_INET
;

314 
n£¬ch
++;

319 ià(
n£¬ch
 < 1 ||‚search > 2)

320 
	`”r_qu™
("n£¬ch = %d", 
n£¬ch
);

321 (
n£¬ch
);

322 
	}
}

329 
	$ga_ai¡ruù
(
addršfo
 ***
·Ãxt
, cÚ¡ addršfØ*
hšt¥
,

330 *
addr
, 
çmy
)

332 
addršfo
 *
ai
;

334 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

335 (
EAI_MEMORY
);

336 
ai
->
ai_Ãxt
 = 
NULL
;

337 
ai
->
ai_ÿnÚÇme
 = 
NULL
;

338 **
·Ãxt
 = 
ai
;

339 *
·Ãxt
 = &
ai
->
ai_Ãxt
;

341 iàĞ(
ai
->
ai_sockty³
 = 
hšt¥
->ai_socktype) == 0)

342 
ai
->
ai_æags
 |ğ
AI_CLONE
;

344 
ai
->
ai_´ÙocŞ
 = 
hšt¥
->ai_protocol;

346 (
ai
->
ai_çmy
 = 
çmy
)) {

347 #ifdef 
IPV4


348 
AF_INET
: {

349 
sockaddr_š
 *
sš±r
;

352 iàĞ(
sš±r
 = 
	`ÿÎoc
(1, (
sockaddr_š
))è=ğ
NULL
)

353 (
EAI_MEMORY
);

354 #ifdef 
HAVE_SOCKADDR_SA_LEN


355 
sš±r
->
sš_Ën
 = (
sockaddr_š
);

357 
sš±r
->
sš_çmy
 = 
AF_INET
;

358 
	`memıy
(&
sš±r
->
sš_addr
, 
addr
, (
š_addr
));

359 
ai
->
ai_addr
 = (
sockaddr
 *è
sš±r
;

360 
ai
->
ai_add¾’
 = (
sockaddr_š
);

365 #ifdef 
IPV6


367 
AF_INET6
: {

368 
sockaddr_š6
 *
sš6±r
;

370 iàĞ(
sš6±r
 = 
	`ÿÎoc
(1, (
sockaddr_š6
))è=ğ
NULL
)

371 (
EAI_MEMORY
);

372 #ifdef 
HAVE_SOCKADDR_SA_LEN


373 
sš6±r
->
sš6_Ën
 = (
sockaddr_š6
);

375 
sš6±r
->
sš6_çmy
 = 
AF_INET6
;

376 
	`memıy
(&
sš6±r
->
sš6_addr
, 
addr
, (
š6_addr
));

377 
ai
->
ai_addr
 = (
sockaddr
 *è
sš6±r
;

378 
ai
->
ai_add¾’
 = (
sockaddr_š6
);

384 
	}
}

391 
	$ga_£rv
(
addršfo
 *
aih—d
, cÚ¡ addršfØ*
hšt¥
,

392 cÚ¡ *
£rv
)

394 
pÜt
, 
rc
, 
nfound
;

395 
£rv’t
 *
¥Œ
;

398 ià(
	`isdig™
(
£rv
[0]è&& 
hšt¥
->
ai_sockty³
 != 0) {

399 
pÜt
 = 
	`htÚs
(
	`©oi
(
£rv
));

400 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
pÜt
, 
hšt¥
->
ai_sockty³
)) == 0)

401 (
EAI_NONAME
);

402 ià(
rc
 < 0)

403 (
EAI_MEMORY
);

409 
nfound
 = 0;

410 ià(
hšt¥
->
ai_sockty³
 =ğ0 || hšt¥->ai_sockty³ =ğ
SOCK_STREAM
) {

411 iàĞ(
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "tı")è!ğ
NULL
) {

412 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_STREAM
)) < 0)

413 (
EAI_MEMORY
);

414 
nfound
 +ğ
rc
;

419 ià(
hšt¥
->
ai_sockty³
 =ğ0 || hšt¥->ai_sockty³ =ğ
SOCK_DGRAM
) {

420 iàĞ(
¥Œ
 = 
	`g‘£rvbyÇme
(
£rv
, "udp")è!ğ
NULL
) {

421 iàĞ(
rc
 = 
	`ga_pÜt
(
aih—d
, 
¥Œ
->
s_pÜt
, 
SOCK_DGRAM
)) < 0)

422 (
EAI_MEMORY
);

423 
nfound
 +ğ
rc
;

427 ià(
nfound
 == 0) {

428 ià(
hšt¥
->
ai_sockty³
 == 0)

429 (
EAI_NONAME
);

431 (
EAI_SERVICE
);

434 
	}
}

463 
	$ga_pÜt
(
addršfo
 *
aih—d
, 
pÜt
, 
sockty³
)

466 
nfound
 = 0;

467 
addršfo
 *
ai
;

469 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğai->
ai_Ãxt
) {

470 ià(
ai
->
ai_æags
 & 
AI_CLONE
) {

471 ià(
ai
->
ai_sockty³
 != 0) {

472 iàĞ(
ai
 = 
	`ga_şÚe
×i)è=ğ
NULL
)

476 } ià(
ai
->
ai_sockty³
 !ğ
sockty³
)

479 
ai
->
ai_sockty³
 = 
sockty³
;

481 
ai
->
ai_çmy
) {

482 #ifdef 
IPV4


483 
AF_INET
:

484 ((
sockaddr_š
 *è
ai
->
ai_addr
)->
sš_pÜt
 = 
pÜt
;

485 
nfound
++;

488 #ifdef 
IPV6


489 
AF_INET6
:

490 ((
sockaddr_š6
 *è
ai
->
ai_addr
)->
sš6_pÜt
 = 
pÜt
;

491 
nfound
++;

496 (
nfound
);

497 
	}
}

503 
addršfo
 *

504 
	$ga_şÚe
(
addršfo
 *
ai
)

506 
addršfo
 *
Ãw
;

508 iàĞ(
Ãw
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

509 (
NULL
);

511 
Ãw
->
ai_Ãxt
 = 
ai
->ai_next;

512 
ai
->
ai_Ãxt
 = 
Ãw
;

514 
Ãw
->
ai_æags
 = 0;

515 
Ãw
->
ai_çmy
 = 
ai
->ai_family;

516 
Ãw
->
ai_sockty³
 = 
ai
->ai_socktype;

517 
Ãw
->
ai_´ÙocŞ
 = 
ai
->ai_protocol;

518 
Ãw
->
ai_ÿnÚÇme
 = 
NULL
;

519 
Ãw
->
ai_add¾’
 = 
ai
->ai_addrlen;

520 iàĞ(
Ãw
->
ai_addr
 = 
	`m®loc
(
ai
->
ai_add¾’
)è=ğ
NULL
)

521 (
NULL
);

522 
	`memıy
(
Ãw
->
ai_addr
, 
ai
->ai_addr,‡i->
ai_add¾’
);

524 (
Ãw
);

525 
	}
}

527 #ifdef 
UNIXDOMAIN


534 
	$ga_unix
(cÚ¡ *
·th
, 
addršfo
 *
hšt¥
, addršfØ**
»suÉ
)

536 
addršfo
 *
ai
;

537 
sockaddr_un
 *
uÅ
;

539 ià(
hšt¥
->
ai_sockty³
 == 0)

540 (
EAI_SOCKTYPE
);

542 iàĞ(
ai
 = 
	`ÿÎoc
(1, (
addršfo
))è=ğ
NULL
)

543 (
NULL
);

545 
ai
->
ai_æags
 = 0;

546 
ai
->
ai_çmy
 = 
AF_LOCAL
;

547 
ai
->
ai_sockty³
 = 
hšt¥
->ai_socktype;

548 
ai
->
ai_´ÙocŞ
 = 0;

551 
ai
->
ai_add¾’
 = (
sockaddr_un
);

552 iàĞ(
ai
->
ai_addr
 = 
	`m®loc
×i->
ai_add¾’
)è=ğ
NULL
)

553 (
EAI_MEMORY
);

554 
uÅ
 = (
sockaddr_un
 *è
ai
->
ai_addr
;

555 
uÅ
->
sun_çmy
 = 
AF_UNIX
;

556 
	`¡ºıy
(
uÅ
->
sun_·th
, 
·th
, (unp->sun_path));

558 
ai
->
ai_ÿnÚÇme
 = 
NULL
;

559 
ai
->
ai_Ãxt
 = 
NULL
;

560 *
»suÉ
 = 
ai
;

562 ià(
hšt¥
->
ai_æags
 & 
AI_PASSIVE
)

563 
	`uÆšk
(
·th
);

566 
	}
}

570 
	$ä“addršfo
(
addršfo
 *
aih—d
)

572 
addršfo
 *
ai
, *
ašext
;

574 
ai
 = 
aih—d
;‡˜!ğ
NULL
;‡˜ğ
ašext
) {

575 ià(
ai
->
ai_addr
 !ğ
NULL
)

576 
	`ä“
(
ai
->
ai_addr
);

577 ià(
ai
->
ai_ÿnÚÇme
 !ğ
NULL
)

578 
	`ä“
(
ai
->
ai_ÿnÚÇme
);

579 
ašext
 = 
ai
->
ai_Ãxt
;

580 
	`ä“
(
ai
);

582 
	}
}

	@osi\unpv13e\unpv13e\libgai\test1.c

1 
	~"uÅ.h
"

10 
	$maš
(
¬gc
, **
¬gv
)

12 
ho¡’t
 *
h±r
;

14 ià(
¬gc
 != 2)

15 
	`”r_qu™
("usage:est2 <IPaddress>");

17 
	`´štf
("g‘ho¡byÇme2(%s, AF_INET): ", 
¬gv
[1]);

18 
h±r
 = 
	`g‘ho¡byÇme2
(
¬gv
[1], 
AF_INET
);

19 
	`´štf
("%s\n", (
h±r
 =ğ
NULL
) ? "failed" : "OK");

21 #ifdef 
IPv6


22 
	`´štf
("g‘ho¡byÇme2(%s, AF_INET6): ", 
¬gv
[1]);

23 
h±r
 = 
	`g‘ho¡byÇme2
(
¬gv
[1], 
AF_INET6
);

24 
	`´štf
("%s\n", (
h±r
 =ğ
NULL
) ? "failed" : "OK");

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\libgai\testga.c

1 
	~"uÅ.h
"

8 
do_”¹e¡
();

9 
do_funcÿÎ
(const *, const *, , , , , );

10 
do_Ú‘e¡
(*, *, 
addršfo
 *, );

11 cÚ¡ *
¡r_çm
();

12 cÚ¡ *
¡r_sock
();

13 
u§ge
(const *);

16 
	gvæag
;

19 
	$maš
(
¬gc
, **
¬gv
)

21 
dÛ¼‹¡
 = 0;

22 
loİcouÁ
 = 1;

23 
c
, 
i
;

24 *
ho¡
 = 
NULL
;

25 
ho¡buf
[
NI_MAXHOST
];

26 *
£rv
 = 
NULL
;

27 
£rvbuf
[
NI_MAXSERV
];

28 
´ÙÛÁ
 *
´Ùo
;

29 
addršfo
 
hšts
;

31 ià(
¬gc
 < 2)

32 
	`u§ge
("");

34 
	`mem£t
(&
hšts
, 0, (
addršfo
));

36 
İ‹¼
 = 0;

37  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "cef:h:l:pr:s:t:v")) != -1) {

38 
c
) {

40 
hšts
.
ai_æags
 |ğ
AI_CANONNAME
;

44 
dÛ¼‹¡
 = 1;

48 #ifdef 
IPv4


49 ià(
	`¡rcmp
(
İrg
, "inet") == 0) {

50 
hšts
.
ai_çmy
 = 
AF_INET
;

54 #ifdef 
IPv6


55 ià(
	`¡rcmp
(
İrg
, "inet6") == 0) {

56 
hšts
.
ai_çmy
 = 
AF_INET6
;

60 #ifdef 
UNIXdomaš


61 ià(
	`¡rcmp
(
İrg
, "unix") == 0) {

62 
hšts
.
ai_çmy
 = 
AF_LOCAL
;

66 
	`u§ge
("invalid -f option");

69 
	`¡ºıy
(
ho¡buf
, 
İrg
, 
NI_MAXHOST
-1);

70 
ho¡
 = 
ho¡buf
;

74 
loİcouÁ
 = 
	`©oi
(
İrg
);

78 
hšts
.
ai_æags
 |ğ
AI_PASSIVE
;

82 ià((
´Ùo
 = 
	`g‘´ÙobyÇme
(
İrg
)è=ğ
NULL
) {

83 
hšts
.
ai_´ÙocŞ
 = 
	`©oi
(
İrg
);

85 
hšts
.
ai_´ÙocŞ
 = 
´Ùo
->
p_´Ùo
;

90 
	`¡ºıy
(
£rvbuf
, 
İrg
, 
NI_MAXSERV
-1);

91 
£rv
 = 
£rvbuf
;

95 ià(
	`¡rcmp
(
İrg
, "stream") == 0) {

96 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

100 ià(
	`¡rcmp
(
İrg
, "dgram") == 0) {

101 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

105 ià(
	`¡rcmp
(
İrg
, "raw") == 0) {

106 
hšts
.
ai_sockty³
 = 
SOCK_RAW
;

110 #ifdef 
SOCK_RDM


111 ià(
	`¡rcmp
(
İrg
, "rdm") == 0) {

112 
hšts
.
ai_sockty³
 = 
SOCK_RDM
;

117 #ifdef 
SOCK_SEQPACKET


118 ià(
	`¡rcmp
(
İrg
, "seqpacket") == 0) {

119 
hšts
.
ai_sockty³
 = 
SOCK_SEQPACKET
;

123 
	`u§ge
("invalid -t option");

126 
væag
 = 1;

130 
	`u§ge
("unrecognized option");

133 ià(
İtšd
 < 
¬gc
) {

134 
	`u§ge
("extra‡rgs");

137 ià(
dÛ¼‹¡
) {

138 
	`do_”¹e¡
();

139 
	`ex™
(0);

142 
i
 = 1; i <ğ
loİcouÁ
; i++) {

143 ià(
	`do_Ú‘e¡
(
ho¡
, 
£rv
, &
hšts
, 
i
) > 0)

144 
	`ex™
(1);

146 ià(
i
 % 1000 == 0) {

147 
	`´štf
(" %d", 
i
);

148 
	`fæush
(
¡dout
);

152 
	`ex™
(0);

153 
	}
}

161 
	$do_”¹e¡
()

164 
	`do_funcÿÎ
(
NULL
, "áp", 
AI_PASSIVE
, 0, 0, 0, 0);

169 
	`do_funcÿÎ
("loÿlho¡", 
NULL
, 999999, 0, 0, 0, 
EAI_BADFLAGS
);

174 
	`do_funcÿÎ
("loÿlho¡", 
NULL
, 0, 
AF_SNA
, 0, 0, 
EAI_FAMILY
);

183 #ifdef 
nÙdef


186 
	`do_funcÿÎ
("foo.b¬.foo.b¬.foo.b¬.com", 
NULL
, 0, 0, 0, 0, 
EAI_NODATA
);

190 
	`do_funcÿÎ
(
NULL
, NULL, 0, 0, 0, 0, 
EAI_NONAME
);

193 
	`do_funcÿÎ
("lkjjkhjhghgfgfd", 
NULL
, 0, 0, 0, 0, 
EAI_NONAME
);

196 
	`do_funcÿÎ
(
NULL
, "nosuch£rviû", 0, 0, 0, 0, 
EAI_NONAME
);

199 
	`do_funcÿÎ
("loÿlho¡", "‹Ê‘", 0, 0, 
SOCK_DGRAM
, 0, 
EAI_SERVICE
);

202 
	`do_funcÿÎ
("loÿlho¡", "táp", 0, 0, 
SOCK_STREAM
, 0, 
EAI_SERVICE
);

205 
	`do_funcÿÎ
("loÿlho¡", 
NULL
, 0, 
AF_INET
, 
SOCK_SEQPACKET
, 0, 
EAI_SOCKTYPE
);

208 
	}
}

211 
	$do_funcÿÎ
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
,

212 
æags
, 
çmy
, 
sockty³
, 
´ÙocŞ
, 
ex´c
)

214 
rc
;

215 
addršfo
 
hšts
, *
»s
;

217 
	`mem£t
(&
hšts
, 0, (
addršfo
));

218 
hšts
.
ai_æags
 = 
æags
;

219 
hšts
.
ai_çmy
 = 
çmy
;

220 
hšts
.
ai_sockty³
 = 
sockty³
;

221 
hšts
.
ai_´ÙocŞ
 = 
´ÙocŞ
;

223 
rc
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
);

224 ià(
rc
 !ğ
ex´c
) {

225 
	`´štf
("expected„eturn = %d (%s),\nactual„eturn = %d (%s)\n",

226 
ex´c
, 
	`gai_¡»¼Ü
Óx´c), 
rc
, gai_strerror(rc));

227 ià(
ho¡
 !ğ
NULL
)

228 
	`´štf
(" ho¡ = %s\n", 
ho¡
);

229 ià(
£rv
 !ğ
NULL
)

230 
	`´štf
(" s”v = %s\n", 
£rv
);

231 
	`´štf
(" flags = %d, family = %s, socktype = %s,…rotocol = %d\n",

232 
æags
, 
	`¡r_çm
(
çmy
), 
	`¡r_sock
(
sockty³
), 
´ÙocŞ
);

233 
	`ex™
(2);

235 
	}
}

238 
	$do_Ú‘e¡
(*
ho¡
, *
£rv
, 
addršfo
 *
hšts
, 
™”©iÚ
)

240 
rc
, 
fd
, 
v”bo£
;

241 
addršfo
 *
»s
, *
»scİy
;

242 
rho¡
[
NI_MAXHOST
], 
r£rv
[
NI_MAXSERV
];

244 
v”bo£
 = 
væag
 && (
™”©iÚ
 == 1);

246 ià(
ho¡
 !ğ
NULL
 && 
v”bo£
)

247 
	`´štf
("ho¡ = %s\n", 
ho¡
);

248 ià(
£rv
 !ğ
NULL
 && 
v”bo£
)

249 
	`´štf
("£rv = %s\n", 
£rv
);

251 
rc
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, 
hšts
, &
»s
);

252 ià(
rc
 != 0) {

253 
	`´štf
("g‘addršfØ»tuº codğ%d (%s)\n", 
rc
, 
	`gai_¡»¼Ü
(rc));

257 
»scİy
 = 
»s
;

259 ià(
™”©iÚ
 == 1) {

260 
	`´štf
("\nsock‘(%s, %s, %d)", 
	`¡r_çm
(
»s
->
ai_çmy
),

261 
	`¡r_sock
(
»s
->
ai_sockty³
),„es->
ai_´ÙocŞ
);

264 ià(
hšts
->
ai_æags
 & 
AI_CANONNAME
) {

265 ià(
»s
->
ai_ÿnÚÇme
)

266 
	`´štf
(",‡i_ÿnÚÇmğ%s", 
»s
->
ai_ÿnÚÇme
);

268 
	`´štf
("\n");

270 
	`´štf
("\taddress: %s\n",

271 
	`Sock_Áİ
(
»s
->
ai_addr
,„es->
ai_add¾’
));

275 
fd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

276 ià(
fd
 < 0)

277 
	`´štf
("callo socket() failed!\n");

279 
	`şo£
(
fd
);

285 
rc
 = 
	`g‘Çmešfo
(
»s
->
ai_addr
,„es->
ai_add¾’
,

286 
rho¡
, 
NI_MAXHOST
, 
r£rv
, 
NI_MAXSERV
,

287 (
»s
->
ai_sockty³
 =ğ
SOCK_DGRAM
è? 
NI_DGRAM
: 0);

288 ià(
rc
 == 0) {

289 ià(
v”bo£
)

290 
	`´štf
("\tgetnameinfo: host = %s, serv = %s\n",

291 
rho¡
, 
r£rv
);

293 
	`´štf
("g‘ÇmešfØ»tuºed %d (%s)\n", 
rc
, 
	`gai_¡»¼Ü
(rc));

295 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

297 
	`ä“addršfo
(
»scİy
);

299 
	}
}

302 
	$u§ge
(cÚ¡ *
msg
)

304 
	`´štf
(

319 ià(
msg
[0] != 0)

320 
	`´štf
("%s\n", 
msg
);

321 
	`ex™
(1);

322 
	}
}

325 
	$¡r_çm
(
çmy
)

327 #ifdef 
IPv4


328 ià(
çmy
 =ğ
AF_INET
)

331 #ifdef 
IPv6


332 ià(
çmy
 =ğ
AF_INET6
)

335 #ifdef 
UNIXdomaš


336 ià(
çmy
 =ğ
AF_LOCAL
)

340 
	}
}

343 
	$¡r_sock
(
sockty³
)

345 
sockty³
) {

346 
SOCK_STREAM
:  "SOCK_STREAM";

347 
SOCK_DGRAM
:  "SOCK_DGRAM";

348 
SOCK_RAW
:  "SOCK_RAW";

349 #ifdeà
SOCK_RDM


350 
SOCK_RDM
:  "SOCK_RDM";

352 #ifdeà
SOCK_SEQPACKET


353 
SOCK_SEQPACKET
: "SOCK_SEQPACKET";

357 
	}
}

	@osi\unpv13e\unpv13e\libroute\get_rtaddrs.c

1 
	~"uÅrou‹.h
"

6 
	#ROUNDUP
(
a
, 
size
è((×è& ((size)-1)è? (1 + (×è| ((size)-1))è: (a))

	)

12 
	#NEXT_SA
(
­
è­ = (
SA
 *) \

13 ((
ÿddr_t
è
­
 + (­->
§_Ën
 ? 
	`ROUNDUP
×p->§_Ën,  (
u_lÚg
)) : \

14 (
u_lÚg
)))

	)

17 
	$g‘_¹addrs
(
addrs
, 
SA
 *
§
, SA **
¹i_šfo
)

19 
i
;

21 
i
 = 0; i < 
RTAX_MAX
; i++) {

22 ià(
addrs
 & (1 << 
i
)) {

23 
¹i_šfo
[
i
] = 
§
;

24 
	`NEXT_SA
(
§
);

26 
¹i_šfo
[
i
] = 
NULL
;

28 
	}
}

	@osi\unpv13e\unpv13e\libroute\if_indextoname.c

2 
	~"uÅifi.h
"

3 
	~"uÅrou‹.h
"

6 
	$if_šdextÚame
(
idx
, *
Çme
)

8 *
buf
, *
Ãxt
, *
lim
;

9 
size_t
 
Ën
;

10 
if_msghdr
 *
ifm
;

11 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

12 
sockaddr_dl
 *
sdl
;

14 iàĞ(
buf
 = 
	`Ãt_¹_iæi¡
(0, 
idx
, &
Ën
)è=ğ
NULL
)

15 (
NULL
);

17 
lim
 = 
buf
 + 
Ën
;

18 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
ifm
->
ifm_msgËn
) {

19 
ifm
 = (
if_msghdr
 *è
Ãxt
;

20 ià(
ifm
->
ifm_ty³
 =ğ
RTM_IFINFO
) {

21 
§
 = (
sockaddr
 *è(
ifm
 + 1);

22 
	`g‘_¹addrs
(
ifm
->
ifm_addrs
, 
§
, 
¹i_šfo
);

23 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFP
]è!ğ
NULL
) {

24 ià(
§
->
§_çmy
 =ğ
AF_LINK
) {

25 
sdl
 = (
sockaddr_dl
 *è
§
;

26 ià(
sdl
->
sdl_šdex
 =ğ
idx
) {

27 
¦’
 = 
	`mš
(
IFNAMSIZ
 - 1, 
sdl
->
sdl_Æ’
);

28 
	`¡ºıy
(
Çme
, 
sdl
->
sdl_d©a
, 
¦’
);

29 
Çme
[
¦’
] = 0;

30 
	`ä“
(
buf
);

31 (
Çme
);

38 
	`ä“
(
buf
);

39 (
NULL
);

40 
	}
}

44 
	$If_šdextÚame
(
idx
, *
Çme
)

46 *
±r
;

48 iàĞ(
±r
 = 
	`if_šdextÚame
(
idx
, 
Çme
)è=ğ
NULL
)

49 
	`”r_qu™
("if_šdextÚam”rÜ fÜ %d", 
idx
);

50 (
±r
);

51 
	}
}

	@osi\unpv13e\unpv13e\libroute\if_nameindex.c

2 
	~"uÅifi.h
"

3 
	~"uÅrou‹.h
"

5 
if_Çmešdex
 *

6 
	$if_Çmešdex
()

8 *
buf
, *
Ãxt
, *
lim
;

9 
size_t
 
Ën
;

10 
if_msghdr
 *
ifm
;

11 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

12 
sockaddr_dl
 *
sdl
;

13 
if_Çmešdex
 *
»suÉ
, *
iåŒ
;

14 *
Çm±r
;

16 iàĞ(
buf
 = 
	`Ãt_¹_iæi¡
(0, 0, &
Ën
)è=ğ
NULL
)

17 (
NULL
);

19 iàĞ(
»suÉ
 = 
	`m®loc
(
Ën
)è=ğ
NULL
)

20 (
NULL
);

21 
iåŒ
 = 
»suÉ
;

22 
Çm±r
 = (*è
»suÉ
 + 
Ën
;

24 
lim
 = 
buf
 + 
Ën
;

25 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
ifm
->
ifm_msgËn
) {

26 
ifm
 = (
if_msghdr
 *è
Ãxt
;

27 ià(
ifm
->
ifm_ty³
 =ğ
RTM_IFINFO
) {

28 
§
 = (
sockaddr
 *è(
ifm
 + 1);

29 
	`g‘_¹addrs
(
ifm
->
ifm_addrs
, 
§
, 
¹i_šfo
);

30 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFP
]è!ğ
NULL
) {

31 ià(
§
->
§_çmy
 =ğ
AF_LINK
) {

32 
sdl
 = (
sockaddr_dl
 *è
§
;

33 
Çm±r
 -ğ
sdl
->
sdl_Æ’
 + 1;

34 
	`¡ºıy
(
Çm±r
, &
sdl
->
sdl_d©a
[0], sdl->
sdl_Æ’
);

35 
Çm±r
[
sdl
->
sdl_Æ’
] = 0;

36 
iåŒ
->
if_Çme
 = 
Çm±r
;

37 
iåŒ
->
if_šdex
 = 
sdl
->
sdl_šdex
;

38 
iåŒ
++;

44 
iåŒ
->
if_Çme
 = 
NULL
;

45 
iåŒ
->
if_šdex
 = 0;

46 
	`ä“
(
buf
);

47 (
»suÉ
);

48 
	}
}

53 
	$if_ä“Çmešdex
(
if_Çmešdex
 *
±r
)

55 
	`ä“
(
±r
);

56 
	}
}

59 
if_Çmešdex
 *

60 
	$If_Çmešdex
()

62 
if_Çmešdex
 *
iåŒ
;

64 iàĞ(
iåŒ
 = 
	`if_Çmešdex
()è=ğ
NULL
)

65 
	`”r_qu™
("if_nameindexƒrror");

66 (
iåŒ
);

67 
	}
}

	@osi\unpv13e\unpv13e\libroute\if_nametoindex.c

2 
	~"uÅifi.h
"

3 
	~"uÅrou‹.h
"

6 
	$if_Çm‘ošdex
(cÚ¡ *
Çme
)

8 
idx
, 
Çm–’
;

9 *
buf
, *
Ãxt
, *
lim
;

10 
size_t
 
Ën
;

11 
if_msghdr
 *
ifm
;

12 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

13 
sockaddr_dl
 *
sdl
;

15 iàĞ(
buf
 = 
	`Ãt_¹_iæi¡
(0, 0, &
Ën
)è=ğ
NULL
)

18 
Çm–’
 = 
	`¡¾’
(
Çme
);

19 
lim
 = 
buf
 + 
Ën
;

20 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
ifm
->
ifm_msgËn
) {

21 
ifm
 = (
if_msghdr
 *è
Ãxt
;

22 ià(
ifm
->
ifm_ty³
 =ğ
RTM_IFINFO
) {

23 
§
 = (
sockaddr
 *è(
ifm
 + 1);

24 
	`g‘_¹addrs
(
ifm
->
ifm_addrs
, 
§
, 
¹i_šfo
);

25 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFP
]è!ğ
NULL
) {

26 ià(
§
->
§_çmy
 =ğ
AF_LINK
) {

27 
sdl
 = (
sockaddr_dl
 *è
§
;

28 ià(
sdl
->
sdl_Æ’
 =ğ
Çm–’
 && 
	`¡ºcmp
(&sdl->
sdl_d©a
[0], 
Çme
, sdl->sdl_nlen) == 0) {

29 
idx
 = 
sdl
->
sdl_šdex
;

30 
	`ä“
(
buf
);

31 (
idx
);

38 
	`ä“
(
buf
);

40 
	}
}

44 
	$If_Çm‘ošdex
(cÚ¡ *
Çme
)

46 
idx
;

48 iàĞ(
idx
 = 
	`if_Çm‘ošdex
(
Çme
)) == 0)

49 
	`”r_qu™
("if_Çm‘ošdexƒ¼Ü fÜ %s", 
Çme
);

50 (
idx
);

51 
	}
}

	@osi\unpv13e\unpv13e\libroute\net_rt_dump.c

2 
	~"uÅrou‹.h
"

5 
	$Ãt_¹_dump
(
çmy
, 
æags
, 
size_t
 *
ËÅ
)

7 
mib
[6];

8 *
buf
;

10 
mib
[0] = 
CTL_NET
;

11 
mib
[1] = 
AF_ROUTE
;

12 
mib
[2] = 0;

13 
mib
[3] = 
çmy
;

14 
mib
[4] = 
NET_RT_DUMP
;

15 
mib
[5] = 
æags
;

16 ià(
	`sysùl
(
mib
, 6, 
NULL
, 
ËÅ
, NULL, 0) < 0)

17 (
NULL
);

19 iàĞ(
buf
 = 
	`m®loc
(*
ËÅ
)è=ğ
NULL
)

20 (
NULL
);

21 ià(
	`sysùl
(
mib
, 6, 
buf
, 
ËÅ
, 
NULL
, 0) < 0)

22 (
NULL
);

24 (
buf
);

25 
	}
}

29 
	$N‘_¹_dump
(
çmy
, 
æags
, 
size_t
 *
ËÅ
)

31 *
±r
;

33 iàĞ(
±r
 = 
	`Ãt_¹_dump
(
çmy
, 
æags
, 
ËÅ
)è=ğ
NULL
)

34 
	`”r_sys
("net_rt_dumpƒrror");

35 (
±r
);

36 
	}
}

	@osi\unpv13e\unpv13e\libroute\net_rt_iflist.c

2 
	~"uÅrou‹.h
"

5 
	$Ãt_¹_iæi¡
(
çmy
, 
æags
, 
size_t
 *
ËÅ
)

7 
mib
[6];

8 *
buf
;

10 
mib
[0] = 
CTL_NET
;

11 
mib
[1] = 
AF_ROUTE
;

12 
mib
[2] = 0;

13 
mib
[3] = 
çmy
;

14 
mib
[4] = 
NET_RT_IFLIST
;

15 
mib
[5] = 
æags
;

16 ià(
	`sysùl
(
mib
, 6, 
NULL
, 
ËÅ
, NULL, 0) < 0)

17 (
NULL
);

19 iàĞ(
buf
 = 
	`m®loc
(*
ËÅ
)è=ğ
NULL
)

20 (
NULL
);

21 ià(
	`sysùl
(
mib
, 6, 
buf
, 
ËÅ
, 
NULL
, 0) < 0) {

22 
	`ä“
(
buf
);

23 (
NULL
);

26 (
buf
);

27 
	}
}

31 
	$N‘_¹_iæi¡
(
çmy
, 
æags
, 
size_t
 *
ËÅ
)

33 *
±r
;

35 iàĞ(
±r
 = 
	`Ãt_¹_iæi¡
(
çmy
, 
æags
, 
ËÅ
)è=ğ
NULL
)

36 
	`”r_sys
("net_rt_iflistƒrror");

37 (
±r
);

38 
	}
}

	@osi\unpv13e\unpv13e\libroute\sock_masktop.c

1 
	~"uÅrou‹.h
"

4 
	$sock_masktİ
(
SA
 *
§
, 
sockËn_t
 
§Ën
)

6 
¡r
[
INET6_ADDRSTRLEN
];

7 *
±r
 = &
§
->
§_d©a
[2];

9 ià(
§
->
§_Ën
 == 0)

11 ià(
§
->
§_Ën
 == 5)

12 
	`¢´štf
(
¡r
, (¡r), "%d.0.0.0", *
±r
);

13 ià(
§
->
§_Ën
 == 6)

14 
	`¢´štf
(
¡r
, (¡r), "%d.%d.0.0", *
±r
, *(ptr+1));

15 ià(
§
->
§_Ën
 == 7)

16 
	`¢´štf
(
¡r
, (¡r), "%d.%d.%d.0", *
±r
, *(ptr+1), *(ptr+2));

17 ià(
§
->
§_Ën
 == 8)

18 
	`¢´štf
(
¡r
, (str), "%d.%d.%d.%d",

19 *
±r
, *(ptr+1), *(ptr+2), *(ptr+3));

21 
	`¢´štf
(
¡r
, (str), "(unknown mask,†en = %d, family = %d)",

22 
§
->
§_Ën
, sa->
§_çmy
);

23 (
¡r
);

24 
	}
}

	@osi\unpv13e\unpv13e\libroute\unproute.h

1 
	~"uÅ.h
"

2 
	~<Ãt/if.h
>

3 
	~<Ãt/if_dl.h
>

4 
	~<Ãt/rou‹.h
>

5 
	~<sys/·¿m.h
>

7 #ifdef 
HAVE_SYS_SYSCTL_H


8 
	~<sys/sysùl.h
>

12 
g‘_¹addrs
(, 
sockaddr
 *, sockaddr **);

13 *
Ãt_¹_iæi¡
(, , 
size_t
 *);

14 *
Ãt_¹_dump
(, , 
size_t
 *);

15 cÚ¡ *
sock_masktİ
(
sockaddr
 *, 
sockËn_t
);

18 *
N‘_¹_iæi¡
(, , 
size_t
 *);

19 *
N‘_¹_dump
(, , 
size_t
 *);

20 
	#Sock_masktİ
(
a
,
b
è
	`sock_masktİ
(×), (b))

	)

	@osi\unpv13e\unpv13e\mcast\dgclibcast1.c

1 
	~"uÅ.h
"

3 
»cväom_®¬m
();

6 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

8 
n
;

9 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

10 
sockËn_t
 
Ën
;

11 
sockaddr
 *
´•ly_addr
;

13 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

15 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

17 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

19 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

21 
	`®¬m
(5);

23 
Ën
 = 
£rvËn
;

24 
n
 = 
	`»cväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

25 ià(
n
 == -1) {

26 ià(
”ºo
 =ğ
EINTR
)

29 
	`”r_sys
("recvfromƒrror");

31 
»cvlše
[
n
] = 0;

32 
	`´štf
("from %s: %s",

33 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
£rvËn
), 
»cvlše
);

37 
	}
}

40 
	$»cväom_®¬m
(
signo
)

43 
	}
}

	@osi\unpv13e\unpv13e\mcast\dgclimcast5.c

1 
	~"uÅ.h
"

2 
	~<£tjmp.h
>

4 
»cväom_®¬m
();

5 
sigjmp_buf
 
	gjmpbuf
;

8 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

10 
n
;

11 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

12 
sockËn_t
 
Ën
;

13 
sockaddr
 *
´•ly_addr
;

15 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

17 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

19 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

21 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

23 
	`®¬m
(5);

25 ià(
	`sig£tjmp
(
jmpbuf
, 1) != 0)

27 
Ën
 = 
£rvËn
;

28 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

29 
»cvlše
[
n
] = 0;

30 
	`´štf
("from %s: %s",

31 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
£rvËn
), 
»cvlše
);

34 
	}
}

37 
	$»cväom_®¬m
(
signo
)

39 
	`siglÚgjmp
(
jmpbuf
, 1);

40 
	}
}

	@osi\unpv13e\unpv13e\mcast\dgclimcast6.c

1 
	~"uÅ.h
"

2 
	~<£tjmp.h
>

4 
»cväom_®¬m
();

5 
sigjmp_buf
 
	gjmpbuf
;

8 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

10 
n
;

11 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

12 
sockËn_t
 
Ën
;

13 
sockaddr
 *
´•ly_addr
;

15 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

17 
	`SigÇl
(
SIGALRM
, 
»cväom_®¬m
);

19 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

21 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

23 
	`®¬m
(5);

25 ià(
	`sig£tjmp
(
jmpbuf
, 1) != 0)

27 
Ën
 = 
£rvËn
;

28 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

29 
»cvlše
[
n
] = 0;

30 
	`´štf
("from %s: %s",

31 
	`Sock_Áİ_ho¡
(
´•ly_addr
, 
£rvËn
), 
»cvlše
);

34 
	}
}

37 
	$»cväom_®¬m
(
signo
)

39 
	`siglÚgjmp
(
jmpbuf
, 1);

40 
	}
}

	@osi\unpv13e\unpv13e\mcast\main.c

1 
	~"uÅ.h
"

3 
»cv_®l
(, 
sockËn_t
);

4 
£nd_®l
(, 
SA
 *, 
sockËn_t
);

7 
	$maš
(
¬gc
, **
¬gv
)

9 
£ndfd
, 
»cvfd
;

10 cÚ¡ 
Ú
 = 1;

11 
sockËn_t
 
§Ën
;

12 
sockaddr
 *
§£nd
, *
§»cv
;

14 ià(
¬gc
 != 3)

15 
	`”r_qu™
("usage: sendrecv <IP-multicast-address> <port#>");

17 
£ndfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§£nd
, &
§Ën
);

19 
»cvfd
 = 
	`Sock‘
(
§£nd
->
§_çmy
, 
SOCK_DGRAM
, 0);

21 
	`S‘sockİt
(
»cvfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

23 
§»cv
 = 
	`M®loc
(
§Ën
);

24 
	`memıy
(
§»cv
, 
§£nd
, 
§Ën
);

25 
	`Bšd
(
»cvfd
, 
§»cv
, 
§Ën
);

27 
	`Mÿ¡_još
(
»cvfd
, 
§£nd
, 
§Ën
, 
NULL
, 0);

28 
	`Mÿ¡_£t_loİ
(
£ndfd
, 0);

30 ià(
	`FÜk
() == 0)

31 
	`»cv_®l
(
»cvfd
, 
§Ën
);

33 
	`£nd_®l
(
£ndfd
, 
§£nd
, 
§Ën
);

34 
	}
}

	@osi\unpv13e\unpv13e\mcast\recv.c

1 
	~"uÅ.h
"

4 
	$»cv_®l
(
»cvfd
, 
sockËn_t
 
§Ën
)

6 
n
;

7 
lše
[
MAXLINE
+1];

8 
sockËn_t
 
Ën
;

9 
sockaddr
 *
§äom
;

11 
§äom
 = 
	`M®loc
(
§Ën
);

14 
Ën
 = 
§Ën
;

15 
n
 = 
	`Recväom
(
»cvfd
, 
lše
, 
MAXLINE
, 0, 
§äom
, &
Ën
);

17 
lše
[
n
] = 0;

18 
	`´štf
("äom %s: %s", 
	`Sock_Áİ
(
§äom
, 
Ën
), 
lše
);

20 
	}
}

	@osi\unpv13e\unpv13e\mcast\send.c

1 
	~"uÅ.h
"

2 
	~<sys/ut¢ame.h
>

4 
	#SENDRATE
 5

	)

7 
	$£nd_®l
(
£ndfd
, 
SA
 *
§de¡
, 
sockËn_t
 
§Ën
)

9 
lše
[
MAXLINE
];

10 
ut¢ame
 
myÇme
;

12 ià(
	`uÇme
(&
myÇme
) < 0)

13 
	`”r_sys
("unameƒrror");;

14 
	`¢´štf
(
lše
, Öše), "%s, %d\n", 
myÇme
.
nod’ame
, 
	`g‘pid
());

17 
	`S’dto
(
£ndfd
, 
lše
, 
	`¡¾’
Öše), 0, 
§de¡
, 
§Ën
);

19 
	`¦“p
(
SENDRATE
);

21 
	}
}

	@osi\unpv13e\unpv13e\mcast\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli01 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\mcast\udpcli05.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli05 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\mcast\udpcli06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
§Ën
;

8 
sockaddr
 *
şi
, *
£rv
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage: udpcli06 <IPaddress>");

13 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1], "daytime", (**è&
£rv
, &
§Ën
);

15 
şi
 = 
	`M®loc
(
§Ën
);

16 
	`memıy
(
şi
, 
£rv
, 
§Ën
);

17 
	`sock_£t_pÜt
(
şi
, 
§Ën
, 0);

18 
	`Bšd
(
sockfd
, 
şi
, 
§Ën
);

20 
	`dg_şi
(
¡dš
, 
sockfd
, 
£rv
, 
§Ën
);

22 
	`ex™
(0);

23 
	}
}

	@osi\unpv13e\unpv13e\mcast\udpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
g½addr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`bz”o
(&
g½addr
, (
£rvaddr
));

19 
g½addr
.
sš_çmy
 = 
AF_INET
;

20 
g½addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
("224.0.0.1");

22 
	`mÿ¡_još
(
sockfd
, &
g½addr
, (g½addr), 
NULL
, 0);

24 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

25 
	}
}

	@osi\unpv13e\unpv13e\mysdr\loop.c

1 
	~"mysdr.h
"

4 
	$loİ
(
sockfd
, 
sockËn_t
 
§Ën
)

6 
sockËn_t
 
Ën
;

7 
ssize_t
 
n
;

8 *
p
;

9 
sockaddr
 *
§
;

10 
	s§p_·ck‘
 {

11 
ušt32_t
 
§p_h—d”
;

12 
ušt32_t
 
§p_¤c
;

13 
§p_d©a
[
BUFFSIZE
];

14 } 
buf
;

16 
§
 = 
	`M®loc
(
§Ën
);

19 
Ën
 = 
§Ën
;

20 
n
 = 
	`Recväom
(
sockfd
, &
buf
, (bufè- 1, 0, 
§
, &
Ën
);

21 ((*)&
buf
)[
n
] = 0;

22 
buf
.
§p_h—d”
 = 
	`Áohl
(buf.sap_header);

24 
	`´štf
("From % hash 0x%04x\n", 
	`Sock_Áİ
(
§
, 
Ën
),

25 
buf
.
§p_h—d”
 & 
SAP_HASH_MASK
);

26 ià(((
buf
.
§p_h—d”
 & 
SAP_VERSION_MASK
è>> 
SAP_VERSION_SHIFT
) > 1) {

27 
	`”r_msg
("... v”siÚ f›ld‚Ù 1 (0x%08x)", 
buf
.
§p_h—d”
);

30 ià(
buf
.
§p_h—d”
 & 
SAP_IPV6
) {

31 
	`”r_msg
("... IPv6");

34 ià(
buf
.
§p_h—d”
 & (
SAP_DELETE
|
SAP_ENCRYPTED
|
SAP_COMPRESSED
)) {

35 
	`”r_msg
("... cª'ˆ·r£hi ·ck‘y³ (0x%08x)", 
buf
.
§p_h—d”
);

38 
p
 = 
buf
.
§p_d©a
 + ((buf.
§p_h—d”
 & 
SAP_AUTHLEN_MASK
)

39 >> 
SAP_AUTHLEN_SHIFT
);

40 ià(
	`¡rcmp
(
p
, "application/sdp") == 0)

41 
p
 += 16;

42 
	`´štf
("%s\n", 
p
);

44 
	}
}

	@osi\unpv13e\unpv13e\mysdr\main.c

1 
	~"uÅ.h
"

3 
	#SAP_NAME
 "§p.mÿ¡.Ãt"

	)

4 
	#SAP_PORT
 "9875"

	)

6 
loİ
(, 
sockËn_t
);

9 
	$maš
(
¬gc
, **
¬gv
)

11 
sockfd
;

12 cÚ¡ 
Ú
 = 1;

13 
sockËn_t
 
§Ën
;

14 
sockaddr
 *
§
;

16 ià(
¬gc
 == 1)

17 
sockfd
 = 
	`Udp_ş›Á
(
SAP_NAME
, 
SAP_PORT
, (**è&
§
, &
§Ën
);

18 ià(
¬gc
 == 4)

19 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

21 
	`”r_qu™
("usage: mysdr <mcast-addr> <port#> <interface-name>");

23 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

24 
	`Bšd
(
sockfd
, 
§
, 
§Ën
);

26 
	`Mÿ¡_još
(
sockfd
, 
§
, 
§Ën
, (
¬gc
 =ğ4è? 
¬gv
[3] : 
NULL
, 0);

28 
	`loİ
(
sockfd
, 
§Ën
);

30 
	`ex™
(0);

31 
	}
}

	@osi\unpv13e\unpv13e\mysdr\mysdr.h

1 
	~"uÅ.h
"

3 
	#SAP_VERSION
 1

	)

4 
	#SAP_VERSION_MASK
 0xe0000000

	)

5 
	#SAP_VERSION_SHIFT
 29

	)

6 
	#SAP_IPV6
 0x10000000

	)

7 
	#SAP_DELETE
 0x04000000

	)

8 
	#SAP_ENCRYPTED
 0x02000000

	)

9 
	#SAP_COMPRESSED
 0x01000000

	)

10 
	#SAP_AUTHLEN_MASK
 0x00ff0000

	)

11 
	#SAP_AUTHLEN_SHIFT
 16

	)

12 
	#SAP_HASH_MASK
 0x0000ffff

	)

	@osi\unpv13e\unpv13e\names\daytimetcpcli.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr_¡Üage
 
ss
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage: daytimetcpcli <hostname/IPaddress> <service/port#>");

14 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

16 
Ën
 = (
ss
);

17 
	`G‘³”Çme
(
sockfd
, (
SA
 *)&
ss
, &
Ën
);

18 
	`´štf
("cÚÃùedØ%s\n", 
	`Sock_Áİ_ho¡
((
SA
 *)&
ss
, 
Ën
));

20  (
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

21 
»cvlše
[
n
] = 0;

22 
	`Fputs
(
»cvlše
, 
¡dout
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpcli1.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

9 
š_addr
 **
µŒ
;

10 
š_addr
 *
š‘add½
[2];

11 
š_addr
 
š‘addr
;

12 
ho¡’t
 *
hp
;

13 
£rv’t
 *
¥
;

15 ià(
¬gc
 != 3)

16 
	`”r_qu™
("usage: daytimetcpcli1 <hostname> <service>");

18 iàĞ(
hp
 = 
	`g‘ho¡byÇme
(
¬gv
[1])è=ğ
NULL
) {

19 ià(
	`š‘_©Ú
(
¬gv
[1], &
š‘addr
) == 0) {

20 
	`”r_qu™
("ho¡Çm”rÜ fÜ %s: %s", 
¬gv
[1], 
	`h¡»¼Ü
(
h_”ºo
));

22 
š‘add½
[0] = &
š‘addr
;

23 
š‘add½
[1] = 
NULL
;

24 
µŒ
 = 
š‘add½
;

27 
µŒ
 = (
š_addr
 **è
hp
->
h_addr_li¡
;

30 iàĞ(
¥
 = 
	`g‘£rvbyÇme
(
¬gv
[2], "tı")è=ğ
NULL
)

31 
	`”r_qu™
("g‘£rvbyÇm”rÜ fÜ %s", 
¬gv
[2]);

33  ; *
µŒ
 !ğ
NULL
;…ptr++) {

34 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

36 
	`bz”o
(&
£rvaddr
, (servaddr));

37 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

38 
£rvaddr
.
sš_pÜt
 = 
¥
->
s_pÜt
;

39 
	`memıy
(&
£rvaddr
.
sš_addr
, *
µŒ
, (
š_addr
));

40 
	`´štf
("trying %s\n",

41 
	`Sock_Áİ
((
SA
 *è&
£rvaddr
, (servaddr)));

43 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) == 0)

45 
	`”r_»t
("connectƒrror");

46 
	`şo£
(
sockfd
);

48 ià(*
µŒ
 =ğ
NULL
)

49 
	`”r_qu™
("unableo connect");

51  (
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

52 
»cvlše
[
n
] = 0;

53 
	`Fputs
(
»cvlše
, 
¡dout
);

55 
	`ex™
(0);

56 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpcli2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

9 
š_addr
 **
µŒ
, *
addrs
[2];

10 
ho¡’t
 *
hp
;

11 
£rv’t
 *
¥
;

13 ià(
¬gc
 != 3)

14 
	`”r_qu™
("usage: daytimetcpcli2 <hostname> <service>");

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

19 ià(
	`š‘_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
) == 1) {

20 
addrs
[0] = &
£rvaddr
.
sš_addr
;

21 
addrs
[1] = 
NULL
;

22 
µŒ
 = &
addrs
[0];

23 } iàĞ(
hp
 = 
	`g‘ho¡byÇme
(
¬gv
[1])è!ğ
NULL
) {

24 
µŒ
 = (
š_addr
 **è
hp
->
h_addr_li¡
;

26 
	`”r_qu™
("ho¡Çm”rÜ fÜ %s: %s", 
¬gv
[1], 
	`h¡»¼Ü
(
h_”ºo
));

28 iàĞ(
n
 = 
	`©oi
(
¬gv
[2])) > 0)

29 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
n
);

30 iàĞ(
¥
 = 
	`g‘£rvbyÇme
(
¬gv
[2], "tı")è!ğ
NULL
)

31 
£rvaddr
.
sš_pÜt
 = 
¥
->
s_pÜt
;

33 
	`”r_qu™
("g‘£rvbyÇm”rÜ fÜ %s", 
¬gv
[2]);

35  ; *
µŒ
 !ğ
NULL
;…ptr++) {

36 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

38 
	`memmove
(&
£rvaddr
.
sš_addr
, *
µŒ
, (
š_addr
));

39 
	`´štf
("trying %s\n",

40 
	`Sock_Áİ
((
SA
 *è&
£rvaddr
, (servaddr)));

42 ià(
	`cÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr)) == 0)

44 
	`”r_»t
("connectƒrror");

45 
	`şo£
(
sockfd
);

47 ià(*
µŒ
 =ğ
NULL
)

48 
	`”r_qu™
("unableo connect");

50  (
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

51 
»cvlše
[
n
] = 0;

52 
	`Fputs
(
»cvlše
, 
¡dout
);

54 
	`ex™
(0);

55 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpcli3.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
£rvaddr
;

9 
sockaddr_š6
 
£rvaddr6
;

10 
sockaddr
 *
§
;

11 
sockËn_t
 
§Ën
;

12 
š_addr
 **
µŒ
;

13 
ho¡’t
 *
hp
;

14 
£rv’t
 *
¥
;

16 ià(
¬gc
 != 3)

17 
	`”r_qu™
("usage: daytimetcpcli3 <hostname> <service>");

19 iàĞ(
hp
 = 
	`g‘ho¡byÇme
(
¬gv
[1])è=ğ
NULL
)

20 
	`”r_qu™
("ho¡Çm”rÜ fÜ %s: %s", 
¬gv
[1], 
	`h¡»¼Ü
(
h_”ºo
));

22 iàĞ(
¥
 = 
	`g‘£rvbyÇme
(
¬gv
[2], "tı")è=ğ
NULL
)

23 
	`”r_qu™
("g‘£rvbyÇm”rÜ fÜ %s", 
¬gv
[2]);

25 
µŒ
 = (
š_addr
 **è
hp
->
h_addr_li¡
;

26  ; *
µŒ
 !ğ
NULL
;…ptr++) {

27 
sockfd
 = 
	`Sock‘
(
hp
->
h_add¹y³
, 
SOCK_STREAM
, 0);

29 ià(
hp
->
h_add¹y³
 =ğ
AF_INET
) {

30 
§
 = (
SA
 *è&
£rvaddr
;

31 
§Ën
 = (
£rvaddr
);

32 } ià(
hp
->
h_add¹y³
 =ğ
AF_INET6
) {

33 
§
 = (
SA
 *è&
£rvaddr6
;

34 
§Ën
 = (
£rvaddr6
);

36 
	`”r_qu™
("unknowÀadd¹y³ %d", 
hp
->
h_add¹y³
);

38 
	`bz”o
(
§
, 
§Ën
);

39 
§
->
§_çmy
 = 
hp
->
h_add¹y³
;

40 
	`sock_£t_pÜt
(
§
, 
§Ën
, 
¥
->
s_pÜt
);

41 
	`sock_£t_addr
(
§
, 
§Ën
, *
µŒ
);

43 
	`´štf
("Œyšg %s\n", 
	`Sock_Áİ
(
§
, 
§Ën
));

45 ià(
	`cÚÃù
(
sockfd
, 
§
, 
§Ën
) == 0)

47 
	`”r_»t
("connectƒrror");

48 
	`şo£
(
sockfd
);

50 ià(*
µŒ
 =ğ
NULL
)

51 
	`”r_qu™
("unableo connect");

53  (
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

54 
»cvlše
[
n
] = 0;

55 
	`Fputs
(
»cvlše
, 
¡dout
);

57 
	`ex™
(0);

58 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpsrv1.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
Ën
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

11 
sockaddr_¡Üage
 
şŸddr
;

13 ià(
¬gc
 != 2)

14 
	`”r_qu™
("usage: daytimetcpsrv1 <service or…ort#>");

16 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

19 
Ën
 = (
şŸddr
);

20 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *)&
şŸddr
, &
Ën
);

21 
	`´štf
("cÚÃùiÚ from %s\n", 
	`Sock_Áİ
((
SA
 *)&
şŸddr
, 
Ën
));

23 
ticks
 = 
	`time
(
NULL
);

24 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

25 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

27 
	`Clo£
(
cÚnfd
);

29 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpsrv2.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
Ën
, 
add¾’
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

11 
sockaddr_¡Üage
 
şŸddr
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage: daytimetcpsrv2 [ <host> ] <service or…ort>");

21 
Ën
 = (
şŸddr
);

22 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *)&
şŸddr
, &
Ën
);

23 
	`´štf
("cÚÃùiÚ from %s\n", 
	`Sock_Áİ
((
SA
 *)&
şŸddr
, 
Ën
));

25 
ticks
 = 
	`time
(
NULL
);

26 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

27 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

29 
	`Clo£
(
cÚnfd
);

31 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpsrv3.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
add¾’
, 
Ën
;

9 
sockaddr
 *
şŸddr
;

10 
lšg”
 
lšg
;

11 
buff
[
MAXLINE
];

12 
time_t
 
ticks
;

14 ià(
¬gc
 == 2)

15 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

16 ià(
¬gc
 == 3)

17 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

19 
	`”r_qu™
("usage: daytimetcpsrv3 [ <host> ] <service or…ort>");

21 
şŸddr
 = 
	`M®loc
(
add¾’
);

24 
Ën
 = 
add¾’
;

25 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

26 
	`´štf
("cÚÃùiÚ from %s\n", 
	`Sock_Áİ
(
şŸddr
, 
Ën
));

29 
lšg
.
l_Úoff
 = 1;

30 
lšg
.
l_lšg”
 = 0;

31 
	`S‘sockİt
(
cÚnfd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg
, (ling));

33 
ticks
 = 
	`time
(
NULL
);

34 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

35 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

37 
	`¦“p
(2);

38 
	`Clo£
(
cÚnfd
);

40 
	}
}

	@osi\unpv13e\unpv13e\names\daytimetcpsrv4.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
add¾’
, 
Ën
;

9 
sockaddr
 *
şŸddr
;

10 
buff
[
MAXLINE
], 
ho¡
[
NI_MAXHOST
], 
£rv
[
NI_MAXSERV
];

11 
time_t
 
ticks
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage: daytimetcpsrv4 [ <host> ] <service or…ort>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
Ën
 = 
add¾’
;

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

25 ià(
	`g‘Çmešfo
(
şŸddr
, 
Ën
, 
ho¡
, 
NI_MAXHOST
, 
£rv
, 
NI_MAXSERV
,

26 
NI_NUMERICHOST
 | 
NI_NUMERICSERV
) == 0)

27 
	`´štf
("cÚÃùiÚ from %s.%s\n", 
ho¡
, 
£rv
);

29 
ticks
 = 
	`time
(
NULL
);

30 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

31 
	`Wr™e
(
cÚnfd
, 
buff
, 
	`¡¾’
(buff));

33 
	`Clo£
(
cÚnfd
);

35 
	}
}

	@osi\unpv13e\unpv13e\names\daytimeudpcli1.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
§Ën
;

9 
sockaddr
 *
§
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage: daytimeudpcli1 <hostname/IPaddress> <service/port#>");

14 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

16 
	`´štf
("£ndšgØ%s\n", 
	`Sock_Áİ_ho¡
(
§
, 
§Ën
));

18 
	`S’dto
(
sockfd
, "", 1, 0, 
§
, 
§Ën
);

20 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

21 
»cvlše
[
n
] = '\0';

22 
	`Fputs
(
»cvlše
, 
¡dout
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\names\daytimeudpcli2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

9 ià(
¬gc
 != 3)

10 
	`”r_qu™
("usage: daytimeudpcli2 <hostname/IPaddress> <service/port#>");

12 
sockfd
 = 
	`Udp_cÚÃù
(
¬gv
[1],‡rgv[2]);

14 
	`Wr™e
(
sockfd
, "", 1);

16 
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
);

17 
»cvlše
[
n
] = '\0';

18 
	`Fputs
(
»cvlše
, 
¡dout
);

20 
	`ex™
(0);

21 
	}
}

	@osi\unpv13e\unpv13e\names\daytimeudpsrv2.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
ssize_t
 
n
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

11 
sockËn_t
 
Ën
;

12 
sockaddr_¡Üage
 
şŸddr
;

14 ià(
¬gc
 == 2)

15 
sockfd
 = 
	`Udp_£rv”
(
NULL
, 
¬gv
[1], NULL);

16 ià(
¬gc
 == 3)

17 
sockfd
 = 
	`Udp_£rv”
(
¬gv
[1],‡rgv[2], 
NULL
);

19 
	`”r_qu™
("usage: daytimeudpsrv [ <host> ] <service or…ort>");

22 
Ën
 = (
şŸddr
);

23 
n
 = 
	`Recväom
(
sockfd
, 
buff
, 
MAXLINE
, 0, (
SA
 *)&
şŸddr
, &
Ën
);

24 
	`´štf
("d©ag¿m from %s\n", 
	`Sock_Áİ
((
SA
 *)&
şŸddr
, 
Ën
));

26 
ticks
 = 
	`time
(
NULL
);

27 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

28 
	`S’dto
(
sockfd
, 
buff
, 
	`¡¾’
(buff), 0, (
SA
 *)&
şŸddr
, 
Ën
);

30 
	}
}

	@osi\unpv13e\unpv13e\names\daytimeudpsrv3.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
ssize_t
 
n
;

9 
buff
[
MAXLINE
];

10 
time_t
 
ticks
;

11 
sockËn_t
 
Ën
;

12 
sockaddr_¡Üage
 
şŸddr
;

14 ià(
¬gc
 == 2)

15 
sockfd
 = 
	`Udp_£rv”_»u£addr
(
NULL
, 
¬gv
[1], NULL);

16 ià(
¬gc
 == 3)

17 
sockfd
 = 
	`Udp_£rv”_»u£addr
(
¬gv
[1],‡rgv[2], 
NULL
);

19 
	`”r_qu™
("usage: daytimeudpsrv [ <host> ] <service or…ort>");

22 
Ën
 = (
şŸddr
);

23 
n
 = 
	`Recväom
(
sockfd
, 
buff
, 
MAXLINE
, 0, (
SA
 *)&
şŸddr
, &
Ën
);

24 
	`´štf
("d©ag¿m from %s\n", 
	`Sock_Áİ
((
SA
 *)&
şŸddr
, 
Ën
));

26 
ticks
 = 
	`time
(
NULL
);

27 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

28 
	`S’dto
(
sockfd
, 
buff
, 
	`¡¾’
(buff), 0, (
SA
 *)&
şŸddr
, 
Ën
);

30 
	}
}

	@osi\unpv13e\unpv13e\names\hostent.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 *
±r
, **
µŒ
;

7 
¡r
[
INET_ADDRSTRLEN
];

8 
ho¡’t
 *
h±r
;

10 --
¬gc
 > 0) {

11 
±r
 = *++
¬gv
;

12 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
±r
)è=ğ
NULL
) {

13 
	`”r_msg
("gethostbynameƒrror for host: %s: %s",

14 
±r
, 
	`h¡»¼Ü
(
h_”ºo
));

17 
	`´štf
("officŸÈho¡Çme: %s\n", 
h±r
->
h_Çme
);

19 
µŒ
 = 
h±r
->
h_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

20 
	`´štf
("\lŸs: %s\n", *
µŒ
);

22 
h±r
->
h_add¹y³
) {

23 
AF_INET
:

24 
µŒ
 = 
h±r
->
h_addr_li¡
;

25  ; *
µŒ
 !ğ
NULL
;…ptr++)

26 
	`´štf
("\taddress: %s\n",

27 
	`IÃt_Áİ
(
h±r
->
h_add¹y³
, *
µŒ
, 
¡r
, (str)));

31 
	`”r_»t
("unknown‡ddressype");

35 
	`ex™
(0);

36 
	}
}

	@osi\unpv13e\unpv13e\names\hostent2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 *
±r
, **
µŒ
;

7 
¡r
[
INET6_ADDRSTRLEN
];

8 
ho¡’t
 *
h±r
;

10 --
¬gc
 > 0) {

11 
±r
 = *++
¬gv
;

12 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
±r
)è=ğ
NULL
) {

13 
	`”r_msg
("gethostbynameƒrror for host: %s: %s",

14 
±r
, 
	`h¡»¼Ü
(
h_”ºo
));

17 
	`´štf
("officŸÈho¡Çme: %s\n", 
h±r
->
h_Çme
);

19 
µŒ
 = 
h±r
->
h_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

20 
	`´štf
("‡lŸs: %s\n", *
µŒ
);

22 
h±r
->
h_add¹y³
) {

23 
AF_INET
:

24 #ifdef 
AF_INET6


25 
AF_INET6
:

27 
µŒ
 = 
h±r
->
h_addr_li¡
;

28  ; *
µŒ
 !ğ
NULL
;…ptr++) {

29 
	`´štf
("\taddress: %s\n",

30 
	`IÃt_Áİ
(
h±r
->
h_add¹y³
, *
µŒ
, 
¡r
, (str)));

32 iàĞ(
h±r
 = 
	`g‘ho¡byaddr
(*
µŒ
, h±r->
h_Ëngth
,

33 
h±r
->
h_add¹y³
)è=ğ
NULL
)

34 
	`´štf
("\t(gethostbyaddr failed)\n");

35 ià(
h±r
->
h_Çme
 !ğ
NULL
)

36 
	`´štf
("\Šamğ%s\n", 
h±r
->
h_Çme
);

38 
	`´štf
("\t(no hostname„eturned by gethostbyaddr)\n");

43 
	`”r_»t
("unknown‡ddressype");

47 
	`ex™
(0);

48 
	}
}

	@osi\unpv13e\unpv13e\names\hostent3.c

1 
	~"uÅ.h
"

3 
´_v4
(**);

6 
	$maš
(
¬gc
, **
¬gv
)

8 *
±r
, **
µŒ
;

9 
ho¡’t
 *
h±r
;

11 --
¬gc
 > 0) {

12 
±r
 = *++
¬gv
;

13 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
±r
)è=ğ
NULL
) {

14 
	`”r_msg
("gethostbynameƒrror for host: %s: %s",

15 
±r
, 
	`h¡»¼Ü
(
h_”ºo
));

18 
	`´štf
("officŸÈho¡‚ame: %s\n", 
h±r
->
h_Çme
);

20 
µŒ
 = 
h±r
->
h_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

21 
	`´štf
("‡lŸs: %s\n", *
µŒ
);

23 
h±r
->
h_add¹y³
) {

24 
AF_INET
:

25 
	`´_v4
(
h±r
->
h_addr_li¡
);

29 
	`”r_»t
("unknown‡ddressype");

33 
	`ex™
(0);

34 
	}
}

43 
	$´_v4
(**
li¡±r
)

45 
š_addr
 
šaddr
;

46 
ho¡’t
 *
h±r
, 
h’t
;

47 
buf
[8192];

48 
h_”ºo
;

50  ; *
li¡±r
 !ğ
NULL
;†istptr++) {

51 
šaddr
 = *((
š_addr
 *è(*
li¡±r
));

52 
	`´štf
(" IPv4‡dd»ss: %s", 
	`IÃt_Áß
(
šaddr
));

54 iàĞ(
h±r
 = 
	`g‘ho¡byaddr_r
((*è&
šaddr
, (
š_addr
),

55 
AF_INET
, &
h’t
,

56 
buf
, (buf), &
h_”ºo
)è=ğ
NULL
)

57 
	`´štf
(" (g‘ho¡byadd¸çed: %s)\n", 
	`h¡»¼Ü
(
h_”ºo
));

58 ià(
h±r
->
h_Çme
 !ğ
NULL
)

59 
	`´štf
("‚amğ%s\n", 
h±r
->
h_Çme
);

61 
	`´štf
(" (no hostname„eturned by gethostbyaddr)\n");

63 
	}
}

	@osi\unpv13e\unpv13e\names\myaddrs1.c

1 
	~"uÅ.h
"

2 
	~<sys/·¿m.h
>

5 
	$my_addrs
(*
add¹y³
)

7 
ho¡’t
 *
h±r
;

8 
myÇme
[
MAXHOSTNAMELEN
];

10 ià(
	`g‘ho¡Çme
(
myÇme
, (myname)) < 0)

11 (
NULL
);

13 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
myÇme
)è=ğ
NULL
)

14 (
NULL
);

16 *
add¹y³
 = 
h±r
->
h_add¹y³
;

17 (
h±r
->
h_addr_li¡
);

18 
	}
}

	@osi\unpv13e\unpv13e\names\netent.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 *
±r
, **
µŒ
;

7 
Ã‹Á
 *
ÅŒ
;

9 --
¬gc
 > 0) {

10 
±r
 = *++
¬gv
;

11 iàĞ(
ÅŒ
 = 
	`g‘ÃtbyÇme
(
±r
)è=ğ
NULL
) {

12 
	`”r_msg
("getnetbynameƒrror for‚et: %s: %s",

13 
±r
, 
	`h¡»¼Ü
(
h_”ºo
));

16 
	`´štf
("officŸÈÃŠame: %s\n", 
ÅŒ
->
n_Çme
);

18 
µŒ
 = 
ÅŒ
->
n_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

19 
	`´štf
("‡lŸs: %s\n", *
µŒ
);

21 
ÅŒ
->
n_add¹y³
) {

22 
AF_INET
:

23 #ifdef 
AF_INET6


24 
AF_INET6
:

29 
	`”r_»t
("unknown‡ddressype");

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\names\prmyaddrs.c

1 
	~"uÅ.h
"

3 **
my_addrs
(*);

6 
	$maš
(
¬gc
, **
¬gv
)

8 
add¹y³
;

9 **
µŒ
, 
buf
[
INET6_ADDRSTRLEN
];

11 iàĞ(
µŒ
 = 
	`my_addrs
(&
add¹y³
)è=ğ
NULL
)

12 
	`”r_qu™
("my_addrsƒrror");

14  ; *
µŒ
 !ğ
NULL
;…ptr++)

15 
	`´štf
("\taddress: %s\n",

16 
	`IÃt_Áİ
(
add¹y³
, *
µŒ
, 
buf
, (buf)));

18 
	`ex™
(0);

19 
	}
}

	@osi\unpv13e\unpv13e\names\prmyaddrs1.c

1 
	~"uÅ.h
"

3 **
my_addrs
(*);

6 
	$maš
(
¬gc
, **
¬gv
)

8 
add¹y³
;

9 **
µŒ
, 
buf
[
INET6_ADDRSTRLEN
];

11 iàĞ(
µŒ
 = 
	`my_addrs
(&
add¹y³
)è=ğ
NULL
)

12 
	`”r_qu™
("my_addrsƒrror");

14  ; *
µŒ
 !ğ
NULL
;…ptr++)

15 
	`´štf
("\taddress: %s\n",

16 
	`IÃt_Áİ
(
add¹y³
, *
µŒ
, 
buf
, (buf)));

18 
	`ex™
(0);

19 
	}
}

	@osi\unpv13e\unpv13e\names\test1.c

1 
	~"uÅ.h
"

3 
´_v4
(**);

6 
	$maš
(
¬gc
, **
¬gv
)

8 *
±r
, **
µŒ
, **
li¡±r
, 
buf
[
INET6_ADDRSTRLEN
];

9 *
li¡
[100];

10 
i
, 
add¹y³
, 
add¾’
;

11 
ho¡’t
 *
h±r
;

13 --
¬gc
 > 0) {

14 
±r
 = *++
¬gv
;

15 iàĞ(
h±r
 = 
	`g‘ho¡byÇme
(
±r
)è=ğ
NULL
) {

16 
	`”r_msg
("gethostbynameƒrror for host: %s: %s",

17 
±r
, 
	`h¡»¼Ü
(
h_”ºo
));

20 
	`´štf
("officŸÈho¡‚ame: %s\n", 
h±r
->
h_Çme
);

22 
µŒ
 = 
h±r
->
h_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

23 
	`´štf
("‡lŸs: %s\n", *
µŒ
);

24 
add¹y³
 = 
h±r
->
h_add¹y³
;

25 
add¾’
 = 
h±r
->
h_Ëngth
;

28 
i
 = 0, 
li¡±r
 = 
h±r
->
h_addr_li¡
; *li¡±¸!ğ
NULL
;†istptr++) {

29 
li¡
[
i
++] = *
li¡±r
;

31 
li¡
[
i
] = 
NULL
;

33 
li¡±r
 = 
li¡
; *li¡±¸!ğ
NULL
;†istptr++) {

34 
	`´štf
("\taddress: %s\n",

35 
	`IÃt_Áİ
(
add¹y³
, *
li¡±r
, 
buf
, (buf)));

37 iàĞ(
h±r
 = 
	`g‘ho¡byaddr
(*
li¡±r
, 
add¾’
, 
add¹y³
)è=ğ
NULL
)

38 
	`´štf
("\t\t(gethostbyaddr failed)\n");

39 ià(
h±r
->
h_Çme
 !ğ
NULL
)

40 
	`´štf
("\t\Šamğ%s\n", 
h±r
->
h_Çme
);

42 
	`´štf
("\t\t(no hostname„eturned by gethostbyaddr)\n");

44 
	`´štf
("\t\tofficŸÈho¡‚ame: %s\n", 
h±r
->
h_Çme
);

46 
µŒ
 = 
h±r
->
h_®Ÿ£s
; *µŒ !ğ
NULL
;…ptr++)

47 
	`´štf
("\t\lŸs: %s\n", *
µŒ
);

50 
	}
}

	@osi\unpv13e\unpv13e\names\test2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
§Ën
;

9 
sockaddr
 *
§
, *
§bšd
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:est2 <hostname/IPaddress> <service/port#>");

14 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

17 
§bšd
 = 
	`M®loc
(
§Ën
);

18 
	`bz”o
(
§bšd
, 
§Ën
);

19 
§bšd
->
§_çmy
 = 
§
->sa_family;

20 
	`Bšd
(
sockfd
, 
§bšd
, 
§Ën
);

21 
	`´štf
("bound %s\n", 
	`Sock_Áİ
(
§bšd
, 
§Ën
));

23 
	`´štf
("£ndšgØ%s\n", 
	`Sock_Áİ_ho¡
(
§
, 
§Ën
));

25 
	`S’dto
(
sockfd
, "", 1, 0, 
§
, 
§Ën
);

27 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

28 
»cvlše
[
n
] = 0;

29 
	`Fputs
(
»cvlše
, 
¡dout
);

31 
	`ex™
(0);

32 
	}
}

	@osi\unpv13e\unpv13e\names\udp_server_reuseaddr.c

2 
	~"uÅ.h
"

5 
	$udp_£rv”_»u£addr
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

7 
sockfd
, 
n
;

8 cÚ¡ 
Ú
 = 1;

9 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

11 
	`bz”o
(&
hšts
, (
addršfo
));

12 
hšts
.
ai_æags
 = 
AI_PASSIVE
;

13 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

14 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

16 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

17 
	`”r_qu™
("udp_serverƒrror for %s, %s: %s",

18 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

19 
»s§ve
 = 
»s
;

22 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

23 ià(
sockfd
 < 0)

26 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

27 ià(
	`bšd
(
sockfd
, 
»s
->
ai_addr
,„es->
ai_add¾’
) == 0)

30 
	`Clo£
(
sockfd
);

31 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

33 ià(
»s
 =ğ
NULL
)

34 
	`”r_sys
("udp_£rv”ƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

36 ià(
add¾’p
)

37 *
add¾’p
 = 
»s
->
ai_add¾’
;

39 
	`ä“addršfo
(
»s§ve
);

41 (
sockfd
);

42 
	}
}

46 
	$Udp_£rv”_»u£addr
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, 
sockËn_t
 *
add¾’p
)

48 (
	`udp_£rv”_»u£addr
(
ho¡
, 
£rv
, 
add¾’p
));

49 
	}
}

	@osi\unpv13e\unpv13e\nonblock\daytimetcpcli.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
sockaddr_š
 
£rvaddr
;

8 
»cvlše
[
MAXLINE
 + 1];

10 iàĞ(
sockfd
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 0)) < 0)

11 
	`”r_sys
("socketƒrror");

13 
	`bz”o
(&
£rvaddr
, (servaddr));

14 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

15 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(
¬gv
[1]);

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

18 ià(
	`cÚÃù_nÚb
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr), 0) < 0)

19 
	`”r_sys
("connectƒrror");

22 iàĞ(
n
 = 
	`»ad
(
sockfd
, 
»cvlše
, 
MAXLINE
)) <= 0) {

23 ià(
n
 == 0)

26 
	`”r_sys
("readƒrror");

28 
»cvlše
[
n
] = 0;

29 
	`Fputs
(
»cvlše
, 
¡dout
);

31 
	`ex™
(0);

32 
	}
}

	@osi\unpv13e\unpv13e\nonblock\home_page.c

1 
	~"web.h
"

4 
	$home_·ge
(cÚ¡ *
ho¡
, cÚ¡ *
âame
)

6 
fd
, 
n
;

7 
lše
[
MAXLINE
];

9 
fd
 = 
	`Tı_cÚÃù
(
ho¡
, 
SERV
);

11 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
âame
);

12 
	`Wr™’
(
fd
, 
lše
, 
n
);

15 iàĞ(
n
 = 
	`R—d
(
fd
, 
lše
, 
MAXLINE
)) == 0)

18 
	`´štf
("»ad %d by‹ oàhom·ge\n", 
n
);

21 
	`´štf
("end-of-file on home…age\n");

22 
	`Clo£
(
fd
);

23 
	}
}

	@osi\unpv13e\unpv13e\nonblock\start_connect.c

1 
	~"web.h
"

4 
	$¡¬t_cÚÃù
(
fe
 *
åŒ
)

6 
fd
, 
æags
, 
n
;

7 
addršfo
 *
ai
;

9 
ai
 = 
	`Ho¡_£rv
(
åŒ
->
f_ho¡
, 
SERV
, 0, 
SOCK_STREAM
);

11 
fd
 = 
	`Sock‘
(
ai
->
ai_çmy
,‡i->
ai_sockty³
,‡i->
ai_´ÙocŞ
);

12 
åŒ
->
f_fd
 = 
fd
;

13 
	`´štf
("¡¬t_cÚÃù fÜ %s, fd %d\n", 
åŒ
->
f_Çme
, 
fd
);

16 
æags
 = 
	`Fú
(
fd
, 
F_GETFL
, 0);

17 
	`Fú
(
fd
, 
F_SETFL
, 
æags
 | 
O_NONBLOCK
);

20 iàĞ(
n
 = 
	`cÚÃù
(
fd
, 
ai
->
ai_addr
,‡i->
ai_add¾’
)) < 0) {

21 ià(
”ºo
 !ğ
EINPROGRESS
)

22 
	`”r_sys
("nonblocking connectƒrror");

23 
åŒ
->
f_æags
 = 
F_CONNECTING
;

24 
	`FD_SET
(
fd
, &
r£t
);

25 
	`FD_SET
(
fd
, &
w£t
);

26 ià(
fd
 > 
maxfd
)

27 
maxfd
 = 
fd
;

29 } ià(
n
 >= 0)

30 
	`wr™e_g‘_cmd
(
åŒ
);

31 
	}
}

	@osi\unpv13e\unpv13e\nonblock\strclifork.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
pid_t
 
pid
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

9 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

10 
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) > 0)

11 
	`Fputs
(
»cvlše
, 
¡dout
);

13 
	`kl
(
	`g‘µid
(), 
SIGTERM
);

14 
	`ex™
(0);

18 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
)

19 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

21 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

22 
	`·u£
();

24 
	}
}

	@osi\unpv13e\unpv13e\nonblock\strclinonb.c

2 
	~"uÅ.h
"

5 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

7 
maxfdp1
, 
v®
, 
¡dšeof
;

8 
ssize_t
 
n
, 
nwr™‹n
;

9 
fd_£t
 
r£t
, 
w£t
;

10 
to
[
MAXLINE
], 
ä
[MAXLINE];

11 *
toŒ
, *
toİŒ
, *
äŒ
, *
äİŒ
;

13 
v®
 = 
	`Fú
(
sockfd
, 
F_GETFL
, 0);

14 
	`Fú
(
sockfd
, 
F_SETFL
, 
v®
 | 
O_NONBLOCK
);

16 
v®
 = 
	`Fú
(
STDIN_FILENO
, 
F_GETFL
, 0);

17 
	`Fú
(
STDIN_FILENO
, 
F_SETFL
, 
v®
 | 
O_NONBLOCK
);

19 
v®
 = 
	`Fú
(
STDOUT_FILENO
, 
F_GETFL
, 0);

20 
	`Fú
(
STDOUT_FILENO
, 
F_SETFL
, 
v®
 | 
O_NONBLOCK
);

22 
toŒ
 = 
toİŒ
 = 
to
;

23 
äŒ
 = 
äİŒ
 = 
ä
;

24 
¡dšeof
 = 0;

26 
maxfdp1
 = 
	`max
(max(
STDIN_FILENO
, 
STDOUT_FILENO
), 
sockfd
) + 1;

28 
	`FD_ZERO
(&
r£t
);

29 
	`FD_ZERO
(&
w£t
);

30 ià(
¡dšeof
 =ğ0 && 
toŒ
 < &
to
[
MAXLINE
])

31 
	`FD_SET
(
STDIN_FILENO
, &
r£t
);

32 ià(
äŒ
 < &
ä
[
MAXLINE
])

33 
	`FD_SET
(
sockfd
, &
r£t
);

34 ià(
toİŒ
 !ğ
toŒ
)

35 
	`FD_SET
(
sockfd
, &
w£t
);

36 ià(
äİŒ
 !ğ
äŒ
)

37 
	`FD_SET
(
STDOUT_FILENO
, &
w£t
);

39 
	`S–eù
(
maxfdp1
, &
r£t
, &
w£t
, 
NULL
, NULL);

42 ià(
	`FD_ISSET
(
STDIN_FILENO
, &
r£t
)) {

43 iàĞ(
n
 = 
	`»ad
(
STDIN_FILENO
, 
toŒ
, &
to
[
MAXLINE
] -oiptr)) < 0) {

44 ià(
”ºo
 !ğ
EWOULDBLOCK
)

45 
	`”r_sys
("readƒrror on stdin");

47 } ià(
n
 == 0) {

48 #ifdef 
VOL2


49 
	`årštf
(
¡d”r
, "%s: EOF oÀ¡dš\n", 
	`gf_time
());

51 
¡dšeof
 = 1;

52 ià(
toİŒ
 =ğ
toŒ
)

53 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

56 #ifdef 
VOL2


57 
	`årštf
(
¡d”r
, "%s:„—d %d by‹ äom stdš\n", 
	`gf_time
(), 
n
);

59 
toŒ
 +ğ
n
;

60 
	`FD_SET
(
sockfd
, &
w£t
);

64 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

65 iàĞ(
n
 = 
	`»ad
(
sockfd
, 
äŒ
, &
ä
[
MAXLINE
] - friptr)) < 0) {

66 ià(
”ºo
 !ğ
EWOULDBLOCK
)

67 
	`”r_sys
("readƒrror on socket");

69 } ià(
n
 == 0) {

70 #ifdef 
VOL2


71 
	`årštf
(
¡d”r
, "%s: EOF oÀsock‘\n", 
	`gf_time
());

73 ià(
¡dšeof
)

76 
	`”r_qu™
("str_cli: servererminated…rematurely");

79 #ifdef 
VOL2


80 
	`årštf
(
¡d”r
, "%s:„ead %d bytes from socket\n",

81 
	`gf_time
(), 
n
);

83 
äŒ
 +ğ
n
;

84 
	`FD_SET
(
STDOUT_FILENO
, &
w£t
);

89 ià(
	`FD_ISSET
(
STDOUT_FILENO
, &
w£t
è&& ( (
n
 = 
äŒ
 - 
äİŒ
) > 0)) {

90 iàĞ(
nwr™‹n
 = 
	`wr™e
(
STDOUT_FILENO
, 
äİŒ
, 
n
)) < 0) {

91 ià(
”ºo
 !ğ
EWOULDBLOCK
)

92 
	`”r_sys
("writeƒrroro stdout");

95 #ifdef 
VOL2


96 
	`årštf
(
¡d”r
, "%s: wrote %d byteso stdout\n",

97 
	`gf_time
(), 
nwr™‹n
);

99 
äİŒ
 +ğ
nwr™‹n
;

100 ià(
äİŒ
 =ğ
äŒ
)

101 
äİŒ
 = 
äŒ
 = 
ä
;

105 ià(
	`FD_ISSET
(
sockfd
, &
w£t
è&& ( (
n
 = 
toŒ
 - 
toİŒ
) > 0)) {

106 iàĞ(
nwr™‹n
 = 
	`wr™e
(
sockfd
, 
toİŒ
, 
n
)) < 0) {

107 ià(
”ºo
 !ğ
EWOULDBLOCK
)

108 
	`”r_sys
("writeƒrroro socket");

111 #ifdef 
VOL2


112 
	`årštf
(
¡d”r
, "%s: wrote %d byteso socket\n",

113 
	`gf_time
(), 
nwr™‹n
);

115 
toİŒ
 +ğ
nwr™‹n
;

116 ià(
toİŒ
 =ğ
toŒ
) {

117 
toŒ
 = 
toİŒ
 = 
to
;

118 ià(
¡dšeof
)

119 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

124 
	}
}

	@osi\unpv13e\unpv13e\nonblock\tcpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\nonblock\tcpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\nonblock\tcpcli03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
lšg”
 
lšg
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
lšg
.
l_Úoff
 = 1;

23 
lšg
.
l_lšg”
 = 0;

24 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg
, (ling));

25 
	`Clo£
(
sockfd
);

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\nonblock\tcpcli04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
lšg”
 
lšg
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
lšg
.
l_Úoff
 = 1;

23 
lšg
.
l_lšg”
 = 0;

24 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg
, (ling));

26 
	`¡r_şi
(
¡dš
, 
sockfd
);

28 
	`ex™
(0);

29 
	}
}

	@osi\unpv13e\unpv13e\nonblock\tcpservselect03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
i
, 
maxi
, 
maxfd
, 
li¡’fd
, 
cÚnfd
, 
sockfd
;

7 
Ä—dy
, 
ş›Á
[
FD_SETSIZE
];

8 
ssize_t
 
n
;

9 
fd_£t
 
r£t
, 
®l£t
;

10 
lše
[
MAXLINE
];

11 
sockËn_t
 
ş’
;

12 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

14 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

19 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

21 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

23 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

25 
maxfd
 = 
li¡’fd
;

26 
maxi
 = -1;

27 
i
 = 0; i < 
FD_SETSIZE
; i++)

28 
ş›Á
[
i
] = -1;

29 
	`FD_ZERO
(&
®l£t
);

30 
	`FD_SET
(
li¡’fd
, &
®l£t
);

33 
r£t
 = 
®l£t
;

34 
Ä—dy
 = 
	`S–eù
(
maxfd
+1, &
r£t
, 
NULL
, NULL, NULL);

36 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
)) {

37 
	`´štf
("listening socket„eadable\n");

38 
	`¦“p
(5);

39 
ş’
 = (
şŸddr
);

40 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

41 #ifdef 
NOTDEF


42 
	`´štf
("new client: %s,…ort %d\n",

43 
	`IÃt_Áİ
(
AF_INET
, &
şŸddr
.
sš_addr
, 4, 
NULL
),

44 
	`Áohs
(
şŸddr
.
sš_pÜt
));

47 
i
 = 0; i < 
FD_SETSIZE
; i++)

48 ià(
ş›Á
[
i
] < 0) {

49 
ş›Á
[
i
] = 
cÚnfd
;

52 ià(
i
 =ğ
FD_SETSIZE
)

53 
	`”r_qu™
("too many clients");

55 
	`FD_SET
(
cÚnfd
, &
®l£t
);

56 ià(
cÚnfd
 > 
maxfd
)

57 
maxfd
 = 
cÚnfd
;

58 ià(
i
 > 
maxi
)

59 
maxi
 = 
i
;

61 ià(--
Ä—dy
 <= 0)

65 
i
 = 0; i <ğ
maxi
; i++) {

66 iàĞ(
sockfd
 = 
ş›Á
[
i
]) < 0)

68 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

69 iàĞ(
n
 = 
	`R—dlše
(
sockfd
, 
lše
, 
MAXLINE
)) == 0) {

71 
	`Clo£
(
sockfd
);

72 
	`FD_CLR
(
sockfd
, &
®l£t
);

73 
ş›Á
[
i
] = -1;

75 
	`Wr™’
(
sockfd
, 
lše
, 
n
);

77 ià(--
Ä—dy
 <= 0)

82 
	}
}

	@osi\unpv13e\unpv13e\nonblock\web.c

2 
	~"web.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
i
, 
fd
, 
n
, 
maxncÚn
, 
æags
, 
”rÜ
;

8 
buf
[
MAXLINE
];

9 
fd_£t
 
rs
, 
ws
;

11 ià(
¬gc
 < 5)

12 
	`”r_qu™
("usage: web <#conns> <hostname> <homepage> <file1> ...");

13 
maxncÚn
 = 
	`©oi
(
¬gv
[1]);

15 
nfes
 = 
	`mš
(
¬gc
 - 4, 
MAXFILES
);

16 
i
 = 0; i < 
nfes
; i++) {

17 
fe
[
i
].
f_Çme
 = 
¬gv
[i + 4];

18 
fe
[
i
].
f_ho¡
 = 
¬gv
[2];

19 
fe
[
i
].
f_æags
 = 0;

21 
	`´štf
("nfe ğ%d\n", 
nfes
);

23 
	`home_·ge
(
¬gv
[2],‡rgv[3]);

25 
	`FD_ZERO
(&
r£t
);

26 
	`FD_ZERO
(&
w£t
);

27 
maxfd
 = -1;

28 
ÆeátÜ—d
 = 
ÆeátocÚn
 = 
nfes
;

29 
ncÚn
 = 0;

32 
ÆeátÜ—d
 > 0) {

33 
ncÚn
 < 
maxncÚn
 && 
ÆeátocÚn
 > 0) {

35 
i
 = 0 ; i < 
nfes
; i++)

36 ià(
fe
[
i
].
f_æags
 == 0)

38 ià(
i
 =ğ
nfes
)

39 
	`”r_qu™
("ÆeátocÚÀğ%d buˆnÙhšg found", 
ÆeátocÚn
);

40 
	`¡¬t_cÚÃù
(&
fe
[
i
]);

41 
ncÚn
++;

42 
ÆeátocÚn
--;

45 
rs
 = 
r£t
;

46 
ws
 = 
w£t
;

47 
n
 = 
	`S–eù
(
maxfd
+1, &
rs
, &
ws
, 
NULL
, NULL);

49 
i
 = 0; i < 
nfes
; i++) {

50 
æags
 = 
fe
[
i
].
f_æags
;

51 ià(
æags
 =ğ0 || fÏg & 
F_DONE
)

53 
fd
 = 
fe
[
i
].
f_fd
;

54 ià(
æags
 & 
F_CONNECTING
 &&

55 (
	`FD_ISSET
(
fd
, &
rs
è|| FD_ISSET(fd, &
ws
))) {

56 
n
 = (
”rÜ
);

57 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_ERROR
, &
”rÜ
, &
n
) < 0 ||

58 
”rÜ
 != 0) {

59 
	`”r_»t
("nonblocking connect failed for %s",

60 
fe
[
i
].
f_Çme
);

63 
	`´štf
("cÚÃùiÚƒ¡ablished fÜ %s\n", 
fe
[
i
].
f_Çme
);

64 
	`FD_CLR
(
fd
, &
w£t
);

65 
	`wr™e_g‘_cmd
(&
fe
[
i
]);

67 } ià(
æags
 & 
F_READING
 && 
	`FD_ISSET
(
fd
, &
rs
)) {

68 iàĞ(
n
 = 
	`R—d
(
fd
, 
buf
, (buf))) == 0) {

69 
	`´štf
("’d-of-fÚ %s\n", 
fe
[
i
].
f_Çme
);

70 
	`Clo£
(
fd
);

71 
fe
[
i
].
f_æags
 = 
F_DONE
;

72 
	`FD_CLR
(
fd
, &
r£t
);

73 
ncÚn
--;

74 
ÆeátÜ—d
--;

76 
	`´štf
("»ad %d by‹ äom %s\n", 
n
, 
fe
[
i
].
f_Çme
);

81 
	`ex™
(0);

82 
	}
}

	@osi\unpv13e\unpv13e\nonblock\web.h

1 
	~"uÅ.h
"

3 
	#MAXFILES
 20

	)

4 
	#SERV
 "80"

	)

6 
	sfe
 {

7 *
	mf_Çme
;

8 *
	mf_ho¡
;

9 
	mf_fd
;

10 
	mf_æags
;

11 } 
	gfe
[
MAXFILES
];

13 
	#F_CONNECTING
 1

	)

14 
	#F_READING
 2

	)

15 
	#F_DONE
 4

	)

17 
	#GET_CMD
 "GET % HTTP/1.0\r\n\r\n"

	)

20 
	gncÚn
, 
	gnfes
, 
	gÆeátocÚn
, 
	gÆeátÜ—d
, 
	gmaxfd
;

21 
fd_£t
 
	gr£t
, 
	gw£t
;

24 
home_·ge
(const *, const *);

25 
¡¬t_cÚÃù
(
fe
 *);

26 
wr™e_g‘_cmd
(
fe
 *);

	@osi\unpv13e\unpv13e\nonblock\write_get_cmd.c

1 
	~"web.h
"

4 
	$wr™e_g‘_cmd
(
fe
 *
åŒ
)

6 
n
;

7 
lše
[
MAXLINE
];

9 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
åŒ
->
f_Çme
);

10 
	`Wr™’
(
åŒ
->
f_fd
, 
lše
, 
n
);

11 
	`´štf
("wrÙ%d by‹ fÜ %s\n", 
n
, 
åŒ
->
f_Çme
);

13 
åŒ
->
f_æags
 = 
F_READING
;

15 
	`FD_SET
(
åŒ
->
f_fd
, &
r£t
);

16 ià(
åŒ
->
f_fd
 > 
maxfd
)

17 
maxfd
 = 
åŒ
->
f_fd
;

18 
	}
}

	@osi\unpv13e\unpv13e\oob\heartbeatcli.c

1 
	~"uÅ.h
"

3 
	g£rvfd
;

4 
	gn£c
;

5 
	gmaxÅrobes
;

6 
	gÅrobes
;

7 
sig_urg
(), 
sig_®rm
();

10 
	$h—¹b—t_şi
(
£rvfd_¬g
, 
n£c_¬g
, 
maxÅrobes_¬g
)

12 
£rvfd
 = 
£rvfd_¬g
;

13 iàĞ(
n£c
 = 
n£c_¬g
) < 1)

14 
n£c
 = 1;

15 iàĞ(
maxÅrobes
 = 
maxÅrobes_¬g
è< 
n£c
)

16 
maxÅrobes
 = 
n£c
;

17 
Årobes
 = 0;

19 
	`SigÇl
(
SIGURG
, 
sig_urg
);

20 
	`Fú
(
£rvfd
, 
F_SETOWN
, 
	`g‘pid
());

22 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

23 
	`®¬m
(
n£c
);

24 
	}
}

27 
	$sig_urg
(
signo
)

29 
n
;

30 
c
;

32 iàĞ(
n
 = 
	`»cv
(
£rvfd
, &
c
, 1, 
MSG_OOB
)) < 0) {

33 ià(
”ºo
 !ğ
EWOULDBLOCK
)

34 
	`”r_sys
("recvƒrror");

36 
Årobes
 = 0;

38 
	}
}

41 
	$sig_®rm
(
signo
)

43 ià(++
Årobes
 > 
maxÅrobes
) {

44 
	`årštf
(
¡d”r
, "server is unreachable\n");

45 
	`ex™
(0);

47 
	`S’d
(
£rvfd
, "1", 1, 
MSG_OOB
);

48 
	`®¬m
(
n£c
);

50 
	}
}

	@osi\unpv13e\unpv13e\oob\heartbeatserv.c

1 
	~"uÅ.h
"

3 
	g£rvfd
;

4 
	gn£c
;

5 
	gmaxÇÏrms
;

6 
	gÅrobes
;

7 
sig_urg
(), 
sig_®rm
();

10 
	$h—¹b—t_£rv
(
£rvfd_¬g
, 
n£c_¬g
, 
maxÇÏrms_¬g
)

12 
£rvfd
 = 
£rvfd_¬g
;

13 iàĞ(
n£c
 = 
n£c_¬g
) < 1)

14 
n£c
 = 1;

15 iàĞ(
maxÇÏrms
 = 
maxÇÏrms_¬g
è< 
n£c
)

16 
maxÇÏrms
 = 
n£c
;

18 
	`SigÇl
(
SIGURG
, 
sig_urg
);

19 
	`Fú
(
£rvfd
, 
F_SETOWN
, 
	`g‘pid
());

21 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

22 
	`®¬m
(
n£c
);

23 
	}
}

26 
	$sig_urg
(
signo
)

28 
n
;

29 
c
;

31 iàĞ(
n
 = 
	`»cv
(
£rvfd
, &
c
, 1, 
MSG_OOB
)) < 0) {

32 ià(
”ºo
 !ğ
EWOULDBLOCK
)

33 
	`”r_sys
("recvƒrror");

35 
	`S’d
(
£rvfd
, &
c
, 1, 
MSG_OOB
);

37 
Årobes
 = 0;

39 
	}
}

42 
	$sig_®rm
(
signo
)

44 ià(++
Årobes
 > 
maxÇÏrms
) {

45 
	`´štf
("no…robes from client\n");

46 
	`ex™
(0);

48 
	`®¬m
(
n£c
);

50 
	}
}

	@osi\unpv13e\unpv13e\oob\sigchldwaitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0) {

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

13 
	}
}

	@osi\unpv13e\unpv13e\oob\strcliselect02.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
maxfdp1
, 
¡dšeof
 = 0;

7 
fd_£t
 
r£t
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

10 
	`h—¹b—t_şi
(
sockfd
, 1, 5);

12 
	`FD_ZERO
(&
r£t
);

14 ià(
¡dšeof
 == 0)

15 
	`FD_SET
(
	`f’o
(
å
), &
r£t
);

16 
	`FD_SET
(
sockfd
, &
r£t
);

17 
maxfdp1
 = 
	`max
(
	`f’o
(
å
), 
sockfd
) + 1;

18 ià(
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL) < 0) {

19 ià(
”ºo
 =ğ
EINTR
)

22 
	`”r_sys
("selectƒrror");

25 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

26 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0) {

27 ià(
¡dšeof
 == 1)

30 
	`”r_qu™
("str_cli: servererminated…rematurely");

33 
	`Wr™’
(
STDOUT_FILENO
, 
»cvlše
, 
	`¡¾’
(recvline));

36 ià(
	`FD_ISSET
(
	`f’o
(
å
), &
r£t
)) {

37 ià(
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è=ğ
NULL
) {

38 
¡dšeof
 = 1;

39 
	`®¬m
(0);

40 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

41 
	`FD_CLR
(
	`f’o
(
å
), &
r£t
);

45 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

48 
	}
}

	@osi\unpv13e\unpv13e\oob\strecho02.c

1 
	~"uÅ.h
"

4 
	$¡r_echo
(
sockfd
)

6 
ssize_t
 
n
;

7 
lše
[
MAXLINE
];

9 
	`h—¹b—t_£rv
(
sockfd
, 1, 5);

12 iàĞ(
n
 = 
	`R—dlše
(
sockfd
, 
lše
, 
MAXLINE
)) == 0)

15 
	`Wr™’
(
sockfd
, 
lše
, 
n
);

17 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv01.c

1 
	~"uÅ.h
"

3 
	gli¡’fd
, 
	gcÚnfd
;

5 
sig_urg
();

8 
	$maš
(
¬gc
, **
¬gv
)

10 
n
;

11 
buff
[100];

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

18 
	`”r_qu™
("usage:cprecv01 [ <host> ] <port#>");

20 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

22 
	`SigÇl
(
SIGURG
, 
sig_urg
);

23 
	`Fú
(
cÚnfd
, 
F_SETOWN
, 
	`g‘pid
());

26 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

27 
	`´štf
("received EOF\n");

28 
	`ex™
(0);

30 
buff
[
n
] = 0;

31 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

33 
	}
}

36 
	$sig_urg
(
signo
)

38 
n
;

39 
buff
[100];

41 
	`´štf
("SIGURG„eceived\n");

42 
n
 = 
	`Recv
(
cÚnfd
, 
buff
, (buff)-1, 
MSG_OOB
);

43 
buff
[
n
] = 0;

44 
	`´štf
("»ad %d OOB by‹: %s\n", 
n
, 
buff
);

45 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
;

7 
buff
[100];

8 
fd_£t
 
r£t
, 
x£t
;

10 ià(
¬gc
 == 2)

11 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

12 ià(
¬gc
 == 3)

13 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

15 
	`”r_qu™
("usage:cprecv02 [ <host> ] <port#>");

17 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

19 
	`FD_ZERO
(&
r£t
);

20 
	`FD_ZERO
(&
x£t
);

22 
	`FD_SET
(
cÚnfd
, &
r£t
);

23 
	`FD_SET
(
cÚnfd
, &
x£t
);

25 
	`S–eù
(
cÚnfd
 + 1, &
r£t
, 
NULL
, &
x£t
, NULL);

27 ià(
	`FD_ISSET
(
cÚnfd
, &
x£t
)) {

28 
n
 = 
	`Recv
(
cÚnfd
, 
buff
, (buff)-1, 
MSG_OOB
);

29 
buff
[
n
] = 0;

30 
	`´štf
("»ad %d OOB by‹: %s\n", 
n
, 
buff
);

33 ià(
	`FD_ISSET
(
cÚnfd
, &
r£t
)) {

34 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

35 
	`´štf
("received EOF\n");

36 
	`ex™
(0);

38 
buff
[
n
] = 0;

39 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

42 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
, 
ju¡»adoob
 = 0;

7 
buff
[100];

8 
fd_£t
 
r£t
, 
x£t
;

10 ià(
¬gc
 == 2)

11 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

12 ià(
¬gc
 == 3)

13 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

15 
	`”r_qu™
("usage:cprecv03 [ <host> ] <port#>");

17 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

19 
	`FD_ZERO
(&
r£t
);

20 
	`FD_ZERO
(&
x£t
);

22 
	`FD_SET
(
cÚnfd
, &
r£t
);

23 ià(
ju¡»adoob
 == 0)

24 
	`FD_SET
(
cÚnfd
, &
x£t
);

26 
	`S–eù
(
cÚnfd
 + 1, &
r£t
, 
NULL
, &
x£t
, NULL);

28 ià(
	`FD_ISSET
(
cÚnfd
, &
x£t
)) {

29 
n
 = 
	`Recv
(
cÚnfd
, 
buff
, (buff)-1, 
MSG_OOB
);

30 
buff
[
n
] = 0;

31 
	`´štf
("»ad %d OOB by‹: %s\n", 
n
, 
buff
);

32 
ju¡»adoob
 = 1;

33 
	`FD_CLR
(
cÚnfd
, &
x£t
);

36 ià(
	`FD_ISSET
(
cÚnfd
, &
r£t
)) {

37 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

38 
	`´štf
("received EOF\n");

39 
	`ex™
(0);

41 
buff
[
n
] = 0;

42 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

43 
ju¡»adoob
 = 0;

46 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv03p.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
, 
ju¡»adoob
 = 0;

7 
buff
[100];

8 
pŞlfd
…ollfd[1];

10 ià(
¬gc
 == 2)

11 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

12 ià(
¬gc
 == 3)

13 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

15 
	`”r_qu™
("usage:cprecv03p [ <host> ] <port#>");

17 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

19 
pŞlfd
[0].
fd
 = 
cÚnfd
;

20 
pŞlfd
[0].
ev’ts
 = 
POLLRDNORM
;

22 ià(
ju¡»adoob
 == 0)

23 
pŞlfd
[0].
ev’ts
 |ğ
POLLRDBAND
;

25 
	`PŞl
(
pŞlfd
, 1, 
INFTIM
);

27 ià(
pŞlfd
[0].
»v’ts
 & 
POLLRDBAND
) {

28 
n
 = 
	`Recv
(
cÚnfd
, 
buff
, (buff)-1, 
MSG_OOB
);

29 
buff
[
n
] = 0;

30 
	`´štf
("»ad %d OOB by‹: %s\n", 
n
, 
buff
);

31 
ju¡»adoob
 = 1;

32 
pŞlfd
[0].
ev’ts
 &ğ~
POLLRDBAND
;

35 ià(
pŞlfd
[0].
»v’ts
 & 
POLLRDNORM
) {

36 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

37 
	`´štf
("received EOF\n");

38 
	`ex™
(0);

40 
buff
[
n
] = 0;

41 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

42 
ju¡»adoob
 = 0;

45 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
, 
Ú
=1;

7 
buff
[100];

9 ià(
¬gc
 == 2)

10 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

11 ià(
¬gc
 == 3)

12 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

14 
	`”r_qu™
("usage:cprecv04 [ <host> ] <port#>");

16 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_OOBINLINE
, &
Ú
, (on));

18 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

19 
	`¦“p
(5);

22 ià(
	`Sock©m¬k
(
cÚnfd
))

23 
	`´štf
("at OOB mark\n");

25 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

26 
	`´štf
("received EOF\n");

27 
	`ex™
(0);

29 
buff
[
n
] = 0;

30 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

32 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv05.c

1 
	~"uÅ.h
"

3 
	gli¡’fd
, 
	gcÚnfd
;

5 
sig_urg
();

8 
	$maš
(
¬gc
, **
¬gv
)

10 
size
;

12 ià(
¬gc
 == 2)

13 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

14 ià(
¬gc
 == 3)

15 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

17 
	`”r_qu™
("usage:cprecv05 [ <host> ] <port#>");

19 
size
 = 4096;

20 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, (size));

22 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

24 
	`SigÇl
(
SIGURG
, 
sig_urg
);

25 
	`Fú
(
cÚnfd
, 
F_SETOWN
, 
	`g‘pid
());

28 
	`·u£
();

29 
	}
}

32 
	$sig_urg
(
signo
)

34 
n
;

35 
buff
[2048];

37 
	`´štf
("SIGURG„eceived\n");

38 
n
 = 
	`Recv
(
cÚnfd
, 
buff
, (buff)-1, 
MSG_OOB
);

39 
buff
[
n
] = 0;

40 
	`´štf
("»ad %d OOB by‹\n", 
n
);

41 
	}
}

	@osi\unpv13e\unpv13e\oob\tcprecv06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
, 
n
, 
Ú
=1;

7 
buff
[100];

9 ià(
¬gc
 == 2)

10 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], NULL);

11 ià(
¬gc
 == 3)

12 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], 
NULL
);

14 
	`”r_qu™
("usage:cprecv06 [ <host> ] <port#>");

16 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_OOBINLINE
, &
Ú
, (on));

18 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
NULL
, NULL);

19 
	`¦“p
(5);

22 ià(
	`Sock©m¬k
(
cÚnfd
))

23 
	`´štf
("at OOB mark\n");

25 iàĞ(
n
 = 
	`R—d
(
cÚnfd
, 
buff
, (buff)-1)) == 0) {

26 
	`´štf
("received EOF\n");

27 
	`ex™
(0);

29 
buff
[
n
] = 0;

30 
	`´štf
("»ad %d by‹s: %s\n", 
n
, 
buff
);

32 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpsend01 <host> <port#>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`Wr™e
(
sockfd
, "123", 3);

14 
	`´štf
("wrote 3 bytes of‚ormal data\n");

15 
	`¦“p
(1);

17 
	`S’d
(
sockfd
, "4", 1, 
MSG_OOB
);

18 
	`´štf
("wrote 1 byte of OOB data\n");

19 
	`¦“p
(1);

21 
	`Wr™e
(
sockfd
, "56", 2);

22 
	`´štf
("wrote 2 bytes of‚ormal data\n");

23 
	`¦“p
(1);

25 
	`S’d
(
sockfd
, "7", 1, 
MSG_OOB
);

26 
	`´štf
("wrote 1 byte of OOB data\n");

27 
	`¦“p
(1);

29 
	`Wr™e
(
sockfd
, "89", 2);

30 
	`´štf
("wrote 2 bytes of‚ormal data\n");

31 
	`¦“p
(1);

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpsend02 <host> <port#>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`Wr™e
(
sockfd
, "123", 3);

14 
	`´štf
("wrote 3 bytes of‚ormal data\n");

15 
	`¦“p
(1);

17 
	`S’d
(
sockfd
, "4", 1, 
MSG_OOB
);

18 
	`´štf
("wrote 1 byte of OOB data\n");

19 
	`¦“p
(1);

21 
	`Wr™e
(
sockfd
, "56", 2);

22 
	`´štf
("wrote 2 bytes of‚ormal data\n");

23 
	`¦“p
(1);

25 
	`S’d
(
sockfd
, "7", 1, 
MSG_OOB
);

26 
	`´štf
("wrote 1 byte of OOB data\n");

27 
	`¦“p
(1);

29 
	`Wr™e
(
sockfd
, "89", 2);

30 
	`´štf
("wrote 2 bytes of‚ormal data\n");

31 
	`¦“p
(1);

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpsend03 <host> <port#>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`Wr™e
(
sockfd
, "123", 3);

14 
	`´štf
("wrote 3 bytes of‚ormal data\n");

15 
	`¦“p
(1);

17 
	`S’d
(
sockfd
, "4", 1, 
MSG_OOB
);

18 
	`´štf
("wrote 1 byte of OOB data\n");

19 
	`¦“p
(1);

21 
	`Wr™e
(
sockfd
, "56", 2);

22 
	`´štf
("wrote 2 bytes of‚ormal data\n");

23 
	`¦“p
(1);

25 
	`S’d
(
sockfd
, "7", 1, 
MSG_OOB
);

26 
	`´štf
("wrote 1 byte of OOB data\n");

27 
	`¦“p
(1);

29 
	`Wr™e
(
sockfd
, "89", 2);

30 
	`´štf
("wrote 2 bytes of‚ormal data\n");

31 
	`¦“p
(1);

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpsend04 <host> <port#>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`Wr™e
(
sockfd
, "123", 3);

14 
	`´štf
("wrote 3 bytes of‚ormal data\n");

16 
	`S’d
(
sockfd
, "4", 1, 
MSG_OOB
);

17 
	`´štf
("wrote 1 byte of OOB data\n");

19 
	`Wr™e
(
sockfd
, "5", 1);

20 
	`´štf
("wrote 1 byte of‚ormal data\n");

22 
	`ex™
(0);

23 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend05.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
size
;

7 
buff
[16384];

9 ià(
¬gc
 != 3)

10 
	`”r_qu™
("usage:cpsend05 <host> <port#>");

12 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

14 
size
 = 32768;

15 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
size
, (size));

17 
	`Wr™e
(
sockfd
, 
buff
, 16384);

18 
	`´štf
("wrote 16384 bytes of‚ormal data\n");

19 
	`¦“p
(5);

21 
	`S’d
(
sockfd
, "a", 1, 
MSG_OOB
);

22 
	`´štf
("wrote 1 byte of OOB data\n");

24 
	`Wr™e
(
sockfd
, 
buff
, 1024);

25 
	`´štf
("wrote 1024 bytes of‚ormal data\n");

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpsend06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpsend06 <host> <port#>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`Wr™e
(
sockfd
, "123", 3);

14 
	`´štf
("wrote 3 bytes of‚ormal data\n");

16 
	`S’d
(
sockfd
, "4", 1, 
MSG_OOB
);

17 
	`´štf
("wrote 1 byte of OOB data\n");

19 
	`Wr™e
(
sockfd
, "5", 1);

20 
	`´štf
("wrote 1 byte of‚ormal data\n");

22 
	`S’d
(
sockfd
, "6", 1, 
MSG_OOB
);

23 
	`´štf
("wrote 1 byte of OOB data\n");

25 
	`Wr™e
(
sockfd
, "7", 1);

26 
	`´štf
("wrote 1 byte of‚ormal data\n");

28 
	`ex™
(0);

29 
	}
}

	@osi\unpv13e\unpv13e\oob\tcpserv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\ping\bsdping.c

39 #iâdeà
lšt


40 
	gcİyright
[] =

45 #iâdeà
lšt


46 
	gsccsid
[] = "@(#)ping.c 8.1 (Berkeley) 6/5/93";

65 
	~<sys/·¿m.h
>

66 
	~<sys/sock‘.h
>

67 
	~<sys/time.h
>

69 
	~<Ãtš‘/š_sy¡m.h
>

70 
	~<Ãtš‘/š.h
>

71 
	~<Ãtš‘/.h
>

72 
	~<Ãtš‘/_icmp.h
>

73 
	~<Ãtš‘/_v¬.h
>

74 
	~<¬·/š‘.h
>

75 
	~<Ãtdb.h
>

77 
	~<ùy³.h
>

78 
	~<”r.h
>

79 
	~<”ºo.h
>

80 
	~<fú.h
>

81 
	~<sigÇl.h
>

82 
	~<¡dio.h
>

83 
	~<¡dlib.h
>

84 
	~<¡ršg.h
>

85 
	~<uni¡d.h
>

87 
	#DEFDATALEN
 (64 - 8è

	)

88 
	#MAXIPLEN
 60

	)

89 
	#MAXICMPLEN
 76

	)

90 
	#MAXPACKET
 (65536 - 60 - 8)

	)

91 
	#NROUTES
 9

	)

93 
	#A
(
b™
è
rcvd_tbl
[(b™)>>3]

	)

94 
	#B
(
b™
è(1 << ((b™è& 0x07)è

	)

95 
	#SET
(
b™
è(
	`A
(b™è|ğ
	`B
(b™))

	)

96 
	#CLR
(
b™
è(
	`A
(b™è&ğ(~
	`B
(b™)))

	)

97 
	#TST
(
b™
è(
	`A
(b™è& 
	`B
(b™))

	)

99 
	#F_FLOOD
 0x0001

	)

100 
	#F_INTERVAL
 0x0002

	)

101 
	#F_NUMERIC
 0x0004

	)

102 
	#F_PINGFILLED
 0x0008

	)

103 
	#F_QUIET
 0x0010

	)

104 
	#F_RROUTE
 0x0020

	)

105 
	#F_SO_DEBUG
 0x0040

	)

106 
	#F_SO_DONTROUTE
 0x0080

	)

107 
	#F_VERBOSE
 0x0100

	)

108 
u_št
 
	gİtiÚs
;

115 
	#MAX_DUP_CHK
 (8 * 8192)

	)

116 
	gmx_dup_ck
 = 
MAX_DUP_CHK
;

117 
	grcvd_tbl
[
MAX_DUP_CHK
 / 8];

119 
sockaddr
 
	gwh”‘o
;

120 
	gd©®’
 = 
DEFDATALEN
;

121 
	gs
;

122 
u_ch¬
 
	gouack
[
MAXPACKET
];

123 
	gBSPACE
 = '\b';

124 
	gDOT
 = '.';

125 *
	gho¡Çme
;

126 
	gid’t
;

129 
	gÅack‘s
;

130 
	gÄeûived
;

131 
	gÄ•—ts
;

132 
	gÁ¿nsm™‹d
;

133 
	gš‹rv®
 = 1;

136 
	gtimšg
;

137 
	gtmš
 = 999999999.0;

138 
	gtmax
 = 0.0;

139 
	gtsum
 = 0.0;

141 
fl
 
__P
((*, *));

142 
u_shÜt
 
š_cksum
 
__P
((u_short *, ));

143 
Ú®rm
 
__P
(());

144 
Úšfo
 
__P
(());

145 
Úšt
 
__P
(());

146 
pšg”
 
__P
(());

147 *
´_addr
 
__P
((
u_lÚg
));

148 
´_icmph
 
__P
((
icmp
 *));

149 
´_h
 
__P
((

 *));

150 
´_·ck
 
__P
((*, , 
sockaddr_š
 *));

151 
´_»t
 
__P
((

 *));

152 
summ¬y
 
__P
(());

153 
tvsub
 
__P
((
timev®
 *, timeval *));

154 
u§ge
 
__P
(());

157 
	$maš
(
¬gc
, 
¬gv
)

158 
¬gc
;

159 *
¬gv
[];

161 
”ºo
, 
İtšd
;

162 *
İrg
;

163 
ho¡’t
 *
hp
;

164 
™im”v®
 
™im”
;

165 
´ÙÛÁ
 *
´Ùo
;

166 
sockaddr_š
 *
to
, 
äom
;

167 
timev®
 
timeout
;

168 
fd_£t
 
fd£t
;

169 
cc
, 
i
;

170 
ch
, 
äomËn
, 
hŞd
, 
·ckËn
, 
´–ßd
;

171 
u_ch¬
 *
d©­
, *
·ck‘
;

172 *
e
, *
rg‘
, 
hÇmebuf
[
MAXHOSTNAMELEN
];

173 #ifdeà
IP_OPTIONS


174 
r¥aû
[3 + 4 * 
NROUTES
 + 1];

177 
´–ßd
 = 0;

178 
d©­
 = &
ouack
[8 + (
timev®
)];

179 (
ch
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "c:dfi:l:np:qRrs:v")) != -1)

180 
ch
) {

182 
Åack‘s
 = 
	`¡¹Ş
(
İrg
, &
e
, 10);

183 ià(
Åack‘s
 <ğ0 || *
İrg
 =ğ'\0' || *
e
 != '\0')

184 
	`”rx
(1,

185 "Ëg®‚umb” oà·ck‘ -- %s", 
İrg
);

188 
İtiÚs
 |ğ
F_SO_DEBUG
;

191 ià(
	`g‘uid
()) {

192 
”ºo
 = 
EPERM
;

193 
	`”r
(1, 
NULL
);

195 
İtiÚs
 |ğ
F_FLOOD
;

196 
	`£tbuf
(
¡dout
, (*)
NULL
);

199 
š‹rv®
 = 
	`¡¹Ş
(
İrg
, &
e
, 10);

200 ià(
š‹rv®
 <ğ0 || *
İrg
 =ğ'\0' || *
e
 != '\0')

201 
	`”rx
(1,

202 "Ëg®imšg iÁ”v® -- %s", 
İrg
);

203 
İtiÚs
 |ğ
F_INTERVAL
;

206 
´–ßd
 = 
	`¡¹Ş
(
İrg
, &
e
, 10);

207 ià(
´–ßd
 < 0 || *
İrg
 =ğ'\0' || *
e
 != '\0')

208 
	`”rx
(1, "Ëg®…»lßd v®u-- %s", 
İrg
);

211 
İtiÚs
 |ğ
F_NUMERIC
;

214 
İtiÚs
 |ğ
F_PINGFILLED
;

215 
	`fl
((*)
d©­
, 
İrg
);

218 
İtiÚs
 |ğ
F_QUIET
;

221 
İtiÚs
 |ğ
F_RROUTE
;

224 
İtiÚs
 |ğ
F_SO_DONTROUTE
;

227 
d©®’
 = 
	`¡¹Ş
(
İrg
, &
e
, 10);

228 ià(
d©®’
 <ğ0 || *
İrg
 =ğ'\0' || *
e
 != '\0')

229 
	`”rx
(1, "Ëg® d©®’ v®u-- %s", 
İrg
);

230 ià(
d©®’
 > 
MAXPACKET
)

231 
	`”rx
(1,

233 
MAXPACKET
);

236 
İtiÚs
 |ğ
F_VERBOSE
;

239 
	`u§ge
();

241 
¬gc
 -ğ
İtšd
;

242 
¬gv
 +ğ
İtšd
;

244 ià(
¬gc
 != 1)

245 
	`u§ge
();

246 
rg‘
 = *
¬gv
;

248 
	`mem£t
(&
wh”‘o
, 0, (
sockaddr
));

249 
to
 = (
sockaddr_š
 *)&
wh”‘o
;

250 
to
->
sš_çmy
 = 
AF_INET
;

251 
to
->
sš_addr
.
s_addr
 = 
	`š‘_addr
(
rg‘
);

252 ià(
to
->
sš_addr
.
s_addr
 !ğ(
u_št
)-1)

253 
ho¡Çme
 = 
rg‘
;

255 
hp
 = 
	`g‘ho¡byÇme
(
rg‘
);

256 ià(!
hp
)

257 
	`”rx
(1, "unknowÀho¡ %s", 
rg‘
);

258 
to
->
sš_çmy
 = 
hp
->
h_add¹y³
;

259 
	`memmove
(&
to
->
sš_addr
, 
hp
->
h_addr
, hp->
h_Ëngth
);

260 ()
	`¡ºıy
(
hÇmebuf
, 
hp
->
h_Çme
, (hnamebuf) - 1);

261 
ho¡Çme
 = 
hÇmebuf
;

264 ià(
İtiÚs
 & 
F_FLOOD
 && o±iÚ & 
F_INTERVAL
)

265 
	`”rx
(1, "-f‡nd -i incompatible options");

267 ià(
d©®’
 >ğ(
timev®
))

268 
timšg
 = 1;

269 
·ckËn
 = 
d©®’
 + 
MAXIPLEN
 + 
MAXICMPLEN
;

270 ià(!(
·ck‘
 = (
u_ch¬
 *)
	`m®loc
((
u_št
)
·ckËn
)))

271 
	`”r
(1, 
NULL
);

272 ià(!(
İtiÚs
 & 
F_PINGFILLED
))

273 
i
 = 8; i < 
d©®’
; ++i)

274 *
d©­
++ = 
i
;

276 
id’t
 = 
	`g‘pid
() & 0xFFFF;

278 ià(!(
´Ùo
 = 
	`g‘´ÙobyÇme
("icmp")))

279 
	`”rx
(1, "unknown…rotocol icmp");

280 ià((
s
 = 
	`sock‘
(
AF_INET
, 
SOCK_RAW
, 
´Ùo
->
p_´Ùo
)) < 0)

281 
	`”r
(1, "socket");

282 
hŞd
 = 1;

283 ià(
İtiÚs
 & 
F_SO_DEBUG
)

284 ()
	`£tsockİt
(
s
, 
SOL_SOCKET
, 
SO_DEBUG
, (*)&
hŞd
,

285 (
hŞd
));

286 ià(
İtiÚs
 & 
F_SO_DONTROUTE
)

287 ()
	`£tsockİt
(
s
, 
SOL_SOCKET
, 
SO_DONTROUTE
, (*)&
hŞd
,

288 (
hŞd
));

291 ià(
İtiÚs
 & 
F_RROUTE
) {

292 #ifdeà
IP_OPTIONS


293 
r¥aû
[
IPOPT_OPTVAL
] = 
IPOPT_RR
;

294 
r¥aû
[
IPOPT_OLEN
] = (rspace)-1;

295 
r¥aû
[
IPOPT_OFFSET
] = 
IPOPT_MINOFF
;

296 ià(
	`£tsockİt
(
s
, 
IPPROTO_IP
, 
IP_OPTIONS
, 
r¥aû
,

297 (
r¥aû
)) < 0)

298 
	`”r
(1, "record„oute");

300 
	`”rx
(1, "record„oute‚ot‡vailable inhis implementation");

310 
hŞd
 = 48 * 1024;

311 ()
	`£tsockİt
(
s
,

312 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
hŞd
, (hold));

314 ià(
to
->
sš_çmy
 =ğ
AF_INET
)

315 ()
	`´štf
("PING % (%s): %d d©¨by‹s\n", 
ho¡Çme
,

316 
	`š‘_Áß
(*(
š_addr
 *)&
to
->
sš_addr
.
s_addr
),

317 
d©®’
);

319 ()
	`´štf
("PING %s: %d d©¨by‹s\n", 
ho¡Çme
, 
d©®’
);

321 
´–ßd
--)

322 
	`pšg”
();

324 ()
	`sigÇl
(
SIGINT
, 
Úšt
);

325 ()
	`sigÇl
(
SIGINFO
, 
Úšfo
);

327 ià((
İtiÚs
 & 
F_FLOOD
) == 0) {

328 ()
	`sigÇl
(
SIGALRM
, 
Ú®rm
);

329 
™im”
.
™_š‹rv®
.
tv_£c
 = 
š‹rv®
;

330 
™im”
.
™_š‹rv®
.
tv_u£c
 = 0;

331 
™im”
.
™_v®ue
.
tv_£c
 = 0;

332 
™im”
.
™_v®ue
.
tv_u£c
 = 1;

333 ()
	`£t™im”
(
ITIMER_REAL
, &
™im”
, 
NULL
);

336 
	`FD_ZERO
(&
fd£t
);

337 
timeout
.
tv_£c
 = 0;

338 
timeout
.
tv_u£c
 = 10000;

340 ià(
İtiÚs
 & 
F_FLOOD
) {

341 
	`pšg”
();

342 
	`FD_SET
(
s
, &
fd£t
);

343 ià(
	`£Ëù
(
s
 + 1, &
fd£t
, 
NULL
, NULL, &
timeout
) < 1)

346 
äomËn
 = (
äom
);

347 ià((
cc
 = 
	`»cväom
(
s
, (*)
·ck‘
, 
·ckËn
, 0,

348 (
sockaddr
 *)&
äom
, &
äomËn
)) < 0) {

349 ià(
”ºo
 =ğ
EINTR
)

351 
	`w¬n
("recvfrom");

354 
	`´_·ck
((*)
·ck‘
, 
cc
, &
äom
);

355 ià(
Åack‘s
 && 
Äeûived
 >=‚packets)

358 
	`summ¬y
();

359 
	`ex™
(
Äeûived
 == 0);

360 
	}
}

367 
	$Ú®rm
(
signo
)

368 
signo
;

370 
™im”v®
 
™im”
;

372 ià(!
Åack‘s
 || 
Á¿nsm™‹d
 <‚packets) {

373 
	`pšg”
();

382 
	#MAXWAIT
 10

	)

383 ià(
Äeûived
) {

384 
™im”
.
™_v®ue
.
tv_£c
 = 2 * 
tmax
 / 1000;

385 ià(
™im”
.
™_v®ue
.
tv_£c
 == 0)

386 
™im”
.
™_v®ue
.
tv_£c
 = 1;

388 
™im”
.
™_v®ue
.
tv_£c
 = 
MAXWAIT
;

389 
™im”
.
™_š‹rv®
.
tv_£c
 = 0;

390 
™im”
.
™_š‹rv®
.
tv_u£c
 = 0;

391 
™im”
.
™_v®ue
.
tv_u£c
 = 0;

393 ()
	`sigÇl
(
SIGALRM
, 
Úšt
);

394 ()
	`£t™im”
(
ITIMER_REAL
, &
™im”
, 
NULL
);

395 
	}
}

406 
	$pšg”
()

408 
icmp
 *
iı
;

409 
cc
;

410 
i
;

412 
iı
 = (
icmp
 *)
ouack
;

413 
iı
->
icmp_ty³
 = 
ICMP_ECHO
;

414 
iı
->
icmp_code
 = 0;

415 
iı
->
icmp_cksum
 = 0;

416 
iı
->
icmp_£q
 = 
Á¿nsm™‹d
++;

417 
iı
->
icmp_id
 = 
id’t
;

419 
	`CLR
(
iı
->
icmp_£q
 % 
mx_dup_ck
);

421 ià(
timšg
)

422 ()
	`g‘timeofday
((
timev®
 *)&
ouack
[8], 
NULL
);

424 
cc
 = 
d©®’
 + 8;

427 
iı
->
icmp_cksum
 = 
	`š_cksum
((
u_shÜt
 *)iı, 
cc
);

429 
i
 = 
	`£ndto
(
s
, (*)
ouack
, 
cc
, 0, &
wh”‘o
,

430 (
sockaddr
));

432 ià(
i
 < 0 || i !ğ
cc
) {

433 ià(
i
 < 0)

434 
	`w¬n
("sendto");

435 ()
	`´štf
("ping: wrote %s %d chars,„et=%d\n",

436 
ho¡Çme
, 
cc
, 
i
);

438 ià(!(
İtiÚs
 & 
F_QUIET
è&& o±iÚ & 
F_FLOOD
)

439 ()
	`wr™e
(
STDOUT_FILENO
, &
DOT
, 1);

440 
	}
}

450 
	$´_·ck
(
buf
, 
cc
, 
äom
)

451 *
buf
;

452 
cc
;

453 
sockaddr_š
 *
äom
;

455 
icmp
 *
iı
;

456 
u_lÚg
 
l
;

457 
i
, 
j
;

458 
u_ch¬
 *
ı
,*
dp
;

459 
Şd_¼Ën
;

460 
Şd_¼
[
MAX_IPOPTLEN
];

461 

 *ip;

462 
timev®
 
tv
, *

;

463 
Œtime
;

464 
hËn
, 
dupæag
;

466 ()
	`g‘timeofday
(&
tv
, 
NULL
);

469 

 = ( *)
buf
;

470 
hËn
 = 

->
_hl
 << 2;

471 ià(
cc
 < 
hËn
 + 
ICMP_MINLEN
) {

472 ià(
İtiÚs
 & 
F_VERBOSE
)

473 
	`w¬nx
("·ck‘oØshÜˆ(%d by‹sèäom %s\n", 
cc
,

474 
	`š‘_Áß
(*(
š_addr
 *)&
äom
->
sš_addr
.
s_addr
));

479 
cc
 -ğ
hËn
;

480 
iı
 = (
icmp
 *)(
buf
 + 
hËn
);

481 ià(
iı
->
icmp_ty³
 =ğ
ICMP_ECHOREPLY
) {

482 ià(
iı
->
icmp_id
 !ğ
id’t
)

484 ++
Äeûived
;

485 ià(
timšg
) {

486 #iâdeà
icmp_d©a


487 

 = (
timev®
 *)&
iı
->
icmp_
;

489 

 = (
timev®
 *)
iı
->
icmp_d©a
;

491 
	`tvsub
(&
tv
, 

);

492 
Œtime
 = (()
tv
.
tv_£c
) * 1000.0 +

493 (()
tv
.
tv_u£c
) / 1000.0;

494 
tsum
 +ğ
Œtime
;

495 ià(
Œtime
 < 
tmš
)

496 
tmš
 = 
Œtime
;

497 ià(
Œtime
 > 
tmax
)

498 
tmax
 = 
Œtime
;

501 ià(
	`TST
(
iı
->
icmp_£q
 % 
mx_dup_ck
)) {

502 ++
Ä•—ts
;

503 --
Äeûived
;

504 
dupæag
 = 1;

506 
	`SET
(
iı
->
icmp_£q
 % 
mx_dup_ck
);

507 
dupæag
 = 0;

510 ià(
İtiÚs
 & 
F_QUIET
)

513 ià(
İtiÚs
 & 
F_FLOOD
)

514 ()
	`wr™e
(
STDOUT_FILENO
, &
BSPACE
, 1);

516 ()
	`´štf
("%d by‹ äom %s: icmp_£q=%u", 
cc
,

517 
	`š‘_Áß
(*(
š_addr
 *)&
äom
->
sš_addr
.
s_addr
),

518 
iı
->
icmp_£q
);

519 ()
	`´štf
("=%d", 

->
_‰l
);

520 ià(
timšg
)

521 ()
	`´štf
("ime=%g ms", 
Œtime
);

522 ià(
dupæag
)

523 ()
	`´štf
(" (DUP!)");

525 
ı
 = (
u_ch¬
*)&
iı
->
icmp_d©a
[8];

526 
dp
 = &
ouack
[8 + (
timev®
)];

527 
i
 = 8; i < 
d©®’
; ++i, ++
ı
, ++
dp
) {

528 ià(*
ı
 !ğ*
dp
) {

529 ()
	`´štf
("\nwrong data byte #%d should be 0x%x but was 0x%x",

530 
i
, *
dp
, *
ı
);

531 
ı
 = (
u_ch¬
*)&
iı
->
icmp_d©a
[0];

532 
i
 = 8; i < 
d©®’
; ++i, ++
ı
) {

533 ià((
i
 % 32) == 8)

534 ()
	`´štf
("\n\t");

535 ()
	`´štf
("%x ", *
ı
);

543 ià(!(
İtiÚs
 & 
F_VERBOSE
))

545 ()
	`´štf
("%d by‹ äom %s: ", 
cc
,

546 
	`´_addr
(
äom
->
sš_addr
.
s_addr
));

547 
	`´_icmph
(
iı
);

551 
ı
 = (
u_ch¬
 *)
buf
 + (

);

553 ; 
hËn
 > ()(

); --hËn, ++
ı
)

554 *
ı
) {

555 
IPOPT_EOL
:

556 
hËn
 = 0;

558 
IPOPT_LSRR
:

559 ()
	`´štf
("\nLSRR: ");

560 
hËn
 -= 2;

561 
j
 = *++
ı
;

562 ++
ı
;

563 ià(
j
 > 
IPOPT_MINOFF
)

565 
l
 = *++
ı
;

566 
l
 = (l<<8è+ *++
ı
;

567 
l
 = (l<<8è+ *++
ı
;

568 
l
 = (l<<8è+ *++
ı
;

569 ià(
l
 == 0)

570 ()
	`´štf
("\t0.0.0.0");

572 ()
	`´štf
("\t%s", 
	`´_addr
(
	`Áohl
(
l
)));

573 
hËn
 -= 4;

574 
j
 -= 4;

575 ià(
j
 <ğ
IPOPT_MINOFF
)

577 ()
	`putch¬
('\n');

580 
IPOPT_RR
:

581 
j
 = *++
ı
;

582 
i
 = *++
ı
;

583 
hËn
 -= 2;

584 ià(
i
 > 
j
)

585 
i
 = 
j
;

586 
i
 -ğ
IPOPT_MINOFF
;

587 ià(
i
 <= 0)

589 ià(
i
 =ğ
Şd_¼Ën


590 && 
ı
 =ğ(
u_ch¬
 *)
buf
 + (

) + 2

591 && !
	`memcmp
((*)
ı
, 
Şd_¼
, 
i
)

592 && !(
İtiÚs
 & 
F_FLOOD
)) {

593 ()
	`´štf
("\t(same„oute)");

594 
i
 = ((i + 3) / 4) * 4;

595 
hËn
 -ğ
i
;

596 
ı
 +ğ
i
;

599 
Şd_¼Ën
 = 
i
;

600 
	`memmove
(
Şd_¼
, 
ı
, 
i
);

601 ()
	`´štf
("\nRR: ");

603 
l
 = *++
ı
;

604 
l
 = (l<<8è+ *++
ı
;

605 
l
 = (l<<8è+ *++
ı
;

606 
l
 = (l<<8è+ *++
ı
;

607 ià(
l
 == 0)

608 ()
	`´štf
("\t0.0.0.0");

610 ()
	`´štf
("\t%s", 
	`´_addr
(
	`Áohl
(
l
)));

611 
hËn
 -= 4;

612 
i
 -= 4;

613 ià(
i
 <= 0)

615 ()
	`putch¬
('\n');

618 
IPOPT_NOP
:

619 ()
	`´štf
("\nNOP");

622 ()
	`´štf
("\nunknowÀİtiÚ %x", *
ı
);

625 ià(!(
İtiÚs
 & 
F_FLOOD
)) {

626 ()
	`putch¬
('\n');

627 ()
	`fæush
(
¡dout
);

629 
	}
}

635 
u_shÜt


636 
	$š_cksum
(
addr
, 
Ën
)

637 
u_shÜt
 *
addr
;

638 
Ën
;

640 
Æeá
 = 
Ën
;

641 
u_shÜt
 *
w
 = 
addr
;

642 
sum
 = 0;

643 
u_shÜt
 
ªsw”
 = 0;

650 
Æeá
 > 1) {

651 
sum
 +ğ*
w
++;

652 
Æeá
 -= 2;

656 ià(
Æeá
 == 1) {

657 *(
u_ch¬
 *)(&
ªsw”
èğ*(u_ch¬ *)
w
 ;

658 
sum
 +ğ
ªsw”
;

662 
sum
 = (sum >> 16) + (sum & 0xffff);

663 
sum
 += (sum >> 16);

664 
ªsw”
 = ~
sum
;

665  (
ªsw”
);

666 
	}
}

674 
	$tvsub
(
out
, 
š
)

675 
timev®
 *
out
, *
š
;

677 ià((
out
->
tv_u£c
 -ğ
š
->tv_usec) < 0) {

678 --
out
->
tv_£c
;

679 
out
->
tv_u£c
 += 1000000;

681 
out
->
tv_£c
 -ğ
š
->tv_sec;

682 
	}
}

689 
	$Úšfo
(
nÙu£d
)

690 
nÙu£d
;

692 
	`summ¬y
();

693 
	}
}

700 
	$Úšt
(
nÙu£d
)

701 
nÙu£d
;

703 
	`summ¬y
();

705 ()
	`sigÇl
(
SIGINT
, 
SIG_DFL
);

706 ()
	`kl
(
	`g‘pid
(), 
SIGINT
);

709 
	`ex™
(1);

710 
	}
}

717 
	$summ¬y
()

719 
i
;

721 ()
	`´štf
("\n--- % pšg sti¡ic ---\n", 
ho¡Çme
);

722 ()
	`´štf
("%ld…ack‘ Œªsm™‹d, ", 
Á¿nsm™‹d
);

723 ()
	`´štf
("%ld…ack‘ »ûived, ", 
Äeûived
);

724 ià(
Ä•—ts
)

725 ()
	`´štf
("+%ld du¶iÿ‹s, ", 
Ä•—ts
);

726 ià(
Á¿nsm™‹d
)

727 ià(
Äeûived
 > 
Á¿nsm™‹d
)

728 ()
	`´štf
("-- somebody's…rinting up…ackets!");

730 ()
	`´štf
("%d%%…acket†oss",

731 (è(((
Á¿nsm™‹d
 - 
Äeûived
) * 100) /

732 
Á¿nsm™‹d
));

733 ()
	`putch¬
('\n');

734 ià(
Äeûived
 && 
timšg
) {

736 
i
 = 1000.0 * 
tsum
 / (
Äeûived
 + 
Ä•—ts
);

737 ()
	`´štf
("round-trip min/avg/max = %g/%g/%g ms\n",

738 
tmš
, (()
i
è/ 1000.0, 
tmax
);

740 
	}
}

742 #ifdeà
nÙdef


743 *
	g‰ab
[] = {

763 
	$´_icmph
(
iı
)

764 
icmp
 *
iı
;

766 
iı
->
icmp_ty³
) {

767 
ICMP_ECHOREPLY
:

768 ()
	`´štf
("Echo Reply\n");

771 
ICMP_UNREACH
:

772 
iı
->
icmp_code
) {

773 
ICMP_UNREACH_NET
:

774 ()
	`´štf
("Destination Net Unreachable\n");

776 
ICMP_UNREACH_HOST
:

777 ()
	`´štf
("Destination Host Unreachable\n");

779 
ICMP_UNREACH_PROTOCOL
:

780 ()
	`´štf
("Destination Protocol Unreachable\n");

782 
ICMP_UNREACH_PORT
:

783 ()
	`´štf
("Destination Port Unreachable\n");

785 
ICMP_UNREACH_NEEDFRAG
:

786 ()
	`´štf
("frag‚eeded‡nd DF set\n");

788 
ICMP_UNREACH_SRCFAIL
:

789 ()
	`´štf
("Source Route Failed\n");

792 ()
	`´štf
("Dest Unreachable, Bad Code: %d\n",

793 
iı
->
icmp_code
);

797 #iâdeà
icmp_d©a


798 
	`´_»t
(&
iı
->
icmp_
);

800 
	`´_»t
((

 *)
iı
->
icmp_d©a
);

803 
ICMP_SOURCEQUENCH
:

804 ()
	`´štf
("Source Quench\n");

805 #iâdeà
icmp_d©a


806 
	`´_»t
(&
iı
->
icmp_
);

808 
	`´_»t
((

 *)
iı
->
icmp_d©a
);

811 
ICMP_REDIRECT
:

812 
iı
->
icmp_code
) {

813 
ICMP_REDIRECT_NET
:

814 ()
	`´štf
("Redirect Network");

816 
ICMP_REDIRECT_HOST
:

817 ()
	`´štf
("Redirect Host");

819 
ICMP_REDIRECT_TOSNET
:

820 ()
	`´štf
("Redirect Type of Service‡nd Network");

822 
ICMP_REDIRECT_TOSHOST
:

823 ()
	`´štf
("Redirect Type of Service‡nd Host");

826 ()
	`´štf
("Redœeù, Bad Code: %d", 
iı
->
icmp_code
);

829 ()
	`´štf
("(New‡ddr: 0x%08lx)\n", 
iı
->
icmp_gwaddr
.
s_addr
);

830 #iâdeà
icmp_d©a


831 
	`´_»t
(&
iı
->
icmp_
);

833 
	`´_»t
((

 *)
iı
->
icmp_d©a
);

836 
ICMP_ECHO
:

837 ()
	`´štf
("Echo Request\n");

840 
ICMP_TIMXCEED
:

841 
iı
->
icmp_code
) {

842 
ICMP_TIMXCEED_INTRANS
:

843 ()
	`´štf
("Timeo†iveƒxceeded\n");

845 
ICMP_TIMXCEED_REASS
:

846 ()
	`´štf
("Frag„eassemblyimeƒxceeded\n");

849 ()
	`´štf
("Timeƒxceeded, Bad Code: %d\n",

850 
iı
->
icmp_code
);

853 #iâdeà
icmp_d©a


854 
	`´_»t
(&
iı
->
icmp_
);

856 
	`´_»t
((

 *)
iı
->
icmp_d©a
);

859 
ICMP_PARAMPROB
:

860 ()
	`´štf
("Parameter…roblem:…ointer = 0x%02x\n",

861 
iı
->
icmp_hun
.
ih_µŒ
);

862 #iâdeà
icmp_d©a


863 
	`´_»t
(&
iı
->
icmp_
);

865 
	`´_»t
((

 *)
iı
->
icmp_d©a
);

868 
ICMP_TSTAMP
:

869 ()
	`´štf
("Timestamp\n");

872 
ICMP_TSTAMPREPLY
:

873 ()
	`´štf
("Timestamp Reply\n");

876 
ICMP_IREQ
:

877 ()
	`´štf
("Information Request\n");

880 
ICMP_IREQREPLY
:

881 ()
	`´štf
("Information Reply\n");

884 #ifdeà
ICMP_MASKREQ


885 
ICMP_MASKREQ
:

886 ()
	`´štf
("Address Mask Request\n");

889 #ifdeà
ICMP_MASKREPLY


890 
ICMP_MASKREPLY
:

891 ()
	`´štf
("Address Mask Reply\n");

895 ()
	`´štf
("Bad ICMPy³: %d\n", 
iı
->
icmp_ty³
);

897 
	}
}

904 
	$´_h
(

)

905 

 *ip;

907 
hËn
;

908 
u_ch¬
 *
ı
;

910 
hËn
 = 

->
_hl
 << 2;

911 
ı
 = (
u_ch¬
 *)

 + 20;

913 ()
	`´štf
("Vr HL TOS Len ID Flg off TTL Pro cks Src Dst Data\n");

914 ()
	`´štf
(" %1x %1x %02x %04x %04x",

915 

->
_v
, ip->
_hl
, ip->
_tos
, ip->
_Ën
, ip->
_id
);

916 ()
	`´štf
(" %1x %04x", ((

->
_off
) & 0xe000) >> 13,

917 (

->
_off
) & 0x1fff);

918 ()
	`´štf
(" %02x %02x %04x", 

->
_‰l
, ip->
_p
, ip->
_sum
);

919 ()
	`´štf
(" % ", 
	`š‘_Áß
(*(
š_addr
 *)&

->
_¤c
.
s_addr
));

920 ()
	`´štf
(" % ", 
	`š‘_Áß
(*(
š_addr
 *)&

->
_d¡
.
s_addr
));

922 
hËn
-- > 20)

923 ()
	`´štf
("%02x", *
ı
++);

924 ()
	`putch¬
('\n');

925 
	}
}

933 
	$´_addr
(
l
)

934 
u_lÚg
 
l
;

936 
ho¡’t
 *
hp
;

937 
buf
[80];

939 ià((
İtiÚs
 & 
F_NUMERIC
) ||

940 !(
hp
 = 
	`g‘ho¡byaddr
((*)&
l
, 4, 
AF_INET
)))

941 ()
	`¥rštf
(
buf
, "%s", 
	`š‘_Áß
(*(
š_addr
 *)&
l
));

943 ()
	`¢´štf
(
buf
, (buf),

944 "% (%s)", 
hp
->
h_Çme
, 
	`š‘_Áß
(*(
š_addr
 *)&
l
));

945  (
buf
);

946 
	}
}

953 
	$´_»t
(

)

954 

 *ip;

956 
hËn
;

957 
u_ch¬
 *
ı
;

959 
	`´_h
(

);

960 
hËn
 = 

->
_hl
 << 2;

961 
ı
 = (
u_ch¬
 *)

 + 
hËn
;

963 ià(

->
_p
 == 6)

964 ()
	`´štf
("TCP: from…ort %u,o…ort %u (decimal)\n",

965 (*
ı
 * 256 + *(cp + 1)), (*(cp + 2) * 256 + *(cp + 3)));

966 ià(

->
_p
 == 17)

967 ()
	`´štf
("UDP: from…ort %u,o…ort %u (decimal)\n",

968 (*
ı
 * 256 + *(cp + 1)), (*(cp + 2) * 256 + *(cp + 3)));

969 
	}
}

972 
	$fl
(
bp
, 
·
)

973 *
bp
, *
·
;

975 
ii
, 
jj
, 
kk
;

976 
·t
[16];

977 *
ı
;

979 
ı
 = 
·
; *cp; cp++)

980 ià(!
	`isxdig™
(*
ı
))

981 
	`”rx
(1, "patterns must be specified‡s hex digits");

982 
ii
 = 
	`ssÿnf
(
·
,

984 &
·t
[0], &pat[1], &pat[2], &pat[3], &pat[4], &pat[5], &pat[6],

985 &
·t
[7], &pat[8], &pat[9], &pat[10], &pat[11], &pat[12],

986 &
·t
[13], &pat[14], &pat[15]);

988 ià(
ii
 > 0)

989 
kk
 = 0;

990 
kk
 <ğ
MAXPACKET
 - (8 + (
timev®
è+ 
ii
);

991 
kk
 +ğ
ii
)

992 
jj
 = 0; jj < 
ii
; ++jj)

993 
bp
[
jj
 + 
kk
] = 
·t
[jj];

994 ià(!(
İtiÚs
 & 
F_QUIET
)) {

995 ()
	`´štf
("PATTERN: 0x");

996 
jj
 = 0; jj < 
ii
; ++jj)

997 ()
	`´štf
("%02x", 
bp
[
jj
] & 0xFF);

998 ()
	`´štf
("\n");

1000 
	}
}

1003 
	$u§ge
()

1005 ()
	`årštf
(
¡d”r
,

1008 
	`ex™
(1);

1009 
	}
}

	@osi\unpv13e\unpv13e\ping\init_v6.c

1 
	~"pšg.h
"

4 
	$š™_v6
()

6 #ifdeà
IPV6


7 
Ú
 = 1;

9 ià(
v”bo£
 == 0) {

11 
icmp6_f‹r
 
myft
;

12 
	`ICMP6_FILTER_SETBLOCKALL
(&
myft
);

13 
	`ICMP6_FILTER_SETPASS
(
ICMP6_ECHO_REPLY
, &
myft
);

14 
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
ICMP6_FILTER
, &
myft
, (myfilt));

19 #ifdeà
IPV6_RECVHOPLIMIT


21 
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_RECVHOPLIMIT
, &
Ú
, (on));

24 
	`£tsockİt
(
sockfd
, 
IPPROTO_IPV6
, 
IPV6_HOPLIMIT
, &
Ú
, (on));

27 
	}
}

	@osi\unpv13e\unpv13e\ping\main.c

1 
	~"pšg.h
"

3 
´Ùo
 
	g´Ùo_v4
 = { 
´oc_v4
, 
£nd_v4
, 
NULL
, NULL, NULL, 0, 
IPPROTO_ICMP
 };

5 #ifdef 
IPV6


6 
´Ùo
 
	g´Ùo_v6
 = { 
´oc_v6
, 
£nd_v6
, 
š™_v6
, 
NULL
, NULL, 0, 
IPPROTO_ICMPV6
 };

9 
	gd©®’
 = 56;

12 
	$maš
(
¬gc
, **
¬gv
)

14 
c
;

15 
addršfo
 *
ai
;

16 *
h
;

18 
İ‹¼
 = 0;

19  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "v")) != -1) {

20 
c
) {

22 
v”bo£
++;

26 
	`”r_qu™
("uÄecognized o±iÚ: %c", 
c
);

30 ià(
İtšd
 !ğ
¬gc
-1)

31 
	`”r_qu™
("usage:…ing [ -v ] <hostname>");

32 
ho¡
 = 
¬gv
[
İtšd
];

34 
pid
 = 
	`g‘pid
() & 0xffff;

35 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

37 
ai
 = 
	`Ho¡_£rv
(
ho¡
, 
NULL
, 0, 0);

39 
h
 = 
	`Sock_Áİ_ho¡
(
ai
->
ai_addr
,‡i->
ai_add¾’
);

40 
	`´štf
("PING %s (%s): %d data bytes\n",

41 
ai
->
ai_ÿnÚÇme
 ?‡i->ai_ÿnÚÇm: 
h
,

42 
h
, 
d©®’
);

45 ià(
ai
->
ai_çmy
 =ğ
AF_INET
) {

46 
´
 = &
´Ùo_v4
;

47 #ifdef 
IPV6


48 } ià(
ai
->
ai_çmy
 =ğ
AF_INET6
) {

49 
´
 = &
´Ùo_v6
;

50 ià(
	`IN6_IS_ADDR_V4MAPPED
(&(((
sockaddr_š6
 *)

51 
ai
->
ai_addr
)->
sš6_addr
)))

52 
	`”r_qu™
("cannot…ing IPv4-mapped IPv6‡ddress");

55 
	`”r_qu™
("unknowÀadd»s çmy %d", 
ai
->
ai_çmy
);

57 
´
->
§£nd
 = 
ai
->
ai_addr
;

58 
´
->
§»cv
 = 
	`C®loc
(1, 
ai
->
ai_add¾’
);

59 
´
->
§Ën
 = 
ai
->
ai_add¾’
;

61 
	`»adloİ
();

63 
	`ex™
(0);

64 
	}
}

	@osi\unpv13e\unpv13e\ping\old\icmp6.h

1 
	sicmp6hdr
 {

2 
u_št8_t
 
	micmp6_ty³
;

3 
u_št8_t
 
	micmp6_code
;

4 
u_št16_t
 
	micmp6_cksum
;

6 
u_št32_t
 
	mun_d©a32
[1];

7 
u_št16_t
 
	mun_d©a16
[2];

8 
u_št8_t
 
	mun_d©a8
[4];

9 } 
	micmp6_d©aun
;

12 
	#icmp6_d©a32
 
icmp6_d©aun
.
un_d©a32


	)

13 
	#icmp6_d©a16
 
icmp6_d©aun
.
un_d©a16


	)

14 
	#icmp6_d©a8
 
icmp6_d©aun
.
un_d©a8


	)

15 
	#icmp6_µŒ
 
icmp6_d©a32
[0]

	)

16 
	#icmp6_mtu
 
icmp6_d©a32
[0]

	)

17 
	#icmp6_id
 
icmp6_d©a16
[0]

	)

18 
	#icmp6_£q
 
icmp6_d©a16
[1]

	)

19 
	#icmp6_maxd–ay
 
icmp6_d©a16
[0]

	)

21 
	#ICMPV6_DEST_UNREACH
 1

	)

22 
	#ICMPV6_PKT_TOOBIG
 2

	)

23 
	#ICMPV6_TIME_EXCEED
 3

	)

24 
	#ICMPV6_PARAMPROB
 4

	)

26 
	#ICMPV6_INFOMSG_MASK
 0x80

	)

28 
	#ICMPV6_ECHORQST
 128

	)

29 
	#ICMPV6_ECHORPLY
 129

	)

30 
	#ICMPV6_MGM_QUERY
 130

	)

31 
	#ICMPV6_MGM_REPORT
 131

	)

32 
	#ICMPV6_MGM_REDUCTION
 132

	)

34 
	#ICMPV6_DEST_UNREACH_NOROUTE
 0

	)

35 
	#ICMPV6_DEST_UNREACH_ADMIN
 1

	)

37 
	#ICMPV6_DEST_UNREACH_NOTNEIGHBOR
 2

	)

38 
	#ICMPV6_DEST_UNREACH_ADDR
 3

	)

39 
	#ICMPV6_DEST_UNREACH_NOPORT
 4

	)

41 
	#ICMPV6_TIME_EXCEED_HOPS
 0

	)

42 
	#ICMPV6_TIME_EXCEED_REASSEMBLY
 1

	)

44 
	#ICMPV6_PARAMPROB_HDR
 0

	)

45 
	#ICMPV6_PARAMPROB_NXT_HDR
 1

	)

46 
	#ICMPV6_PARAMPROB_OPTS
 2

	)

	@osi\unpv13e\unpv13e\ping\old\ip6.h

1 
	s6hdr
 {

3 
	s6hdrùl
 {

4 
u_št32_t
 
	mùl6_æow
;

5 
u_št16_t
 
	mùl6_¶’
;

6 
u_št8_t
 
	mùl6_nxt
;

7 
u_št8_t
 
	mùl6_hlim
;

8 } 
	mun_ùl6
;

9 
u_št8_t
 
	mun_vfc
;

10 } 
	m6_ùlun
;

11 
š6_addr
 
	m6_¤c
;

12 
š6_addr
 
	m6_d¡
;

15 
	#6_vfc
 
6_ùlun
.
un_vfc


	)

16 
	#6_æow
 
6_ùlun
.
un_ùl6
.
ùl6_æow


	)

17 
	#6_¶’
 
6_ùlun
.
un_ùl6
.
ùl6_¶’


	)

18 
	#6_nxt
 
6_ùlun
.
un_ùl6
.
ùl6_nxt


	)

19 
	#6_hlim
 
6_ùlun
.
un_ùl6
.
ùl6_hlim


	)

20 
	#6_hİs
 
6_ùlun
.
un_ùl6
.
ùl6_hlim


	)

	@osi\unpv13e\unpv13e\ping\ping.h

1 
	~"uÅ.h
"

2 
	~<Ãtš‘/š_sy¡m.h
>

3 
	~<Ãtš‘/.h
>

4 
	~<Ãtš‘/_icmp.h
>

6 
	#BUFSIZE
 1500

	)

9 
	g£ndbuf
[
BUFSIZE
];

11 
	gd©®’
;

12 *
	gho¡
;

13 
	gn£Á
;

14 
pid_t
 
	gpid
;

15 
	gsockfd
;

16 
	gv”bo£
;

19 
š™_v6
();

20 
´oc_v4
(*, 
ssize_t
, 
msghdr
 *, 
timev®
 *);

21 
´oc_v6
(*, 
ssize_t
, 
msghdr
 *, 
timev®
 *);

22 
£nd_v4
();

23 
£nd_v6
();

24 
»adloİ
();

25 
sig_®rm
();

26 
tv_sub
(
timev®
 *, timeval *);

28 
	s´Ùo
 {

29 (*
	måroc
)(*, 
	mssize_t
, 
	mmsghdr
 *, 
	mtimev®
 *);

30 (*
	mf£nd
)();

31 (*
	mfš™
)();

32 
sockaddr
 *
	m§£nd
;

33 
sockaddr
 *
	m§»cv
;

34 
sockËn_t
 
	m§Ën
;

35 
	micmµrÙo
;

36 } *
	g´
;

38 #ifdef 
IPV6


40 
	~<Ãtš‘/6.h
>

41 
	~<Ãtš‘/icmp6.h
>

	@osi\unpv13e\unpv13e\ping\ping_v4.c

1 
	~"pšg.h
"

4 
	$pšg_v4
(
ho¡’t
 *
h±r
)

6 
size
;

7 
»cvbuf
[
BUFSIZE
];

8 
sockËn_t
 
Ën
;

9 
ssize_t
 
n
;

10 
timev®
 
tv®
;

12 
	`£tuid
(
	`g‘uid
());

14 
size
 = 60 * 1024;

15 
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, (size));

18 
	`sig_®rm
(
SIGALRM
);

21 
Ën
 = 
§Ën
;

22 
n
 = 
	`»cväom
(
sockfd
, 
»cvbuf
, Ôecvbuf), 0, 
§»cv
, &
Ën
);

23 ià(
n
 < 0) {

24 ià(
”ºo
 =ğ
EINTR
)

27 
	`”r_sys
("recvfromƒrror");

30 
	`G‘timeofday
(&
tv®
, 
NULL
);

31 (*
åŒs
.
´oc_f
)(
»cvbuf
, 
n
, &
tv®
);

33 
	}
}

	@osi\unpv13e\unpv13e\ping\proc_v4.c

1 
	~"pšg.h
"

4 
	$´oc_v4
(*
±r
, 
ssize_t
 
Ën
, 
msghdr
 *
msg
, 
timev®
 *
tv»cv
)

6 
hËn1
, 
icm¶’
;

7 
¹t
;

8 

 *ip;

9 
icmp
 *icmp;

10 
timev®
 *
tv£nd
;

12 

 = ( *è
±r
;

13 
hËn1
 = 

->
_hl
 << 2;

14 ià(

->
_p
 !ğ
IPPROTO_ICMP
)

17 
icmp
 = (icm°*è(
±r
 + 
hËn1
);

18 iàĞ(
icm¶’
 = 
Ën
 - 
hËn1
) < 8)

21 ià(
icmp
->
icmp_ty³
 =ğ
ICMP_ECHOREPLY
) {

22 ià(
icmp
->
icmp_id
 !ğ
pid
)

24 ià(
icm¶’
 < 16)

27 
tv£nd
 = (
timev®
 *è
icmp
->
icmp_d©a
;

28 
	`tv_sub
(
tv»cv
, 
tv£nd
);

29 
¹t
 = 
tv»cv
->
tv_£c
 * 1000.0 +v»cv->
tv_u£c
 / 1000.0;

31 
	`´štf
("%d bytes from %s: seq=%u,tl=%d,„tt=%.3f ms\n",

32 
icm¶’
, 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

33 
icmp
->
icmp_£q
, 

->
_‰l
, 
¹t
);

35 } ià(
v”bo£
) {

36 
	`´štf
(" %d bytes from %s:ype = %d, code = %d\n",

37 
icm¶’
, 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

38 
icmp
->
icmp_ty³
, icmp->
icmp_code
);

40 
	}
}

	@osi\unpv13e\unpv13e\ping\proc_v6.c

1 
	~"pšg.h
"

4 
	$´oc_v6
(*
±r
, 
ssize_t
 
Ën
, 
msghdr
 *
msg
, 
timev®
* 
tv»cv
)

6 #ifdef 
IPV6


7 
¹t
;

8 
icmp6_hdr
 *
icmp6
;

9 
timev®
 *
tv£nd
;

10 
cmsghdr
 *
cmsg
;

11 
hlim
;

13 
icmp6
 = (
icmp6_hdr
 *è
±r
;

14 ià(
Ën
 < 8)

17 ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_ECHO_REPLY
) {

18 ià(
icmp6
->
icmp6_id
 !ğ
pid
)

20 ià(
Ën
 < 16)

23 
tv£nd
 = (
timev®
 *è(
icmp6
 + 1);

24 
	`tv_sub
(
tv»cv
, 
tv£nd
);

25 
¹t
 = 
tv»cv
->
tv_£c
 * 1000.0 +v»cv->
tv_u£c
 / 1000.0;

27 
hlim
 = -1;

28 
cmsg
 = 
	`CMSG_FIRSTHDR
(
msg
); cmsg !ğ
NULL
; cmsg = 
	`CMSG_NXTHDR
(msg, cmsg)) {

29 ià(
cmsg
->
cmsg_Ëv–
 =ğ
IPPROTO_IPV6
 &&

30 
cmsg
->
cmsg_ty³
 =ğ
IPV6_HOPLIMIT
) {

31 
hlim
 = *(
u_št32_t
 *)
	`CMSG_DATA
(
cmsg
);

35 
	`´štf
("%d bytes from %s: seq=%u, hlim=",

36 
Ën
, 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

37 
icmp6
->
icmp6_£q
);

38 ià(
hlim
 == -1)

39 
	`´štf
("???");

41 
	`´štf
("%d", 
hlim
);

42 
	`´štf
(",„‰=%.3àms\n", 
¹t
);

43 } ià(
v”bo£
) {

44 
	`´štf
(" %d bytes from %s:ype = %d, code = %d\n",

45 
Ën
, 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

46 
icmp6
->
icmp6_ty³
, icmp6->
icmp6_code
);

49 
	}
}

	@osi\unpv13e\unpv13e\ping\readloop.c

1 
	~"pšg.h
"

4 
	$»adloİ
()

6 
size
;

7 
»cvbuf
[
BUFSIZE
];

8 
cÚŒŞbuf
[
BUFSIZE
];

9 
msghdr
 
msg
;

10 
iovec
 
iov
;

11 
ssize_t
 
n
;

12 
timev®
 
tv®
;

14 
sockfd
 = 
	`Sock‘
(
´
->
§£nd
->
§_çmy
, 
SOCK_RAW
,…r->
icmµrÙo
);

15 
	`£tuid
(
	`g‘uid
());

16 ià(
´
->
fš™
)

17 (*
´
->
fš™
)();

19 
size
 = 60 * 1024;

20 
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, (size));

22 
	`sig_®rm
(
SIGALRM
);

24 
iov
.
iov_ba£
 = 
»cvbuf
;

25 
iov
.
iov_Ën
 = (
»cvbuf
);

26 
msg
.
msg_Çme
 = 
´
->
§»cv
;

27 
msg
.
msg_iov
 = &
iov
;

28 
msg
.
msg_iovËn
 = 1;

29 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞbuf
;

31 
msg
.
msg_Çm–’
 = 
´
->
§Ën
;

32 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞbuf
);

33 
n
 = 
	`»cvmsg
(
sockfd
, &
msg
, 0);

34 ià(
n
 < 0) {

35 ià(
”ºo
 =ğ
EINTR
)

38 
	`”r_sys
("recvmsgƒrror");

41 
	`G‘timeofday
(&
tv®
, 
NULL
);

42 (*
´
->
åroc
)(
»cvbuf
, 
n
, &
msg
, &
tv®
);

44 
	}
}

	@osi\unpv13e\unpv13e\ping\send_v4.c

1 
	~"pšg.h
"

4 
	$£nd_v4
()

6 
Ën
;

7 
icmp
 *icmp;

9 
icmp
 = (icm°*è
£ndbuf
;

10 
icmp
->
icmp_ty³
 = 
ICMP_ECHO
;

11 
icmp
->
icmp_code
 = 0;

12 
icmp
->
icmp_id
 = 
pid
;

13 
icmp
->
icmp_£q
 = 
n£Á
++;

14 
	`mem£t
(
icmp
->
icmp_d©a
, 0xa5, 
d©®’
);

15 
	`G‘timeofday
((
timev®
 *è
icmp
->
icmp_d©a
, 
NULL
);

17 
Ën
 = 8 + 
d©®’
;

18 
icmp
->
icmp_cksum
 = 0;

19 
icmp
->
icmp_cksum
 = 
	`š_cksum
((
u_shÜt
 *èicmp, 
Ën
);

21 
	`S’dto
(
sockfd
, 
£ndbuf
, 
Ën
, 0, 
´
->
§£nd
,…r->
§Ën
);

22 
	}
}

	@osi\unpv13e\unpv13e\ping\send_v6.c

1 
	~"pšg.h
"

4 
	$£nd_v6
()

6 #ifdef 
IPV6


7 
Ën
;

8 
icmp6_hdr
 *
icmp6
;

10 
icmp6
 = (
icmp6_hdr
 *è
£ndbuf
;

11 
icmp6
->
icmp6_ty³
 = 
ICMP6_ECHO_REQUEST
;

12 
icmp6
->
icmp6_code
 = 0;

13 
icmp6
->
icmp6_id
 = 
pid
;

14 
icmp6
->
icmp6_£q
 = 
n£Á
++;

15 
	`mem£t
((
icmp6
 + 1), 0xa5, 
d©®’
);

16 
	`G‘timeofday
((
timev®
 *è(
icmp6
 + 1), 
NULL
);

18 
Ën
 = 8 + 
d©®’
;

20 
	`S’dto
(
sockfd
, 
£ndbuf
, 
Ën
, 0, 
´
->
§£nd
,…r->
§Ën
);

23 
	}
}

	@osi\unpv13e\unpv13e\ping\sig_alrm.c

1 
	~"pšg.h
"

4 
	$sig_®rm
(
signo
)

6 (*
´
->
f£nd
)();

8 
	`®¬m
(1);

10 
	}
}

	@osi\unpv13e\unpv13e\ping\tv_sub.c

1 
	~"uÅ.h
"

4 
	$tv_sub
(
timev®
 *
out
, timev® *
š
)

6 iàĞ(
out
->
tv_u£c
 -ğ
š
->tv_usec) < 0) {

7 --
out
->
tv_£c
;

8 
out
->
tv_u£c
 += 1000000;

10 
out
->
tv_£c
 -ğ
š
->tv_sec;

11 
	}
}

	@osi\unpv13e\unpv13e\route\checkudpsum.c

1 
	~"uÅrou‹.h
"

2 
	~<Ãtš‘/udp.h
>

3 
	~<Ãtš‘/_v¬.h
>

4 
	~<Ãtš‘/udp_v¬.h
>

7 
	$maš
(
¬gc
, **
¬gv
)

9 
mib
[4], 
v®
;

10 
size_t
 
Ën
;

12 
mib
[0] = 
CTL_NET
;

13 
mib
[1] = 
AF_INET
;

14 
mib
[2] = 
IPPROTO_UDP
;

15 
mib
[3] = 
UDPCTL_CHECKSUM
;

17 
Ën
 = (
v®
);

18 
	`Sysùl
(
mib
, 4, &
v®
, &
Ën
, 
NULL
, 0);

19 
	`´štf
("ud°checksum fÏg: %d\n", 
v®
);

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\route\get_ifi_info.c

1 
	~"uÅifi.h
"

2 
	~"uÅrou‹.h
"

5 
ifi_šfo
 *

6 
	$g‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)

8 
æags
;

9 *
buf
, *
Ãxt
, *
lim
;

10 
size_t
 
Ën
;

11 
if_msghdr
 *
ifm
;

12 
iç_msghdr
 *
içm
;

13 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

14 
sockaddr_dl
 *
sdl
;

15 
ifi_šfo
 *
ifi
, *
ifi§ve
, *
ifih—d
, **
ifÃxt
;

17 
buf
 = 
	`N‘_¹_iæi¡
(
çmy
, 0, &
Ën
);

19 
ifih—d
 = 
NULL
;

20 
ifÃxt
 = &
ifih—d
;

22 
lim
 = 
buf
 + 
Ën
;

23 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
ifm
->
ifm_msgËn
) {

24 
ifm
 = (
if_msghdr
 *è
Ãxt
;

25 ià(
ifm
->
ifm_ty³
 =ğ
RTM_IFINFO
) {

26 iàĞ((
æags
 = 
ifm
->
ifm_æags
è& 
IFF_UP
) == 0)

29 
§
 = (
sockaddr
 *è(
ifm
 + 1);

30 
	`g‘_¹addrs
(
ifm
->
ifm_addrs
, 
§
, 
¹i_šfo
);

31 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFP
]è!ğ
NULL
) {

32 
ifi
 = 
	`C®loc
(1, (
ifi_šfo
));

33 *
ifÃxt
 = 
ifi
;

34 
ifÃxt
 = &
ifi
->
ifi_Ãxt
;

36 
ifi
->
ifi_æags
 = 
æags
;

37 ià(
§
->
§_çmy
 =ğ
AF_LINK
) {

38 
sdl
 = (
sockaddr_dl
 *è
§
;

39 
ifi
->
ifi_šdex
 = 
sdl
->
sdl_šdex
;

40 ià(
sdl
->
sdl_Æ’
 > 0)

41 
	`¢´štf
(
ifi
->
ifi_Çme
, 
IFI_NAME
, "%*s",

42 
sdl
->
sdl_Æ’
, &sdl->
sdl_d©a
[0]);

44 
	`¢´štf
(
ifi
->
ifi_Çme
, 
IFI_NAME
, "index %d",

45 
sdl
->
sdl_šdex
);

47 iàĞ(
ifi
->
ifi_hËn
 = 
sdl
->
sdl_®’
) > 0)

48 
	`memıy
(
ifi
->
ifi_haddr
, 
	`LLADDR
(
sdl
),

49 
	`mš
(
IFI_HADDR
, 
sdl
->
sdl_®’
));

55 } ià(
ifm
->
ifm_ty³
 =ğ
RTM_NEWADDR
) {

56 ià(
ifi
->
ifi_addr
) {

57 ià(
dßlŸ£s
 == 0)

61 
ifi§ve
 = 
ifi
;

62 
ifi
 = 
	`C®loc
(1, (
ifi_šfo
));

63 *
ifÃxt
 = 
ifi
;

64 
ifÃxt
 = &
ifi
->
ifi_Ãxt
;

65 
ifi
->
ifi_æags
 = 
ifi§ve
->ifi_flags;

66 
ifi
->
ifi_šdex
 = 
ifi§ve
->ifi_index;

67 
ifi
->
ifi_hËn
 = 
ifi§ve
->ifi_hlen;

68 
	`memıy
(
ifi
->
ifi_Çme
, 
ifi§ve
->ifi_Çme, 
IFI_NAME
);

69 
	`memıy
(
ifi
->
ifi_haddr
, 
ifi§ve
->ifi_haddr, 
IFI_HADDR
);

72 
içm
 = (
iç_msghdr
 *è
Ãxt
;

73 
§
 = (
sockaddr
 *è(
içm
 + 1);

74 
	`g‘_¹addrs
(
içm
->
içm_addrs
, 
§
, 
¹i_šfo
);

76 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFA
]è!ğ
NULL
) {

77 
ifi
->
ifi_addr
 = 
	`C®loc
(1, 
§
->
§_Ën
);

78 
	`memıy
(
ifi
->
ifi_addr
, 
§
, sa->
§_Ën
);

81 ià((
æags
 & 
IFF_BROADCAST
) &&

82 (
§
 = 
¹i_šfo
[
RTAX_BRD
]è!ğ
NULL
) {

83 
ifi
->
ifi_brdaddr
 = 
	`C®loc
(1, 
§
->
§_Ën
);

84 
	`memıy
(
ifi
->
ifi_brdaddr
, 
§
, sa->
§_Ën
);

87 ià((
æags
 & 
IFF_POINTOPOINT
) &&

88 (
§
 = 
¹i_šfo
[
RTAX_BRD
]è!ğ
NULL
) {

89 
ifi
->
ifi_d¡addr
 = 
	`C®loc
(1, 
§
->
§_Ën
);

90 
	`memıy
(
ifi
->
ifi_d¡addr
, 
§
, sa->
§_Ën
);

94 
	`”r_qu™
("uÃx³ùed mes§gty³ %d", 
ifm
->
ifm_ty³
);

97 (
ifih—d
);

98 
	}
}

102 
	$ä“_ifi_šfo
(
ifi_šfo
 *
ifih—d
)

104 
ifi_šfo
 *
ifi
, *
ifšext
;

106 
ifi
 = 
ifih—d
; if˜!ğ
NULL
; if˜ğ
ifšext
) {

107 ià(
ifi
->
ifi_addr
 !ğ
NULL
)

108 
	`ä“
(
ifi
->
ifi_addr
);

109 ià(
ifi
->
ifi_brdaddr
 !ğ
NULL
)

110 
	`ä“
(
ifi
->
ifi_brdaddr
);

111 ià(
ifi
->
ifi_d¡addr
 !ğ
NULL
)

112 
	`ä“
(
ifi
->
ifi_d¡addr
);

113 
ifšext
 = 
ifi
->
ifi_Ãxt
;

114 
	`ä“
(
ifi
);

116 
	}
}

118 
ifi_šfo
 *

119 
	$G‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)

121 
ifi_šfo
 *
ifi
;

123 iàĞ(
ifi
 = 
	`g‘_ifi_šfo
(
çmy
, 
dßlŸ£s
)è=ğ
NULL
)

124 
	`”r_qu™
("get_ifi_infoƒrror");

125 (
ifi
);

126 
	}
}

	@osi\unpv13e\unpv13e\route\getrt.c

2 
	~"uÅrou‹.h
"

4 
	#BUFLEN
 ((
¹_msghdr
è+ 512)

	)

6 
	#SEQ
 9999

	)

9 
	$maš
(
¬gc
, **
¬gv
)

11 
sockfd
;

12 *
buf
;

13 
pid_t
 
pid
;

14 
ssize_t
 
n
;

15 
¹_msghdr
 *
¹m
;

16 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

17 
sockaddr_š
 *
sš
;

19 ià(
¬gc
 != 2)

20 
	`”r_qu™
("usage: getrt <IPaddress>");

22 
sockfd
 = 
	`Sock‘
(
AF_ROUTE
, 
SOCK_RAW
, 0);

24 
buf
 = 
	`C®loc
(1, 
BUFLEN
);

26 
¹m
 = (
¹_msghdr
 *è
buf
;

27 
¹m
->
¹m_msgËn
 = (
¹_msghdr
è+ (
sockaddr_š
);

28 
¹m
->
¹m_v”siÚ
 = 
RTM_VERSION
;

29 
¹m
->
¹m_ty³
 = 
RTM_GET
;

30 
¹m
->
¹m_addrs
 = 
RTA_DST
;

31 
¹m
->
¹m_pid
 = 
pid
 = 
	`g‘pid
();

32 
¹m
->
¹m_£q
 = 
SEQ
;

34 
sš
 = (
sockaddr_š
 *è(
¹m
 + 1);

35 
sš
->
sš_Ën
 = (
sockaddr_š
);

36 
sš
->
sš_çmy
 = 
AF_INET
;

37 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
sš
->
sš_addr
);

39 
	`Wr™e
(
sockfd
, 
¹m
,„tm->
¹m_msgËn
);

42 
n
 = 
	`R—d
(
sockfd
, 
¹m
, 
BUFLEN
);

43 } 
¹m
->
¹m_ty³
 !ğ
RTM_GET
 ||„tm->
¹m_£q
 !ğ
SEQ
 ||

44 
¹m
->
¹m_pid
 !ğ
pid
);

48 
¹m
 = (
¹_msghdr
 *è
buf
;

49 
§
 = (
sockaddr
 *è(
¹m
 + 1);

50 
	`g‘_¹addrs
(
¹m
->
¹m_addrs
, 
§
, 
¹i_šfo
);

51 iàĞ(
§
 = 
¹i_šfo
[
RTAX_DST
]è!ğ
NULL
)

52 
	`´štf
("de¡: %s\n", 
	`Sock_Áİ_ho¡
(
§
, sa->
§_Ën
));

54 iàĞ(
§
 = 
¹i_šfo
[
RTAX_GATEWAY
]è!ğ
NULL
)

55 
	`´štf
("g©eway: %s\n", 
	`Sock_Áİ_ho¡
(
§
, sa->
§_Ën
));

57 iàĞ(
§
 = 
¹i_šfo
[
RTAX_NETMASK
]è!ğ
NULL
)

58 
	`´štf
("Ãtmask: %s\n", 
	`Sock_masktİ
(
§
, sa->
§_Ën
));

60 iàĞ(
§
 = 
¹i_šfo
[
RTAX_GENMASK
]è!ğ
NULL
)

61 
	`´štf
("g’mask: %s\n", 
	`Sock_masktİ
(
§
, sa->
§_Ën
));

63 
	`ex™
(0);

64 
	}
}

	@osi\unpv13e\unpv13e\route\mynetstat.c

1 
	~"uÅrou‹.h
"

3 
´_¹abË
();

4 
´_iæi¡
();

7 
	$maš
(
¬gc
, **
¬gv
)

9 
çmy
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage: mynetstat <inet4|inet6|all>");

13 ià(
	`¡rcmp
(
¬gv
[1], "inet4") == 0)

14 
çmy
 = 
AF_INET
;

15 #ifdef 
AF_INET6


16 ià(
	`¡rcmp
(
¬gv
[1], "inet6") == 0)

17 
çmy
 = 
AF_INET6
;

19 ià(
	`¡rcmp
(
¬gv
[1], "all") == 0)

20 
çmy
 = 0;

22 
	`”r_qu™
("invalid <address-family>");

24 
	`´_¹abË
(
çmy
);

26 
	`´_iæi¡
(
çmy
);

28 
	`ex™
(0);

29 
	}
}

32 
	$´_¹abË
(
çmy
)

34 *
buf
, *
Ãxt
, *
lim
;

35 
size_t
 
Ën
;

36 
¹_msghdr
 *
¹m
;

37 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

39 
buf
 = 
	`N‘_¹_dump
(
çmy
, 0, &
Ën
);

41 
lim
 = 
buf
 + 
Ën
;

42 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
¹m
->
¹m_msgËn
) {

43 
¹m
 = (
¹_msghdr
 *è
Ãxt
;

44 
§
 = (
sockaddr
 *)(
¹m
 + 1);

45 
	`g‘_¹addrs
(
¹m
->
¹m_addrs
, 
§
, 
¹i_šfo
);

46 iàĞ(
§
 = 
¹i_šfo
[
RTAX_DST
]è!ğ
NULL
)

47 
	`´štf
("de¡: %s", 
	`sock_Áİ
(
§
, sa->
§_Ën
));

49 iàĞ(
§
 = 
¹i_šfo
[
RTAX_GATEWAY
]è!ğ
NULL
)

50 
	`´štf
(", g©eway: %s", 
	`sock_Áİ
(
§
, sa->
§_Ën
));

52 
	`´štf
("\n");

54 
	}
}

57 
	$´_iæi¡
(
çmy
)

59 
æags
;

60 *
buf
, *
Ãxt
, *
lim
;

61 
u_ch¬
 *
±r
;

62 
size_t
 
Ën
;

63 
if_msghdr
 *
ifm
;

64 
iç_msghdr
 *
içm
;

65 
sockaddr
 *
§
, *
¹i_šfo
[
RTAX_MAX
];

66 
sockaddr_dl
 *
sdl
;

68 
buf
 = 
	`N‘_¹_iæi¡
(
çmy
, 0, &
Ën
);

70 
lim
 = 
buf
 + 
Ën
;

71 
Ãxt
 = 
buf
;‚exˆ< 
lim
;‚exˆ+ğ
ifm
->
ifm_msgËn
) {

72 
ifm
 = (
if_msghdr
 *è
Ãxt
;

73 ià(
ifm
->
ifm_ty³
 =ğ
RTM_IFINFO
) {

74 
§
 = (
sockaddr
 *)(
ifm
 + 1);

75 
	`g‘_¹addrs
(
ifm
->
ifm_addrs
, 
§
, 
¹i_šfo
);

76 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFP
]è!ğ
NULL
) {

77 ià(((
æags
 = 
ifm
->
ifm_æags
è& 
IFF_UP
) == 0)

79 
	`´štf
("š‹rçû: %s: <", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

80 ià(
æags
 & 
IFF_UP
è
	`´štf
("UP ");

81 ià(
æags
 & 
IFF_BROADCAST
è
	`´štf
("BCAST ");

82 ià(
æags
 & 
IFF_MULTICAST
è
	`´štf
("MCAST ");

83 ià(
æags
 & 
IFF_LOOPBACK
è
	`´štf
("LOOP ");

84 ià(
æags
 & 
IFF_POINTOPOINT
è
	`´štf
("P2P ");

85 
	`´štf
(">\n");

87 ià(
§
->
§_çmy
 =ğ
AF_LINK
 &&

88 (
sdl
 = (
sockaddr_dl
 *è
§
) &&

89 (
sdl
->
sdl_®’
 > 0)) {

90 
±r
 = (
u_ch¬
 *è&
sdl
->
sdl_d©a
[sdl->
sdl_Æ’
];

91 
	`´štf
(" %x:%x:%x:%x:%x:%x\n", *
±r
, *(ptr+1),

92 *(
±r
+2), *(ptr+3), *(ptr+4), *(ptr+5));

96 } ià(
ifm
->
ifm_ty³
 =ğ
RTM_NEWADDR
) {

97 
içm
 = (
iç_msghdr
 *è
Ãxt
;

98 
§
 = (
sockaddr
 *)(
içm
 + 1);

99 
	`g‘_¹addrs
(
içm
->
içm_addrs
, 
§
, 
¹i_šfo
);

100 iàĞ(
§
 = 
¹i_šfo
[
RTAX_IFA
]è!ğ
NULL
)

101 
	`´štf
(" IP‡ddr: %s\n", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

102 ià((
æags
 & 
IFF_BROADCAST
è&& (
§
 = 
¹i_šfo
[
RTAX_BRD
]))

103 
	`´štf
(" bÿ¡‡ddr: %s\n", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

106 
	`”r_qu™
("uÃx³ùed mes§gty³ %d", 
ifm
->
ifm_ty³
);

108 
	}
}

	@osi\unpv13e\unpv13e\route\prifindex.c

1 
	~"uÅifi.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 ià(
¬gc
 != 2)

7 
	`”r_qu™
("usage:…rifname <interface-name>");

9 
	`´štf
("š‹rçû index = %d\n", 
	`If_Çm‘ošdex
(
¬gv
[1]));

10 
	`ex™
(0);

11 
	}
}

	@osi\unpv13e\unpv13e\route\prifinfo.c

1 
	~"uÅifi.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
ifi_šfo
 *
ifi
, *
ifih—d
;

7 
sockaddr
 *
§
;

8 
u_ch¬
 *
±r
;

9 
i
, 
çmy
, 
dßlŸ£s
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage:…rifinfo <inet4|inet6> <doaliases>");

13 ià(
	`¡rcmp
(
¬gv
[1], "inet4") == 0)

14 
çmy
 = 
AF_INET
;

15 #ifdef 
AF_INET6


16 ià(
	`¡rcmp
(
¬gv
[1], "inet6") == 0)

17 
çmy
 = 
AF_INET6
;

20 
	`”r_qu™
("invalid <address-family>");

21 
dßlŸ£s
 = 
	`©oi
(
¬gv
[2]);

23 
ifih—d
 = 
ifi
 = 
	`G‘_ifi_šfo
(
çmy
, 
dßlŸ£s
);

24 
ifi
 !ğ
NULL
; if˜ğifi->
ifi_Ãxt
) {

25 
	`´štf
("%s: <", 
ifi
->
ifi_Çme
);

26 ià(
ifi
->
ifi_æags
 & 
IFF_UP
è
	`´štf
("UP ");

27 ià(
ifi
->
ifi_æags
 & 
IFF_BROADCAST
è
	`´štf
("BCAST ");

28 ià(
ifi
->
ifi_æags
 & 
IFF_MULTICAST
è
	`´štf
("MCAST ");

29 ià(
ifi
->
ifi_æags
 & 
IFF_LOOPBACK
è
	`´štf
("LOOP ");

30 ià(
ifi
->
ifi_æags
 & 
IFF_POINTOPOINT
è
	`´štf
("P2P ");

31 
	`´štf
(">\n");

33 iàĞ(
i
 = 
ifi
->
ifi_hËn
) > 0) {

34 
±r
 = 
ifi
->
ifi_haddr
;

36 
	`´štf
("%s%x", (
i
 =ğ
ifi
->
ifi_hËn
è? " " : ":", *
±r
++);

37 } --
i
 > 0);

38 
	`´štf
("\n");

41 iàĞ(
§
 = 
ifi
->
ifi_addr
è!ğ
NULL
)

42 
	`´štf
(" IP‡ddr: %s\n", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

43 iàĞ(
§
 = 
ifi
->
ifi_brdaddr
è!ğ
NULL
)

44 
	`´štf
(" brßdÿ¡‡ddr: %s\n", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

45 iàĞ(
§
 = 
ifi
->
ifi_d¡addr
è!ğ
NULL
)

46 
	`´štf
(" de¡š©iÚ‡ddr: %s\n", 
	`Sock_Áİ
(
§
, sa->
§_Ën
));

48 
	`ä“_ifi_šfo
(
ifih—d
);

49 
	`ex™
(0);

50 
	}
}

	@osi\unpv13e\unpv13e\route\prifname.c

1 
	~"uÅifi.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
Çme
[16];

8 ià(
¬gc
 != 2)

9 
	`”r_qu™
("usage:…rifname <interface-index>");

11 
	`´štf
("š‹rçû‚amğ%s\n", 
	`If_šdextÚame
(
	`©oi
(
¬gv
[1]), 
Çme
));

12 
	`ex™
(0);

13 
	}
}

	@osi\unpv13e\unpv13e\route\prifnameindex.c

1 
	~"uÅifi.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
n
;

7 
iâame
[
IFNAMSIZ
];

8 
if_Çmešdex
 *
iåŒ
, *
§ve
;

10 ià(
¬gc
 != 1)

11 
	`”r_qu™
("usage:…rifnameindex");

14 
§ve
 = 
iåŒ
 = 
	`If_Çmešdex
(); iåŒ->
if_šdex
 > 0; ifptr++) {

15 
	`´štf
("Çmğ%s, index = %d\n", 
iåŒ
->
if_Çme
, iåŒ->
if_šdex
);;

17 iàĞ(
n
 = 
	`If_Çm‘ošdex
(
iåŒ
->
if_Çme
)è!ğiåŒ->
if_šdex
)

18 
	`”r_qu™
("if_nametoindex„eturned %d,ƒxpected %d, for %s",

19 
n
, 
iåŒ
->
if_šdex
, iåŒ->
if_Çme
);

21 
	`If_šdextÚame
(
iåŒ
->
if_šdex
, 
iâame
);

22 ià(
	`¡rcmp
(
iâame
, 
iåŒ
->
if_Çme
) != 0)

23 
	`”r_qu™
("if_indextoname„eturned %s,ƒxpected %s, for %d",

24 
iâame
, 
iåŒ
->
if_Çme
, iåŒ->
if_šdex
);

27 
n
 = 
	`if_Çm‘ošdex
("fkjhkjhgjhgjhgdjhguyetiuyiuyhkjhkjdh");

28 ià(
n
 != 0)

29 
	`”r_qu™
("if_Çm‘ošdex„‘uºed %d fÜ fkjh...", 
n
);

30 
n
 = 
	`if_Çm‘ošdex
("");

31 ià(
n
 != 0)

32 
	`”r_qu™
("if_Çm‘ošdex„‘uºed %d fÜ (nuÎ)", 
n
);

34 ià(
	`if_šdextÚame
(0, 
iâame
è!ğ
NULL
)

35 
	`”r_qu™
("if_indextonameƒrror for 0");

36 ià(
	`if_šdextÚame
(888888, 
iâame
è!ğ
NULL
)

37 
	`”r_qu™
("if_indextonameƒrror for 888888");

39 
	`if_ä“Çmešdex
(
§ve
);

40 
	`ex™
(0);

41 
	}
}

	@osi\unpv13e\unpv13e\route\unproute.h

1 
	~"uÅ.h
"

2 
	~<Ãt/if.h
>

3 
	~<Ãt/if_dl.h
>

4 
	~<Ãt/rou‹.h
>

5 
	~<sys/·¿m.h
>

7 #ifdef 
HAVE_SYS_SYSCTL_H


8 
	~<sys/sysùl.h
>

12 
g‘_¹addrs
(, 
sockaddr
 *, sockaddr **);

13 *
Ãt_¹_iæi¡
(, , 
size_t
 *);

14 *
Ãt_¹_dump
(, , 
size_t
 *);

15 *
sock_masktİ
(
sockaddr
 *, 
sockËn_t
);

18 *
N‘_¹_iæi¡
(, , 
size_t
 *);

19 *
N‘_¹_dump
(, , 
size_t
 *);

20 
	#Sock_masktİ
(
a
,
b
è
	`sock_masktİ
(×), (b))

	)

	@osi\unpv13e\unpv13e\rtt\dg_cli.c

1 
	~"uÅ.h
"

3 
ssize_t
 
Dg_£nd_»cv
(, cÚ¡ *, 
size_t
, *, size_t,

4 cÚ¡ 
SA
 *, 
sockËn_t
);

7 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

9 
ssize_t
 
n
;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

12 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

14 
n
 = 
	`Dg_£nd_»cv
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline),

15 
»cvlše
, 
MAXLINE
, 
p£rvaddr
, 
£rvËn
);

17 
»cvlše
[
n
] = 0;

18 
	`Fputs
(
»cvlše
, 
¡dout
);

20 
	}
}

	@osi\unpv13e\unpv13e\rtt\dg_echo.c

1 
	~"uÅ.h
"

4 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

6 
n
;

7 
sockËn_t
 
Ën
;

8 
mesg
[
MAXLINE
];

11 
Ën
 = 
ş’
;

12 
n
 = 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
pşŸddr
, &
Ën
);

14 
	`S’dto
(
sockfd
, 
mesg
, 
n
, 0, 
pşŸddr
, 
ş’
);

16 
	}
}

	@osi\unpv13e\unpv13e\rtt\dg_send_recv.c

2 
	~"uÅ¹t.h
"

3 
	~<£tjmp.h
>

5 
	#RTT_DEBUG


	)

7 
¹t_šfo
 
	g¹tšfo
;

8 
	g¹tš™
 = 0;

9 
msghdr
 
	gmsg£nd
, 
	gmsg»cv
;

10 
	shdr
 {

11 
ušt32_t
 
	m£q
;

12 
ušt32_t
 
	mts
;

13 } 
	g£ndhdr
, 
	g»cvhdr
;

15 
sig_®rm
(
signo
);

16 
sigjmp_buf
 
	gjmpbuf
;

18 
ssize_t


19 
	$dg_£nd_»cv
(
fd
, cÚ¡ *
outbuff
, 
size_t
 
outby‹s
,

20 *
šbuff
, 
size_t
 
šby‹s
,

21 cÚ¡ 
SA
 *
de¡addr
, 
sockËn_t
 
de¡Ën
)

23 
ssize_t
 
n
;

24 
iovec
 
iov£nd
[2], 
iov»cv
[2];

26 ià(
¹tš™
 == 0) {

27 
	`¹t_š™
(&
¹tšfo
);

28 
¹tš™
 = 1;

29 
¹t_d_æag
 = 1;

32 
£ndhdr
.
£q
++;

33 
msg£nd
.
msg_Çme
 = 
de¡addr
;

34 
msg£nd
.
msg_Çm–’
 = 
de¡Ën
;

35 
msg£nd
.
msg_iov
 = 
iov£nd
;

36 
msg£nd
.
msg_iovËn
 = 2;

37 
iov£nd
[0].
iov_ba£
 = &
£ndhdr
;

38 
iov£nd
[0].
iov_Ën
 = (
hdr
);

39 
iov£nd
[1].
iov_ba£
 = 
outbuff
;

40 
iov£nd
[1].
iov_Ën
 = 
outby‹s
;

42 
msg»cv
.
msg_Çme
 = 
NULL
;

43 
msg»cv
.
msg_Çm–’
 = 0;

44 
msg»cv
.
msg_iov
 = 
iov»cv
;

45 
msg»cv
.
msg_iovËn
 = 2;

46 
iov»cv
[0].
iov_ba£
 = &
»cvhdr
;

47 
iov»cv
[0].
iov_Ën
 = (
hdr
);

48 
iov»cv
[1].
iov_ba£
 = 
šbuff
;

49 
iov»cv
[1].
iov_Ën
 = 
šby‹s
;

53 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

54 
	`¹t_Ãw·ck
(&
¹tšfo
);

56 
£ndagaš
:

57 #ifdef 
RTT_DEBUG


58 
	`årštf
(
¡d”r
, "£nd %4d: ", 
£ndhdr
.
£q
);

60 
£ndhdr
.
ts
 = 
	`¹t_ts
(&
¹tšfo
);

61 
	`S’dmsg
(
fd
, &
msg£nd
, 0);

63 
	`®¬m
(
	`¹t_¡¬t
(&
¹tšfo
));

64 #ifdef 
RTT_DEBUG


65 
	`¹t_debug
(&
¹tšfo
);

68 ià(
	`sig£tjmp
(
jmpbuf
, 1) != 0) {

69 ià(
	`¹t_timeout
(&
¹tšfo
) < 0) {

70 
	`”r_msg
("dg_send_recv:‚o„esponse from server, giving up");

71 
¹tš™
 = 0;

72 
”ºo
 = 
ETIMEDOUT
;

75 #ifdef 
RTT_DEBUG


76 
	`”r_msg
("dg_send_recv:imeout,„etransmitting");

78 
£ndagaš
;

82 
n
 = 
	`Recvmsg
(
fd
, &
msg»cv
, 0);

83 #ifdef 
RTT_DEBUG


84 
	`årštf
(
¡d”r
, "»cv %4d\n", 
»cvhdr
.
£q
);

86 } 
n
 < (
hdr
è|| 
»cvhdr
.
£q
 !ğ
£ndhdr
.seq);

88 
	`®¬m
(0);

90 
	`¹t_¡İ
(&
¹tšfo
, 
	`¹t_ts
(&¹tšfoè- 
»cvhdr
.
ts
);

92 (
n
 - (
hdr
));

93 
	}
}

96 
	$sig_®rm
(
signo
)

98 
	`siglÚgjmp
(
jmpbuf
, 1);

99 
	}
}

102 
ssize_t


103 
	$Dg_£nd_»cv
(
fd
, cÚ¡ *
outbuff
, 
size_t
 
outby‹s
,

104 *
šbuff
, 
size_t
 
šby‹s
,

105 cÚ¡ 
SA
 *
de¡addr
, 
sockËn_t
 
de¡Ën
)

107 
ssize_t
 
n
;

109 
n
 = 
	`dg_£nd_»cv
(
fd
, 
outbuff
, 
outby‹s
, 
šbuff
, 
šby‹s
,

110 
de¡addr
, 
de¡Ën
);

111 ià(
n
 < 0)

112 
	`”r_qu™
("dg_send_recvƒrror");

114 (
n
);

115 
	}
}

	@osi\unpv13e\unpv13e\rtt\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\rtt\unprtt.h

1 #iâdef 
__uÅ_¹t_h


2 
	#__uÅ_¹t_h


	)

4 
	~"uÅ.h
"

6 
	s¹t_šfo
 {

7 
	m¹t_¹t
;

8 
	m¹t_¤‰
;

9 
	m¹t_¹tv¬
;

10 
	m¹t_¹o
;

11 
	m¹t_Äexmt
;

12 
ušt32_t
 
	m¹t_ba£
;

15 
	#RTT_RXTMIN
 2

	)

16 
	#RTT_RXTMAX
 60

	)

17 
	#RTT_MAXNREXMT
 3

	)

20 
¹t_debug
(
¹t_šfo
 *);

21 
¹t_š™
(
¹t_šfo
 *);

22 
¹t_Ãw·ck
(
¹t_šfo
 *);

23 
¹t_¡¬t
(
¹t_šfo
 *);

24 
¹t_¡İ
(
¹t_šfo
 *, 
ušt32_t
);

25 
¹t_timeout
(
¹t_šfo
 *);

26 
ušt32_t
 
¹t_ts
(
¹t_šfo
 *);

28 
¹t_d_æag
;

	@osi\unpv13e\unpv13e\sctp\sctp_addr_to_associd.c

1 
	~"uÅ.h
"

3 
sùp_assoc_t


4 
	$sùp_add»ss_to_associd
(
sock_fd
, 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
)

6 
sùp_·dd½¬ams
 
¥
;

7 
siz
;

9 
siz
 = (
sùp_·dd½¬ams
);

10 
	`bz”o
(&
¥
,
siz
);

11 
	`memıy
(&
¥
.
¥p_add»ss
,
§
,
§Ën
);

12 
	`sùp_İt_šfo
(
sock_fd
,0,

13 
SCTP_PEER_ADDR_PARAMS
, &
¥
, &
siz
);

14 (
¥
.
¥p_assoc_id
);

15 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_bindargs.c

1 
	~"uÅ.h
"

4 
	$sùp_bšd_¬g_li¡
(
sock_fd
, **
¬gv
, 
¬gc
)

6 
addršfo
 *
addr
;

7 *
bšdbuf
, *
p
, 
pÜtbuf
[10];

8 
addrút
=0;

9 
i
;

11 
bšdbuf
 = (*)
	`C®loc
(
¬gc
, (
sockaddr_¡Üage
));

12 
p
 = 
bšdbuf
;

13 
	`¥rštf
(
pÜtbuf
, "%d", 
SERV_PORT
);

14  
i
=0; i<
¬gc
; i++ ) {

15 
addr
 = 
	`Ho¡_£rv
(
¬gv
[
i
], 
pÜtbuf
, 
AF_UNSPEC
, 
SOCK_SEQPACKET
);

16 
	`memıy
(
p
, 
addr
->
ai_addr
,‡ddr->
ai_add¾’
);

17 
	`ä“addršfo
(
addr
);

18 
addrút
++;

19 
p
 +ğ
addr
->
ai_add¾’
;

21 
	`Sùp_bšdx
(
sock_fd
,(
SA
 *)
bšdbuf
,
addrút
,
SCTP_BINDX_ADD_ADDR
);

22 
	`ä“
(
bšdbuf
);

24 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_check_notify.c

1 
	~"uÅ.h
"

4 
	$check_nÙifiÿtiÚ
(
sock_fd
,*
»cvlše
,
rd_Ën
)

6 
sùp_nÙifiÿtiÚ
 *
¢p
;

7 
sùp_assoc_chªge
 *
§c
;

8 
sockaddr_¡Üage
 *
§l
,*
§r
;

9 
num_»m
, 
num_loc
;

11 
¢p
 = (
sùp_nÙifiÿtiÚ
 *)
»cvlše
;

12 if(
¢p
->
¢_h—d”
.
¢_ty³
 =ğ
SCTP_ASSOC_CHANGE
) {

13 
§c
 = &
¢p
->
¢_assoc_chªge
;

14 if((
§c
->
§c_¡©e
 =ğ
SCTP_COMM_UP
) ||

15 (
§c
->
§c_¡©e
 =ğ
SCTP_RESTART
)) {

16 
num_»m
 = 
	`sùp_g‘·ddrs
(
sock_fd
,
§c
->
§c_assoc_id
,&
§r
);

17 
	`´štf
("There‡re %d„emote‡ddresses‡ndhey‡re:\n",

18 
num_»m
);

19 
	`sùp_´št_add»s£s
(
§r
,
num_»m
);

20 
	`sùp_ä“·ddrs
(
§r
);

22 
num_loc
 = 
	`sùp_g‘Ïddrs
(
sock_fd
,
§c
->
§c_assoc_id
,&
§l
);

23 
	`´štf
("There‡re %d†ocal‡ddresses‡ndhey‡re:\n",

24 
num_loc
);

25 
	`sùp_´št_add»s£s
(
§l
,
num_loc
);

26 
	`sùp_ä“Ïddrs
(
§l
);

30 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_displayevents.c

1 
	~"uÅ.h
"

4 
	$´št_nÙifiÿtiÚ
(*
nÙify_buf
)

6 
sùp_nÙifiÿtiÚ
 *
¢p
;

7 
sùp_assoc_chªge
 *
§c
;

8 
sùp_·ddr_chªge
 *
¥c
;

9 
sùp_»mÙe_”rÜ
 *
¤e
;

10 
sùp_£nd_çed
 *
ssf
;

11 
sùp_shutdown_ev’t
 *
s£
;

12 
sùp_ad­tiÚ_ev’t
 *
«
;

13 
sùp_pd­i_ev’t
 *
pd­i
;

14 cÚ¡ *
¡r
;

16 
¢p
 = (
sùp_nÙifiÿtiÚ
 *)
nÙify_buf
;

17 
¢p
->
¢_h—d”
.
¢_ty³
) {

18 
SCTP_ASSOC_CHANGE
:

19 
§c
 = &
¢p
->
¢_assoc_chªge
;

20 
§c
->
§c_¡©e
) {

21 
SCTP_COMM_UP
:

22 
¡r
 = "COMMUNICATION UP";

24 
SCTP_COMM_LOST
:

25 
¡r
 = "COMMUNICATION LOST";

27 
SCTP_RESTART
:

28 
¡r
 = "RESTART";

30 
SCTP_SHUTDOWN_COMP
:

31 
¡r
 = "SHUTDOWN COMPLETE";

33 
SCTP_CANT_STR_ASSOC
:

34 
¡r
 = "CAN'T START ASSOC";

37 
¡r
 = "UNKNOWN";

40 
	`´štf
("SCTP_ASSOC_CHANGE: %s,‡ssoc=0x%x\n", 
¡r
,

41 (
ušt32_t
)
§c
->
§c_assoc_id
);

43 
SCTP_PEER_ADDR_CHANGE
:

44 
¥c
 = &
¢p
->
¢_·ddr_chªge
;

45 
¥c
->
¥c_¡©e
) {

46 
SCTP_ADDR_AVAILABLE
:

47 
¡r
 = "ADDRESS AVAILABLE";

49 
SCTP_ADDR_UNREACHABLE
:

50 
¡r
 = "ADDRESS UNREACHABLE";

52 
SCTP_ADDR_REMOVED
:

53 
¡r
 = "ADDRESS REMOVED";

55 
SCTP_ADDR_ADDED
:

56 
¡r
 = "ADDRESS ADDED";

58 
SCTP_ADDR_MADE_PRIM
:

59 
¡r
 = "ADDRESS MADE PRIMARY";

62 
¡r
 = "UNKNOWN";

65 
	`´štf
("SCTP_PEER_ADDR_CHANGE: %s,‡ddr=%s,‡ssoc=0x%x\n", 
¡r
,

66 
	`Sock_Áİ
((
SA
 *)&
¥c
->
¥c_¯ddr
, (spc->spc_aaddr)),

67 (
ušt32_t
)
¥c
->
¥c_assoc_id
);

69 
SCTP_REMOTE_ERROR
:

70 
¤e
 = &
¢p
->
¢_»mÙe_”rÜ
;

71 
	`´štf
("SCTP_REMOTE_ERROR:‡ssoc=0x%xƒrror=%d\n",

72 (
ušt32_t
)
¤e
->
¤e_assoc_id
, s»->
¤e_”rÜ
);

74 
SCTP_SEND_FAILED
:

75 
ssf
 = &
¢p
->
¢_£nd_çed
;

76 
	`´štf
("SCTP_SEND_FAILED:‡ssoc=0x%xƒrror=%d\n",

77 (
ušt32_t
)
ssf
->
ssf_assoc_id
, ssf->
ssf_”rÜ
);

79 
SCTP_ADAPTION_INDICATION
:

80 
«
 = &
¢p
->
¢_ad­tiÚ_ev’t
;

81 
	`´štf
("SCTP_ADAPTION_INDICATION: 0x%x\n",

82 (
u_št
)
«
->
§i_ad­tiÚ_šd
);

84 
SCTP_PARTIAL_DELIVERY_EVENT
:

85 
pd­i
 = &
¢p
->
¢_pd­i_ev’t
;

86 if(
pd­i
->
pd­i_šdiÿtiÚ
 =ğ
SCTP_PARTIAL_DELIVERY_ABORTED
)

87 
	`´štf
("SCTP_PARTIAL_DELIEVERY_ABORTED\n");

89 
	`´štf
("Unknown SCTP_PARTIAL_DELIVERY_EVENT 0x%x\n",

90 
pd­i
->
pd­i_šdiÿtiÚ
);

92 
SCTP_SHUTDOWN_EVENT
:

93 
s£
 = &
¢p
->
¢_shutdown_ev’t
;

94 
	`´štf
("SCTP_SHUTDOWN_EVENT:‡ssoc=0x%x\n",

95 (
ušt32_t
)
s£
->
s£_assoc_id
);

98 
	`´štf
("Unknown‚otificationƒventype=0x%x\n",

99 
¢p
->
¢_h—d”
.
¢_ty³
);

101 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_getnostrm.c

1 
	~"uÅ.h
"

4 
	$sùp_g‘_no_¡rms
(
sock_fd
,
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

6 
»tsz
;

7 
sùp_¡©us
 
¡©us
;

8 
»tsz
 = (
¡©us
);

9 
	`bz”o
(&
¡©us
,(status));

11 
¡©us
.
s¡©_assoc_id
 = 
	`sùp_add»ss_to_associd
(
sock_fd
,
to
,
tŞ’
);

12 
	`G‘sockİt
(
sock_fd
,
IPPROTO_SCTP
, 
SCTP_STATUS
,

13 &
¡©us
, &
»tsz
);

14 (
¡©us
.
s¡©_out¡rms
);

15 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_modify_hb.c

1 
	~"uÅ.h
"

3 
	$h—¹b—t_aùiÚ
(
sock_fd
, 
sockaddr
 *
§
, 
sockËn_t
 
§Ën
,

4 
u_št
 
v®ue
)

6 
sùp_·dd½¬ams
 
¥
;

7 
siz
;

9 
	`bz”o
(&
¥
,(sp));

10 
¥
.
¥p_hbš‹rv®
 = 
v®ue
;

11 
	`memıy
((
ÿddr_t
)&
¥
.
¥p_add»ss
,
§
,
§Ën
);

12 
	`S‘sockİt
(
sock_fd
,
IPPROTO_SCTP
,

13 
SCTP_PEER_ADDR_PARAMS
, &
¥
, (sp));

15 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_pdapircv.c

1 
	~"uÅ.h
"

3 
ušt8_t
 *
	gsùp_pd­i_»adbuf
=
NULL
;

4 
	gsùp_pd­i_rdbuf_sz
=0;

7 
ušt8_t
 *

8 
	$pd­i_»cvmsg
(
sock_fd
,

9 *
rdËn
,

10 
SA
 *
äom
,

11 *
äom_Ën
,

12 
sùp_¢drcvšfo
 *
¤i
,

13 *
msg_æags
)

15 
rdsz
,
Ëá
,
©_š_buf
;

16 
ämËn
=0;

18 ià(
sùp_pd­i_»adbuf
 =ğ
NULL
) {

19 
sùp_pd­i_»adbuf
 = (
ušt8_t
 *)
	`M®loc
(
SCTP_PDAPI_INCR_SZ
);

20 
sùp_pd­i_rdbuf_sz
 = 
SCTP_PDAPI_INCR_SZ
;

22 
©_š_buf
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
sùp_pd­i_»adbuf
, 
sùp_pd­i_rdbuf_sz
,

23 
äom
, 
äom_Ën
,

24 
¤i
,
msg_æags
);

25 if(
©_š_buf
 < 1){

26 *
rdËn
 = 
©_š_buf
;

27 (
NULL
);

29 (*
msg_æags
 & 
MSG_EOR
) == 0) {

30 
Ëá
 = 
sùp_pd­i_rdbuf_sz
 - 
©_š_buf
;

31 if(
Ëá
 < 
SCTP_PDAPI_NEED_MORE_THRESHOLD
) {

32 
sùp_pd­i_»adbuf
 = 
	`»®loc
(sùp_pd­i_»adbuf, 
sùp_pd­i_rdbuf_sz
+
SCTP_PDAPI_INCR_SZ
);

33 if(
sùp_pd­i_»adbuf
 =ğ
NULL
) {

34 
	`”r_qu™
("sctp_pdapi„an out of memory");

36 
sùp_pd­i_rdbuf_sz
 +ğ
SCTP_PDAPI_INCR_SZ
;

37 
Ëá
 = 
sùp_pd­i_rdbuf_sz
 - 
©_š_buf
;

39 
rdsz
 = 
	`Sùp_»cvmsg
(
sock_fd
, &
sùp_pd­i_»adbuf
[
©_š_buf
],

40 
Ëá
, 
NULL
, &
ämËn
, NULL, 
msg_æags
);

41 
©_š_buf
 +ğ
rdsz
;

43 *
rdËn
 = 
©_š_buf
;

44 (
sùp_pd­i_»adbuf
);

45 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_print_addrs.c

1 
	~"uÅ.h
"

4 
	$sùp_´št_add»s£s
(
sockaddr_¡Üage
 *
addrs
, 
num
)

6 
sockaddr_¡Üage
 *
ss
;

7 
i
,
§Ën
;

9 
ss
 = 
addrs
;

10 
i
=0; i<
num
; i++){

11 
	`´štf
("%s\n", 
	`Sock_Áİ
((
SA
 *)
ss
, 
§Ën
));

12 #ifdeà
HAVE_SOCKADDR_SA_LEN


13 
§Ën
 = 
ss
->
ss_Ën
;

15 
ss
->
ss_çmy
) {

16 
AF_INET
:

17 
§Ën
 = (
sockaddr_š
);

19 #ifdeà
IPV6


20 
AF_INET6
:

21 
§Ën
 = (
sockaddr_š6
);

25 
	`”r_qu™
("sctp_print_addresses: unknown AF");

29 
ss
 = (
sockaddr_¡Üage
 *)((*)s + 
§Ën
);

31 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_strcli.c

1 
	~"uÅ.h
"

4 
	$sùp¡r_şi
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

6 
sockaddr_š
 
³”addr
;

7 
sùp_¢drcvšfo
 
¤i
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

9 
sockËn_t
 
Ën
;

10 
out_sz
,
rd_sz
;

11 
msg_æags
;

13 
	`bz”o
(&
¤i
,(sri));

14 
	`fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 if(
£ndlše
[0] != '[') {

16 
	`´štf
("Error,†ine must be ofhe form '[streamnum]text'\n");

19 
¤i
.
sšfo_¡»am
 = 
	`¡¹Ş
(&
£ndlše
[1],
NULL
,0);

20 
out_sz
 = 
	`¡¾’
(
£ndlše
);

21 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, 
out_sz
,

22 
to
, 
tŞ’
,

24 
¤i
.
sšfo_¡»am
,

27 
Ën
 = (
³”addr
);

28 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»cvlše
, (recvline),

29 (
SA
 *)&
³”addr
, &
Ën
,

30 &
¤i
,&
msg_æags
);

31 
	`´štf
("From str:%d seq:%d (assoc:0x%x):",

32 
¤i
.
sšfo_¡»am
,¤i.
sšfo_s¢
,

33 (
u_št
)
¤i
.
sšfo_assoc_id
);

34 
	`´štf
("%.*s",
rd_sz
,
»cvlše
);

36 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_strcli1.c

1 
	~"uÅ.h
"

4 
	$sùp¡r_şi
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

6 
sockaddr_š
 
³”addr
;

7 
sùp_¢drcvšfo
 
¤i
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

9 
sockËn_t
 
Ën
;

10 
out_sz
,
rd_sz
;

11 
msg_æags
;

13 
	`bz”o
(&
¤i
,(sri));

14 
	`fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 if(
£ndlše
[0] != '[') {

16 
	`´štf
("Error,†ine must be ofhe form '[streamnum]text'\n");

19 
¤i
.
sšfo_¡»am
 = 
	`¡¹Ş
(&
£ndlše
[1],
NULL
,0);

20 
out_sz
 = 
	`¡¾’
(
£ndlše
);

21 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, 
out_sz
,

22 
to
, 
tŞ’
,

24 
¤i
.
sšfo_¡»am
,

28 
Ën
 = (
³”addr
);

29 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»cvlše
, (recvline),

30 (
SA
 *)&
³”addr
, &
Ën
,

31 &
¤i
,&
msg_æags
);

32 if(
msg_æags
 & 
MSG_NOTIFICATION
)

33 
	`check_nÙifiÿtiÚ
(
sock_fd
,
»cvlše
,
rd_sz
);

34 } 
msg_æags
 & 
MSG_NOTIFICATION
);

35 
	`´štf
("From str:%d seq:%d (assoc:0x%x):",

36 
¤i
.
sšfo_¡»am
,¤i.
sšfo_s¢
,

37 (
u_št
)
¤i
.
sšfo_assoc_id
);

38 
	`´štf
("%.*s",
rd_sz
,
»cvlše
);

41 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_strcli_un.c

1 
	~"uÅ.h
"

4 
	$sùp¡r_şi
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

6 
sockaddr_š
 
³”addr
;

7 
sùp_¢drcvšfo
 
¤i
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

9 
sockËn_t
 
Ën
;

10 
out_sz
,
rd_sz
;

11 
msg_æags
;

13 
	`bz”o
(&
¤i
,(sri));

14 
	`fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 if(
£ndlše
[0] != '[') {

16 
	`´štf
("Error,†ine must be ofhe form '[streamnum]text'\n");

19 
¤i
.
sšfo_¡»am
 = 
	`¡¹Ş
(&
£ndlše
[1],
NULL
,0);

21 
out_sz
 = 
	`¡¾’
(
£ndlše
);

22 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, 
out_sz
,

23 
to
, 
tŞ’
,

25 
MSG_UNORDERED
,

26 
¤i
.
sšfo_¡»am
,

29 
Ën
 = (
³”addr
);

30 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»cvlše
, (recvline),

31 (
SA
 *)&
³”addr
, &
Ën
,

32 &
¤i
,&
msg_æags
);

33 
	`´štf
("From str:%d seq:%d (assoc:0x%x):",

34 
¤i
.
sšfo_¡»am
,¤i.
sšfo_s¢
,

35 (
u_št
)
¤i
.
sšfo_assoc_id
);

36 
	`´štf
("%.*s",
rd_sz
,
»cvlše
);

38 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_strcliecho.c

1 
	~"uÅ.h
"

3 
	#SCTP_MAXLINE
 800

	)

6 
	$sùp¡r_şi_echßÎ
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

8 
sockaddr_š
 
³”addr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
£ndlše
[
SCTP_MAXLINE
], 
»cvlše
[SCTP_MAXLINE];

11 
sockËn_t
 
Ën
;

12 
rd_sz
,
i
,
¡rsz
;

13 
msg_æags
;

15 
	`bz”o
(
£ndlše
,(sendline));

16 
	`bz”o
(&
¤i
,(sri));

17 
	`fg‘s
(
£ndlše
, 
SCTP_MAXLINE
 - 9, 
å
è!ğ
NULL
) {

18 
¡rsz
 = 
	`¡¾’
(
£ndlše
);

19 if(
£ndlše
[
¡rsz
-1] == '\n') {

20 
£ndlše
[
¡rsz
-1] = '\0';

21 
¡rsz
--;

23 
i
=0;i<
SERV_MAX_SCTP_STRM
;i++) {

24 
	`¢´štf
(
£ndlše
 + 
¡rsz
, (sendline) - strsz,

25 ".msg.%d", 
i
);

26 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, (sendline),

27 
to
, 
tŞ’
,

29 
i
,

32 
i
=0;i<
SERV_MAX_SCTP_STRM
;i++) {

33 
Ën
 = (
³”addr
);

34 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»cvlše
, (recvline),

35 (
SA
 *)&
³”addr
, &
Ën
,

36 &
¤i
,&
msg_æags
);

37 
	`´štf
("From str:%d seq:%d (assoc:0x%x):",

38 
¤i
.
sšfo_¡»am
,¤i.
sšfo_s¢
,

39 (
u_št
)
¤i
.
sšfo_assoc_id
);

40 
	`´štf
("%.*s\n",
rd_sz
,
»cvlše
);

43 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_strcliecho2.c

1 
	~"uÅ.h
"

3 
	#SCTP_MAXLINE
 800

	)

6 
	$sùp¡r_şi_echßÎ
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
)

8 
sockaddr_š
 
³”addr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
£ndlše
[
SCTP_MAXLINE
], 
»cvlše
[SCTP_MAXLINE];

11 
sockËn_t
 
Ën
;

12 
rd_sz
,
i
,
¡rsz
;

13 
msg_æags
;

15 
	`bz”o
(
£ndlše
,(sendline));

16 
	`bz”o
(&
¤i
,(sri));

17 
	`fg‘s
(
£ndlše
, 
SCTP_MAXLINE
 - 9, 
å
è!ğ
NULL
) {

18 
¡rsz
 = 
	`¡¾’
(
£ndlše
);

19 if(
£ndlše
[
¡rsz
-1] == '\n') {

20 
£ndlše
[
¡rsz
-1] = '\0';

21 
¡rsz
--;

24 
i
=0;i<
SERV_MAX_SCTP_STRM
;i++) {

25 
	`¢´štf
(
£ndlše
 + 
¡rsz
, (sendline) - strsz,

26 ".msg.%d 1", 
i
);

27 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, (sendline),

28 
to
, 
tŞ’
,

30 
i
,

32 
	`¢´štf
(
£ndlše
 + 
¡rsz
, (sendline) - strsz,

33 ".msg.%d 2", 
i
);

34 
	`Sùp_£ndmsg
(
sock_fd
, 
£ndlše
, (sendline),

35 
to
, 
tŞ’
,

37 
i
,

40 
i
=0;i<
SERV_MAX_SCTP_STRM
*2;i++) {

41 
Ën
 = (
³”addr
);

43 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»cvlše
, (recvline),

44 (
SA
 *)&
³”addr
, &
Ën
,

45 &
¤i
,&
msg_æags
);

46 
	`´štf
("From str:%d seq:%d (assoc:0x%x):",

47 
¤i
.
sšfo_¡»am
,¤i.
sšfo_s¢
,

48 (
u_št
)
¤i
.
sšfo_assoc_id
);

49 
	`´štf
("%.*s\n",
rd_sz
,
»cvlše
);

52 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctp_wrapper.c

1 
	~"uÅ.h
"

5 
	$Sùp_»cvmsg
(
s
, *
msg
, 
size_t
 
Ën
,

6 
sockaddr
 *
äom
, 
sockËn_t
 *
äomËn
,

7 
sùp_¢drcvšfo
 *
sšfo
,

8 *
msg_æags
)

10 
»t
;

11 
»t
 = 
	`sùp_»cvmsg
(
s
,
msg
,
Ën
,
äom
,
äomËn
,
sšfo
,
msg_æags
);

12 if(
»t
 < 0){

13 
	`”r_sys
("sctp_recvmsgƒrror");

15 (
»t
);

16 
	}
}

20 
	$Sùp_£ndmsg
 (
s
, *
d©a
, 
size_t
 
Ën
, 
sockaddr
 *
to
,

21 
sockËn_t
 
tŞ’
, 
ušt32_t
 
µid
, ušt32_ˆ
æags
,

22 
ušt16_t
 
¡»am_no
, 
ušt32_t
 
tim‘Şive
, ušt32_ˆ
cÚ‹xt
)

24 
»t
;

25 
»t
 = 
	`sùp_£ndmsg
(
s
,
d©a
,
Ën
,
to
,
tŞ’
,
µid
,
æags
,
¡»am_no
,

26 
tim‘Şive
,
cÚ‹xt
);

27 if(
»t
 < 0){

28 
	`”r_sys
("sctp_sendmsgƒrror");

30 (
»t
);

31 
	}
}

34 
	$Sùp_bšdx
(
sock_fd
,
sockaddr_¡Üage
 *
©
,
num
,
İ
)

36 
»t
;

37 
»t
 = 
	`sùp_bšdx
(
sock_fd
,
©
,
num
,
İ
);

38 if(
»t
 < 0){

39 
	`”r_sys
("sctp_bindxƒrror");

41 (
»t
);

42 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpclient01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
;

7 
sockaddr_š
 
£rvaddr
;

8 
sùp_ev’t_subsüibe
 
evÁs
;

9 
echo_to_®l
=0;

11 if(
¬gc
 < 2)

12 
	`”r_qu™
("Missing host‡rgument - use '%s host [echo]'\n",

13 
¬gv
[0]);

14 if(
¬gc
 > 2) {

15 
	`´štf
("Echoing messageso‡ll streams\n");

16 
echo_to_®l
 = 1;

18 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

19 
	`bz”o
(&
£rvaddr
, (servaddr));

20 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

21 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

22 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

25 
	`bz”o
(&
evÁs
, (evnts));

26 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

27 
	`S‘sockİt
(
sock_fd
,
IPPROTO_SCTP
, 
SCTP_EVENTS
,

28 &
evÁs
, (evnts));

29 if(
echo_to_®l
 == 0)

30 
	`sùp¡r_şi
(
¡dš
,
sock_fd
,(
SA
 *)&
£rvaddr
,(servaddr));

32 
	`sùp¡r_şi_echßÎ
(
¡dš
,
sock_fd
,(
SA
 *)&
£rvaddr
,(servaddr));

33 
	`Clo£
(
sock_fd
);

35 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpclient02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
;

7 
sockaddr_š
 
£rvaddr
;

8 
sùp_ev’t_subsüibe
 
evÁs
;

9 
echo_to_®l
=0;

10 
byemsg
[10];

12 if(
¬gc
 < 2)

13 
	`”r_qu™
("Missing host‡rgument - use '%s host [echo]'\n",

14 
¬gv
[0]);

15 if(
¬gc
 > 2) {

16 
	`´štf
("Echoing messageso‡ll streams\n");

17 
echo_to_®l
 = 1;

19 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

20 
	`bz”o
(&
£rvaddr
, (servaddr));

21 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

22 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

23 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

24 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

26 
	`bz”o
(&
evÁs
, (evnts));

27 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

28 
	`S‘sockİt
(
sock_fd
,
IPPROTO_SCTP
, 
SCTP_EVENTS
,

29 &
evÁs
, (evnts));

31 if(
echo_to_®l
 == 0)

32 
	`sùp¡r_şi
(
¡dš
,
sock_fd
,(
SA
 *)&
£rvaddr
,(servaddr));

34 
	`sùp¡r_şi_echßÎ
(
¡dš
,
sock_fd
,(
SA
 *)&
£rvaddr
,(servaddr));

35 
	`¡rıy
(
byemsg
,"goodbye");

36 
	`Sùp_£ndmsg
(
sock_fd
, 
byemsg
, 
	`¡¾’
(byemsg),

37 (
SA
 *)&
£rvaddr
, (servaddr),

39 
MSG_ABORT
,

41 
	`Clo£
(
sock_fd
);

44 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpclient04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
;

7 
sockaddr_š
 
£rvaddr
;

8 
sùp_ev’t_subsüibe
 
evÁs
;

10 if(
¬gc
 != 2)

11 
	`”r_qu™
("Missing host‡rgument - use '%s host'\n",

12 
¬gv
[0]);

13 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`bz”o
(&
evÁs
, (evnts));

21 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

22 
evÁs
.
sùp_assocŸtiÚ_ev’t
 = 1;

23 
	`S‘sockİt
(
sock_fd
,
IPPROTO_SCTP
, 
SCTP_EVENTS
,

24 &
evÁs
, (evnts));

26 
	`sùp¡r_şi
(
¡dš
,
sock_fd
,(
SA
 *)&
£rvaddr
,(servaddr));

28 
	`şo£
(
sock_fd
);

30 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

15 ià(
¬gc
 == 2)

16 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

17 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

18 
	`bz”o
(&
£rvaddr
, (servaddr));

19 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

20 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

21 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

25 
	`bz”o
(&
evÁs
, (evnts));

26 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

27 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

28 &
evÁs
, (evnts));

30 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

32 
Ën
 = (
sockaddr_š
);

33 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

34 (
SA
 *)&
şŸddr
, &
Ën
,

35 &
¤i
,&
msg_æags
);

36 if(
¡»am_šüem’t
) {

37 
¤i
.
sšfo_¡»am
++;

38 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

39 
¤i
.
sšfo_¡»am
 = 0;

41 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

42 (
SA
 *)&
şŸddr
, 
Ën
,

43 
¤i
.
sšfo_µid
,

44 
¤i
.
sšfo_æags
,

45 
¤i
.
sšfo_¡»am
,

48 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

14 
sùp_š™msg
 
š™m
;

17 ià(
¬gc
 == 2)

18 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

19 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

20 
	`bz”o
(&
š™m
,(initm));

21 
š™m
.
sš™_num_o¡»ams
 = 
SERV_MORE_STRMS_SCTP
;

22 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_INITMSG
,

23 &
š™m
, (initm));

25 
	`bz”o
(&
£rvaddr
, (servaddr));

26 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

27 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

28 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

30 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

32 
	`bz”o
(&
evÁs
, (evnts));

33 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

34 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

35 &
evÁs
, (evnts));

37 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

39 
Ën
 = (
sockaddr_š
);

40 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

41 (
SA
 *)&
şŸddr
, &
Ën
,

42 &
¤i
,&
msg_æags
);

43 if(
¡»am_šüem’t
) {

44 
¤i
.
sšfo_¡»am
++;

45 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

46 
¤i
.
sšfo_¡»am
 = 0;

48 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

49 (
SA
 *)&
şŸddr
, 
Ën
,

50 
¤i
.
sšfo_µid
,

51 
¤i
.
sšfo_æags
,

52 
¤i
.
sšfo_¡»am
,

55 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

15 ià(
¬gc
 == 2)

16 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

17 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

18 
	`bz”o
(&
£rvaddr
, (servaddr));

19 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

20 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

21 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

25 
	`bz”o
(&
evÁs
, (evnts));

26 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

27 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

28 &
evÁs
, (evnts));

30 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

33 
Ën
 = (
sockaddr_š
);

34 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

35 (
SA
 *)&
şŸddr
, &
Ën
,

36 &
¤i
,&
msg_æags
);

37 if(
¡»am_šüem’t
) {

38 
¤i
.
sšfo_¡»am
++;

39 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

40 
¤i
.
sšfo_¡»am
 = 0;

42 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

43 (
SA
 *)&
şŸddr
, 
Ën
,

44 
¤i
.
sšfo_µid
,

45 (
¤i
.
sšfo_æags
|
MSG_EOF
),

46 
¤i
.
sšfo_¡»am
,

50 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
şo£_time
;

13 
sockËn_t
 
Ën
;

14 
size_t
 
rd_sz
;

17 ià(
¬gc
 == 2)

18 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

19 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

20 
şo£_time
 = 120;

21 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_AUTOCLOSE
,

22 &
şo£_time
, (close_time));

24 
	`bz”o
(&
£rvaddr
, (servaddr));

25 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

26 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

27 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

29 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

31 
	`bz”o
(&
evÁs
, (evnts));

32 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

33 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

34 &
evÁs
, (evnts));

36 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

38 
Ën
 = (
sockaddr_š
);

39 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

40 (
SA
 *)&
şŸddr
, &
Ën
,

41 &
¤i
,&
msg_æags
);

42 if(
¡»am_šüem’t
) {

43 
¤i
.
sšfo_¡»am
++;

44 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

45 
¤i
.
sšfo_¡»am
 = 0;

47 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

48 (
SA
 *)&
şŸddr
, 
Ën
,

49 
¤i
.
sšfo_µid
,

50 
¤i
.
sšfo_æags
,

51 
¤i
.
sšfo_¡»am
,

54 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv05.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
ušt8_t
 *
»adbuf
;

7 
sock_fd
,
msg_æags
;

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

15 ià(
¬gc
 == 2)

16 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

17 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

18 
	`bz”o
(&
£rvaddr
, (servaddr));

19 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

20 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

21 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

25 
	`bz”o
(&
evÁs
, (evnts));

26 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

27 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

28 &
evÁs
, (evnts));

30 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

31 
rd_sz
 = 0;

34 
Ën
 = (
sockaddr_š
);

35 
	`bz”o
(&
¤i
,(sri));

36 
»adbuf
 = 
	`pd­i_»cvmsg
(
sock_fd
, &
rd_sz
,

37 (
SA
 *)&
şŸddr
, &
Ën
,

38 &
¤i
,&
msg_æags
);

39 if(
»adbuf
 =ğ
NULL
)

42 if(
¡»am_šüem’t
) {

43 
¤i
.
sšfo_¡»am
++;

44 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

45 
¤i
.
sšfo_¡»am
 = 0;

47 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

48 (
SA
 *)&
şŸddr
, 
Ën
,

49 
¤i
.
sšfo_µid
,

50 
¤i
.
sšfo_æags
,

51 
¤i
.
sšfo_¡»am
,

54 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
¡»am_šüem’t
=1;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

15 ià(
¬gc
 == 2)

16 
¡»am_šüem’t
 = 
	`©oi
(
¬gv
[1]);

17 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

18 
	`bz”o
(&
£rvaddr
, (servaddr));

19 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

20 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

21 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

26 
	`bz”o
(&
evÁs
, (evnts));

27 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

28 
evÁs
.
sùp_assocŸtiÚ_ev’t
 = 1;

29 
evÁs
.
sùp_add»ss_ev’t
 = 1;

30 
evÁs
.
sùp_£nd_çu»_ev’t
 = 1;

31 
evÁs
.
sùp_³”_”rÜ_ev’t
 = 1;

32 
evÁs
.
sùp_shutdown_ev’t
 = 1;

33 
evÁs
.
sùp_·¹Ÿl_d–iv”y_ev’t
 = 1;

34 
evÁs
.
sùp_ad­tiÚ_Ïy”_ev’t
 = 1;

35 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

36 &
evÁs
, (evnts));

38 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

40 
Ën
 = (
sockaddr_š
);

41 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

42 (
SA
 *)&
şŸddr
, &
Ën
,

43 &
¤i
,&
msg_æags
);

44 if(
msg_æags
 & 
MSG_NOTIFICATION
) {

45 
	`´št_nÙifiÿtiÚ
(
»adbuf
);

49 if(
¡»am_šüem’t
) {

50 
¤i
.
sšfo_¡»am
++;

51 if(
¤i
.
sšfo_¡»am
 >ğ
	`sùp_g‘_no_¡rms
(
sock_fd
,(
SA
 *)&
şŸddr
, 
Ën
))

52 
¤i
.
sšfo_¡»am
 = 0;

54 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

55 (
SA
 *)&
şŸddr
, 
Ën
,

56 
¤i
.
sšfo_µid
,

57 
¤i
.
sšfo_æags
,

58 
¤i
.
sšfo_¡»am
,

61 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv07.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
;

7 
»adbuf
[
BUFFSIZE
];

8 
sockaddr_š
 
şŸddr
;

9 
sùp_¢drcvšfo
 
¤i
;

10 
sùp_ev’t_subsüibe
 
evÁs
;

11 
sockËn_t
 
Ën
;

12 
size_t
 
rd_sz
;

14 if(
¬gc
 < 2)

15 
	`”r_qu™
("Error, use %s [list of‡ddresseso bind]\n",

16 
¬gv
[0]);

17 
sock_fd
 = 
	`Sock‘
(
AF_INET6
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

19 if(
	`sùp_bšd_¬g_li¡
(
sock_fd
, 
¬gv
 + 1, 
¬gc
 - 1))

20 
	`”r_sys
("Can't bindhe‡ddress set");

22 
	`bz”o
(&
evÁs
, (evnts));

23 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

25 
evÁs
.
sùp_assocŸtiÚ_ev’t
 = 1;

26 
evÁs
.
sùp_add»ss_ev’t
 = 1;

27 
evÁs
.
sùp_£nd_çu»_ev’t
 = 1;

28 
evÁs
.
sùp_³”_”rÜ_ev’t
 = 1;

29 
evÁs
.
sùp_shutdown_ev’t
 = 1;

30 
evÁs
.
sùp_·¹Ÿl_d–iv”y_ev’t
 = 1;

31 
evÁs
.
sùp_ad­tiÚ_Ïy”_ev’t
 = 1;

32 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

33 &
evÁs
, (evnts));

35 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

38 
Ën
 = (
sockaddr_š
);

39 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

40 (
SA
 *)&
şŸddr
, &
Ën
,

41 &
¤i
,&
msg_æags
);

42 if(
msg_æags
 & 
MSG_NOTIFICATION
) {

43 
	`´št_nÙifiÿtiÚ
(
»adbuf
);

46 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

47 (
SA
 *)&
şŸddr
, 
Ën
,

48 
¤i
.
sšfo_µid
,

49 
¤i
.
sšfo_æags
,

50 
¤i
.
sšfo_¡»am
,

54 
	}
}

	@osi\unpv13e\unpv13e\sctp\sctpserv_fork.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sock_fd
,
msg_æags
,
cÚnfd
,
chdpid
;

7 
sùp_assoc_t
 
assoc
;

8 
»adbuf
[
BUFFSIZE
];

9 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

10 
sùp_¢drcvšfo
 
¤i
;

11 
sùp_ev’t_subsüibe
 
evÁs
;

12 
sockËn_t
 
Ën
;

13 
size_t
 
rd_sz
;

15 
sock_fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

19 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

21 
	`Bšd
(
sock_fd
, (
SA
 *è&
£rvaddr
, (servaddr));

23 
	`bz”o
(&
evÁs
, (evnts));

24 
evÁs
.
sùp_d©a_io_ev’t
 = 1;

25 
	`S‘sockİt
(
sock_fd
, 
IPPROTO_SCTP
, 
SCTP_EVENTS
,

26 &
evÁs
, (evnts));

28 
	`Li¡’
(
sock_fd
, 
LISTENQ
);

31 
Ën
 = (
sockaddr_š
);

32 
rd_sz
 = 
	`Sùp_»cvmsg
(
sock_fd
, 
»adbuf
, (readbuf),

33 (
SA
 *)&
şŸddr
, &
Ën
,

34 &
¤i
,&
msg_æags
);

35 
	`Sùp_£ndmsg
(
sock_fd
, 
»adbuf
, 
rd_sz
,

36 (
SA
 *)&
şŸddr
, 
Ën
,

37 
¤i
.
sšfo_µid
,

38 
¤i
.
sšfo_æags
,

39 
¤i
.
sšfo_¡»am
,

41 
assoc
 = 
	`sùp_add»ss_to_associd
(
sock_fd
,(
SA
 *)&
şŸddr
,
Ën
);

42 if(()
assoc
 == 0){

43 
	`”r_»t
("Can't get‡ssociation id");

46 
cÚnfd
 = 
	`sùp_³–off
(
sock_fd
,
assoc
);

47 if(
cÚnfd
 == -1){

48 
	`”r_»t
("sctp_peeloff fails");

51 if((
chdpid
 = 
	`fÜk
()) == 0) {

52 
	`Clo£
(
sock_fd
);

53 
	`¡r_echo
(
cÚnfd
);

54 
	`ex™
(0);

56 
	`Clo£
(
cÚnfd
);

60 
	}
}

	@osi\unpv13e\unpv13e\sctp\unp.h

4 #iâdef 
__uÅ_h


5 
	#__uÅ_h


	)

7 
	~"../cÚfig.h
"

13 
	~<sys/ty³s.h
>

14 
	~<sys/sock‘.h
>

15 
	~<sys/time.h
>

16 
	~<time.h
>

17 
	~<Ãtš‘/š.h
>

18 
	~<¬·/š‘.h
>

19 
	~<Ãtš‘/sùp.h
>

20 
	~<”ºo.h
>

21 
	~<fú.h
>

22 
	~<Ãtdb.h
>

23 
	~<sigÇl.h
>

24 
	~<¡dio.h
>

25 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

27 
	~<sys/¡©.h
>

28 
	~<sys/uio.h
>

29 
	~<uni¡d.h
>

30 
	~<sys/wa™.h
>

31 
	~<sys/un.h
>

33 #ifdef 
HAVE_SYS_SELECT_H


34 
	~<sys/£Ëù.h
>

37 #ifdef 
HAVE_POLL_H


38 
	~<pŞl.h
>

41 #ifdef 
HAVE_STRINGS_H


42 
	~<¡ršgs.h
>

48 #ifdef 
HAVE_SYS_IOCTL_H


49 
	~<sys/ioùl.h
>

51 #ifdef 
HAVE_SYS_FILIO_H


52 
	~<sys/fio.h
>

54 #ifdef 
HAVE_SYS_SOCKIO_H


55 
	~<sys/sockio.h
>

58 #ifdef 
HAVE_PTHREAD_H


59 
	~<±h»ad.h
>

63 #ifdef 
__osf__


64 #undeà
»cv


65 #undeà
£nd


66 
	#»cv
(
a
,
b
,
c
,
d
è
	`»cväom
×,b,c,d,0,0)

	)

67 
	#£nd
(
a
,
b
,
c
,
d
è
	`£ndto
×,b,c,d,0,0)

	)

70 #iâdef 
INADDR_NONE


72 
	#INADDR_NONE
 0xfffffffà

	)

75 #iâdef 
SHUT_RD


76 
	#SHUT_RD
 0

	)

77 
	#SHUT_WR
 1

	)

78 
	#SHUT_RDWR
 2

	)

85 #iâdeà
INET_ADDRSTRLEN


87 
	#INET_ADDRSTRLEN
 16

	)

93 #iâdeà
INET6_ADDRSTRLEN


95 
	#INET6_ADDRSTRLEN
 46

	)

103 #iâdef 
HAVE_BZERO


104 
	#bz”o
(
±r
,
n
è
	`mem£t
ÕŒ, 0,‚)

	)

110 #iâdef 
HAVE_GETHOSTBYNAME2


111 
	#g‘ho¡byÇme2
(
ho¡
,
çmy
è
	`g‘ho¡byÇme
((ho¡))

	)

115 
	sš_pktšfo
 {

116 
š_addr
 
	mi_addr
;

117 
	mi_ifšdex
;

126 #iâdef 
CMSG_LEN


128 
	#CMSG_LEN
(
size
è((
cmsghdr
è+ (size))

	)

130 #iâdef 
CMSG_SPACE


132 
	#CMSG_SPACE
(
size
è((
cmsghdr
è+ (size))

	)

138 #iâdef 
SUN_LEN


140 
	#SUN_LEN
(
su
) \

141 ((*(
su
)è- ((su)->
sun_·th
è+ 
	`¡¾’
((su)->sun_·th))

	)

146 #iâdef 
AF_LOCAL


147 
	#AF_LOCAL
 
AF_UNIX


	)

149 #iâdef 
PF_LOCAL


150 
	#PF_LOCAL
 
PF_UNIX


	)

157 #iâdeà
INFTIM


158 
	#INFTIM
 (-1è

	)

160 #ifdef 
HAVE_POLL_H


161 
	#INFTIM_UNPH


	)

167 
	#LISTENQ
 1024

	)

170 
	#MAXLINE
 4096

	)

171 
	#MAXSOCKADDR
 128

	)

172 
	#BUFFSIZE
 8192

	)

175 
	#SERV_PORT
 9877

	)

176 
	#SERV_PORT_STR
 "9877"

	)

178 
	#SCTP_PDAPI_INCR_SZ
 65535

	)

179 
	#SCTP_PDAPI_NEED_MORE_THRESHOLD
 1024

	)

180 
	#SERV_MAX_SCTP_STRM
 10

	)

181 
	#SERV_MORE_STRMS_SCTP
 20

	)

184 
	#UNIXSTR_PATH
 "/tmp/unix.¡r"

	)

185 
	#UNIXDG_PATH
 "/tmp/unix.dg"

	)

195 
	#SA
 
sockaddr


	)

197 
	#FILE_MODE
 (
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
)

	)

199 
	#DIR_MODE
 (
FILE_MODE
 | 
S_IXUSR
 | 
S_IXGRP
 | 
S_IXOTH
)

	)

202 
	tSigfunc
();

204 
	#mš
(
a
,
b
è(×è< (bè? (aè: (b))

	)

205 
	#max
(
a
,
b
è(×è> (bè? (aè: (b))

	)

207 #iâdef 
HAVE_ADDRINFO_STRUCT


208 
	~"../lib/addršfo.h
"

211 #iâdef 
HAVE_IF_NAMEINDEX_STRUCT


212 
	sif_Çmešdex
 {

213 
	mif_šdex
;

214 *
	mif_Çme
;

221 #iâdef 
HAVE_TIMESPEC_STRUCT


222 
	stime¥ec
 {

223 
time_t
 
	mtv_£c
;

224 
	mtv_n£c
;

233 
cÚÃù_nÚb
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

234 
cÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

235 
d«mÚ_š™
(const *, );

236 
d«mÚ_š‘d
(const *, );

237 
dg_şi
(
FILE
 *, , cÚ¡ 
SA
 *, 
sockËn_t
);

238 
dg_echo
(, 
SA
 *, 
sockËn_t
);

239 *
gf_time
();

240 
h—¹b—t_şi
(, , );

241 
h—¹b—t_£rv
(, , );

242 
addršfo
 *
ho¡_£rv
(const *, const *, , );

243 
š‘_¤üt_add
(*, );

244 
u_ch¬
 *
š‘_¤üt_š™
();

245 
š‘_¤üt_´št
(
u_ch¬
 *, );

246 **
my_addrs
(*);

247 
»adabË_timeo
(, );

248 
ssize_t
 
»adlše
(, *, 
size_t
);

249 
ssize_t
 
»adn
(, *, 
size_t
);

250 
ssize_t
 
»ad_fd
(, *, 
size_t
, *);

251 
ssize_t
 
»cväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

252 
š_pktšfo
 *);

253 
Sigfunc
 *
sigÇl_šŒ
(, Sigfunc *);

254 
sock_bšd_wd
(, );

255 
sock_cmp_addr
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

256 
sock_cmp_pÜt
(cÚ¡ 
SA
 *, cÚ¡ SA *, 
sockËn_t
);

257 
sock_g‘_pÜt
(cÚ¡ 
SA
 *, 
sockËn_t
);

258 
sock_£t_addr
(
SA
 *, 
sockËn_t
, const *);

259 
sock_£t_pÜt
(
SA
 *, 
sockËn_t
, );

260 
sock_£t_wd
(
SA
 *, 
sockËn_t
);

261 *
sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

262 *
sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

263 
sockfd_to_çmy
();

264 
¡r_echo
();

265 
¡r_şi
(
FILE
 *, );

266 
sùp¡r_şi
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
);

267 
sùp¡r_şi_echßÎ
(
FILE
 *
å
, 
sock_fd
, 
sockaddr
 *
to
,

268 
sockËn_t
 
tŞ’
);

269 
ušt8_t
 *
sùp_pd­i_»cvmsg
(
sock_fd
, *
rdËn
, 
SA
 *
äom
, *
äom_Ën
,

270 
sùp_¢drcvšfo
 *
¤i
, *
msg_æags
);

271 
sùp_bšd_¬g_li¡
(
sock_fd
, **
¬gv
, 
¬gc
);

273 
sùp_´št_add»s£s
(
sockaddr_¡Üage
 *
addrs
, 
num
);

275 
sùp_check_nÙifiÿtiÚ
(
sock_fd
,*
»cvlš
);

277 
	#SCTP_ON_DEMAND_HB
 1

	)

278 
	#SCTP_SET_HB_INTERVAL
 2

	)

279 
	#SCTP_DISABLE_HB
 3

	)

280 
sùp_h—¹b—t_aùiÚ
(
sock_fd
, 
sockaddr
 *
§
,

281 
aùiÚ
, 
u_št
 
v®ue
);

283 
sùp_assoc_t


284 
sùp_add»ss_to_associd
(
sock_fd
, 
sockaddr
 *
§
, 
sockËn_t
);

288 
sùp_´št_nÙifiÿtiÚ
(*
nÙify_buf
);

290 
tı_cÚÃù
(const *, const *);

291 
tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

292 
tv_sub
(
timev®
 *, timeval *);

293 
udp_ş›Á
(cÚ¡ *, cÚ¡ *, **, 
sockËn_t
 *);

294 
udp_cÚÃù
(const *, const *);

295 
udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

296 
wr™abË_timeo
(, );

297 
ssize_t
 
wr™’
(, cÚ¡ *, 
size_t
);

298 
ssize_t
 
wr™e_fd
(, *, 
size_t
, );

300 #ifdef 
MCAST


301 
mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

302 
mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

303 
mÿ¡_g‘_if
();

304 
mÿ¡_g‘_loİ
();

305 
mÿ¡_g‘_‰l
();

306 
mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

307 
mÿ¡_£t_loİ
(, );

308 
mÿ¡_£t_‰l
(, );

310 
Mÿ¡_Ëave
(, cÚ¡ 
SA
 *, 
sockËn_t
);

311 
Mÿ¡_još
(, cÚ¡ 
SA
 *, 
sockËn_t
, cÚ¡ *, 
u_št
);

312 
Mÿ¡_g‘_if
();

313 
Mÿ¡_g‘_loİ
();

314 
Mÿ¡_g‘_‰l
();

315 
Mÿ¡_£t_if
(, cÚ¡ *, 
u_št
);

316 
Mÿ¡_£t_loİ
(, );

317 
Mÿ¡_£t_‰l
(, );

320 
š_cksum
(*, );

322 #iâdef 
HAVE_GETADDRINFO_PROTO


323 
g‘addršfo
(cÚ¡ *, cÚ¡ *, cÚ¡ 
addršfo
 *,

324 
addršfo
 **);

325 
ä“addršfo
(
addršfo
 *);

326 *
gai_¡»¼Ü
();

329 #iâdef 
HAVE_GETNAMEINFO_PROTO


330 
g‘Çmešfo
(cÚ¡ 
SA
 *, 
sockËn_t
, *, 
size_t
, *, size_t, );

333 #iâdef 
HAVE_GETHOSTNAME_PROTO


334 
g‘ho¡Çme
(*, );

337 #iâdef 
HAVE_HSTRERROR_PROTO


338 cÚ¡ *
h¡»¼Ü
();

341 #iâdef 
HAVE_IF_NAMETOINDEX_PROTO


342 
if_Çm‘ošdex
(const *);

343 *
if_šdextÚame
(, *);

344 
if_ä“Çmešdex
(
if_Çmešdex
 *);

345 
if_Çmešdex
 *if_nameindex();

348 #iâdef 
HAVE_INET_PTON_PROTO


349 
š‘_±Ú
(, const *, *);

350 cÚ¡ *
š‘_Áİ
(, cÚ¡ *, *, 
size_t
);

353 #iâdef 
HAVE_INET_ATON_PROTO


354 
š‘_©Ú
(cÚ¡ *, 
š_addr
 *);

357 #iâdef 
HAVE_ISFDTYPE_PROTO


358 
isfdty³
(, );

361 #iâdef 
HAVE_PSELECT_PROTO


362 
p£Ëù
(, 
fd_£t
 *, fd_set *, fd_set *,

363 cÚ¡ 
time¥ec
 *, cÚ¡ 
sig£t_t
 *);

366 #iâdef 
HAVE_SOCKATMARK_PROTO


367 
sock©m¬k
();

370 #iâdef 
HAVE_SNPRINTF_PROTO


371 
¢´štf
(*, 
size_t
, const *, ...);

375 
CÚÃù_timeo
(, cÚ¡ 
SA
 *, 
sockËn_t
, );

376 
addršfo
 *
Ho¡_£rv
(const *, const *, , );

377 cÚ¡ *
IÃt_Áİ
(, cÚ¡ *, *, 
size_t
);

378 
IÃt_±Ú
(, const *, *);

379 *
If_šdextÚame
(, *);

380 
If_Çm‘ošdex
(const *);

381 
if_Çmešdex
 *
If_Çmešdex
();

382 **
My_addrs
(*);

383 
ssize_t
 
R—d_fd
(, *, 
size_t
, *);

384 
R—dabË_timeo
(, );

385 
ssize_t
 
Recväom_æags
(, *, 
size_t
, *, 
SA
 *, 
sockËn_t
 *,

386 
š_pktšfo
 *);

387 
Sigfunc
 *
SigÇl
(, Sigfunc *);

388 
Sigfunc
 *
SigÇl_šŒ
(, Sigfunc *);

389 
Sock_bšd_wd
(, );

390 *
Sock_Áİ
(cÚ¡ 
SA
 *, 
sockËn_t
);

391 *
Sock_Áİ_ho¡
(cÚ¡ 
SA
 *, 
sockËn_t
);

392 
Sockfd_to_çmy
();

393 
Tı_cÚÃù
(const *, const *);

394 
Tı_li¡’
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

395 
Udp_ş›Á
(cÚ¡ *, cÚ¡ *, **, 
sockËn_t
 *);

396 
Udp_cÚÃù
(const *, const *);

397 
Udp_£rv”
(cÚ¡ *, cÚ¡ *, 
sockËn_t
 *);

398 
ssize_t
 
Wr™e_fd
(, *, 
size_t
, );

399 
Wr™abË_timeo
(, );

402 *
C®loc
(
size_t
, size_t);

403 
Clo£
();

404 
Dup2
(, );

405 
Fú
(, , );

406 
G‘timeofday
(
timev®
 *, *);

407 
Ioùl
(, , *);

408 
pid_t
 
FÜk
();

409 *
M®loc
(
size_t
);

410 
Mk‹mp
(*);

411 *
Mm­
(*, 
size_t
, , , , 
off_t
);

412 
O³n
(cÚ¡ *, , 
mode_t
);

413 
Pe
(*
fds
);

414 
ssize_t
 
R—d
(, *, 
size_t
);

415 
Sigadd£t
(
sig£t_t
 *, );

416 
Sigd–£t
(
sig£t_t
 *, );

417 
Sigem±y£t
(
sig£t_t
 *);

418 
Sigfl£t
(
sig£t_t
 *);

419 
Sigismemb”
(cÚ¡ 
sig£t_t
 *, );

420 
Sig³ndšg
(
sig£t_t
 *);

421 
Sig´ocmask
(, cÚ¡ 
sig£t_t
 *, sigset_t *);

422 *
SŒdup
(const *);

423 
SyscÚf
();

424 
Sysùl
(*, 
u_št
, *, 
size_t
 *, *, size_t);

425 
UÆšk
(const *);

426 
pid_t
 
Wa™
(*);

427 
pid_t
 
Wa™pid
(pid_t, *, );

428 
Wr™e
(, *, 
size_t
);

431 
Fşo£
(
FILE
 *);

432 
FILE
 *
Fdİ’
(, const *);

433 *
Fg‘s
(*, , 
FILE
 *);

434 
FILE
 *
Fİ’
(const *, const *);

435 
Fputs
(cÚ¡ *, 
FILE
 *);

438 
Acû±
(, 
SA
 *, 
sockËn_t
 *);

439 
Bšd
(, cÚ¡ 
SA
 *, 
sockËn_t
);

440 
CÚÃù
(, cÚ¡ 
SA
 *, 
sockËn_t
);

441 
G‘³”Çme
(, 
SA
 *, 
sockËn_t
 *);

442 
G‘sockÇme
(, 
SA
 *, 
sockËn_t
 *);

443 
G‘sockİt
(, , , *, 
sockËn_t
 *);

444 
Isfdty³
(, );

445 
Li¡’
(, );

446 #ifdef 
HAVE_POLL


447 
PŞl
(
pŞlfd
 *, , );

449 
ssize_t
 
R—dlše
(, *, 
size_t
);

450 
ssize_t
 
R—dn
(, *, 
size_t
);

451 
ssize_t
 
Recv
(, *, 
size_t
, );

452 
ssize_t
 
Recväom
(, *, 
size_t
, , 
SA
 *, 
sockËn_t
 *);

453 
ssize_t
 
Recvmsg
(, 
msghdr
 *, );

454 
S–eù
(, 
fd_£t
 *, fd_£ˆ*, fd_£ˆ*, 
timev®
 *);

455 
S’d
(, cÚ¡ *, 
size_t
, );

456 
S’dto
(, cÚ¡ *, 
size_t
, , cÚ¡ 
SA
 *, 
sockËn_t
);

457 
S’dmsg
(, cÚ¡ 
msghdr
 *, );

458 
S‘sockİt
(, , , cÚ¡ *, 
sockËn_t
);

459 
Shutdown
(, );

460 
Sock©m¬k
();

461 
Sock‘
(, , );

462 
Sock‘·œ
(, , , *);

463 
Wr™’
(, *, 
size_t
);

465 
”r_dump
(const *, ...);

466 
”r_msg
(const *, ...);

467 
”r_qu™
(const *, ...);

468 
”r_»t
(const *, ...);

469 
”r_sys
(const *, ...);

	@osi\unpv13e\unpv13e\select\strcliselect01.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
maxfdp1
;

7 
fd_£t
 
r£t
;

8 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

10 
	`FD_ZERO
(&
r£t
);

12 
	`FD_SET
(
	`f’o
(
å
), &
r£t
);

13 
	`FD_SET
(
sockfd
, &
r£t
);

14 
maxfdp1
 = 
	`max
(
	`f’o
(
å
), 
sockfd
) + 1;

15 
	`S–eù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL);

17 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

18 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0)

19 
	`”r_qu™
("str_cli: servererminated…rematurely");

20 
	`Fputs
(
»cvlše
, 
¡dout
);

23 ià(
	`FD_ISSET
(
	`f’o
(
å
), &
r£t
)) {

24 ià(
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è=ğ
NULL
)

26 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

29 
	}
}

	@osi\unpv13e\unpv13e\select\strcliselect02.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
maxfdp1
, 
¡dšeof
;

7 
fd_£t
 
r£t
;

8 
buf
[
MAXLINE
];

9 
n
;

11 
¡dšeof
 = 0;

12 
	`FD_ZERO
(&
r£t
);

14 ià(
¡dšeof
 == 0)

15 
	`FD_SET
(
	`f’o
(
å
), &
r£t
);

16 
	`FD_SET
(
sockfd
, &
r£t
);

17 
maxfdp1
 = 
	`max
(
	`f’o
(
å
), 
sockfd
) + 1;

18 
	`S–eù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL);

20 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

21 iàĞ(
n
 = 
	`R—d
(
sockfd
, 
buf
, 
MAXLINE
)) == 0) {

22 ià(
¡dšeof
 == 1)

25 
	`”r_qu™
("str_cli: servererminated…rematurely");

28 
	`Wr™e
(
	`f’o
(
¡dout
), 
buf
, 
n
);

31 ià(
	`FD_ISSET
(
	`f’o
(
å
), &
r£t
)) {

32 iàĞ(
n
 = 
	`R—d
(
	`f’o
(
å
), 
buf
, 
MAXLINE
)) == 0) {

33 
¡dšeof
 = 1;

34 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

35 
	`FD_CLR
(
	`f’o
(
å
), &
r£t
);

39 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

42 
	}
}

	@osi\unpv13e\unpv13e\select\tcpcli01.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\select\tcpcli02.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\select\tcpcli03.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli03 <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(19);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`shutdown
(
sockfd
, 
SHUT_RD
);

24 
	`·u£
();

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\server\child.h

2 
pid_t
 
	mchd_pid
;

3 
	mchd_pefd
;

4 
	mchd_¡©us
;

5 
	mchd_couÁ
;

6 } 
	tChd
;

8 
Chd
 *
	gıŒ
;

	@osi\unpv13e\unpv13e\server\child02.c

2 
	~"uÅ.h
"

4 
pid_t


5 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

7 
pid_t
 
pid
;

8 
	`chd_maš
(, , );

10 iàĞ(
pid
 = 
	`FÜk
()) > 0)

11 (
pid
);

13 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

14 
	}
}

19 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

21 
cÚnfd
;

22 
	`web_chd
();

23 
sockËn_t
 
ş’
;

24 
sockaddr
 *
şŸddr
;

26 
şŸddr
 = 
	`M®loc
(
add¾’
);

28 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

30 
ş’
 = 
add¾’
;

31 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

33 
	`web_chd
(
cÚnfd
);

34 
	`Clo£
(
cÚnfd
);

36 
	}
}

	@osi\unpv13e\unpv13e\server\child02l.c

1 
	~"uÅ.h
"

3 
pid_t


4 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

6 
pid_t
 
pid
;

7 
	`chd_maš
(, , );

9 iàĞ(
pid
 = 
	`FÜk
()) > 0)

10 (
pid
);

12 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

13 
	}
}

16 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

18 
cÚnfd
;

19 
	`web_chd
();

20 
fd_£t
 
r£t
;

21 
sockËn_t
 
ş’
;

22 
sockaddr
 *
şŸddr
;

24 
şŸddr
 = 
	`M®loc
(
add¾’
);

26 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

27 
	`FD_ZERO
(&
r£t
);

29 
	`FD_SET
(
li¡’fd
, &
r£t
);

30 
	`S–eù
(
li¡’fd
+1, &
r£t
, 
NULL
, NULL, NULL);

31 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
) == 0)

32 
	`”r_qu™
("listenfd„eadable");

34 
ş’
 = 
add¾’
;

35 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

37 
	`web_chd
(
cÚnfd
);

38 
	`Clo£
(
cÚnfd
);

40 
	}
}

	@osi\unpv13e\unpv13e\server\child02m.c

1 
	~"uÅ.h
"

3 
pid_t


4 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

6 
pid_t
 
pid
;

7 
	`chd_maš
(, , );

9 iàĞ(
pid
 = 
	`FÜk
()) > 0)

10 (
pid
);

12 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

13 
	}
}

16 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

18 
cÚnfd
;

19 
	`web_chd
();

20 
sockËn_t
 
ş’
;

21 
sockaddr
 *
şŸddr
;

22 *
ıŒ
;

24 
şŸddr
 = 
	`M®loc
(
add¾’
);

26 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

28 
ş’
 = 
add¾’
;

29 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

30 
ıŒ
[
i
]++;

32 
	`web_chd
(
cÚnfd
);

33 
	`Clo£
(
cÚnfd
);

35 
	}
}

	@osi\unpv13e\unpv13e\server\child03.c

1 
	~"uÅ.h
"

3 
pid_t


4 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

6 
pid_t
 
pid
;

7 
	`chd_maš
(, , );

9 iàĞ(
pid
 = 
	`FÜk
()) > 0)

10 (
pid
);

12 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

13 
	}
}

16 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

18 
cÚnfd
;

19 
	`web_chd
();

20 
sockËn_t
 
ş’
;

21 
sockaddr
 *
şŸddr
;

23 
şŸddr
 = 
	`M®loc
(
add¾’
);

25 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

27 
ş’
 = 
add¾’
;

28 
	`my_lock_wa™
();

29 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

30 
	`my_lock_»Ëa£
();

32 
	`web_chd
(
cÚnfd
);

33 
	`Clo£
(
cÚnfd
);

35 
	}
}

	@osi\unpv13e\unpv13e\server\child03m.c

1 
	~"uÅ.h
"

3 
pid_t


4 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

6 
pid_t
 
pid
;

7 
	`chd_maš
(, , );

9 iàĞ(
pid
 = 
	`FÜk
()) > 0)

10 (
pid
);

12 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

13 
	}
}

16 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

18 
cÚnfd
;

19 
	`web_chd
();

20 
sockËn_t
 
ş’
;

21 
sockaddr
 *
şŸddr
;

22 *
ıŒ
;

24 
şŸddr
 = 
	`M®loc
(
add¾’
);

26 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

28 
ş’
 = 
add¾’
;

29 
	`my_lock_wa™
();

30 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

31 
	`my_lock_»Ëa£
();

32 
ıŒ
[
i
]++;

34 
	`web_chd
(
cÚnfd
);

35 
	`Clo£
(
cÚnfd
);

37 
	}
}

	@osi\unpv13e\unpv13e\server\child04.c

1 
	~"uÅ.h
"

3 
pid_t


4 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

6 
pid_t
 
pid
;

7 
	`chd_maš
(, , );

9 iàĞ(
pid
 = 
	`FÜk
()) > 0)

10 (
pid
);

12 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

13 
	}
}

16 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

18 
cÚnfd
;

19 
	`web_chd
();

20 
sockËn_t
 
ş’
;

21 
sockaddr
 *
şŸddr
;

23 
şŸddr
 = 
	`M®loc
(
add¾’
);

25 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

27 
ş’
 = 
add¾’
;

28 
	`my_lock_wa™
();

29 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

30 
	`my_lock_»Ëa£
();

32 
	`web_chd
(
cÚnfd
);

33 
	`Clo£
(
cÚnfd
);

35 
	}
}

	@osi\unpv13e\unpv13e\server\child05.c

2 
	~"uÅ.h
"

3 
	~"chd.h
"

5 
pid_t


6 
	$chd_make
(
i
, 
li¡’fd
, 
add¾’
)

8 
sockfd
[2];

9 
pid_t
 
pid
;

10 
	`chd_maš
(, , );

12 
	`Sock‘·œ
(
AF_LOCAL
, 
SOCK_STREAM
, 0, 
sockfd
);

14 iàĞ(
pid
 = 
	`FÜk
()) > 0) {

15 
	`Clo£
(
sockfd
[1]);

16 
ıŒ
[
i
].
chd_pid
 = 
pid
;

17 
ıŒ
[
i
].
chd_pefd
 = 
sockfd
[0];

18 
ıŒ
[
i
].
chd_¡©us
 = 0;

19 (
pid
);

22 
	`Dup2
(
sockfd
[1], 
STDERR_FILENO
);

23 
	`Clo£
(
sockfd
[0]);

24 
	`Clo£
(
sockfd
[1]);

25 
	`Clo£
(
li¡’fd
);

26 
	`chd_maš
(
i
, 
li¡’fd
, 
add¾’
);

27 
	}
}

32 
	$chd_maš
(
i
, 
li¡’fd
, 
add¾’
)

34 
c
;

35 
cÚnfd
;

36 
ssize_t
 
n
;

37 
	`web_chd
();

39 
	`´štf
("chd %ld s¹šg\n", (è
	`g‘pid
());

41 iàĞ(
n
 = 
	`R—d_fd
(
STDERR_FILENO
, &
c
, 1, &
cÚnfd
)) == 0)

42 
	`”r_qu™
("read_fd„eturned 0");

43 ià(
cÚnfd
 < 0)

44 
	`”r_qu™
("no descriptor from„ead_fd");

46 
	`web_chd
(
cÚnfd
);

47 
	`Clo£
(
cÚnfd
);

49 
	`Wr™e
(
STDERR_FILENO
, "", 1);

51 
	}
}

	@osi\unpv13e\unpv13e\server\client.c

1 
	~"uÅ.h
"

3 
	#MAXN
 16384

	)

6 
	$maš
(
¬gc
, **
¬gv
)

8 
i
, 
j
, 
fd
, 
nchd»n
, 
Æoİs
, 
nby‹s
;

9 
pid_t
 
pid
;

10 
ssize_t
 
n
;

11 
»que¡
[
MAXLINE
], 
»¶y
[
MAXN
];

13 ià(
¬gc
 != 6)

14 
	`”r_qu™
("usage: client <hostname or IPaddr> <port> <#children> "

17 
nchd»n
 = 
	`©oi
(
¬gv
[3]);

18 
Æoİs
 = 
	`©oi
(
¬gv
[4]);

19 
nby‹s
 = 
	`©oi
(
¬gv
[5]);

20 
	`¢´štf
(
»que¡
, Ôeque¡), "%d\n", 
nby‹s
);

22 
i
 = 0; i < 
nchd»n
; i++) {

23 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

24 
j
 = 0; j < 
Æoİs
; j++) {

25 
fd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

27 
	`Wr™e
(
fd
, 
»que¡
, 
	`¡¾’
(request));

29 iàĞ(
n
 = 
	`R—dn
(
fd
, 
»¶y
, 
nby‹s
)) !=‚bytes)

30 
	`”r_qu™
("£rv”„‘uºed %d by‹s", 
n
);

32 
	`Clo£
(
fd
);

34 
	`´štf
("chd %d dÚe\n", 
i
);

35 
	`ex™
(0);

40 
	`wa™
(
NULL
) > 0)

42 ià(
”ºo
 !ğ
ECHILD
)

43 
	`”r_sys
("waitƒrror");

45 
	`ex™
(0);

46 
	}
}

	@osi\unpv13e\unpv13e\server\clientrst.c

1 
	~"uÅ.h
"

3 
	#MAXN
 16384

	)

6 
	$maš
(
¬gc
, **
¬gv
)

8 
i
, 
j
, 
fd
, 
nchd»n
, 
Æoİs
, 
nby‹s
;

9 
pid_t
 
pid
;

10 
ssize_t
 
n
;

11 
»que¡
[
MAXLINE
], 
»¶y
[
MAXN
];

13 ià(
¬gc
 != 6)

14 
	`”r_qu™
("usage: client <hostname or IPaddr> <port> <#children> "

17 
nchd»n
 = 
	`©oi
(
¬gv
[3]);

18 
Æoİs
 = 
	`©oi
(
¬gv
[4]);

19 
nby‹s
 = 
	`©oi
(
¬gv
[5]);

20 
	`¢´štf
(
»que¡
, Ôeque¡), "%d\n", 
nby‹s
);

22 
i
 = 0; i < 
nchd»n
; i++) {

23 iàĞ(
pid
 = 
	`FÜk
()) == 0) {

24 
j
 = 0; j < 
Æoİs
; j++) {

25 
fd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

39 ià(
i
 =ğ2 && (
j
 % 3) == 0) {

40 
lšg”
 
lšg
;

42 
lšg
.
l_Úoff
 = 1;

43 
lšg
.
l_lšg”
 = 0;

44 
	`S‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg
, (ling));

45 
	`Clo£
(
fd
);

48 
fd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

51 
	`Wr™e
(
fd
, 
»que¡
, 
	`¡¾’
(request));

53 iàĞ(
n
 = 
	`R—dn
(
fd
, 
»¶y
, 
nby‹s
)) !=‚bytes)

54 
	`”r_qu™
("£rv”„‘uºed %d by‹s", 
n
);

56 
	`Clo£
(
fd
);

58 
	`´štf
("chd %d dÚe\n", 
i
);

59 
	`ex™
(0);

64 
	`wa™
(
NULL
) > 0)

66 ià(
”ºo
 !ğ
ECHILD
)

67 
	`”r_sys
("waitƒrror");

69 
	`ex™
(0);

70 
	}
}

	@osi\unpv13e\unpv13e\server\lock_fcntl.c

2 
	~"uÅ.h
"

4 
æock
 
	glock_™
, 
	guÆock_™
;

5 
	glock_fd
 = -1;

9 
	$my_lock_š™
(*
·thÇme
)

11 
lock_fe
[1024];

14 
	`¡ºıy
(
lock_fe
, 
·thÇme
, (lock_file));

15 
lock_fd
 = 
	`Mk¡emp
(
lock_fe
);

17 
	`UÆšk
(
lock_fe
);

19 
lock_™
.
l_ty³
 = 
F_WRLCK
;

20 
lock_™
.
l_wh’û
 = 
SEEK_SET
;

21 
lock_™
.
l_¡¬t
 = 0;

22 
lock_™
.
l_Ën
 = 0;

24 
uÆock_™
.
l_ty³
 = 
F_UNLCK
;

25 
uÆock_™
.
l_wh’û
 = 
SEEK_SET
;

26 
uÆock_™
.
l_¡¬t
 = 0;

27 
uÆock_™
.
l_Ën
 = 0;

28 
	}
}

33 
	$my_lock_wa™
()

35 
rc
;

37  (
rc
 = 
	`fú
(
lock_fd
, 
F_SETLKW
, &
lock_™
)) < 0) {

38 ià(
”ºo
 =ğ
EINTR
)

41 
	`”r_sys
("fcntlƒrror for my_lock_wait");

43 
	}
}

46 
	$my_lock_»Ëa£
()

48 ià(
	`fú
(
lock_fd
, 
F_SETLKW
, &
uÆock_™
) < 0)

49 
	`”r_sys
("fcntlƒrror for my_lock_release");

50 
	}
}

	@osi\unpv13e\unpv13e\server\lock_pthread.c

2 
	~"uÅth»ad.h
"

3 
	~<sys/mmª.h
>

5 
±h»ad_mu‹x_t
 *
	gm±r
;

8 
	$my_lock_š™
(*
·thÇme
)

10 
fd
;

11 
±h»ad_mu‹x©Œ_t
 
m©Œ
;

13 
fd
 = 
	`O³n
("/dev/z”o", 
O_RDWR
, 0);

15 
m±r
 = 
	`Mm­
(0, (
±h»ad_mu‹x_t
), 
PROT_READ
 | 
PROT_WRITE
,

16 
MAP_SHARED
, 
fd
, 0);

17 
	`Clo£
(
fd
);

19 
	`Pth»ad_mu‹x©Œ_š™
(&
m©Œ
);

20 
	`Pth»ad_mu‹x©Œ_£sh¬ed
(&
m©Œ
, 
PTHREAD_PROCESS_SHARED
);

21 
	`Pth»ad_mu‹x_š™
(
m±r
, &
m©Œ
);

22 
	}
}

27 
	$my_lock_wa™
()

29 
	`Pth»ad_mu‹x_lock
(
m±r
);

30 
	}
}

33 
	$my_lock_»Ëa£
()

35 
	`Pth»ad_mu‹x_uÆock
(
m±r
);

36 
	}
}

	@osi\unpv13e\unpv13e\server\meter.c

1 
	~"uÅ.h
"

2 
	~<sys/mmª.h
>

11 
	$m‘”
(
nchd»n
)

13 
fd
;

14 *
±r
;

16 #ifdef 
MAP_ANON


17 
±r
 = 
	`Mm­
(0, 
nchd»n
*(), 
PROT_READ
 | 
PROT_WRITE
,

18 
MAP_ANON
 | 
MAP_SHARED
, -1, 0);

20 
fd
 = 
	`O³n
("/dev/z”o", 
O_RDWR
, 0);

22 
±r
 = 
	`Mm­
(0, 
nchd»n
*(), 
PROT_READ
 | 
PROT_WRITE
,

23 
MAP_SHARED
, 
fd
, 0);

24 
	`Clo£
(
fd
);

27 (
±r
);

28 
	}
}

	@osi\unpv13e\unpv13e\server\pr_cpu_time.c

1 
	~"uÅ.h
"

2 
	~<sys/»sourû.h
>

4 #iâdef 
HAVE_GETRUSAGE_PROTO


5 
g‘ru§ge
(, 
ru§ge
 *);

9 
	$´_ıu_time
()

11 
u£r
, 
sys
;

12 
ru§ge
 
myu§ge
, 
chdu§ge
;

14 ià(
	`g‘ru§ge
(
RUSAGE_SELF
, &
myu§ge
) < 0)

15 
	`”r_sys
("getrusageƒrror");

16 ià(
	`g‘ru§ge
(
RUSAGE_CHILDREN
, &
chdu§ge
) < 0)

17 
	`”r_sys
("getrusageƒrror");

19 
u£r
 = (è
myu§ge
.
ru_utime
.
tv_£c
 +

20 
myu§ge
.
ru_utime
.
tv_u£c
/1000000.0;

21 
u£r
 +ğ(è
chdu§ge
.
ru_utime
.
tv_£c
 +

22 
chdu§ge
.
ru_utime
.
tv_u£c
/1000000.0;

23 
sys
 = (è
myu§ge
.
ru_¡ime
.
tv_£c
 +

24 
myu§ge
.
ru_¡ime
.
tv_u£c
/1000000.0;

25 
sys
 +ğ(è
chdu§ge
.
ru_¡ime
.
tv_£c
 +

26 
chdu§ge
.
ru_¡ime
.
tv_u£c
/1000000.0;

28 
	`´štf
("\nu£¸timğ%g, sy timğ%g\n", 
u£r
, 
sys
);

29 
	}
}

	@osi\unpv13e\unpv13e\server\pthread07.c

1 
	~"uÅth»ad.h
"

2 
	~"±h»ad07.h
"

5 
	$th»ad_make
(
i
)

7 *
	`th»ad_maš
(*);

9 
	`Pth»ad_ü—‹
(&
Œ
[
i
].
th»ad_tid
, 
NULL
, &
th»ad_maš
, (*) i);

11 
	}
}

14 
	$th»ad_maš
(*
¬g
)

16 
cÚnfd
;

17 
	`web_chd
();

18 
sockËn_t
 
ş’
;

19 
sockaddr
 *
şŸddr
;

21 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
	`´štf
("th»ad %d s¹šg\n", (è
¬g
);

25 
ş’
 = 
add¾’
;

26 
	`Pth»ad_mu‹x_lock
(&
mlock
);

27 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

28 
	`Pth»ad_mu‹x_uÆock
(&
mlock
);

29 
Œ
[(è
¬g
].
th»ad_couÁ
++;

31 
	`web_chd
(
cÚnfd
);

32 
	`Clo£
(
cÚnfd
);

34 
	}
}

	@osi\unpv13e\unpv13e\server\pthread07.h

2 
±h»ad_t
 
	mth»ad_tid
;

3 
	mth»ad_couÁ
;

4 } 
	tTh»ad
;

5 
Th»ad
 *
	gŒ
;

7 
	gli¡’fd
, 
	gÁh»ads
;

8 
sockËn_t
 
	gadd¾’
;

9 
±h»ad_mu‹x_t
 
	gmlock
;

	@osi\unpv13e\unpv13e\server\pthread08.c

1 
	~"uÅth»ad.h
"

2 
	~"±h»ad08.h
"

5 
	$th»ad_make
(
i
)

7 *
	`th»ad_maš
(*);

9 
	`Pth»ad_ü—‹
(&
Œ
[
i
].
th»ad_tid
, 
NULL
, &
th»ad_maš
, (*) i);

11 
	}
}

14 
	$th»ad_maš
(*
¬g
)

16 
cÚnfd
;

17 
	`web_chd
();

19 
	`´štf
("th»ad %d s¹šg\n", (è
¬g
);

21 
	`Pth»ad_mu‹x_lock
(&
şifd_mu‹x
);

22 
ig‘
 =ğ
ut
)

23 
	`Pth»ad_cÚd_wa™
(&
şifd_cÚd
, &
şifd_mu‹x
);

24 
cÚnfd
 = 
şifd
[
ig‘
];

25 ià(++
ig‘
 =ğ
MAXNCLI
)

26 
ig‘
 = 0;

27 
	`Pth»ad_mu‹x_uÆock
(&
şifd_mu‹x
);

28 
Œ
[(è
¬g
].
th»ad_couÁ
++;

30 
	`web_chd
(
cÚnfd
);

31 
	`Clo£
(
cÚnfd
);

33 
	}
}

	@osi\unpv13e\unpv13e\server\pthread08.h

2 
±h»ad_t
 
	mth»ad_tid
;

3 
	mth»ad_couÁ
;

4 } 
	tTh»ad
;

5 
Th»ad
 *
	gŒ
;

7 
	#MAXNCLI
 32

	)

8 
	gşifd
[
MAXNCLI
], 
	gig‘
, 
	gut
;

9 
±h»ad_mu‹x_t
 
	gşifd_mu‹x
;

10 
±h»ad_cÚd_t
 
	gşifd_cÚd
;

	@osi\unpv13e\unpv13e\server\pthread09.c

1 
	~"uÅth»ad.h
"

2 
	~"±h»ad09.h
"

5 
	$th»ad_make
(
i
)

7 *
	`th»ad_maš
(*);

9 
	`Pth»ad_ü—‹
(&
Œ
[
i
].
th»ad_tid
, 
NULL
, &
th»ad_maš
, (*) i);

11 
	}
}

14 
	$th»ad_maš
(*
¬g
)

16 
cÚnfd
;

17 
	`web_chd
();

18 
sockËn_t
 
ş’
;

19 
sockaddr
 *
şŸddr
;

21 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
	`´štf
("th»ad %d s¹šg\n", (è
¬g
);

25 
ş’
 = 
add¾’
;

26 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

27 
Œ
[(è
¬g
].
th»ad_couÁ
++;

29 
	`web_chd
(
cÚnfd
);

30 
	`Clo£
(
cÚnfd
);

32 
	}
}

	@osi\unpv13e\unpv13e\server\pthread09.h

2 
±h»ad_t
 
	mth»ad_tid
;

3 
	mth»ad_couÁ
;

4 } 
	tTh»ad
;

5 
Th»ad
 *
	gŒ
;

7 
	gli¡’fd
, 
	gÁh»ads
;

8 
sockËn_t
 
	gadd¾’
;

	@osi\unpv13e\unpv13e\server\readline.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$»adlše
(
fd
, *
v±r
, 
size_t
 
maxËn
)

7 
ssize_t
 
n
, 
rc
;

8 
c
, *
±r
;

10 
±r
 = 
v±r
;

11 
n
 = 1;‚ < 
maxËn
;‚++) {

12 iàĞ(
rc
 = 
	`»ad
(
fd
, &
c
, 1)) == 1) {

13 *
±r
++ = 
c
;

14 ià(
c
 == '\n')

16 } ià(
rc
 == 0) {

17 ià(
n
 == 1)

25 *
±r
 = 0;

26 (
n
);

27 
	}
}

30 
ssize_t


31 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

33 
ssize_t
 
n
;

35 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) == -1)

36 
	`”r_sys
("readlineƒrror");

37 (
n
);

38 
	}
}

	@osi\unpv13e\unpv13e\server\readline_r.c

2 
	~"uÅ.h
"

3 
	~"»adlše_r.h
"

5 
ssize_t


6 
	$my_»ad_r
(
Rlše
 *
½Œ
, *
±r
)

8 ià(
½Œ
->
¾_út
 <= 0) {

9 
agaš
:

10 
½Œ
->
¾_út
 = 
	`»ad
Ô±r->
»ad_fd
,„±r->
¾_buf
, (rptr->rl_buf));

11 ià(
½Œ
->
¾_út
 < 0) {

12 ià(
”ºo
 =ğ
EINTR
)

13 
agaš
;

17 ià(
½Œ
->
¾_út
 == 0)

19 
½Œ
->
¾_buåŒ
 =„±r->
¾_buf
;

22 
½Œ
->
¾_út
--;

23 *
±r
 = *
½Œ
->
¾_buåŒ
++ & 255;

25 
	}
}

28 
	$»adlše_rš™
(
fd
, *
±r
, 
size_t
 
maxËn
, 
Rlše
 *
½Œ
)

30 
½Œ
->
»ad_fd
 = 
fd
;

31 
½Œ
->
»ad_±r
 = 
±r
;

32 
½Œ
->
»ad_maxËn
 = 
maxËn
;

34 
½Œ
->
¾_út
 = 0;

35 
½Œ
->
¾_buåŒ
 =„±r->
¾_buf
;

36 
	}
}

38 
ssize_t


39 
	$»adlše_r
(
Rlše
 *
½Œ
)

41 
n
, 
rc
;

42 
c
, *
±r
;

44 
±r
 = 
½Œ
->
»ad_±r
;

45 
n
 = 1;‚ < 
½Œ
->
»ad_maxËn
;‚++) {

46 iàĞ(
rc
 = 
	`my_»ad_r
(
½Œ
, &
c
)) == 1) {

47 *
±r
++ = 
c
;

48 ià(
c
 == '\n')

50 } ià(
rc
 == 0) {

51 ià(
n
 == 1)

59 *
±r
 = 0;

60 (
n
);

61 
	}
}

64 
ssize_t


65 
	$R—dlše_r
(
Rlše
 *
½Œ
)

67 
ssize_t
 
n
;

69 iàĞ(
n
 = 
	`»adlše_r
(
½Œ
)) == -1)

70 
	`”r_sys
("readline_rƒrror");

71 (
n
);

72 
	}
}

	@osi\unpv13e\unpv13e\server\readline_r.h

2 
	m»ad_fd
;

3 *
	m»ad_±r
;

4 
size_t
 
	m»ad_maxËn
;

6 
	m¾_út
;

7 *
	m¾_buåŒ
;

8 
	m¾_buf
[
MAXLINE
];

9 } 
	tRlše
;

11 
»adlše_rš™
(, *, 
size_t
, 
Rlše
 *);

12 
ssize_t
 
»adlše_r
(
Rlše
 *);

13 
ssize_t
 
R—dlše_r
(
Rlše
 *);

	@osi\unpv13e\unpv13e\server\serv00.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
	`sig_št
(), 
	`web_chd
();

9 
sockËn_t
 
ş’
, 
add¾’
;

10 
sockaddr
 *
şŸddr
;

12 ià(
¬gc
 == 2)

13 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

14 ià(
¬gc
 == 3)

15 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

17 
	`”r_qu™
("usage: serv00 [ <host> ] <port#>");

18 
şŸddr
 = 
	`M®loc
(
add¾’
);

20 
	`SigÇl
(
SIGINT
, 
sig_št
);

23 
ş’
 = 
add¾’
;

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

26 
	`web_chd
(
cÚnfd
);

28 
	`Clo£
(
cÚnfd
);

30 
	}
}

35 
	$sig_št
(
signo
)

37 
	`´_ıu_time
();

39 
	`´_ıu_time
();

40 
	`ex™
(0);

41 
	}
}

	@osi\unpv13e\unpv13e\server\serv01.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
pid_t
 
chdpid
;

9 
	`sig_chld
(), 
	`sig_št
(), 
	`web_chd
();

10 
sockËn_t
 
ş’
, 
add¾’
;

11 
sockaddr
 *
şŸddr
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage: serv01 [ <host> ] <port#>");

19 
şŸddr
 = 
	`M®loc
(
add¾’
);

21 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

22 
	`SigÇl
(
SIGINT
, 
sig_št
);

25 
ş’
 = 
add¾’
;

26 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, 
şŸddr
, &
ş’
)) < 0) {

27 ià(
”ºo
 =ğ
EINTR
)

30 
	`”r_sys
("acceptƒrror");

33 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

34 
	`Clo£
(
li¡’fd
);

35 
	`web_chd
(
cÚnfd
);

36 
	`ex™
(0);

38 
	`Clo£
(
cÚnfd
);

40 
	}
}

45 
	$sig_št
(
signo
)

47 
	`´_ıu_time
();

49 
	`´_ıu_time
();

50 
	`ex™
(0);

51 
	}
}

	@osi\unpv13e\unpv13e\server\serv02.c

2 
	~"uÅ.h
"

4 
	gnchd»n
;

5 
pid_t
 *
	gpids
;

8 
	$maš
(
¬gc
, **
¬gv
)

10 
li¡’fd
, 
i
;

11 
sockËn_t
 
add¾’
;

12 
	`sig_št
();

13 
pid_t
 
	`chd_make
(, , );

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

17 ià(
¬gc
 == 4)

18 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

20 
	`”r_qu™
("usage: serv02 [ <host> ] <port#> <#children>");

21 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

22 
pids
 = 
	`C®loc
(
nchd»n
, (
pid_t
));

24 
i
 = 0; i < 
nchd»n
; i++)

25 
pids
[
i
] = 
	`chd_make
(i, 
li¡’fd
, 
add¾’
);

27 
	`SigÇl
(
SIGINT
, 
sig_št
);

30 
	`·u£
();

31 
	}
}

36 
	$sig_št
(
signo
)

38 
i
;

39 
	`´_ıu_time
();

42 
i
 = 0; i < 
nchd»n
; i++)

43 
	`kl
(
pids
[
i
], 
SIGTERM
);

44 
	`wa™
(
NULL
) > 0)

46 ià(
”ºo
 !ğ
ECHILD
)

47 
	`”r_sys
("waitƒrror");

49 
	`´_ıu_time
();

50 
	`ex™
(0);

51 
	}
}

	@osi\unpv13e\unpv13e\server\serv02m.c

1 
	~"uÅ.h
"

3 
	gnchd»n
;

4 
pid_t
 *
	gpids
;

5 *
	gıŒ
, *
m‘”
();

8 
	$maš
(
¬gc
, **
¬gv
)

10 
li¡’fd
, 
i
;

11 
sockËn_t
 
add¾’
;

12 
	`sig_št
();

13 
pid_t
 
	`chd_make
(, , );

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

17 ià(
¬gc
 == 4)

18 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

20 
	`”r_qu™
("usage: serv02 [ <host> ] <port#> <#children>");

21 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

22 
pids
 = 
	`C®loc
(
nchd»n
, (
pid_t
));

23 
ıŒ
 = 
	`m‘”
(
nchd»n
);

25 
i
 = 0; i < 
nchd»n
; i++)

26 
pids
[
i
] = 
	`chd_make
(i, 
li¡’fd
, 
add¾’
);

28 
	`SigÇl
(
SIGINT
, 
sig_št
);

31 
	`·u£
();

32 
	}
}

35 
	$sig_št
(
signo
)

37 
i
;

38 
	`´_ıu_time
();

41 
i
 = 0; i < 
nchd»n
; i++)

42 
	`kl
(
pids
[
i
], 
SIGTERM
);

43 
	`wa™
(
NULL
) > 0)

45 ià(
”ºo
 !ğ
ECHILD
)

46 
	`”r_sys
("waitƒrror");

48 
	`´_ıu_time
();

50 
i
 = 0; i < 
nchd»n
; i++)

51 
	`´štf
("chd %d, %ld cÚÃùiÚs\n", 
i
, 
ıŒ
[i]);

53 
	`ex™
(0);

54 
	}
}

	@osi\unpv13e\unpv13e\server\serv03.c

1 
	~"uÅ.h
"

3 
	gnchd»n
;

4 
pid_t
 *
	gpids
;

7 
	$maš
(
¬gc
, **
¬gv
)

9 
li¡’fd
, 
i
;

10 
sockËn_t
 
add¾’
;

11 
	`sig_št
();

12 
pid_t
 
	`chd_make
(, , );

14 ià(
¬gc
 == 3)

15 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

16 ià(
¬gc
 == 4)

17 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

19 
	`”r_qu™
("usage: serv03 [ <host> ] <port#> <#children>");

20 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

21 
pids
 = 
	`C®loc
(
nchd»n
, (
pid_t
));

23 
	`my_lock_š™
("/tmp/lock.XXXXXX");

24 
i
 = 0; i < 
nchd»n
; i++)

25 
pids
[
i
] = 
	`chd_make
(i, 
li¡’fd
, 
add¾’
);

27 
	`SigÇl
(
SIGINT
, 
sig_št
);

30 
	`·u£
();

31 
	}
}

34 
	$sig_št
(
signo
)

36 
i
;

37 
	`´_ıu_time
();

40 
i
 = 0; i < 
nchd»n
; i++)

41 
	`kl
(
pids
[
i
], 
SIGTERM
);

42 
	`wa™
(
NULL
) > 0)

44 ià(
”ºo
 !ğ
ECHILD
)

45 
	`”r_sys
("waitƒrror");

47 
	`´_ıu_time
();

48 
	`ex™
(0);

49 
	}
}

	@osi\unpv13e\unpv13e\server\serv03m.c

1 
	~"uÅ.h
"

3 
	gnchd»n
;

4 
pid_t
 *
	gpids
;

5 *
	gıŒ
, *
m‘”
();

8 
	$maš
(
¬gc
, **
¬gv
)

10 
li¡’fd
, 
i
;

11 
sockËn_t
 
add¾’
;

12 
	`sig_št
();

13 
pid_t
 
	`chd_make
(, , );

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

17 ià(
¬gc
 == 4)

18 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

20 
	`”r_qu™
("usage: serv03 [ <host> ] <port#> <#children>");

21 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

22 
pids
 = 
	`C®loc
(
nchd»n
, (
pid_t
));

23 
ıŒ
 = 
	`m‘”
(
nchd»n
);

25 
	`my_lock_š™
("/tmp/lock.XXXXXX");

26 
i
 = 0; i < 
nchd»n
; i++)

27 
pids
[
i
] = 
	`chd_make
(i, 
li¡’fd
, 
add¾’
);

29 
	`SigÇl
(
SIGINT
, 
sig_št
);

32 
	`·u£
();

33 
	}
}

36 
	$sig_št
(
signo
)

38 
i
;

39 
	`´_ıu_time
();

42 
i
 = 0; i < 
nchd»n
; i++)

43 
	`kl
(
pids
[
i
], 
SIGTERM
);

44 
	`wa™
(
NULL
) > 0)

46 ià(
”ºo
 !ğ
ECHILD
)

47 
	`”r_sys
("waitƒrror");

49 
	`´_ıu_time
();

51 
i
 = 0; i < 
nchd»n
; i++)

52 
	`´štf
("chd %d, %ld cÚÃùiÚs\n", 
i
, 
ıŒ
[i]);

54 
	`ex™
(0);

55 
	}
}

	@osi\unpv13e\unpv13e\server\serv04.c

1 
	~"uÅ.h
"

3 
	gnchd»n
;

4 
pid_t
 *
	gpids
;

7 
	$maš
(
¬gc
, **
¬gv
)

9 
li¡’fd
, 
i
;

10 
sockËn_t
 
add¾’
;

11 
	`sig_št
();

12 
pid_t
 
	`chd_make
(, , );

14 ià(
¬gc
 == 3)

15 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

16 ià(
¬gc
 == 4)

17 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

19 
	`”r_qu™
("usage: serv04 [ <host> ] <port#> <#children>");

20 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

21 
pids
 = 
	`C®loc
(
nchd»n
, (
pid_t
));

23 
	`my_lock_š™
(
NULL
);

24 
i
 = 0; i < 
nchd»n
; i++)

25 
pids
[
i
] = 
	`chd_make
(i, 
li¡’fd
, 
add¾’
);

27 
	`SigÇl
(
SIGINT
, 
sig_št
);

30 
	`·u£
();

31 
	}
}

34 
	$sig_št
(
signo
)

36 
i
;

37 
	`´_ıu_time
();

40 
i
 = 0; i < 
nchd»n
; i++)

41 
	`kl
(
pids
[
i
], 
SIGTERM
);

42 
	`wa™
(
NULL
) > 0)

44 ià(
”ºo
 !ğ
ECHILD
)

45 
	`”r_sys
("waitƒrror");

47 
	`´_ıu_time
();

48 
	`ex™
(0);

49 
	}
}

	@osi\unpv13e\unpv13e\server\serv05.c

2 
	~"uÅ.h
"

3 
	~"chd.h
"

5 
	gnchd»n
;

8 
	$maš
(
¬gc
, **
¬gv
)

10 
li¡’fd
, 
i
, 
Çva
, 
maxfd
, 
n£l
, 
cÚnfd
, 
rc
;

11 
	`sig_št
();

12 
pid_t
 
	`chd_make
(, , );

13 
ssize_t
 
n
;

14 
fd_£t
 
r£t
, 
ma¡”£t
;

15 
sockËn_t
 
add¾’
, 
ş’
;

16 
sockaddr
 *
şŸddr
;

18 ià(
¬gc
 == 3)

19 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

20 ià(
¬gc
 == 4)

21 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

23 
	`”r_qu™
("usage: serv05 [ <host> ] <port#> <#children>");

25 
	`FD_ZERO
(&
ma¡”£t
);

26 
	`FD_SET
(
li¡’fd
, &
ma¡”£t
);

27 
maxfd
 = 
li¡’fd
;

28 
şŸddr
 = 
	`M®loc
(
add¾’
);

30 
nchd»n
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

31 
Çva
 = 
nchd»n
;

32 
ıŒ
 = 
	`C®loc
(
nchd»n
, (
Chd
));

35 
i
 = 0; i < 
nchd»n
; i++) {

36 
	`chd_make
(
i
, 
li¡’fd
, 
add¾’
);

37 
	`FD_SET
(
ıŒ
[
i
].
chd_pefd
, &
ma¡”£t
);

38 
maxfd
 = 
	`max
(maxfd, 
ıŒ
[
i
].
chd_pefd
);

41 
	`SigÇl
(
SIGINT
, 
sig_št
);

44 
r£t
 = 
ma¡”£t
;

45 ià(
Çva
 <= 0)

46 
	`FD_CLR
(
li¡’fd
, &
r£t
);

47 
n£l
 = 
	`S–eù
(
maxfd
 + 1, &
r£t
, 
NULL
, NULL, NULL);

50 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
)) {

51 
ş’
 = 
add¾’
;

52 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

54 
i
 = 0; i < 
nchd»n
; i++)

55 ià(
ıŒ
[
i
].
chd_¡©us
 == 0)

58 ià(
i
 =ğ
nchd»n
)

59 
	`”r_qu™
("no‡vailable children");

60 
ıŒ
[
i
].
chd_¡©us
 = 1;

61 
ıŒ
[
i
].
chd_couÁ
++;

62 
Çva
--;

64 
n
 = 
	`Wr™e_fd
(
ıŒ
[
i
].
chd_pefd
, "", 1, 
cÚnfd
);

65 
	`Clo£
(
cÚnfd
);

66 ià(--
n£l
 == 0)

71 
i
 = 0; i < 
nchd»n
; i++) {

72 ià(
	`FD_ISSET
(
ıŒ
[
i
].
chd_pefd
, &
r£t
)) {

73 iàĞ(
n
 = 
	`R—d
(
ıŒ
[
i
].
chd_pefd
, &
rc
, 1)) == 0)

74 
	`”r_qu™
("chd %d”mš©ed uÃx³ùedly", 
i
);

75 
ıŒ
[
i
].
chd_¡©us
 = 0;

76 
Çva
++;

77 ià(--
n£l
 == 0)

82 
	}
}

86 
	$sig_št
(
signo
)

88 
i
;

89 
	`´_ıu_time
();

92 
i
 = 0; i < 
nchd»n
; i++)

93 
	`kl
(
ıŒ
[
i
].
chd_pid
, 
SIGTERM
);

94 
	`wa™
(
NULL
) > 0)

96 ià(
”ºo
 !ğ
ECHILD
)

97 
	`”r_sys
("waitƒrror");

99 
	`´_ıu_time
();

101 
i
 = 0; i < 
nchd»n
; i++)

102 
	`´štf
("chd %d, %ld cÚÃùiÚs\n", 
i
, 
ıŒ
[i].
chd_couÁ
);

104 
	`ex™
(0);

105 
	}
}

	@osi\unpv13e\unpv13e\server\serv06.c

2 
	~"uÅth»ad.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
;

8 
	`sig_št
();

9 *
	`do™
(*);

10 
±h»ad_t
 
tid
;

11 
sockËn_t
 
ş’
, 
add¾’
;

12 
sockaddr
 *
şŸddr
;

14 ià(
¬gc
 == 2)

15 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

16 ià(
¬gc
 == 3)

17 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

19 
	`”r_qu™
("usage: serv06 [ <host> ] <port#>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

22 
	`SigÇl
(
SIGINT
, 
sig_št
);

25 
ş’
 = 
add¾’
;

26 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

28 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, &
do™
, (*è
cÚnfd
);

30 
	}
}

33 
	$do™
(*
¬g
)

35 
	`web_chd
();

37 
	`Pth»ad_d‘ach
(
	`±h»ad_£lf
());

38 
	`web_chd
((è
¬g
);

39 
	`Clo£
((è
¬g
);

40 (
NULL
);

41 
	}
}

45 
	$sig_št
(
signo
)

47 
	`´_ıu_time
();

49 
	`´_ıu_time
();

50 
	`ex™
(0);

51 
	}
}

	@osi\unpv13e\unpv13e\server\serv07.c

2 
	~"uÅth»ad.h
"

3 
	~"±h»ad07.h
"

5 
±h»ad_mu‹x_t
 
	gmlock
 = 
PTHREAD_MUTEX_INITIALIZER
;

8 
	$maš
(
¬gc
, **
¬gv
)

10 
i
;

11 
	`sig_št
(), 
	`th»ad_make
();

13 ià(
¬gc
 == 3)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 4)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage: serv07 [ <host> ] <port#> <#threads>");

19 
Áh»ads
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

20 
Œ
 = 
	`C®loc
(
Áh»ads
, (
Th»ad
));

22 
i
 = 0; i < 
Áh»ads
; i++)

23 
	`th»ad_make
(
i
);

25 
	`SigÇl
(
SIGINT
, 
sig_št
);

28 
	`·u£
();

29 
	}
}

33 
	$sig_št
(
signo
)

35 
i
;

36 
	`´_ıu_time
();

38 
	`´_ıu_time
();

40 
i
 = 0; i < 
Áh»ads
; i++)

41 
	`´štf
("th»ad %d, %ld cÚÃùiÚs\n", 
i
, 
Œ
[i].
th»ad_couÁ
);

43 
	`ex™
(0);

44 
	}
}

	@osi\unpv13e\unpv13e\server\serv08.c

2 
	~"uÅth»ad.h
"

3 
	~"±h»ad08.h
"

5 
	gÁh»ads
;

6 
±h»ad_mu‹x_t
 
	gşifd_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

7 
±h»ad_cÚd_t
 
	gşifd_cÚd
 = 
PTHREAD_COND_INITIALIZER
;

10 
	$maš
(
¬gc
, **
¬gv
)

12 
i
, 
li¡’fd
, 
cÚnfd
;

13 
	`sig_št
(), 
	`th»ad_make
();

14 
sockËn_t
 
add¾’
, 
ş’
;

15 
sockaddr
 *
şŸddr
;

17 ià(
¬gc
 == 3)

18 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

19 ià(
¬gc
 == 4)

20 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

22 
	`”r_qu™
("usage: serv08 [ <host> ] <port#> <#threads>");

23 
şŸddr
 = 
	`M®loc
(
add¾’
);

25 
Áh»ads
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

26 
Œ
 = 
	`C®loc
(
Áh»ads
, (
Th»ad
));

27 
ig‘
 = 
ut
 = 0;

30 
i
 = 0; i < 
Áh»ads
; i++)

31 
	`th»ad_make
(
i
);

33 
	`SigÇl
(
SIGINT
, 
sig_št
);

36 
ş’
 = 
add¾’
;

37 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
ş’
);

39 
	`Pth»ad_mu‹x_lock
(&
şifd_mu‹x
);

40 
şifd
[
ut
] = 
cÚnfd
;

41 ià(++
ut
 =ğ
MAXNCLI
)

42 
ut
 = 0;

43 ià(
ut
 =ğ
ig‘
)

44 
	`”r_qu™
("uˆğig‘ = %d", 
ut
);

45 
	`Pth»ad_cÚd_sigÇl
(&
şifd_cÚd
);

46 
	`Pth»ad_mu‹x_uÆock
(&
şifd_mu‹x
);

48 
	}
}

52 
	$sig_št
(
signo
)

54 
i
;

55 
	`´_ıu_time
();

57 
	`´_ıu_time
();

59 
i
 = 0; i < 
Áh»ads
; i++)

60 
	`´štf
("th»ad %d, %ld cÚÃùiÚs\n", 
i
, 
Œ
[i].
th»ad_couÁ
);

62 
	`ex™
(0);

63 
	}
}

	@osi\unpv13e\unpv13e\server\serv09.c

2 
	~"uÅth»ad.h
"

3 
	~"±h»ad09.h
"

6 
	$maš
(
¬gc
, **
¬gv
)

8 
i
;

9 
	`sig_št
(), 
	`th»ad_make
();

11 ià(
¬gc
 == 3)

12 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

13 ià(
¬gc
 == 4)

14 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

16 
	`”r_qu™
("usage: serv09 [ <host> ] <port#> <#threads>");

17 
Áh»ads
 = 
	`©oi
(
¬gv
[
¬gc
-1]);

18 
Œ
 = 
	`C®loc
(
Áh»ads
, (
Th»ad
));

20 
i
 = 0; i < 
Áh»ads
; i++)

21 
	`th»ad_make
(
i
);

23 
	`SigÇl
(
SIGINT
, 
sig_št
);

26 
	`·u£
();

27 
	}
}

31 
	$sig_št
(
signo
)

33 
i
;

34 
	`´_ıu_time
();

36 
	`´_ıu_time
();

38 
i
 = 0; i < 
Áh»ads
; i++)

39 
	`´štf
("th»ad %d, %ld cÚÃùiÚs\n", 
i
, 
Œ
[i].
th»ad_couÁ
);

41 
	`ex™
(0);

42 
	}
}

	@osi\unpv13e\unpv13e\server\sig_chld_waitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0) {

13 
	}
}

	@osi\unpv13e\unpv13e\server\unpthread.h

4 #iâdef 
__uÅ_±h»ad_h


5 
	#__uÅ_±h»ad_h


	)

7 
	~"uÅ.h
"

9 
Pth»ad_ü—‹
(
±h»ad_t
 *, cÚ¡ 
±h»ad_©Œ_t
 *,

11 
Pth»ad_još
(
±h»ad_t
, **);

12 
Pth»ad_d‘ach
(
±h»ad_t
);

13 
Pth»ad_kl
(
±h»ad_t
, );

15 
Pth»ad_mu‹x©Œ_š™
(
±h»ad_mu‹x©Œ_t
 *);

16 
Pth»ad_mu‹x©Œ_£sh¬ed
(
±h»ad_mu‹x©Œ_t
 *, );

17 
Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *, 
±h»ad_mu‹x©Œ_t
 *);

18 
Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *);

19 
Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *);

21 
Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *);

22 
Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *);

23 
Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *);

24 
Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *,

25 cÚ¡ 
time¥ec
 *);

27 
Pth»ad_key_ü—‹
(
±h»ad_key_t
 *, (*)(*));

28 
	`Pth»ad_£t¥ecific
(
±h»ad_key_t
, const *);

29 
	`Pth»ad_Úû
(
±h»ad_Úû_t
 *, (*)());

	@osi\unpv13e\unpv13e\server\web_child.c

1 
	~"uÅ.h
"

3 
	#MAXN
 16384

	)

6 
	$web_chd
(
sockfd
)

8 
Áowr™e
;

9 
ssize_t
 
Ä—d
;

10 
lše
[
MAXLINE
], 
»suÉ
[
MAXN
];

13 iàĞ(
Ä—d
 = 
	`R—dlše
(
sockfd
, 
lše
, 
MAXLINE
)) == 0)

17 
Áowr™e
 = 
	`©Ş
(
lše
);

18 ià((
Áowr™e
 <ğ0è|| (Áowr™> 
MAXN
))

19 
	`”r_qu™
("ş›Á„eque¡ fÜ %d by‹s", 
Áowr™e
);

21 
	`Wr™’
(
sockfd
, 
»suÉ
, 
Áowr™e
);

23 
	}
}

	@osi\unpv13e\unpv13e\server\web_child_r.c

1 
	~"uÅ.h
"

2 
	~"»adlše_r.h
"

4 
	#MAXN
 16384

	)

7 
	$web_chd
(
sockfd
)

9 
Áowr™e
;

10 
ssize_t
 
Ä—d
;

11 
lše
[
MAXLINE
], 
»suÉ
[
MAXN
];

12 
Rlše
 
¾še
;

14 
	`»adlše_rš™
(
sockfd
, 
lše
, 
MAXLINE
, &
¾še
);

16 iàĞ(
Ä—d
 = 
	`R—dlše_r
(&
¾še
)) == 0)

20 
Áowr™e
 = 
	`©Ş
(
lše
);

21 ià((
Áowr™e
 <ğ0è|| (Áowr™> 
MAXN
))

22 
	`”r_qu™
("ş›Á„eque¡ fÜ %d by‹s", 
Áowr™e
);

24 
	`Wr™’
(
sockfd
, 
»suÉ
, 
Áowr™e
);

26 
	}
}

	@osi\unpv13e\unpv13e\sigio\dgcli01.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

11 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

13 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

15 
»cvlše
[
n
] = 0;

16 
	`Fputs
(
»cvlše
, 
¡dout
);

18 
	}
}

	@osi\unpv13e\unpv13e\sigio\dgecho01.c

2 
	~"uÅ.h
"

4 
	gsockfd
;

6 
	#QSIZE
 8

	)

7 
	#MAXDG
 4096

	)

10 *
	mdg_d©a
;

11 
size_t
 
	mdg_Ën
;

12 
sockaddr
 *
	mdg_§
;

13 
sockËn_t
 
	mdg_§Ën
;

14 } 
	tDG
;

15 
DG
 
	gdg
[
QSIZE
];

16 
	gúŒ—d
[
QSIZE
+1];

18 
	gig‘
;

19 
	gut
;

20 
	gnqueue
;

21 
sockËn_t
 
	gş’
;

23 
sig_io
();

24 
sig_hup
();

29 
	$dg_echo
(
sockfd_¬g
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’_¬g
)

31 
i
;

32 cÚ¡ 
Ú
 = 1;

33 
sig£t_t
 
z”omask
, 
Ãwmask
, 
Şdmask
;

35 
sockfd
 = 
sockfd_¬g
;

36 
ş’
 = 
ş’_¬g
;

38 
i
 = 0; i < 
QSIZE
; i++) {

39 
dg
[
i
].
dg_d©a
 = 
	`M®loc
(
MAXDG
);

40 
dg
[
i
].
dg_§
 = 
	`M®loc
(
ş’
);

41 
dg
[
i
].
dg_§Ën
 = 
ş’
;

43 
ig‘
 = 
ut
 = 
nqueue
 = 0;

45 
	`SigÇl
(
SIGHUP
, 
sig_hup
);

46 
	`SigÇl
(
SIGIO
, 
sig_io
);

47 
	`Fú
(
sockfd
, 
F_SETOWN
, 
	`g‘pid
());

48 
	`Ioùl
(
sockfd
, 
FIOASYNC
, &
Ú
);

49 
	`Ioùl
(
sockfd
, 
FIONBIO
, &
Ú
);

51 
	`Sigem±y£t
(&
z”omask
);

52 
	`Sigem±y£t
(&
Şdmask
);

53 
	`Sigem±y£t
(&
Ãwmask
);

54 
	`Sigadd£t
(&
Ãwmask
, 
SIGIO
);

56 
	`Sig´ocmask
(
SIG_BLOCK
, &
Ãwmask
, &
Şdmask
);

58 
nqueue
 == 0)

59 
	`sigsu¥’d
(&
z”omask
);

62 
	`Sig´ocmask
(
SIG_SETMASK
, &
Şdmask
, 
NULL
);

64 
	`S’dto
(
sockfd
, 
dg
[
ig‘
].
dg_d©a
, dg[ig‘].
dg_Ën
, 0,

65 
dg
[
ig‘
].
dg_§
, dg[ig‘].
dg_§Ën
);

67 ià(++
ig‘
 >ğ
QSIZE
)

68 
ig‘
 = 0;

71 
	`Sig´ocmask
(
SIG_BLOCK
, &
Ãwmask
, &
Şdmask
);

72 
nqueue
--;

74 
	}
}

79 
	$sig_io
(
signo
)

81 
ssize_t
 
Ën
;

82 
Ä—d
;

83 
DG
 *
±r
;

85 
Ä—d
 = 0; ; ) {

86 ià(
nqueue
 >ğ
QSIZE
)

87 
	`”r_qu™
("receive overflow");

89 
±r
 = &
dg
[
ut
];

90 
±r
->
dg_§Ën
 = 
ş’
;

91 
Ën
 = 
	`»cväom
(
sockfd
, 
±r
->
dg_d©a
, 
MAXDG
, 0,

92 
±r
->
dg_§
, &±r->
dg_§Ën
);

93 ià(
Ën
 < 0) {

94 ià(
”ºo
 =ğ
EWOULDBLOCK
)

97 
	`”r_sys
("recvfromƒrror");

99 
±r
->
dg_Ën
 = 
Ën
;

101 
Ä—d
++;

102 
nqueue
++;

103 ià(++
ut
 >ğ
QSIZE
)

104 
ut
 = 0;

107 
úŒ—d
[
Ä—d
]++;

108 
	}
}

113 
	$sig_hup
(
signo
)

115 
i
;

117 
i
 = 0; i <ğ
QSIZE
; i++)

118 
	`´štf
("úŒ—d[%d] = %ld\n", 
i
, 
úŒ—d
[i]);

119 
	}
}

	@osi\unpv13e\unpv13e\sigio\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli01 <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\sigio\udpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\sock\buffers.c

10 
	~"sock.h
"

13 
	$bufãrs
(
sockfd
)

15 
n
;

16 
sockËn_t
 
İ’
;

20 ià(
rbuf
 =ğ
NULL
) {

21 iàĞ(
rbuf
 = 
	`m®loc
(
»adËn
)è=ğ
NULL
)

22 
	`”r_sys
("mallocƒrror for„ead buffer");

25 ià(
wbuf
 =ğ
NULL
) {

26 iàĞ(
wbuf
 = 
	`m®loc
(
wr™–’
)è=ğ
NULL
)

27 
	`”r_sys
("mallocƒrror for write buffer");

33 ià(
rcvbuæ’
) {

34 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuæ’
,

35 (
rcvbuæ’
)) < 0)

36 
	`”r_sys
("SO_RCVBUF setsockoptƒrror");

38 
İ’
 = (
n
);

39 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
n
, &
İ’
) < 0)

40 
	`”r_sys
("SO_RCVBUF getsockoptƒrror");

41 ià(
n
 !ğ
rcvbuæ’
)

42 
	`”r_qu™
("rcvbuæ’ = %d, SO_RCVBUF = %d", 
rcvbuæ’
, 
n
);

43 ià(
v”bo£
)

44 
	`årštf
(
¡d”r
, "SO_RCVBUF = %d\n", 
n
);

47 ià(
¢dbuæ’
) {

48 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
¢dbuæ’
,

49 (
¢dbuæ’
)) < 0)

50 
	`”r_sys
("SO_SNDBUF setsockoptƒrror");

52 
İ’
 = (
n
);

53 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
n
, &
İ’
) < 0)

54 
	`”r_sys
("SO_SNDBUF getsockoptƒrror");

55 ià(
n
 !ğ
¢dbuæ’
)

56 
	`”r_qu™
("¢dbuæ’ = %d, SO_SNDBUF = %d", 
¢dbuæ’
, 
n
);

57 ià(
v”bo£
)

58 
	`årštf
(
¡d”r
, "SO_SNDBUF = %d\n", 
n
);

60 
	}
}

	@osi\unpv13e\unpv13e\sock\cliopen.c

10 
	~"sock.h
"

13 
	$şiİ’
(*
ho¡
, *
pÜt
)

15 
fd
, 
i
, 
Ú
;

16 cÚ¡ *
´ÙocŞ
;

17 
š_addr
 
šaddr
;

18 
£rv’t
 *
¥
;

19 
ho¡’t
 *
hp
;

21 
´ÙocŞ
 = 
udp
 ? "udp" : "tcp";

24 
	`bz”o
(&
£rvaddr
, (servaddr));

25 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

28 iàĞ(
i
 = 
	`©oi
(
pÜt
)) == 0) {

29 iàĞ(
¥
 = 
	`g‘£rvbyÇme
(
pÜt
, 
´ÙocŞ
)è=ğ
NULL
)

30 
	`”r_qu™
("g‘£rvbyÇme(è”rÜ fÜ: %s/%s", 
pÜt
, 
´ÙocŞ
);

32 
£rvaddr
.
sš_pÜt
 = 
¥
->
s_pÜt
;

34 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
i
);

41 ià(
	`š‘_©Ú
(
ho¡
, &
šaddr
) == 1)

42 
£rvaddr
.
sš_addr
 = 
šaddr
;

43 iàĞ(
hp
 = 
	`g‘ho¡byÇme
(
ho¡
)è!ğ
NULL
)

44 
	`memıy
(&
£rvaddr
.
sš_addr
, 
hp
->
h_addr
, hp->
h_Ëngth
);

46 
	`”r_qu™
("šv®id ho¡Çme: %s", 
ho¡
);

48 iàĞ(
fd
 = 
	`sock‘
(
AF_INET
, 
udp
 ? 
SOCK_DGRAM
 : 
SOCK_STREAM
, 0)) < 0)

49 
	`”r_sys
("socket()ƒrror");

51 ià(
»u£addr
) {

52 
Ú
 = 1;

53 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
,  (on)) < 0)

54 
	`”r_sys
("setsockopt of SO_REUSEADDRƒrror");

57 #ifdef 
SO_REUSEPORT


58 ià(
»u£pÜt
) {

59 
Ú
 = 1;

60 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEPORT
, &
Ú
,  (on)) < 0)

61 
	`”r_sys
("setsockopt of SO_REUSEPORTƒrror");

75 ià(
bšdpÜt
 !ğ0 || 
loÿl
[0] !ğ0 || 
udp
) {

76 
	`bz”o
(&
şŸddr
, (cliaddr));

77 
şŸddr
.
sš_çmy
 = 
AF_INET
;

78 
şŸddr
.
sš_pÜt
 = 
	`htÚs
(
bšdpÜt
);

79 ià(
loÿl
[0] != 0) {

80 ià(
	`š‘_©Ú
(
loÿl
, &
şŸddr
.
sš_addr
) == 0)

81 
	`”r_qu™
("šv®id IP‡dd»ss: %s", 
loÿl
);

83 
şŸddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

85 ià(
	`bšd
(
fd
, (
sockaddr
 *è&
şŸddr
, (cliaddr)) < 0)

86 
	`”r_sys
("bind()ƒrror");

93 
	`bufãrs
(
fd
);

94 
	`sockİts
(
fd
, 0);

100 ià(
udp
 =ğ0 || 
cÚÃùudp
) {

102 ià(
	`cÚÃù
(
fd
, (
sockaddr
 *è&
£rvaddr
, (servaddr))

105 ià(
”ºo
 =ğ
EINTR
)

107 ià(
”ºo
 =ğ
EISCONN
)

109 
	`”r_sys
("connect()ƒrror");

113 ià(
v”bo£
) {

117 
i
 = (
şŸddr
);

118 ià(
	`g‘sockÇme
(
fd
, (
sockaddr
 *è&
şŸddr
, &
i
) < 0)

119 
	`”r_sys
("getsockname()ƒrror");

123 
	`årštf
(
¡d”r
, "connected on %s.%d ",

124 
	`INET_NTOA
(
şŸddr
.
sš_addr
), 
	`Áohs
(şŸddr.
sš_pÜt
));

125 
	`årštf
(
¡d”r
, "to %s.%d\n",

126 
	`INET_NTOA
(
£rvaddr
.
sš_addr
), 
	`Áohs
(£rvaddr.
sš_pÜt
));

129 
	`sockİts
(
fd
, 1);

131 (
fd
);

132 
	}
}

	@osi\unpv13e\unpv13e\sock\crlf.c

10 
	~"sock.h
"

15 
	$ülf_add
(*
d¡
, 
d¡size
, cÚ¡ *
¤c
, 
Ënš
)

17 
Ënout
;

18 
c
;

20 iàĞ(
Ënout
 = 
Ënš
è> 
d¡size
)

21 
	`”r_qu™
("crlf_add: destination‚ot bigƒnough");

23  ; 
Ënš
 > 0;†enin--) {

24 iàĞ(
c
 = *
¤c
++) == '\n') {

25 ià(++
Ënout
 >ğ
d¡size
)

26 
	`”r_qu™
("crlf_add: destination‚ot bigƒnough");

27 *
d¡
++ = '\r';

29 *
d¡
++ = 
c
;

32 (
Ënout
);

33 
	}
}

36 
	$ülf_¡r
(*
d¡
, 
d¡size
, cÚ¡ *
¤c
, 
Ënš
)

38 
Ënout
;

39 
c
;

41 
Ënout
 = 0; 
Ënš
 > 0;†enin--) {

42 iàĞ(
c
 = *
¤c
++) != '\r') {

43 ià(++
Ënout
 >ğ
d¡size
)

44 
	`”r_qu™
("crlf_strip: destination‚ot bigƒnough");

45 *
d¡
++ = 
c
;

49 (
Ënout
);

50 
	}
}

	@osi\unpv13e\unpv13e\sock\error.c

1 
	~<”ºo.h
>

2 
	~<¡d¬g.h
>

3 
	~"ourhdr.h
"

5 
”r_do™
(, cÚ¡ *, 
va_li¡
);

7 *
	g²ame
 = 
NULL
;

14 
	$”r_»t
(cÚ¡ *
fmt
, ...)

16 
va_li¡
 
­
;

18 
	`va_¡¬t
(
­
, 
fmt
);

19 
	`”r_do™
(1, 
fmt
, 
­
);

20 
	`va_’d
(
­
);

22 
	}
}

29 
	$”r_sys
(cÚ¡ *
fmt
, ...)

31 
va_li¡
 
­
;

33 
	`va_¡¬t
(
­
, 
fmt
);

34 
	`”r_do™
(1, 
fmt
, 
­
);

35 
	`va_’d
(
­
);

36 
	`ex™
(1);

37 
	}
}

44 
	$”r_dump
(cÚ¡ *
fmt
, ...)

46 
va_li¡
 
­
;

48 
	`va_¡¬t
(
­
, 
fmt
);

49 
	`”r_do™
(1, 
fmt
, 
­
);

50 
	`va_’d
(
­
);

51 
	`abÜt
();

52 
	`ex™
(1);

53 
	}
}

60 
	$”r_msg
(cÚ¡ *
fmt
, ...)

62 
va_li¡
 
­
;

64 
	`va_¡¬t
(
­
, 
fmt
);

65 
	`”r_do™
(0, 
fmt
, 
­
);

66 
	`va_’d
(
­
);

68 
	}
}

75 
	$”r_qu™
(cÚ¡ *
fmt
, ...)

77 
va_li¡
 
­
;

79 
	`va_¡¬t
(
­
, 
fmt
);

80 
	`”r_do™
(0, 
fmt
, 
­
);

81 
	`va_’d
(
­
);

82 
	`ex™
(1);

83 
	}
}

89 
	$”r_do™
(
”ºoæag
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

91 
”ºo_§ve
;

92 
buf
[
MAXLINE
];

94 
”ºo_§ve
 = 
”ºo
;

95 
	`v¥rštf
(
buf
, 
fmt
, 
­
);

96 ià(
”ºoæag
)

97 
	`¥rštf
(
buf
+
	`¡¾’
(buf), ": %s", 
	`¡»¼Ü
(
”ºo_§ve
));

98 
	`¡rÿt
(
buf
, "\n");

99 
	`fæush
(
¡dout
);

100 
	`åuts
(
buf
, 
¡d”r
);

101 
	`fæush
(
¡d”r
);

103 
	}
}

	@osi\unpv13e\unpv13e\sock\loop.c

10 
	~"sock.h
"

15 
‰y_©ex™
();

16 
sig_ÿtch
();

19 
	$loİ
(
sockfd
)

21 
maxfdp1
, 
Ä—d
, 
Áowr™e
, 
¡dšeof
, 
ş’
;

22 
fd_£t
 
r£t
;

23 
sockaddr_š
 
şŸddr
;

25 #ifdef 
MSG_TRUNC


26 
iovec
 
iov
[1];

27 
msghdr
 
msg
;

29 #ifdef 
IP_RECVDSTADDR


30 
cmsghdr
 *
cm±r
 = 
NULL
;

31 
š_addr
 
d¡šaddr
;

32 
	#CONTROLLEN
 ((
cmsghdr
è+ (
š_addr
))

	)

37 #ifdef 
nÙdef


43 ià(
cb»ak
 && 
	`i§‰y
(
STDIN_FILENO
)) {

44 ià(
	`‰y_cb»ak
(
STDIN_FILENO
) < 0)

45 
	`”r_sys
("tty_cbreakƒrror");

46 ià(
	`©ex™
(
‰y_©ex™
) < 0)

47 
	`”r_sys
("tty_atexitƒrror");

49 ià(
	`sigÇl
(
SIGINT
, 
sig_ÿtch
è=ğ
SIG_ERR
)

50 
	`”r_sys
("signalƒrror");

51 ià(
	`sigÇl
(
SIGQUIT
, 
sig_ÿtch
è=ğ
SIG_ERR
)

52 
	`”r_sys
("signalƒrror");

53 ià(
	`sigÇl
(
SIGTERM
, 
sig_ÿtch
è=ğ
SIG_ERR
)

54 
	`”r_sys
("signalƒrror");

58 ià(
·u£š™
)

59 
	`¦“p
(
·u£š™
);

61 
¡dšeof
 = 0;

62 
	`FD_ZERO
(&
r£t
);

63 
maxfdp1
 = 
sockfd
 + 1;

70 ià(
¡dšeof
 == 0)

71 
	`FD_SET
(
STDIN_FILENO
, &
r£t
);

72 
	`FD_SET
(
sockfd
, &
r£t
);

74 ià(
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL) < 0)

75 
	`”r_sys
("selectƒrror");

77 ià(
	`FD_ISSET
(
STDIN_FILENO
, &
r£t
)) {

78 iàĞ(
Ä—d
 = 
	`»ad
(
STDIN_FILENO
, 
rbuf
, 
»adËn
)) < 0)

79 
	`”r_sys
("readƒrror from stdin");

80 ià(
Ä—d
 == 0) {

81 ià(
h®fşo£
) {

82 ià(
	`shutdown
(
sockfd
, 1) < 0)

83 
	`”r_sys
("shutdown()ƒrror");

85 
	`FD_CLR
(
STDIN_FILENO
, &
r£t
);

86 
¡dšeof
 = 1;

92 ià(
ülf
) {

93 
Áowr™e
 = 
	`ülf_add
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

94 ià(
	`wr™e
(
sockfd
, 
wbuf
, 
Áowr™e
) !=‚towrite)

95 
	`”r_sys
("writeƒrror");

97 ià(
	`wr™e
(
sockfd
, 
rbuf
, 
Ä—d
) !=‚read)

98 
	`”r_sys
("writeƒrror");

102 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

103 ià(
udp
 && 
£rv”
) {

104 
ş’
 = (
şŸddr
);

105 #iâdef 
MSG_TRUNC


106 
Ä—d
 = 
	`»cväom
(
sockfd
, 
rbuf
, 
»adËn
, 0,

107 (
sockaddr
 *è&
şŸddr
, &
ş’
);

113 
iov
[0].
iov_ba£
 = 
rbuf
;

114 
iov
[0].
iov_Ën
 = 
»adËn
;

115 
msg
.
msg_iov
 = 
iov
;

116 
msg
.
msg_iovËn
 = 1;

117 
msg
.
msg_Çme
 = (
ÿddr_t
è&
şŸddr
;

118 
msg
.
msg_Çm–’
 = 
ş’
;

120 #ifdef 
IP_RECVDSTADDR


121 ià(
cm±r
 =ğ
NULL
 && (cm±¸ğ
	`m®loc
(
CONTROLLEN
)) == NULL)

122 
	`”r_sys
("mallocƒrror for control buffer");

124 
msg
.
msg_cÚŒŞ
 = (
ÿddr_t
è
cm±r
;

125 
msg
.
msg_cÚŒŞËn
 = 
CONTROLLEN
;

127 
msg
.
msg_cÚŒŞ
 = (
ÿddr_t
) 0;

128 
msg
.
msg_cÚŒŞËn
 = 0;

130 
msg
.
msg_æags
 = 0;

132 
Ä—d
 = 
	`»cvmsg
(
sockfd
, &
msg
, 0);

134 ià(
Ä—d
 < 0)

135 
	`”r_sys
("datagram„eceiveƒrror");

137 ià(
v”bo£
) {

138 
	`´štf
("äom %s", 
	`INET_NTOA
(
şŸddr
.
sš_addr
));

139 #ifdef 
MSG_TRUNC


140 #ifdef 
IP_RECVDSTADDR


141 ià(
»cvd¡addr
) {

142 ià(
cm±r
->
cmsg_Ëv–
 !ğ
IPPROTO_IP
)

143 
	`”r_qu™
("control†evel != IPPROTO_IP");

144 ià(
cm±r
->
cmsg_ty³
 !ğ
IP_RECVDSTADDR
)

145 
	`”r_qu™
("controlype != IP_RECVDSTADDR");

146 ià(
cm±r
->
cmsg_Ën
 !ğ
CONTROLLEN
)

147 
	`”r_qu™
("control†ength (%d) != %d",

148 
cm±r
->
cmsg_Ën
, 
CONTROLLEN
);

149 
	`memıy
((*è&
d¡šaddr
, (*è
	`CMSG_DATA
(
cm±r
),

150 (
š_addr
));

152 
	`´štf
(",Ø%s", 
	`INET_NTOA
(
d¡šaddr
));

156 
	`´štf
(": ");

157 
	`fæush
(
¡dout
);

160 #ifdef 
MSG_TRUNC


161 ià(
msg
.
msg_æags
 & 
MSG_TRUNC
)

162 
	`´štf
("(datagramruncated)\n");

166 iàĞ(
Ä—d
 = 
	`»ad
(
sockfd
, 
rbuf
, 
»adËn
)) < 0)

167 
	`”r_sys
("readƒrror");

168 ià(
Ä—d
 == 0) {

169 ià(
v”bo£
)

170 
	`årštf
(
¡d”r
, "connection closed by…eer\n");

175 ià(
ülf
) {

176 
Áowr™e
 = 
	`ülf_¡r
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

177 ià(
	`wr™’
(
STDOUT_FILENO
, 
wbuf
, 
Áowr™e
) !=‚towrite)

178 
	`”r_sys
("writenƒrroro stdout");

180 ià(
	`wr™’
(
STDOUT_FILENO
, 
rbuf
, 
Ä—d
) !=‚read)

181 
	`”r_sys
("writenƒrroro stdout");

186 ià(
·u£şo£
) {

187 ià(
v”bo£
)

188 
	`årštf
(
¡d”r
, "pausing before close\n");

189 
	`¦“p
(
·u£şo£
);

192 ià(
	`şo£
(
sockfd
) < 0)

193 
	`”r_sys
("closeƒrror");

194 
	}
}

197 
	$sig_ÿtch
(
signo
)

199 
	`ex™
(0);

200 
	}
}

	@osi\unpv13e\unpv13e\sock\looptcp.c

10 
	~"sock.h
"

16 
	$loİ_tı
(
sockfd
)

18 
maxfdp1
, 
Ä—d
, 
Áowr™e
, 
¡dšeof
, 
æags
;

19 
fd_£t
 
r£t
;

21 ià(
·u£š™
)

22 
	`¦“p_us
(
·u£š™
*1000);

24 
æags
 = 0;

25 
¡dšeof
 = 0;

26 
	`FD_ZERO
(&
r£t
);

27 
maxfdp1
 = 
sockfd
 + 1;

30 ià(
¡dšeof
 == 0)

31 
	`FD_SET
(
STDIN_FILENO
, &
r£t
);

32 
	`FD_SET
(
sockfd
, &
r£t
);

34 ià(
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL) < 0)

35 
	`”r_sys
("selectƒrror");

37 ià(
	`FD_ISSET
(
STDIN_FILENO
, &
r£t
)) {

38 iàĞ(
Ä—d
 = 
	`»ad
(
STDIN_FILENO
, 
rbuf
, 
»adËn
)) < 0)

39 
	`”r_sys
("readƒrror from stdin");

40 ià(
Ä—d
 == 0) {

41 ià(
h®fşo£
) {

42 ià(
	`shutdown
(
sockfd
, 
SHUT_WR
) < 0)

43 
	`”r_sys
("shutdown()ƒrror");

45 
	`FD_CLR
(
STDIN_FILENO
, &
r£t
);

46 
¡dšeof
 = 1;

52 ià(
ülf
) {

53 
Áowr™e
 = 
	`ülf_add
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

54 ià(
	`dowr™e
(
sockfd
, 
wbuf
, 
Áowr™e
) !=‚towrite)

55 
	`”r_sys
("writeƒrror");

57 ià(
	`dowr™e
(
sockfd
, 
rbuf
, 
Ä—d
) !=‚read)

58 
	`”r_sys
("writeƒrror");

62 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

64 
æags
 = 
msg³ek
;

65 
ÚûmÜe
:

66 iàĞ(
Ä—d
 = 
	`»cv
(
sockfd
, 
rbuf
, 
»adËn
, 
æags
)) < 0)

67 
	`”r_sys
("recvƒrror");

68 ià(
Ä—d
 == 0) {

69 ià(
v”bo£
)

70 
	`årštf
(
¡d”r
, "connection closed by…eer\n");

74 ià(
ülf
) {

75 
Áowr™e
 = 
	`ülf_¡r
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

76 ià(
	`wr™’
(
STDOUT_FILENO
, 
wbuf
, 
Áowr™e
) !=‚towrite)

77 
	`”r_sys
("writenƒrroro stdout");

79 ià(
	`wr™’
(
STDOUT_FILENO
, 
rbuf
, 
Ä—d
) !=‚read)

80 
	`”r_sys
("writenƒrroro stdout");

83 ià(
æags
 != 0) {

84 
æags
 = 0;

85 
ÚûmÜe
;

90 ià(
·u£şo£
) {

91 ià(
v”bo£
)

92 
	`årštf
(
¡d”r
, "pausing before close\n");

93 
	`¦“p_us
(
·u£şo£
*1000);

96 ià(
	`şo£
(
sockfd
) < 0)

97 
	`”r_sys
("closeƒrror");

98 
	}
}

	@osi\unpv13e\unpv13e\sock\loopudp.c

10 
	~"sock.h
"

16 
	$loİ_udp
(
sockfd
)

18 
maxfdp1
, 
Ä—d
, 
Áowr™e
, 
¡dšeof
,

19 
ş’
, 
£rvËn
, 
æags
;

20 
fd_£t
 
r£t
;

21 
sockaddr_š
 
şŸddr
;

22 
sockaddr_š
 
£rvaddr
;

24 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


25 
iovec
 
iov
[1];

26 
msghdr
 
msg
;

28 #ifdef 
IP_RECVDSTADDR


29 
cmsghdr
 *
cm±r
 = 
NULL
;

30 
š_addr
 
d¡šaddr
;

31 
	#CONTROLLEN
 ((
cmsghdr
è+ (
š_addr
))

	)

36 ià(
·u£š™
)

37 
	`¦“p_us
(
·u£š™
*1000);

39 
æags
 = 0;

40 
¡dšeof
 = 0;

41 
	`FD_ZERO
(&
r£t
);

42 
maxfdp1
 = 
sockfd
 + 1;

49 ià(
¡dšeof
 == 0)

50 
	`FD_SET
(
STDIN_FILENO
, &
r£t
);

51 
	`FD_SET
(
sockfd
, &
r£t
);

53 ià(
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL) < 0)

54 
	`”r_sys
("selectƒrror");

56 ià(
	`FD_ISSET
(
STDIN_FILENO
, &
r£t
)) {

57 iàĞ(
Ä—d
 = 
	`»ad
(
STDIN_FILENO
, 
rbuf
, 
»adËn
)) < 0)

58 
	`”r_sys
("readƒrror from stdin");

59 ià(
Ä—d
 == 0) {

60 ià(
h®fşo£
) {

61 ià(
	`shutdown
(
sockfd
, 
SHUT_WR
) < 0)

62 
	`”r_sys
("shutdown()ƒrror");

64 
	`FD_CLR
(
STDIN_FILENO
, &
r£t
);

65 
¡dšeof
 = 1;

71 ià(
ülf
) {

72 
Áowr™e
 = 
	`ülf_add
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

73 ià(
cÚÃùudp
) {

74 ià(
	`wr™e
(
sockfd
, 
wbuf
, 
Áowr™e
) !=‚towrite)

75 
	`”r_sys
("writeƒrror");

77 ià(
	`£ndto
(
sockfd
, 
wbuf
, 
Áowr™e
, 0,

78 (
sockaddr
 *è&
£rvaddr
, (servaddr))

79 !ğ
Áowr™e
)

80 
	`”r_sys
("sendtoƒrror");

83 ià(
cÚÃùudp
) {

84 ià(
	`wr™e
(
sockfd
, 
rbuf
, 
Ä—d
) !=‚read)

85 
	`”r_sys
("writeƒrror");

87 ià(
	`£ndto
(
sockfd
, 
rbuf
, 
Ä—d
, 0,

88 (
sockaddr
 *è&
£rvaddr
, (servaddr))

89 !ğ
Ä—d
)

90 
	`”r_sys
("sendtoƒrror");

95 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

96 ià(
£rv”
) {

97 
ş’
 = (
şŸddr
);

98 #iâdef 
HAVE_MSGHDR_MSG_CONTROL


99 
Ä—d
 = 
	`»cväom
(
sockfd
, 
rbuf
, 
»adËn
, 0,

100 (
sockaddr
 *è&
şŸddr
, &
ş’
);

106 
iov
[0].
iov_ba£
 = 
rbuf
;

107 
iov
[0].
iov_Ën
 = 
»adËn
;

108 
msg
.
msg_iov
 = 
iov
;

109 
msg
.
msg_iovËn
 = 1;

110 
msg
.
msg_Çme
 = (
ÿddr_t
è&
şŸddr
;

111 
msg
.
msg_Çm–’
 = 
ş’
;

113 #ifdef 
IP_RECVDSTADDR


114 ià(
cm±r
 =ğ
NULL
 && (cm±¸ğ
	`m®loc
(
CONTROLLEN
)) == NULL)

115 
	`”r_sys
("mallocƒrror for control buffer");

117 
msg
.
msg_cÚŒŞ
 = (
ÿddr_t
è
cm±r
;

118 
msg
.
msg_cÚŒŞËn
 = 
CONTROLLEN
;

120 
msg
.
msg_cÚŒŞ
 = (
ÿddr_t
) 0;

121 
msg
.
msg_cÚŒŞËn
 = 0;

123 
msg
.
msg_æags
 = 0;

125 
Ä—d
 = 
	`»cvmsg
(
sockfd
, &
msg
, 0);

127 ià(
Ä—d
 < 0)

128 
	`”r_sys
("datagram„eceiveƒrror");

130 ià(
v”bo£
) {

131 
	`´štf
("äom %s", 
	`INET_NTOA
(
şŸddr
.
sš_addr
));

132 #ifdef 
HAVE_MSGHDR_MSG_CONTROL


133 #ifdef 
IP_RECVDSTADDR


134 ià(
»cvd¡addr
) {

135 ià(
cm±r
->
cmsg_Ën
 !ğ
CONTROLLEN
)

136 
	`”r_qu™
("control†ength (%d) != %d",

137 
cm±r
->
cmsg_Ën
, 
CONTROLLEN
);

138 ià(
cm±r
->
cmsg_Ëv–
 !ğ
IPPROTO_IP
)

139 
	`”r_qu™
("control†evel != IPPROTO_IP");

140 ià(
cm±r
->
cmsg_ty³
 !ğ
IP_RECVDSTADDR
)

141 
	`”r_qu™
("controlype != IP_RECVDSTADDR");

142 
	`memıy
(&
d¡šaddr
, 
	`CMSG_DATA
(
cm±r
),

143 (
š_addr
));

144 
	`bz”o
(
cm±r
, 
CONTROLLEN
);

146 
	`´štf
(",Ø%s", 
	`INET_NTOA
(
d¡šaddr
));

150 
	`´štf
(": ");

151 
	`fæush
(
¡dout
);

154 #ifdef 
MSG_TRUNC


155 ià(
msg
.
msg_æags
 & 
MSG_TRUNC
)

156 
	`´štf
("(datagramruncated)\n");

159 } ià(
cÚÃùudp
) {

161 
æags
 = 
msg³ek
;

162 
ÚûmÜe
:

163 iàĞ(
Ä—d
 = 
	`»cv
(
sockfd
, 
rbuf
, 
»adËn
, 
æags
)) < 0)

164 
	`”r_sys
("recvƒrror");

165 ià(
Ä—d
 == 0) {

166 ià(
v”bo£
)

167 
	`årštf
(
¡d”r
, "connection closed by…eer\n");

173 
£rvËn
 = (
£rvaddr
);

174 
Ä—d
 = 
	`»cväom
(
sockfd
, 
rbuf
, 
»adËn
, 0,

175 (
sockaddr
 *è&
£rvaddr
, &
£rvËn
);

176 ià(
Ä—d
 < 0)

177 
	`”r_sys
("datagram„ecvfrom()ƒrror");

179 ià(
v”bo£
) {

180 
	`´štf
("äom %s", 
	`INET_NTOA
(
£rvaddr
.
sš_addr
));

181 
	`´štf
(": ");

182 
	`fæush
(
¡dout
);

186 ià(
ülf
) {

187 
Áowr™e
 = 
	`ülf_¡r
(
wbuf
, 
wr™–’
, 
rbuf
, 
Ä—d
);

188 ià(
	`wr™’
(
STDOUT_FILENO
, 
wbuf
, 
Áowr™e
) !=‚towrite)

189 
	`”r_sys
("writenƒrroro stdout");

191 ià(
	`wr™’
(
STDOUT_FILENO
, 
rbuf
, 
Ä—d
) !=‚read)

192 
	`”r_sys
("writenƒrroro stdout");

195 ià(
æags
 != 0) {

196 
æags
 = 0;

197 
ÚûmÜe
;

202 ià(
·u£şo£
) {

203 ià(
v”bo£
)

204 
	`årštf
(
¡d”r
, "pausing before close\n");

205 
	`¦“p_us
(
·u£şo£
*1000);

208 ià(
	`şo£
(
sockfd
) < 0)

209 
	`”r_sys
("closeƒrror");

210 
	}
}

	@osi\unpv13e\unpv13e\sock\main.c

10 
	~"sock.h
"

12 *
	gho¡
;

13 *
	gpÜt
;

16 
	gbšdpÜt
;

18 
	gbrßdÿ¡
;

19 
	gcb»ak
;

20 
	gchunkwr™e
;

21 
	gş›Á
 = 1;

22 
	gcÚÃùudp
 = 1;

23 
	gülf
;

24 
	gdebug
;

25 
	gdofÜk
;

26 
	gdÚŒou‹
;

27 
	gfÜeign
[32];

28 
	gfÜeigÅÜt
;

29 
	gh®fşo£
;

30 
	gignÜew”r
;

31 
	gtos
 = -1;

32 
	g‰l
 = -1;

33 
	gjoš
[32];

34 
	gk“·live
;

35 
	glšg”
 = -1;

36 
	gli¡’q
 = 5;

37 
	gloÿl
[32];

38 
	gmax£g
;

39 
	gmÿ¡‰l
;

40 
	gmsg³ek
;

41 
	gnod–ay
;

42 
	gnbuf
 = 1024;

43 
	gÚesbÿ¡
;

44 
	g·u£şo£
;

45 
	g·u£š™
;

46 
	g·u£li¡’
;

47 
	g·u£rw
;

48 
	g»u£addr
;

49 
	g»u£pÜt
;

50 
	g»adËn
 = 1024;

51 
	gwr™–’
 = 1024;

52 
	g»cvd¡addr
;

53 
	grcvbuæ’
;

54 
	g¢dbuæ’
;

55 
	grcvtimeo
;

56 
	g¢dtimeo
;

57 
	g¤ou‹_út
;

58 *
	grbuf
;

59 *
	gwbuf
;

60 
	g£rv”
;

61 
	gsigio
;

62 
	gsourûsšk
;

63 
	gudp
;

64 
	gurgwr™e
;

65 
	gv”bo£
;

66 
	gu£wr™ev
;

68 
sockaddr_š
 
	gşŸddr
, 
	g£rvaddr
;

70 
u§ge
(const *);

73 
	$maš
(
¬gc
, *
¬gv
[])

75 
c
, 
fd
;

76 *
±r
;

78 ià(
¬gc
 < 2)

79 
	`u§ge
("");

81 
İ‹¼
 = 0;

82  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "2b:cf:g:hij:kl:n:op:q:r:st:uvw:x:y:ABCDEFG:H:IJ:KL:NO:P:Q:R:S:TU:VWX:YZ")) != -1) {

83 
c
) {

84 #ifdef 
IP_ONESBCAST


86 
Úesbÿ¡
 = 1;

91 
bšdpÜt
 = 
	`©oi
(
İrg
);

95 
ülf
 = 1;

99 iàĞ(
±r
 = 
	`¡¼chr
(
İrg
, '.')è=ğ
NULL
)

100 
	`u§ge
("invalid -f option");

102 *
±r
++ = 0;

103 
fÜeigÅÜt
 = 
	`©oi
(
±r
);

104 
	`¡rıy
(
fÜeign
, 
İrg
);

108 
	`¤ou‹_doİt
(0, 
İrg
);

112 
h®fşo£
 = 1;

116 
sourûsšk
 = 1;

119 #ifdef 
IP_ADD_MEMBERSHIP


121 
	`¡rıy
(
još
, 
İrg
);

126 
chunkwr™e
 = 1;

130 iàĞ(
±r
 = 
	`¡¼chr
(
İrg
, '.')è=ğ
NULL
)

131 
	`u§ge
("invalid -l option");

133 *
±r
++ = 0;

134 
bšdpÜt
 = 
	`©oi
(
±r
);

135 
	`¡rıy
(
loÿl
, 
İrg
);

139 
nbuf
 = 
	`©Ş
(
İrg
);

143 
cÚÃùudp
 = 0;

147 
·u£rw
 = 
	`©oi
(
İrg
);

151 
li¡’q
 = 
	`©oi
(
İrg
);

155 
»adËn
 = 
	`©oi
(
İrg
);

159 
£rv”
 = 1;

160 
ş›Á
 = 0;

163 #ifdef 
IP_MULTICAST_TTL


165 
mÿ¡‰l
 = 
	`©oi
(
İrg
);

170 
udp
 = 1;

174 
v”bo£
++;

178 
wr™–’
 = 
	`©oi
(
İrg
);

182 
rcvtimeo
 = 
	`©Ş
(
İrg
);

186 
¢dtimeo
 = 
	`©Ş
(
İrg
);

190 
»u£addr
 = 1;

194 
brßdÿ¡
 = 1;

198 
cb»ak
 = 1;

202 
debug
 = 1;

206 
»cvd¡addr
 = 1;

210 
dofÜk
 = 1;

214 
	`¤ou‹_doİt
(1, 
İrg
);

217 #ifdef 
IP_TOS


219 
tos
 = 
	`©oi
(
İrg
);

224 
sigio
 = 1;

227 #ifdef 
IP_TTL


229 
‰l
 = 
	`©oi
(
İrg
);

234 
k“·live
 = 1;

238 
lšg”
 = 
	`©Ş
(
İrg
);

242 
nod–ay
 = 1;

246 
·u£li¡’
 = 
	`©oi
(
İrg
);

250 
·u£š™
 = 
	`©oi
(
İrg
);

254 
·u£şo£
 = 
	`©oi
(
İrg
);

258 
rcvbuæ’
 = 
	`©oi
(
İrg
);

262 
¢dbuæ’
 = 
	`©oi
(
İrg
);

265 #ifdef 
SO_REUSEPORT


267 
»u£pÜt
 = 1;

272 
urgwr™e
 = 
	`©oi
(
İrg
);

276 
u£wr™ev
 = 1;

277 
chunkwr™e
 = 1;

281 
ignÜew”r
 = 1;

285 
max£g
 = 
	`©oi
(
İrg
);

289 
dÚŒou‹
 = 1;

293 
msg³ek
 = 
MSG_PEEK
;

297 
	`u§ge
("unrecognized option");

302 ià(
udp
 && 
h®fşo£
)

303 
	`u§ge
("can't specify -h‡nd -u");

304 ià(
udp
 && 
debug
)

305 
	`u§ge
("can't specify -D‡nd -u");

306 ià(
udp
 && 
lšg”
 >= 0)

307 
	`u§ge
("can't specify -L‡nd -u");

308 ià(
udp
 && 
nod–ay
)

309 
	`u§ge
("can't specify -N‡nd -u");

310 #ifdef 
nÙdef


311 ià(
udp
 =ğ0 && 
brßdÿ¡
)

312 
	`u§ge
("can't specify -B with TCP");

314 ià(
udp
 =ğ0 && 
fÜeign
[0] != 0)

315 
	`u§ge
("can't specify -f with TCP");

317 ià(
ş›Á
) {

318 ià(
İtšd
 !ğ
¬gc
-2)

319 
	`u§ge
("missing <hostname>‡nd/or <port>");

320 
ho¡
 = 
¬gv
[
İtšd
];

321 
pÜt
 = 
¬gv
[
İtšd
+1];

326 ià(
İtšd
 =ğ
¬gc
-2) {

327 
ho¡
 = 
¬gv
[
İtšd
];

328 
pÜt
 = 
¬gv
[
İtšd
+1];

329 } ià(
İtšd
 =ğ
¬gc
-1) {

330 
ho¡
 = 
NULL
;

331 
pÜt
 = 
¬gv
[
İtšd
];

333 
	`u§ge
("missing <port>");

336 ià(
ş›Á
)

337 
fd
 = 
	`şiİ’
(
ho¡
, 
pÜt
);

339 
fd
 = 
	`£rvİ’
(
ho¡
, 
pÜt
);

341 ià(
sourûsšk
) {

342 ià(
ş›Á
) {

343 ià(
udp
)

344 
	`sourû_udp
(
fd
);

346 
	`sourû_tı
(
fd
);

348 ià(
udp
)

349 
	`sšk_udp
(
fd
);

351 
	`sšk_tı
(
fd
);

355 ià(
udp
)

356 
	`loİ_udp
(
fd
);

358 
	`loİ_tı
(
fd
);

361 
	`ex™
(0);

362 
	}
}

365 
	$u§ge
(cÚ¡ *
msg
)

367 
	`”r_msg
(

378 #ifdef 
IP_ADD_MEMBERSHIP


389 #ifdef 
IP_MULTICAST_TTL


404 #ifdef 
IP_TOS


408 #ifdef 
IP_TTL


419 #ifdef 
SO_REUSEPORT


428 #ifdef 
IP_ONESBCAST


433 ià(
msg
[0] != 0)

434 
	`”r_qu™
("%s", 
msg
);

435 
	`ex™
(1);

436 
	}
}

	@osi\unpv13e\unpv13e\sock\multicast.c

10 
	~"sock.h
"

13 
	$još_mÿ¡
(
fd
, 
sockaddr_š
 *
sš
)

15 #ifdef 
IP_ADD_MEMBERSHIP


16 
u_lÚg
 
šaddr
;

17 
_m»q
 
m»q
;

19 
šaddr
 = 
sš
->
sš_addr
.
s_addr
;

20 ià(
	`IN_MULTICAST
(
šaddr
) == 0)

23 
m»q
.
imr_muÉŸddr
.
s_addr
 = 
šaddr
;

24 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

25 ià(
	`£tsockİt
(
fd
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, &
m»q
,

26 (
m»q
)) == -1 )

27 
	`”r_sys
("IP_ADD_MEMBERSHIPƒrror");

29 ià(
v”bo£
)

30 
	`årštf
(
¡d”r
, "multicast group joined\n");

32 
	}
}

	@osi\unpv13e\unpv13e\sock\ourhdr.h

3 #iâdef 
__ourhdr_h


4 
	#__ourhdr_h


	)

6 
	~<sys/ty³s.h
>

7 
	~<¡dio.h
>

8 
	~<¡dlib.h
>

9 
	~<¡ršg.h
>

10 
	~<uni¡d.h
>

12 #ifdef 
nÙdef


13 
	tssize_t
;

16 #ifdef 
nÙdef


17 *
İrg
;

18 
İtšd
, 
İ‹¼
, 
İtİt
;

21 #ifdef 
nÙdef


22 
	#£nd
(
a
,
b
,
c
,
d
è
	`£ndto
(×), (b), (c), (d), (
sockaddr
 *è
NULL
, 0)

	)

25 
	#MAXLINE
 4096

	)

27 
	#FILE_MODE
 (
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
)

	)

29 
	#DIR_MODE
 (
FILE_MODE
 | 
S_IXUSR
 | 
S_IXGRP
 | 
S_IXOTH
)

	)

32 
	tSigfunc
();

35 #if 
defšed
(
SIG_IGN
è&& !defšed(
SIG_ERR
)

36 
	#SIG_ERR
 ((
Sigfunc
 *)-1)

	)

39 
	#mš
(
a
,
b
è(×è< (bè? (aè: (b))

	)

40 
	#max
(
a
,
b
è(×è> (bè? (aè: (b))

	)

43 *
·th_®loc
(*);

44 
İ’_max
();

45 
şr_æ
(, );

46 
£t_æ
(, );

47 
´_ex™
();

48 
´_mask
(const *);

49 
Sigfunc
 *
sigÇl_šŒ
(, Sigfunc *);

51 
‰y_cb»ak
();

52 
‰y_¿w
();

53 
‰y_»£t
();

54 
‰y_©ex™
();

55 #ifdef 
ECHO


56 
‹rmios
 *
‰y_‹rmios
();

59 
¦“p_us
();

60 
ssize_t
 
»adn
(, *, 
size_t
);

61 
ssize_t
 
wr™’
(, cÚ¡ *, 
size_t
);

62 
d«mÚ_š™
();

64 
s_pe
(*);

65 
»cv_fd
(, 
	$ssize_t
 (*
func
)(, cÚ¡ *, 
size_t
));

67 
	`£nd_fd
(, );

68 
	`£nd_”r
(, , const *);

69 
	`£rv_li¡’
(const *);

70 
	`£rv_acû±
(, 
uid_t
 *);

71 
	`şi_cÚn
(const *);

72 
	`buf_¬gs
(*, (*
func
)(, **));

75 
	`±ym_İ’
(*);

76 
	`±ys_İ’
(, *);

77 #ifdef 
TIOCGWINSZ


78 
pid_t
 
	`±y_fÜk
(*, *, cÚ¡ 
‹rmios
 *,

79 cÚ¡ 
wšsize
 *);

82 
	`lock_»g
(, , , 
off_t
, , off_t);

84 
	#»ad_lock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

85 
	`lock_»g
(
fd
, 
F_SETLK
, 
F_RDLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

86 
	#»adw_lock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

87 
	`lock_»g
(
fd
, 
F_SETLKW
, 
F_RDLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

88 
	#wr™e_lock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

89 
	`lock_»g
(
fd
, 
F_SETLK
, 
F_WRLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

90 
	#wr™ew_lock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

91 
	`lock_»g
(
fd
, 
F_SETLKW
, 
F_WRLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

92 
	#un_lock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

93 
	`lock_»g
(
fd
, 
F_SETLK
, 
F_UNLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

95 
pid_t
 
	`lock_‹¡
(, , 
off_t
, , off_t);

98 
	#is_»adlock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

99 
	`lock_‹¡
(
fd
, 
F_RDLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

100 
	#is_wr™–ock
(
fd
, 
off£t
, 
wh’û
, 
Ën
) \

101 
	`lock_‹¡
(
fd
, 
F_WRLCK
, 
off£t
, 
wh’û
, 
Ën
)

	)

103 
	`”r_dump
(const *, ...);

104 
	`”r_msg
(const *, ...);

105 
	`”r_qu™
(const *, ...);

106 
	`”r_»t
(const *, ...);

107 
	`”r_sys
(const *, ...);

109 
	`log_msg
(const *, ...);

110 
	`log_İ’
(const *, , );

111 
	`log_qu™
(const *, ...);

112 
	`log_»t
(const *, ...);

113 
	`log_sys
(const *, ...);

115 
	`TELL_WAIT
();

116 
	`TELL_PARENT
(
pid_t
);

117 
	`TELL_CHILD
(
pid_t
);

118 
	`WAIT_PARENT
();

119 
	`WAIT_CHILD
();

	@osi\unpv13e\unpv13e\sock\pattern.c

10 
	~"sock.h
"

11 
	~<ùy³.h
>

14 
	$·‰”n
(*
±r
, 
Ën
)

16 
c
;

18 
c
 = 0;

19 
Ën
-- > 0) {

20 
	`i¥ršt
((
c
 & 0x7F)) == 0)

21 
c
++;

22 *
±r
++ = (
c
++ & 0x7F);

24 
	}
}

	@osi\unpv13e\unpv13e\sock\servopen.c

10 
	~"sock.h
"

13 
	$£rvİ’
(*
ho¡
, *
pÜt
)

15 
fd
, 
Ãwfd
, 
i
, 
Ú
, 
pid
;

16 cÚ¡ *
´ÙocŞ
;

17 
š_addr
 
šaddr
;

18 
£rv’t
 *
¥
;

20 
´ÙocŞ
 = 
udp
 ? "udp" : "tcp";

23 
	`bz”o
(&
£rvaddr
, (servaddr));

24 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

29 ià(
ho¡
 =ğ
NULL
)

30 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

32 ià(
	`š‘_©Ú
(
ho¡
, &
šaddr
) == 0)

33 
	`”r_qu™
("šv®id ho¡‚amfÜ s”v”: %s", 
ho¡
);

34 
£rvaddr
.
sš_addr
 = 
šaddr
;

38 iàĞ(
i
 = 
	`©oi
(
pÜt
)) == 0) {

39 iàĞ(
¥
 = 
	`g‘£rvbyÇme
(
pÜt
, 
´ÙocŞ
)è=ğ
NULL
)

40 
	`”r_»t
("g‘£rvbyÇme(è”rÜ fÜ: %s/%s", 
pÜt
, 
´ÙocŞ
);

42 
£rvaddr
.
sš_pÜt
 = 
¥
->
s_pÜt
;

44 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
i
);

46 iàĞ(
fd
 = 
	`sock‘
(
AF_INET
, 
udp
 ? 
SOCK_DGRAM
 : 
SOCK_STREAM
, 0)) < 0)

47 
	`”r_sys
("socket()ƒrror");

49 ià(
»u£addr
) {

50 
Ú
 = 1;

51 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on)) < 0)

52 
	`”r_sys
("setsockopt of SO_REUSEADDRƒrror");

55 #ifdef 
SO_REUSEPORT


56 ià(
»u£pÜt
) {

57 
Ú
 = 1;

58 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEPORT
, &
Ú
, (on)) < 0)

59 
	`”r_sys
("setsockopt of SO_REUSEPORTƒrror");

64 ià(
	`bšd
(
fd
, (
sockaddr
 *è&
£rvaddr
, (servaddr)) < 0)

65 
	`”r_sys
("can't bind†ocal‡ddress");

67 
	`još_mÿ¡
(
fd
, &
£rvaddr
);

69 ià(
udp
) {

70 
	`bufãrs
(
fd
);

72 ià(
fÜeign
[0] != 0) {

73 
	`bz”o
(&
şŸddr
, (cliaddr));

74 ià(
	`š‘_©Ú
(
fÜeign
, &
şŸddr
.
sš_addr
) == 0)

75 
	`”r_qu™
("šv®id IP‡dd»ss: %s", 
fÜeign
);

76 
şŸddr
.
sš_çmy
 = 
AF_INET
;

77 
şŸddr
.
sš_pÜt
 = 
	`htÚs
(
fÜeigÅÜt
);

81 ià(
	`cÚÃù
(
fd
, (
sockaddr
 *è&
şŸddr
, (cliaddr))

83 
	`”r_sys
("connect()ƒrror");

87 
	`sockİts
(
fd
, 1);

89 (
fd
);

92 
	`bufãrs
(
fd
);

94 
	`sockİts
(
fd
, 0);

96 
	`li¡’
(
fd
, 
li¡’q
);

98 ià(
·u£li¡’
)

99 
	`¦“p_us
(
·u£li¡’
*1000);

101 ià(
dofÜk
)

102 
	`TELL_WAIT
();

105 
i
 = (
şŸddr
);

106 iàĞ(
Ãwfd
 = 
	`acû±
(
fd
, (
sockaddr
 *è&
şŸddr
, &
i
)) < 0)

107 
	`”r_sys
("accept()ƒrror");

109 ià(
dofÜk
) {

110 iàĞ(
pid
 = 
	`fÜk
()) < 0)

111 
	`”r_sys
("forkƒrror");

113 ià(
pid
 > 0) {

114 
	`şo£
(
Ãwfd
);

115 
	`WAIT_CHILD
();

118 
	`şo£
(
fd
);

123 ià(
v”bo£
) {

126 
i
 = (
£rvaddr
);

127 ià(
	`g‘sockÇme
(
Ãwfd
, (
sockaddr
 *è&
£rvaddr
, &
i
) < 0)

128 
	`”r_sys
("getsockname()ƒrror");

132 
	`årštf
(
¡d”r
, "connection on %s.%d ",

133 
	`INET_NTOA
(
£rvaddr
.
sš_addr
), 
	`Áohs
(£rvaddr.
sš_pÜt
));

134 
	`årštf
(
¡d”r
, "from %s.%d\n",

135 
	`INET_NTOA
(
şŸddr
.
sš_addr
), 
	`Áohs
(şŸddr.
sš_pÜt
));

138 
	`bufãrs
(
Ãwfd
);

140 
	`sockİts
(
Ãwfd
, 1);

142 ià(
dofÜk
)

143 
	`TELL_PARENT
(
	`g‘µid
());

145 (
Ãwfd
);

147 
	}
}

	@osi\unpv13e\unpv13e\sock\sinktcp.c

10 
	~"sock.h
"

13 
	$sšk_tı
(
sockfd
)

15 
n
, 
æags
;

17 ià(
·u£š™
)

18 
	`¦“p_us
(
·u£š™
*1000);

22 
æags
 = 
msg³ek
;

23 
ÚûmÜe
:

24 iàĞ(
n
 = 
	`»cv
(
sockfd
, 
rbuf
, 
»adËn
, 
æags
)) < 0) {

25 
	`”r_sys
("recvƒrror");

27 } ià(
n
 == 0) {

28 ià(
v”bo£
)

29 
	`årštf
(
¡d”r
, "connection closed by…eer\n");

32 #ifdef 
nÙdef


33 } ià(
n
 !ğ
»adËn
)

34 
	`”r_qu™
("»ad„‘uºed %d,ƒx³ùed %d", 
n
, 
»adËn
);

39 ià(
v”bo£
)

40 
	`årštf
(
¡d”r
, "»ûived %d by‹s%s\n", 
n
,

41 (
æags
 =ğ
MSG_PEEK
) ? " (MSG_PEEK)" : "");

43 ià(
·u£rw
)

44 
	`¦“p_us
(
·u£rw
*1000);

46 ià(
æags
 != 0) {

47 
æags
 = 0;

48 
ÚûmÜe
;

52 ià(
·u£şo£
) {

53 ià(
v”bo£
)

54 
	`årštf
(
¡d”r
, "pausing before close\n");

55 
	`¦“p_us
(
·u£şo£
*1000);

58 ià(
	`şo£
(
sockfd
) < 0)

59 
	`”r_sys
("closeƒrror");

60 
	}
}

	@osi\unpv13e\unpv13e\sock\sinkudp.c

10 
	~"sock.h
"

13 
	$sšk_udp
(
sockfd
)

15 
n
, 
æags
;

17 ià(
·u£š™
)

18 
	`¦“p_us
(
·u£š™
*1000);

22 
æags
 = 
msg³ek
;

23 
ÚûmÜe
:

24 iàĞ(
n
 = 
	`»cv
(
sockfd
, 
rbuf
, 
»adËn
, 
æags
)) < 0) {

25 
	`”r_sys
("recvƒrror");

27 } ià(
n
 == 0) {

28 ià(
v”bo£
)

29 
	`årštf
(
¡d”r
, "connection closed by…eer\n");

32 #ifdef 
nÙdef


33 } ià(
n
 !ğ
»adËn
)

34 
	`”r_qu™
("»ad„‘uºed %d,ƒx³ùed %d", 
n
, 
»adËn
);

39 ià(
v”bo£
) {

40 
	`årštf
(
¡d”r
, "»ûived %d by‹s%s\n", 
n
,

41 (
æags
 =ğ
MSG_PEEK
) ? " (MSG_PEEK)" : "");

42 ià(
v”bo£
 > 1) {

43 
	`årštf
(
¡d”r
, "´štšg %d by‹s\n", 
n
);

44 
rbuf
[
n
] = 0;

45 
	`årštf
(
¡d”r
, "SDAP h—d”: %lx\n", *((*è
rbuf
));

46 
	`årštf
(
¡d”r
, "ÃxˆlÚg: %lx\n", *((*è
rbuf
+4));

47 
	`åuts
(&
rbuf
[8], 
¡d”r
);

51 ià(
·u£rw
)

52 
	`¦“p_us
(
·u£rw
*1000);

54 ià(
æags
 != 0) {

55 
æags
 = 0;

56 
ÚûmÜe
;

60 ià(
·u£şo£
) {

61 ià(
v”bo£
)

62 
	`årštf
(
¡d”r
, "pausing before close\n");

63 
	`¦“p_us
(
·u£şo£
*1000);

66 ià(
	`şo£
(
sockfd
) < 0)

67 
	`”r_sys
("closeƒrror");

68 
	}
}

	@osi\unpv13e\unpv13e\sock\sleepus.c

1 
	~<sys/ty³s.h
>

2 
	~<sys/time.h
>

3 
	~<”ºo.h
>

4 
	~<¡ddef.h
>

5 
	~"ourhdr.h
"

8 
	$¦“p_us
(
nu£cs
)

10 
timev®
 
tv®
;

13 
tv®
.
tv_£c
 = 
nu£cs
 / 1000000;

14 
tv®
.
tv_u£c
 = 
nu£cs
 % 1000000;

15 ià(
	`£Ëù
(0, 
NULL
, NULL, NULL, &
tv®
) == 0)

25 ià(
”ºo
 =ğ
EINTR
)

27 
	`”r_sys
("sleep_us: selectƒrror");

29 
	}
}

	@osi\unpv13e\unpv13e\sock\sock.h

10 
	~"uÅ.h
"

12 
	~<sys/uio.h
>

13 #ifdef 
__bsdi__


14 
	~<machše/’dŸn.h
>

16 
	~<Ãtš‘/tı.h
>

17 
	~<Ãtdb.h
>

20 
bšdpÜt
;

21 
brßdÿ¡
;

22 
cb»ak
;

23 
chunkwr™e
;

24 
ş›Á
;

25 
cÚÃùudp
;

26 
ülf
;

27 
debug
;

28 
dofÜk
;

29 
dÚŒou‹
;

30 
fÜeign
[];

31 
fÜeigÅÜt
;

32 
h®fşo£
;

33 
ignÜew”r
;

34 
tos
;

35 
‰l
;

36 
još
[];

37 
k“·live
;

38 
lšg”
;

39 
li¡’q
;

40 
loÿl
[];

41 
max£g
;

42 
mÿ¡‰l
;

43 
msg³ek
;

44 
nod–ay
;

45 
nbuf
;

46 
Úesbÿ¡
;

47 
·u£şo£
;

48 
·u£š™
;

49 
·u£li¡’
;

50 
·u£rw
;

51 
»u£addr
;

52 
»u£pÜt
;

53 
»adËn
;

54 
wr™–’
;

55 
»cvd¡addr
;

56 
rcvbuæ’
;

57 
¢dbuæ’
;

58 
rcvtimeo
;

59 
¢dtimeo
;

60 *
rbuf
;

61 *
wbuf
;

62 
£rv”
;

63 
sigio
;

64 
sourûsšk
;

65 
¤ou‹_út
;

66 
udp
;

67 
urgwr™e
;

68 
v”bo£
;

69 
u£wr™ev
;

71 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

77 #if 
defšed
(
sun
è&& defšed(
__GNUC__
è&& defšed(
GCC_STRUCT_PROBLEM
)

78 
	#INET_NTOA
(
foo
è
	`š‘_Áß
(&foo)

	)

80 
	#INET_NTOA
(
foo
è
	`š‘_Áß
(foo)

	)

84 
bufãrs
();

85 
şiİ’
(*, *);

86 
ülf_add
(*, , const *, );

87 
ülf_¡r
(*, , const *, );

88 
još_mÿ¡
(, 
sockaddr_š
 *);

89 
loİ_tı
();

90 
loİ_udp
();

91 
·‰”n
(*, );

92 
£rvİ’
(*, *);

93 
sšk_tı
();

94 
sšk_udp
();

95 
sourû_tı
();

96 
sourû_udp
();

97 
¤ou‹_doİt
(, *);

98 
¤ou‹_£t
();

99 
¦“p_us
();

100 
sockİts
(, );

101 
ssize_t
 
dowr™e
(, cÚ¡ *, 
size_t
);

103 
TELL_WAIT
();

104 
TELL_PARENT
(
pid_t
);

105 
WAIT_PARENT
();

106 
TELL_CHILD
(
pid_t
);

107 
WAIT_CHILD
();

	@osi\unpv13e\unpv13e\sock\sockopts.c

10 
	~"sock.h
"

11 
	~<fú.h
>

12 
	~<sys/ioùl.h
>

15 
	$sockİts
(
sockfd
, 
dßÎ
)

17 
İtiÚ
, 
İ’
;

18 
lšg”
 
lšg
;

19 
timev®
 
tim”
;

25 ià(
debug
) {

26 
İtiÚ
 = 1;

27 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_DEBUG
,

28 &
İtiÚ
, (option)) < 0)

29 
	`”r_sys
("SO_DEBUG setsockoptƒrror");

31 
İtiÚ
 = 0;

32 
İ’
 = (
İtiÚ
);

33 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_DEBUG
,

34 &
İtiÚ
, &
İ’
) < 0)

35 
	`”r_sys
("SO_DEBUG getsockoptƒrror");

36 ià(
İtiÚ
 == 0)

37 
	`”r_qu™
("SO_DEBUG‚Ù s‘ (%d)", 
İtiÚ
);

39 ià(
v”bo£
)

40 
	`årštf
(
¡d”r
, "SO_DEBUG set\n");

43 ià(
dÚŒou‹
) {

44 
İtiÚ
 = 1;

45 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_DONTROUTE
,

46 &
İtiÚ
, (option)) < 0)

47 
	`”r_sys
("SO_DONTROUTE setsockoptƒrror");

49 
İtiÚ
 = 0;

50 
İ’
 = (
İtiÚ
);

51 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_DONTROUTE
,

52 &
İtiÚ
, &
İ’
) < 0)

53 
	`”r_sys
("SO_DONTROUTE getsockoptƒrror");

54 ià(
İtiÚ
 == 0)

55 
	`”r_qu™
("SO_DONTROUTE‚Ù s‘ (%d)", 
İtiÚ
);

57 ià(
v”bo£
)

58 
	`årštf
(
¡d”r
, "SO_DONTROUTE set\n");

61 #ifdef 
IP_TOS


62 ià(
tos
 !ğ-1 && 
dßÎ
 == 0) {

63 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_TOS
,

64 &
tos
, (iptos)) < 0)

65 
	`”r_sys
("IP_TOS setsockoptƒrror");

67 
İtiÚ
 = 0;

68 
İ’
 = (
İtiÚ
);

69 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_TOS
,

70 &
İtiÚ
, &
İ’
) < 0)

71 
	`”r_sys
("IP_TOS getsockoptƒrror");

72 ià(
İtiÚ
 !ğ
tos
)

73 
	`”r_qu™
("IP_TOS‚Ù s‘ (%d)", 
İtiÚ
);

75 ià(
v”bo£
)

76 
	`årštf
(
¡d”r
, "IP_TOS s‘Ø%d\n", 
tos
);

80 #ifdef 
IP_TTL


81 ià(
‰l
 !ğ-1 && 
dßÎ
 == 0) {

82 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_TTL
,

83 &
‰l
, (ipttl)) < 0)

84 
	`”r_sys
("IP_TTL setsockoptƒrror");

86 
İtiÚ
 = 0;

87 
İ’
 = (
İtiÚ
);

88 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_TTL
,

89 &
İtiÚ
, &
İ’
) < 0)

90 
	`”r_sys
("IP_TTL getsockoptƒrror");

91 ià(
İtiÚ
 !ğ
‰l
)

92 
	`”r_qu™
("IP_TTL‚Ù s‘ (%d)", 
İtiÚ
);

94 ià(
v”bo£
)

95 
	`årštf
(
¡d”r
, "IP_TTL s‘Ø%d\n", 
‰l
);

99 ià(
max£g
 && 
udp
 == 0) {

103 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
,

104 &
max£g
, (maxseg)) < 0)

105 
	`”r_sys
("TCP_MAXSEG setsockoptƒrror");

107 
İtiÚ
 = 0;

108 
İ’
 = (
İtiÚ
);

109 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
,

110 &
İtiÚ
, &
İ’
) < 0)

111 
	`”r_sys
("TCP_MAXSEG getsockoptƒrror");

113 ià(
v”bo£
)

114 
	`årštf
(
¡d”r
, "TCP_MAXSEG = %d\n", 
İtiÚ
);

117 ià(
¤ou‹_út
 > 0)

118 
	`¤ou‹_£t
(
sockfd
);

120 ià(
brßdÿ¡
) {

121 
İtiÚ
 = 1;

122 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
,

123 &
İtiÚ
, (option)) < 0)

124 
	`”r_sys
("SO_BROADCAST setsockoptƒrror");

126 
İtiÚ
 = 0;

127 
İ’
 = (
İtiÚ
);

128 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_BROADCAST
,

129 &
İtiÚ
, &
İ’
) < 0)

130 
	`”r_sys
("SO_BROADCAST getsockoptƒrror");

131 ià(
İtiÚ
 == 0)

132 
	`”r_qu™
("SO_BROADCAST‚Ù s‘ (%d)", 
İtiÚ
);

134 ià(
v”bo£
)

135 
	`årštf
(
¡d”r
, "SO_BROADCAST set\n");

137 #ifdef 
IP_ONESBCAST


138 ià(
Úesbÿ¡
) {

139 
İtiÚ
 = 1;

140 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ONESBCAST
,

141 &
İtiÚ
, (option)) < 0)

142 
	`”r_sys
("IP_ONESBCAST setsockoptƒrror");

144 
İtiÚ
 = 0;

145 
İ’
 = (
İtiÚ
);

146 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ONESBCAST
,

147 &
İtiÚ
, &
İ’
) < 0)

148 
	`”r_sys
("IP_ONESBCAST getsockoptƒrror");

149 ià(
İtiÚ
 == 0)

150 
	`”r_qu™
("IP_ONESBCAST‚Ù s‘ (%d)", 
İtiÚ
);

152 ià(
v”bo£
)

153 
	`årštf
(
¡d”r
, "IP_ONESBCAST set\n");

158 #ifdef 
IP_ADD_MEMBERSHIP


159 ià(
još
[0]) {

160 
_m»q
 
još
;

162 ià(
	`š‘_©Ú
(
još
, &
još
.
imr_muÉŸddr
) == 0)

163 
	`”r_qu™
("šv®id muÉiÿ¡‡dd»ss: %s", 
još
);

164 
još
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

165 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
,

166 &
još
, (join)) < 0)

167 
	`”r_sys
("IP_ADD_MEMBERSHIP setsockoptƒrror");

169 ià(
v”bo£
)

170 
	`årštf
(
¡d”r
, "IP_ADD_MEMBERSHIP set\n");

174 #ifdef 
IP_MULTICAST_TTL


175 ià(
mÿ¡‰l
) {

176 
u_ch¬
 
‰l
 = 
mÿ¡‰l
;

178 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

179 &
‰l
, (ttl)) < 0)

180 
	`”r_sys
("IP_MULTICAST_TTL setsockoptƒrror");

182 
İ’
 = (
‰l
);

183 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
,

184 &
‰l
, &
İ’
) < 0)

185 
	`”r_sys
("IP_MULTICAST_TTL getsockoptƒrror");

186 ià(
‰l
 !ğ
mÿ¡‰l
)

187 
	`”r_qu™
("IP_MULTICAST_TTL‚Ù s‘ (%d)", 
‰l
);

189 ià(
v”bo£
)

190 
	`årštf
(
¡d”r
, "IP_MULTICAST_TTL s‘Ø%d\n", 
‰l
);

194 ià(
k“·live
 && 
dßÎ
 && 
udp
 == 0) {

195 
İtiÚ
 = 1;

196 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
,

197 &
İtiÚ
, (option)) < 0)

198 
	`”r_sys
("SO_KEEPALIVE setsockoptƒrror");

200 
İtiÚ
 = 0;

201 
İ’
 = (
İtiÚ
);

202 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
,

203 &
İtiÚ
, &
İ’
) < 0)

204 
	`”r_sys
("SO_KEEPALIVE getsockoptƒrror");

205 ià(
İtiÚ
 == 0)

206 
	`”r_qu™
("SO_KEEPALIVE‚Ù s‘ (%d)", 
İtiÚ
);

208 ià(
v”bo£
)

209 
	`årštf
(
¡d”r
, "SO_KEEPALIVE set\n");

212 ià(
nod–ay
 && 
dßÎ
 && 
udp
 == 0) {

213 
İtiÚ
 = 1;

214 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

215 &
İtiÚ
, (option)) < 0)

216 
	`”r_sys
("TCP_NODELAY setsockoptƒrror");

218 
İtiÚ
 = 0;

219 
İ’
 = (
İtiÚ
);

220 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

221 &
İtiÚ
, &
İ’
) < 0)

222 
	`”r_sys
("TCP_NODELAY getsockoptƒrror");

223 ià(
İtiÚ
 == 0)

224 
	`”r_qu™
("TCP_NODELAY‚Ù s‘ (%d)", 
İtiÚ
);

226 ià(
v”bo£
)

227 
	`årštf
(
¡d”r
, "TCP_NODELAY set\n");

230 ià(
dßÎ
 && 
v”bo£
 && 
udp
 == 0) {

231 
İtiÚ
 = 0;

232 
İ’
 = (
İtiÚ
);

233 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
,

234 &
İtiÚ
, &
İ’
) < 0)

235 
	`”r_sys
("TCP_MAXSEG getsockoptƒrror");

237 
	`årštf
(
¡d”r
, "TCP_MAXSEG = %d\n", 
İtiÚ
);

240 ià(
lšg”
 >ğ0 && 
dßÎ
 && 
udp
 == 0) {

241 
lšg
.
l_Úoff
 = 1;

242 
lšg
.
l_lšg”
 = 
lšg”
;

243 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
,

244 &
lšg
, (ling)) < 0)

245 
	`”r_sys
("SO_LINGER setsockoptƒrror");

247 
lšg
.
l_Úoff
 = 0;

248 
lšg
.
l_lšg”
 = -1;

249 
İ’
 = (
lšg”
);

250 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
,

251 &
lšg
, &
İ’
) < 0)

252 
	`”r_sys
("SO_LINGER getsockoptƒrror");

253 ià(
lšg
.
l_Úoff
 =ğ0 ||†šg.
l_lšg”
 !ğ
lšg”
)

254 
	`”r_qu™
("SO_LINGER‚Ù s‘ (%d, %d)", 
lšg
.
l_Úoff
,†šg.
l_lšg”
);

256 ià(
v”bo£
)

257 
	`årštf
(
¡d”r
, "linger %s,ime = %d\n",

258 
lšg
.
l_Úoff
 ? "Ú" : "off",†šg.
l_lšg”
);

261 ià(
dßÎ
 && 
rcvtimeo
) {

262 #ifdef 
SO_RCVTIMEO


264 
tim”
.
tv_£c
 = 
rcvtimeo
 / 1000;

265 
tim”
.
tv_u£c
 = (
rcvtimeo
 % 1000) * 1000;

266 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

267 &
tim”
, (timer)) < 0)

268 
	`”r_sys
("SO_RCVTIMEO setsockoptƒrror");

270 
tim”
.
tv_£c
 =im”.
tv_u£c
 = 0;

271 
İ’
 = (
tim”
);

272 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVTIMEO
,

273 &
tim”
, &
İ’
) < 0)

274 
	`”r_sys
("SO_RCVTIMEO getsockoptƒrror");

276 ià(
v”bo£
)

277 
	`årštf
(
¡d”r
, "SO_RCVTIMEO: %ld.%06ld\n",

278 
tim”
.
tv_£c
,im”.
tv_u£c
);

280 
	`årštf
(
¡d”r
, "warning: SO_RCVTIMEO‚ot supported by host\n");

284 ià(
dßÎ
 && 
¢dtimeo
) {

285 #ifdef 
SO_SNDTIMEO


287 
tim”
.
tv_£c
 = 
¢dtimeo
 / 1000;

288 
tim”
.
tv_u£c
 = (
¢dtimeo
 % 1000) * 1000;

289 ià(
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDTIMEO
,

290 &
tim”
, (timer)) < 0)

291 
	`”r_sys
("SO_SNDTIMEO setsockoptƒrror");

293 
tim”
.
tv_£c
 =im”.
tv_u£c
 = 0;

294 
İ’
 = (
tim”
);

295 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDTIMEO
,

296 &
tim”
, &
İ’
) < 0)

297 
	`”r_sys
("SO_SNDTIMEO getsockoptƒrror");

299 ià(
v”bo£
)

300 
	`årštf
(
¡d”r
, "SO_SNDTIMEO: %ld.%06ld\n",

301 
tim”
.
tv_£c
,im”.
tv_u£c
);

303 
	`årštf
(
¡d”r
, "warning: SO_SNDTIMEO‚ot supported by host\n");

307 ià(
»cvd¡addr
 && 
udp
) {

308 #ifdef 
IP_RECVDSTADDR


309 
İtiÚ
 = 1;

310 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
,

311 &
İtiÚ
, (option)) < 0)

312 
	`”r_sys
("IP_RECVDSTADDR setsockoptƒrror");

314 
İtiÚ
 = 0;

315 
İ’
 = (
İtiÚ
);

316 ià(
	`g‘sockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_RECVDSTADDR
,

317 &
İtiÚ
, &
İ’
) < 0)

318 
	`”r_sys
("IP_RECVDSTADDR getsockoptƒrror");

319 ià(
İtiÚ
 == 0)

320 
	`”r_qu™
("IP_RECVDSTADDR‚Ù s‘ (%d)", 
İtiÚ
);

322 ià(
v”bo£
)

323 
	`årštf
(
¡d”r
, "IP_RECVDSTADDR set\n");

325 
	`årštf
(
¡d”r
, "warning: IP_RECVDSTADDR‚ot supported by host\n");

329 ià(
sigio
) {

330 #ifdef 
FIOASYNC


331 
	`sigio_func
();

339 
	`sigÇl
(
SIGIO
, 
sigio_func
);

341 ià(
	`fú
(
sockfd
, 
F_SETOWN
, 
	`g‘pid
()) < 0)

342 
	`”r_sys
("fcntl F_SETOWNƒrror");

344 
İtiÚ
 = 1;

345 ià(
	`ioùl
(
sockfd
, 
FIOASYNC
, (*è&
İtiÚ
) < 0)

346 
	`”r_sys
("ioctl FIOASYNCƒrror");

348 ià(
v”bo£
)

349 
	`årštf
(
¡d”r
, "FIOASYNC set\n");

351 
	`årštf
(
¡d”r
, "warning: FIOASYNC‚ot supported by host\n");

354 
	}
}

357 
	$sigio_func
(
signo
)

359 
	`årštf
(
¡d”r
, "SIGIO\n");

361 
	}
}

	@osi\unpv13e\unpv13e\sock\sourceroute.c

10 
	~"sock.h
"

11 
	~<Ãtš‘/š_sy¡m.h
>

12 
	~<Ãtš‘/.h
>

27 
u_ch¬
 
	g¤ou‹_İt
[44];

29 
u_ch¬
 *
	gİŒ
;

41 
	$¤ou‹_doİt
(
¡riù
, *
¬g±r
)

43 
š_addr
 
šaddr
;

44 
ho¡’t
 *
hp
;

46 ià(
¤ou‹_út
 >= 9)

47 
	`”r_qu™
("toØmªy sourû„ou‹ w™h: %s", 
¬g±r
);

49 ià(
¤ou‹_út
 == 0) {

50 
	`bz”o
(
¤ou‹_İt
, (sroute_opt));

51 
İŒ
 = 
¤ou‹_İt
;

52 *
İŒ
++ = 
¡riù
 ? 
IPOPT_SSRR
 : 
IPOPT_LSRR
;

53 
İŒ
++;

54 *
İŒ
++ = 4;

57 ià(
	`š‘_©Ú
(
¬g±r
, &
šaddr
) == 1) {

58 
	`memıy
(
İŒ
, &
šaddr
, (
u_lÚg
));

59 ià(
v”bo£
)

60 
	`årštf
(
¡d”r
, "sourû„ou‹Ø%s\n", 
	`š‘_Áß
(
šaddr
));

61 } iàĞ(
hp
 = 
	`g‘ho¡byÇme
(
¬g±r
)è!ğ
NULL
) {

62 
	`memıy
(
İŒ
, 
hp
->
h_addr
, (
u_lÚg
));

63 ià(
v”bo£
)

64 
	`årštf
(
¡d”r
, "source„outeo %s\n",

65 
	`š‘_Áß
(*((
š_addr
 *è
hp
->
h_addr
)));

67 
	`”r_qu™
("unknowÀho¡: %s\n", 
¬g±r
);

69 
İŒ
 +ğ(
u_lÚg
);

70 
¤ou‹_út
++;

71 
	}
}

80 
	$¤ou‹_£t
(
sockfd
)

82 
¤ou‹_út
++;

83 
¤ou‹_İt
[1] = 3 + (
¤ou‹_út
 * 4);

86 
	`memıy
(
İŒ
, &
£rvaddr
.
sš_addr
, (
u_lÚg
));

87 
İŒ
 +ğ(
u_lÚg
);

88 ià(
v”bo£
) {

89 
	`årštf
(
¡d”r
, "sourû„ou‹Ø%s\n", 
	`š‘_Áß
(
£rvaddr
.
sš_addr
));

90 
	`årštf
(
¡d”r
, "sourû„ou‹ siz%d by‹s\n", 
¤ou‹_İt
[1]);

102 (
İŒ
 - 
¤ou‹_İt
) & 3)

103 
İŒ
++;

105 ià(
	`£tsockİt
(
sockfd
, 
IPPROTO_IP
, 
IP_OPTIONS
,

106 
¤ou‹_İt
, 
İŒ
 - sroute_opt) < 0)

107 
	`”r_sys
("setsockoptƒrror for IP_OPTIONS");

109 
¤ou‹_út
 = 0;

110 
	}
}

	@osi\unpv13e\unpv13e\sock\sourcesink.c

10 
	~"sock.h
"

11 
	~<ùy³.h
>

13 
·‰”n
(*
±r
, 
Ën
);

16 
	$sšk
(
sockfd
)

18 
i
, 
n
;

19 
oob
;

21 ià(
ş›Á
) {

22 
	`·‰”n
(
wbuf
, 
wr™–’
);

24 ià(
·u£š™
)

25 
	`¦“p
(
·u£š™
);

27 
i
 = 1; i <ğ
nbuf
; i++) {

28 ià(
urgwr™e
 =ğ
i
) {

29 
oob
 = 
urgwr™e
;

30 iàĞ(
n
 = 
	`£nd
(
sockfd
, &
oob
, 1, 
MSG_OOB
)) != 1)

31 
	`”r_sys
("send of MSG_OOB„eturned %d,ƒxpected %d",

32 
n
, 
wr™–’
);

33 ià(
v”bo£
)

34 
	`årštf
(
¡d”r
, "wrÙ%d by‹ oàurg’ˆd©a\n", 
n
);

37 iàĞ(
n
 = 
	`wr™e
(
sockfd
, 
wbuf
, 
wr™–’
)) != writelen)

38 
	`”r_sys
("wr™»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

39 ià(
v”bo£
)

40 
	`årštf
(
¡d”r
, "wrÙ%d by‹s\n", 
n
);

42 ià(
·u£rw
)

43 
	`¦“p
(
·u£rw
);

48 ià(
·u£š™
)

49 
	`¦“p
(
·u£š™
);

52 iàĞ(
n
 = 
	`»ad
(
sockfd
, 
rbuf
, 
»adËn
)) < 0) {

53 
	`”r_sys
("readƒrror");

55 } ià(
n
 == 0) {

58 } ià(
n
 !ğ
»adËn
)

59 
	`”r_qu™
("»ad„‘uºed %d,ƒx³ùed %d", 
n
, 
»adËn
);

61 ià(
v”bo£
)

62 
	`årštf
(
¡d”r
, "»ûived %d by‹s\n", 
n
);

64 ià(
·u£rw
)

65 
	`¦“p
(
·u£rw
);

69 ià(
·u£şo£
) {

70 ià(
v”bo£
)

71 
	`årštf
(
¡d”r
, "pausing before close\n");

72 
	`¦“p
(
·u£şo£
);

75 ià(
	`şo£
(
sockfd
) < 0)

76 
	`”r_sys
("closeƒrror");

77 
	}
}

80 
	$·‰”n
(*
±r
, 
Ën
)

82 
c
;

84 
c
 = 0;

85 
Ën
-- > 0) {

86 
	`i¥ršt
((
c
 & 0x7F)) == 0)

87 
c
++;

88 *
±r
++ = (
c
++ & 0x7F);

90 
	}
}

	@osi\unpv13e\unpv13e\sock\sourcetcp.c

10 
	~"sock.h
"

13 
	$sourû_tı
(
sockfd
)

15 
i
, 
n
, 
İtiÚ
;

16 
sockËn_t
 
İ’
;

17 
oob
;

19 
	`·‰”n
(
wbuf
, 
wr™–’
);

21 ià(
·u£š™
)

22 
	`¦“p_us
(
·u£š™
*1000);

24 
i
 = 1; i <ğ
nbuf
; i++) {

25 ià(
urgwr™e
 =ğ
i
) {

26 
oob
 = 
urgwr™e
;

27 iàĞ(
n
 = 
	`£nd
(
sockfd
, &
oob
, 1, 
MSG_OOB
)) != 1)

28 
	`”r_sys
("send of MSG_OOB„eturned %d,ƒxpected %d",

29 
n
, 
wr™–’
);

30 ià(
v”bo£
)

31 
	`årštf
(
¡d”r
, "wrÙ%d by‹ oàurg’ˆd©a\n", 
n
);

34 iàĞ(
n
 = 
	`wr™e
(
sockfd
, 
wbuf
, 
wr™–’
)) != writelen) {

35 ià(
ignÜew”r
) {

36 
	`”r_»t
("wr™»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

38 
İ’
 = (
İtiÚ
);

39 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_ERROR
,

40 &
İtiÚ
, &
İ’
) < 0)

41 
	`”r_sys
("SO_ERROR getsockoptƒrror");

43 
	`”r_sys
("wr™»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

45 } ià(
v”bo£
)

46 
	`årštf
(
¡d”r
, "wrÙ%d by‹s\n", 
n
);

48 ià(
·u£rw
)

49 
	`¦“p_us
(
·u£rw
*1000);

52 ià(
·u£şo£
) {

53 ià(
v”bo£
)

54 
	`årštf
(
¡d”r
, "pausing before close\n");

55 
	`¦“p_us
(
·u£şo£
*1000);

58 ià(
	`şo£
(
sockfd
) < 0)

59 
	`”r_sys
("closeƒrror");

60 
	}
}

	@osi\unpv13e\unpv13e\sock\sourceudp.c

10 
	~"sock.h
"

13 
	$sourû_udp
(
sockfd
)

15 
i
, 
n
, 
İtiÚ
;

16 
sockËn_t
 
İ’
;

18 
	`·‰”n
(
wbuf
, 
wr™–’
);

20 ià(
·u£š™
)

21 
	`¦“p_us
(
·u£š™
*1000);

23 
i
 = 1; i <ğ
nbuf
; i++) {

24 ià(
cÚÃùudp
) {

25 iàĞ(
n
 = 
	`wr™e
(
sockfd
, 
wbuf
, 
wr™–’
)) != writelen) {

26 ià(
ignÜew”r
) {

27 
	`”r_»t
("wr™»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

29 
İ’
 = (
İtiÚ
);

30 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_ERROR
,

31 &
İtiÚ
, &
İ’
) < 0)

32 
	`”r_sys
("SO_ERROR getsockoptƒrror");

34 
	`”r_sys
("wr™»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

37 iàĞ(
n
 = 
	`£ndto
(
sockfd
, 
wbuf
, 
wr™–’
, 0,

38 (
sockaddr
 *è&
£rvaddr
,

39 (
£rvaddr
))è!ğ
wr™–’
) {

40 ià(
ignÜew”r
) {

41 
	`”r_»t
("£ndtØ»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

43 
İ’
 = (
İtiÚ
);

44 ià(
	`g‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_ERROR
,

45 &
İtiÚ
, &
İ’
) < 0)

46 
	`”r_sys
("SO_ERROR getsockoptƒrror");

48 
	`”r_sys
("£ndtØ»tuºed %d,ƒx³ùed %d", 
n
, 
wr™–’
);

52 ià(
v”bo£
)

53 
	`årštf
(
¡d”r
, "wrÙ%d by‹s\n", 
n
);

55 ià(
·u£rw
)

56 
	`¦“p_us
(
·u£rw
*1000);

59 ià(
·u£şo£
) {

60 ià(
v”bo£
)

61 
	`årštf
(
¡d”r
, "pausing before close\n");

62 
	`¦“p_us
(
·u£şo£
*1000);

65 ià(
	`şo£
(
sockfd
) < 0)

66 
	`”r_sys
("closeƒrror");

67 
	}
}

	@osi\unpv13e\unpv13e\sock\strerror.c

1 
	~<¡dio.h
>

3 cÚ¡ *cÚ¡ 
sys_”¾i¡
[];

4 
sys_Ã¼
;

7 
	$¡»¼Ü
(
”rÜ
)

9 
mesg
[30];

11 ià(
”rÜ
 >ğ0 &&ƒ¼Ü <ğ
sys_Ã¼
)

12 (
sys_”¾i¡
[
”rÜ
]);

14 
	`¢´štf
(
mesg
, (mesg), "UnknowÀ”rÜ (%d)", 
”rÜ
);

15 (
mesg
);

16 
	}
}

	@osi\unpv13e\unpv13e\sock\tellwait.c

1 
	~<sigÇl.h
>

2 
	~"ourhdr.h
"

4 vŞ©
sig_©omic_t
 
	gsigæag
;

6 
sig£t_t
 
	gÃwmask
, 
	gŞdmask
, 
	gz”omask
;

9 
	$sig_u¤
(
signo
)

11 
sigæag
 = 1;

13 
	}
}

16 
	$TELL_WAIT
()

18 ià(
	`sigÇl
(
SIGUSR1
, 
sig_u¤
è=ğ
SIG_ERR
)

19 
	`”r_sys
("signal(SIGINT)ƒrror");

20 ià(
	`sigÇl
(
SIGUSR2
, 
sig_u¤
è=ğ
SIG_ERR
)

21 
	`”r_sys
("signal(SIGQUIT)ƒrror");

23 
	`sigem±y£t
(&
z”omask
);

25 
	`sigem±y£t
(&
Ãwmask
);

26 
	`sigadd£t
(&
Ãwmask
, 
SIGUSR1
);

27 
	`sigadd£t
(&
Ãwmask
, 
SIGUSR2
);

29 ià(
	`sig´ocmask
(
SIG_BLOCK
, &
Ãwmask
, &
Şdmask
) < 0)

30 
	`”r_sys
("SIG_BLOCKƒrror");

31 
	}
}

34 
	$TELL_PARENT
(
pid_t
 
pid
)

36 
	`kl
(
pid
, 
SIGUSR2
);

37 
	}
}

40 
	$WAIT_PARENT
()

42 
sigæag
 == 0)

43 
	`sigsu¥’d
(&
z”omask
);

45 
sigæag
 = 0;

47 ià(
	`sig´ocmask
(
SIG_SETMASK
, &
Şdmask
, 
NULL
) < 0)

48 
	`”r_sys
("SIG_SETMASKƒrror");

49 
	}
}

52 
	$TELL_CHILD
(
pid_t
 
pid
)

54 
	`kl
(
pid
, 
SIGUSR1
);

55 
	}
}

58 
	$WAIT_CHILD
()

60 
sigæag
 == 0)

61 
	`sigsu¥’d
(&
z”omask
);

63 
sigæag
 = 0;

65 ià(
	`sig´ocmask
(
SIG_SETMASK
, &
Şdmask
, 
NULL
) < 0)

66 
	`”r_sys
("SIG_SETMASKƒrror");

67 
	}
}

	@osi\unpv13e\unpv13e\sock\write.c

10 
	~"sock.h
"

11 
	~<sys/uio.h
>

13 #iâdef 
UIO_MAXIOV


14 
	#UIO_MAXIOV
 16

	)

17 
ssize_t


18 
	$dowr™e
(
fd
, cÚ¡ *
v±r
, 
size_t
 
nby‹s
)

20 
iovec
 
iov
[
UIO_MAXIOV
];

21 cÚ¡ *
±r
;

22 
chunksize
, 
i
, 
n
, 
Æeá
, 
nwr™‹n
, 
ÁÙ®
;

24 ià(
chunkwr™e
 =ğ0 && 
u£wr™ev
 == 0)

25 (
	`wr™e
(
fd
, 
v±r
, 
nby‹s
));

32 
chunksize
 = 
nby‹s
 / 
UIO_MAXIOV
;

33 ià(
chunksize
 <= 0)

34 
chunksize
 = 1;

35 ià((
nby‹s
 % 
UIO_MAXIOV
) != 0)

36 
chunksize
++;

38 
±r
 = 
v±r
;

39 
Æeá
 = 
nby‹s
;

40 
i
 = 0; i < 
UIO_MAXIOV
; i++) {

41 
iov
[
i
].
iov_ba£
 = 
±r
;

42 
n
 = (
Æeá
 >ğ
chunksize
) ? chunksize :‚left;

43 
iov
[
i
].
iov_Ën
 = 
n
;

44 ià(
v”bo£
)

45 
	`årštf
(
¡d”r
, "iov[%2d].iov_base = %x, iov[%2d].iov_len = %d\n",

46 
i
, 
iov
[i].
iov_ba£
, i, iov[i].
iov_Ën
);

47 
±r
 +ğ
n
;

48 ià((
Æeá
 -ğ
n
) == 0)

51 ià(
i
 =ğ
UIO_MAXIOV
)

52 
	`”r_qu™
("i == UIO_MAXIOV");

54 ià(
u£wr™ev
)

55 (
	`wr™ev
(
fd
, 
iov
, 
i
+1));

57 
ÁÙ®
 = 0;

58 
n
 = 0;‚ <ğ
i
;‚++) {

59 
nwr™‹n
 = 
	`wr™e
(
fd
, 
iov
[
n
].
iov_ba£
, iov[n].
iov_Ën
);

60 ià(
nwr™‹n
 !ğ
iov
[
n
].
iov_Ën
)

62 
ÁÙ®
 +ğ
nwr™‹n
;

64 (
ÁÙ®
);

66 
	}
}

	@osi\unpv13e\unpv13e\sock\writen.c

1 
	~"ourhdr.h
"

3 
ssize_t


4 
	$wr™’
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
)

6 
size_t
 
Æeá
, 
nwr™‹n
;

7 cÚ¡ *
±r
;

9 
±r
 = 
v±r
;

10 
Æeá
 = 
n
;

11 
Æeá
 > 0) {

12 iàĞ(
nwr™‹n
 = 
	`wr™e
(
fd
, 
±r
, 
Æeá
)) <= 0)

13 (
nwr™‹n
);

15 
Æeá
 -ğ
nwr™‹n
;

16 
±r
 +ğ
nwr™‹n
;

18 (
n
);

19 
	}
}

	@osi\unpv13e\unpv13e\sockopt\checkopts.c

3 
	~"uÅ.h
"

4 
	~<Ãtš‘/tı.h
>

6 
	uv®
 {

7 
	mi_v®
;

8 
	ml_v®
;

9 
lšg”
 
	mlšg”_v®
;

10 
timev®
 
	mtimev®_v®
;

11 } 
	gv®
;

13 *
sock_¡r_æag
(
v®
 *, );

14 *
sock_¡r_št
(
v®
 *, );

15 *
sock_¡r_lšg”
(
v®
 *, );

16 *
sock_¡r_timev®
(
v®
 *, );

18 
	ssock_İts
 {

19 cÚ¡ *
	mİt_¡r
;

20 
	mİt_Ëv–
;

21 
	mİt_Çme
;

22 *(*
	mİt_v®_¡r
)(
	mv®
 *, );

23 } 
	gsock_İts
[] = {

24 { "SO_BROADCAST", 
SOL_SOCKET
, 
SO_BROADCAST
, 
sock_¡r_æag
 },

25 { "SO_DEBUG", 
SOL_SOCKET
, 
SO_DEBUG
, 
sock_¡r_æag
 },

26 { "SO_DONTROUTE", 
SOL_SOCKET
, 
SO_DONTROUTE
, 
sock_¡r_æag
 },

27 { "SO_ERROR", 
SOL_SOCKET
, 
SO_ERROR
, 
sock_¡r_št
 },

28 { "SO_KEEPALIVE", 
SOL_SOCKET
, 
SO_KEEPALIVE
, 
sock_¡r_æag
 },

29 { "SO_LINGER", 
SOL_SOCKET
, 
SO_LINGER
, 
sock_¡r_lšg”
 },

30 { "SO_OOBINLINE", 
SOL_SOCKET
, 
SO_OOBINLINE
, 
sock_¡r_æag
 },

31 { "SO_RCVBUF", 
SOL_SOCKET
, 
SO_RCVBUF
, 
sock_¡r_št
 },

32 { "SO_SNDBUF", 
SOL_SOCKET
, 
SO_SNDBUF
, 
sock_¡r_št
 },

33 { "SO_RCVLOWAT", 
SOL_SOCKET
, 
SO_RCVLOWAT
, 
sock_¡r_št
 },

34 { "SO_SNDLOWAT", 
SOL_SOCKET
, 
SO_SNDLOWAT
, 
sock_¡r_št
 },

35 { "SO_RCVTIMEO", 
SOL_SOCKET
, 
SO_RCVTIMEO
, 
sock_¡r_timev®
 },

36 { "SO_SNDTIMEO", 
SOL_SOCKET
, 
SO_SNDTIMEO
, 
sock_¡r_timev®
 },

37 { "SO_REUSEADDR", 
SOL_SOCKET
, 
SO_REUSEADDR
, 
sock_¡r_æag
 },

38 #ifdef 
SO_REUSEPORT


39 { "SO_REUSEPORT", 
SOL_SOCKET
, 
SO_REUSEPORT
, 
sock_¡r_æag
 },

41 { "SO_REUSEPORT", 0, 0, 
NULL
 },

43 { "SO_TYPE", 
SOL_SOCKET
, 
SO_TYPE
, 
sock_¡r_št
 },

44 { "SO_USELOOPBACK", 
SOL_SOCKET
, 
SO_USELOOPBACK
, 
sock_¡r_æag
 },

45 { "IP_TOS", 
IPPROTO_IP
, 
IP_TOS
, 
sock_¡r_št
 },

46 { "IP_TTL", 
IPPROTO_IP
, 
IP_TTL
, 
sock_¡r_št
 },

47 #ifdef 
IPV6_DONTFRAG


48 { "IPV6_DONTFRAG", 
IPPROTO_IPV6
,
IPV6_DONTFRAG
, 
sock_¡r_æag
 },

50 { "IPV6_DONTFRAG", 0, 0, 
NULL
 },

52 #ifdef 
IPV6_UNICAST_HOPS


53 { "IPV6_UNICAST_HOPS", 
IPPROTO_IPV6
,
IPV6_UNICAST_HOPS
,
sock_¡r_št
 },

55 { "IPV6_UNICAST_HOPS", 0, 0, 
NULL
 },

57 #ifdef 
IPV6_V6ONLY


58 { "IPV6_V6ONLY", 
IPPROTO_IPV6
,
IPV6_V6ONLY
, 
sock_¡r_æag
 },

60 { "IPV6_V6ONLY", 0, 0, 
NULL
 },

62 { "TCP_MAXSEG", 
IPPROTO_TCP
,
TCP_MAXSEG
, 
sock_¡r_št
 },

63 { "TCP_NODELAY", 
IPPROTO_TCP
,
TCP_NODELAY
, 
sock_¡r_æag
 },

64 #ifdef 
SCTP_AUTOCLOSE


65 { "SCTP_AUTOCLOSE", 
IPPROTO_SCTP
,
SCTP_AUTOCLOSE
,
sock_¡r_št
 },

67 { "SCTP_AUTOCLOSE", 0, 0, 
NULL
 },

69 #ifdef 
SCTP_MAXBURST


70 { "SCTP_MAXBURST", 
IPPROTO_SCTP
,
SCTP_MAXBURST
, 
sock_¡r_št
 },

72 { "SCTP_MAXBURST", 0, 0, 
NULL
 },

74 #ifdef 
SCTP_MAXSEG


75 { "SCTP_MAXSEG", 
IPPROTO_SCTP
,
SCTP_MAXSEG
, 
sock_¡r_št
 },

77 { "SCTP_MAXSEG", 0, 0, 
NULL
 },

79 #ifdef 
SCTP_NODELAY


80 { "SCTP_NODELAY", 
IPPROTO_SCTP
,
SCTP_NODELAY
, 
sock_¡r_æag
 },

82 { "SCTP_NODELAY", 0, 0, 
NULL
 },

84 { 
NULL
, 0, 0, NULL }

91 
	$maš
(
¬gc
, **
¬gv
)

93 
fd
;

94 
sockËn_t
 
Ën
;

95 
sock_İts
 *
±r
;

97 
±r
 = 
sock_İts
;…Œ->
İt_¡r
 !ğ
NULL
;…tr++) {

98 
	`´štf
("%s: ", 
±r
->
İt_¡r
);

99 ià(
±r
->
İt_v®_¡r
 =ğ
NULL
)

100 
	`´štf
("(undefined)\n");

102 
±r
->
İt_Ëv–
) {

103 
SOL_SOCKET
:

104 
IPPROTO_IP
:

105 
IPPROTO_TCP
:

106 
fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

108 #ifdef 
IPV6


109 
IPPROTO_IPV6
:

110 
fd
 = 
	`Sock‘
(
AF_INET6
, 
SOCK_STREAM
, 0);

113 #ifdef 
IPPROTO_SCTP


114 
IPPROTO_SCTP
:

115 
fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_SEQPACKET
, 
IPPROTO_SCTP
);

119 
	`”r_qu™
("Cª'ˆü—‹ fd fÜ†ev– %d\n", 
±r
->
İt_Ëv–
);

122 
Ën
 = (
v®
);

123 ià(
	`g‘sockİt
(
fd
, 
±r
->
İt_Ëv–
,…Œ->
İt_Çme
,

124 &
v®
, &
Ën
) == -1) {

125 
	`”r_»t
("getsockoptƒrror");

127 
	`´štf
("deçuÉ = %s\n", (*
±r
->
İt_v®_¡r
)(&
v®
, 
Ën
));

129 
	`şo£
(
fd
);

132 
	`ex™
(0);

133 
	}
}

137 
	g¡¼es
[128];

140 
	$sock_¡r_æag
(
v®
 *
±r
, 
Ën
)

143 ià(
Ën
 != ())

144 
	`¢´štf
(
¡¼es
, (¡¼es), "siz(%dènÙ sizeof(št)", 
Ën
);

146 
	`¢´štf
(
¡¼es
, (strres),

147 "%s", (
±r
->
i_v®
 == 0) ? "off" : "on");

148 (
¡¼es
);

150 
	}
}

154 
	$sock_¡r_št
(
v®
 *
±r
, 
Ën
)

156 ià(
Ën
 != ())

157 
	`¢´štf
(
¡¼es
, (¡¼es), "siz(%dènÙ sizeof(št)", 
Ën
);

159 
	`¢´štf
(
¡¼es
, (¡¼es), "%d", 
±r
->
i_v®
);

160 (
¡¼es
);

161 
	}
}

164 
	$sock_¡r_lšg”
(
v®
 *
±r
, 
Ën
)

166 
lšg”
 *
ÍŒ
 = &
±r
->
lšg”_v®
;

168 ià(
Ën
 !ğ(
lšg”
))

169 
	`¢´štf
(
¡¼es
, (strres),

170 "siz(%dènÙ sizeof(¡ruù†šg”)", 
Ën
);

172 
	`¢´štf
(
¡¼es
, (strres), "l_onoff = %d,†_linger = %d",

173 
ÍŒ
->
l_Úoff
,†±r->
l_lšg”
);

174 (
¡¼es
);

175 
	}
}

178 
	$sock_¡r_timev®
(
v®
 *
±r
, 
Ën
)

180 
timev®
 *
tv±r
 = &
±r
->
timev®_v®
;

182 ià(
Ën
 !ğ(
timev®
))

183 
	`¢´štf
(
¡¼es
, (strres),

184 "siz(%dènÙ sizeof(¡ruùimev®)", 
Ën
);

186 
	`¢´štf
(
¡¼es
, (strres), "%d sec, %d usec",

187 
tv±r
->
tv_£c
,v±r->
tv_u£c
);

188 (
¡¼es
);

189 
	}
}

	@osi\unpv13e\unpv13e\sockopt\prdefaults.c

1 
	~"uÅ.h
"

3 
do™
(, const *);

6 
	$maš
()

8 
tısock
, 
udpsock
;

9 
sockaddr_š
 
£rvaddr
;

11 iàĞ(
tısock
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

12 
	`”r_sys
("TCP socketƒrror");

14 #ifdeà
nÙdef


15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(9);

18 ià(
	`ascii2addr
(
AF_INET
, "127.0.0.1", &
£rvaddr
.
sš_addr
) != 4)

19 
	`”r_qu™
("ascii2addrƒrror");

21 ià(
	`cÚÃù
(
tısock
, (
SA
 *è&
£rvaddr
, (servaddr)) < 0)

22 
	`”r_sys
("connectƒrror");

25 
	`do™
(
tısock
, "tcp");

27 iàĞ(
udpsock
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)) < 0)

28 
	`”r_sys
("UDP socketƒrror");

30 
	`do™
(
udpsock
, "udp");

31 
	`ex™
(0);

32 
	}
}

35 
	$do™
(
fd
, cÚ¡ *
Çme
)

37 
v®
;

38 
sockËn_t
 
İ’
;

40 
İ’
 = (
v®
);

41 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
v®
, &
İ’
) < 0)

42 
	`”r_sys
("SO_SNDBUF getsockoptƒrror");

43 
	`´štf
("% £nd bufã¸sizğ%d\n", 
Çme
, 
v®
);

45 
İ’
 = (
v®
);

46 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
v®
, &
İ’
) < 0)

47 
	`”r_sys
("SO_RCVBUF getsockoptƒrror");

48 
	`´štf
("% »cv bufã¸sizğ%d\n", 
Çme
, 
v®
);

50 
İ’
 = (
v®
);

51 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDLOWAT
, &
v®
, &
İ’
) < 0)

52 
	`”r_sys
("SO_SNDLOWAT getsockoptƒrror");

53 
	`´štf
("% £nd†ow-w©” m¬k = %d\n", 
Çme
, 
v®
);

55 
İ’
 = (
v®
);

56 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVLOWAT
, &
v®
, &
İ’
) < 0)

57 
	`”r_sys
("SO_RCVLOWAT getsockoptƒrror");

58 
	`´štf
("% »ûivlow-w©” m¬k sizğ%d\n", 
Çme
, 
v®
);

59 
	}
}

	@osi\unpv13e\unpv13e\sockopt\rcvbuf.c

1 
	~"uÅ.h
"

2 
	~<Ãtš‘/tı.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
, 
rcvbuf
, 
mss
;

8 
sockËn_t
 
Ën
;

9 
sockaddr_š
 
£rvaddr
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage:„cvbuf <IPaddress>");

14 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

16 
Ën
 = (
rcvbuf
);

17 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, &
Ën
);

18 
Ën
 = (
mss
);

19 
	`G‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
, &
mss
, &
Ën
);

20 
	`´štf
("deçuÉs: SO_RCVBUF = %d, MSS = %d\n", 
rcvbuf
, 
mss
);

22 
	`bz”o
(&
£rvaddr
, (servaddr));

23 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

24 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

25 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

27 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

29 
Ën
 = (
rcvbuf
);

30 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, &
Ën
);

31 
Ën
 = (
mss
);

32 
	`G‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
, &
mss
, &
Ën
);

33 
	`´štf
("aá” cÚÃù: SO_RCVBUF = %d, MSS = %d\n", 
rcvbuf
, 
mss
);

35 
	`ex™
(0);

36 
	}
}

	@osi\unpv13e\unpv13e\sockopt\rcvbufset.c

1 
	~"uÅ.h
"

2 
	~<Ãtš‘/tı.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
, 
rcvbuf
, 
mss
;

8 
sockËn_t
 
Ën
;

9 
sockaddr_š
 
£rvaddr
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage:„cvbufset <IPaddress>");

14 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

16 
Ën
 = (
rcvbuf
);

17 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, &
Ën
);

18 
Ën
 = (
mss
);

19 
	`G‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
, &
mss
, &
Ën
);

20 
	`´štf
("deçuÉs: SO_RCVBUF = %d, MSS = %d\n", 
rcvbuf
, 
mss
);

22 
rcvbuf
 = 9973;

23 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, (rcvbuf));

24 
Ën
 = (
rcvbuf
);

25 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, &
Ën
);

26 
	`´štf
("SO_RCVBUF = %d (aá” s‘tšg iˆtØ9973)\n", 
rcvbuf
);

28 
	`bz”o
(&
£rvaddr
, (servaddr));

29 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

30 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

31 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

33 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

35 
Ën
 = (
rcvbuf
);

36 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
rcvbuf
, &
Ën
);

37 
Ën
 = (
mss
);

38 
	`G‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
, &
mss
, &
Ën
);

39 
	`´štf
("aá” cÚÃù: SO_RCVBUF = %d, MSS = %d\n", 
rcvbuf
, 
mss
);

42 
	`ex™
(0);

43 
	}
}

	@osi\unpv13e\unpv13e\sockopt\sockopt.c

1 
	~"uÅ.h
"

2 
	~<Ãtš‘/tı.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
, 
mss
, 
£ndbuff
;

8 
sockËn_t
 
İ’
;

10 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

13 
İ’
 = (
mss
);

14 
	`G‘sockİt
(
sockfd
, 
IPPROTO_TCP
, 
TCP_MAXSEG
, &
mss
, &
İ’
);

15 
	`´štf
("TCP ms ğ%d\n", 
mss
);

18 
£ndbuff
 = 65536;

19 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
£ndbuff
, (sendbuff));

21 
İ’
 = (
£ndbuff
);

22 
	`G‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
£ndbuff
, &
İ’
);

23 
	`´štf
("£nd bufã¸sizğ%d\n", 
£ndbuff
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\sparc64-unknown-freebsd5.1\config.h

5 
	#CPU_VENDOR_OS
 "¥¬c64-unknown-ä“bsd5.1"

	)

8 
	#HAVE_ADDRINFO_STRUCT
 1

	)

11 
	#HAVE_ARPA_INET_H
 1

	)

14 
	#HAVE_BZERO
 1

	)

26 
	#HAVE_ERRNO_H
 1

	)

29 
	#HAVE_FCNTL_H
 1

	)

32 
	#HAVE_GETADDRINFO
 1

	)

35 
	#HAVE_GETADDRINFO_PROTO
 1

	)

38 
	#HAVE_GETHOSTBYNAME2
 1

	)

44 
	#HAVE_GETHOSTNAME
 1

	)

47 
	#HAVE_GETHOSTNAME_PROTO
 1

	)

50 
	#HAVE_GETNAMEINFO
 1

	)

53 
	#HAVE_GETNAMEINFO_PROTO
 1

	)

56 
	#HAVE_GETRUSAGE_PROTO
 1

	)

59 
	#HAVE_HSTRERROR
 1

	)

62 
	#HAVE_HSTRERROR_PROTO
 1

	)

65 
	#HAVE_IF_NAMEINDEX_STRUCT
 1

	)

68 
	#HAVE_IF_NAMETOINDEX
 1

	)

71 
	#HAVE_IF_NAMETOINDEX_PROTO
 1

	)

74 
	#HAVE_INET_ATON
 1

	)

77 
	#HAVE_INET_ATON_PROTO
 1

	)

80 
	#HAVE_INET_PTON
 1

	)

83 
	#HAVE_INET_PTON_PROTO
 1

	)

86 
	#HAVE_KEVENT
 1

	)

89 
	#HAVE_KQUEUE
 1

	)

107 
	#HAVE_MKSTEMP
 1

	)

110 
	#HAVE_MSGHDR_MSG_CONTROL
 1

	)

113 
	#HAVE_NETCONFIG_H
 1

	)

116 
	#HAVE_NETDB_H
 1

	)

122 
	#HAVE_NETINET_IN_H
 1

	)

125 
	#HAVE_NET_IF_DL_H
 1

	)

128 
	#HAVE_POLL
 1

	)

131 
	#HAVE_POLL_H
 1

	)

134 
	#HAVE_PSELECT
 1

	)

137 
	#HAVE_PSELECT_PROTO
 1

	)

140 
	#HAVE_PTHREAD_H
 1

	)

143 
	#HAVE_SIGNAL_H
 1

	)

146 
	#HAVE_SNPRINTF
 1

	)

149 
	#HAVE_SNPRINTF_PROTO
 1

	)

152 
	#HAVE_SOCKADDR_DL_STRUCT
 1

	)

155 
	#HAVE_SOCKADDR_SA_LEN
 1

	)

158 
	#HAVE_SOCKATMARK
 1

	)

161 
	#HAVE_SOCKATMARK_PROTO
 1

	)

164 
	#HAVE_STDIO_H
 1

	)

167 
	#HAVE_STDLIB_H
 1

	)

170 
	#HAVE_STRINGS_H
 1

	)

173 
	#HAVE_STRING_H
 1

	)

179 
	#HAVE_STRUCT_IFREQ_IFR_MTU
 1

	)

182 
	#HAVE_STRUCT_SOCKADDR_STORAGE
 1

	)

185 
	#HAVE_SYS_EVENT_H
 1

	)

188 
	#HAVE_SYS_FILIO_H
 1

	)

191 
	#HAVE_SYS_IOCTL_H
 1

	)

194 
	#HAVE_SYS_SELECT_H
 1

	)

197 
	#HAVE_SYS_SOCKET_H
 1

	)

200 
	#HAVE_SYS_SOCKIO_H
 1

	)

203 
	#HAVE_SYS_STAT_H
 1

	)

206 
	#HAVE_SYS_SYSCTL_H
 1

	)

209 
	#HAVE_SYS_TIME_H
 1

	)

212 
	#HAVE_SYS_TYPES_H
 1

	)

215 
	#HAVE_SYS_UIO_H
 1

	)

218 
	#HAVE_SYS_UN_H
 1

	)

221 
	#HAVE_SYS_WAIT_H
 1

	)

224 
	#HAVE_TIMESPEC_STRUCT
 1

	)

227 
	#HAVE_TIME_H
 1

	)

230 
	#HAVE_UNISTD_H
 1

	)

233 
	#HAVE_VSNPRINTF
 1

	)

242 
	#IPV4
 1

	)

245 
	#IPV6
 1

	)

248 
	#IPv4
 1

	)

251 
	#IPv6
 1

	)

254 
	#MCAST
 1

	)

260 
	#STDC_HEADERS
 1

	)

263 
	#TIME_WITH_SYS_TIME
 1

	)

266 
	#UNIXDOMAIN
 1

	)

269 
	#UNIXdomaš
 1

	)

293 
	#t_sÿÏr_t
 
št32_t


	)

296 
	#t_usÿÏr_t
 
ušt32_t


	)

	@osi\unpv13e\unpv13e\ssntp\main.c

1 
	~"¢.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
buf
[
MAXLINE
];

8 
ssize_t
 
n
;

9 
sockËn_t
 
§Ën
, 
Ën
;

10 
ifi_šfo
 *
ifi
;

11 
sockaddr
 *
mÿ¡§
, *
wd
, *
äom
;

12 
timev®
 
now
;

14 ià(
¬gc
 != 2)

15 
	`”r_qu™
("usage: ssntp <IPaddress>");

17 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1], "Áp", (**è&
mÿ¡§
, &
§Ën
);

19 
wd
 = 
	`M®loc
(
§Ën
);

20 
	`memıy
(
wd
, 
mÿ¡§
, 
§Ën
);

21 
	`sock_£t_wd
(
wd
, 
§Ën
);

22 
	`Bšd
(
sockfd
, 
wd
, 
§Ën
);

24 #ifdef 
MCAST


26 
ifi
 = 
	`G‘_ifi_šfo
(
mÿ¡§
->
§_çmy
, 1); if˜!ğ
NULL
;

27 
ifi
 = ifi->
ifi_Ãxt
) {

28 ià(
ifi
->
ifi_æags
 & 
IFF_MULTICAST
) {

29 
	`Mÿ¡_još
(
sockfd
, 
mÿ¡§
, 
§Ën
, 
ifi
->
ifi_Çme
, 0);

30 
	`´štf
("joined %s on %s\n",

31 
	`Sock_Áİ
(
mÿ¡§
, 
§Ën
), 
ifi
->
ifi_Çme
);

36 
äom
 = 
	`M®loc
(
§Ën
);

38 
Ën
 = 
§Ën
;

39 
n
 = 
	`Recväom
(
sockfd
, 
buf
, (buf), 0, 
äom
, &
Ën
);

40 
	`G‘timeofday
(&
now
, 
NULL
);

41 
	`¢_´oc
(
buf
, 
n
, &
now
);

43 
	}
}

	@osi\unpv13e\unpv13e\ssntp\ntp.h

1 
	#JAN_1970
 2208988800UL

	)

3 
	sl_fixed±
 {

4 
ušt32_t
 
	mšt_·¹
;

5 
ušt32_t
 
	mäaùiÚ
;

8 
	ss_fixed±
 {

9 
ušt16_t
 
	mšt_·¹
;

10 
ušt16_t
 
	mäaùiÚ
;

13 
	sÁpd©a
 {

14 
u_ch¬
 
	m¡©us
;

15 
u_ch¬
 
	m¡¿tum
;

16 
u_ch¬
 
	mµŞl
;

17 
	m´ecisiÚ
:8;

18 
s_fixed±
 
	mdi¡ªû
;

19 
s_fixed±
 
	mdi¥”siÚ
;

20 
ušt32_t
 
	m»fid
;

21 
l_fixed±
 
	m»áime
;

22 
l_fixed±
 
	mÜg
;

23 
l_fixed±
 
	m»c
;

24 
l_fixed±
 
	mxmt
;

27 
	#VERSION_MASK
 0x38

	)

28 
	#MODE_MASK
 0x07

	)

30 
	#MODE_CLIENT
 3

	)

31 
	#MODE_SERVER
 4

	)

32 
	#MODE_BROADCAST
 5

	)

	@osi\unpv13e\unpv13e\ssntp\sntp.h

1 
	~"uÅifi.h
"

2 
	~"Áp.h
"

4 
¢_´oc
(*, 
ssize_t
, 
timev®
 *);

	@osi\unpv13e\unpv13e\ssntp\sntp_proc.c

1 
	~"¢.h
"

4 
	$¢_´oc
(*
buf
, 
ssize_t
 
n
, 
timev®
 *
now±r
)

6 
v”siÚ
, 
mode
;

7 
ušt32_t
 
n£c
, 
u£ci
;

8 
u£cf
;

9 
timev®
 
diff
;

10 
Ápd©a
 *
Áp
;

12 ià(
n
 < (
ssize_t
)(
Ápd©a
)) {

13 
	`´štf
("\Åack‘oØsm®l: %d by‹s\n", 
n
);

17 
Áp
 = (
Ápd©a
 *è
buf
;

18 
v”siÚ
 = (
Áp
->
¡©us
 & 
VERSION_MASK
) >> 3;

19 
mode
 = 
Áp
->
¡©us
 & 
MODE_MASK
;

20 
	`´štf
("\nv%d, mod%d, sŒ© %d, ", 
v”siÚ
, 
mode
, 
Áp
->
¡¿tum
);

21 ià(
mode
 =ğ
MODE_CLIENT
) {

22 
	`´štf
("client\n");

26 
n£c
 = 
	`Áohl
(
Áp
->
xmt
.
št_·¹
è- 
JAN_1970
;

27 
u£ci
 = 
	`Áohl
(
Áp
->
xmt
.
äaùiÚ
);

28 
u£cf
 = 
u£ci
;

29 
u£cf
 /= 4294967296.0;

30 
u£ci
 = 
u£cf
 * 1000000.0;

32 
diff
.
tv_£c
 = 
now±r
->tv_£ø- 
n£c
;

33 iàĞ(
diff
.
tv_u£c
 = 
now±r
->tv_u£ø- 
u£ci
) < 0) {

34 
diff
.
tv_u£c
 += 1000000;

35 
diff
.
tv_£c
--;

37 
u£ci
 = (
diff
.
tv_£c
 * 1000000è+ diff.
tv_u£c
;

38 
	`´štf
("şock difã»nû = %d u£c\n", 
u£ci
);

39 
	}
}

	@osi\unpv13e\unpv13e\streams\stream_dg\client.c

1 
	~<¡dio.h
>

2 
	~<sys/ty³s.h
>

3 
	~<sys/fú.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

8 
”ºo
;

10 
	#SERV_HOST_ADDR
 "128.220.101.4"

	)

11 
	#SERV_TCP_PORT
 6000

	)

13 
	$maš
()

15 
fd
;

16 
sockaddr_š
 
my_addr
;

17 
sockaddr_š
 
£rv_addr
;

18 
buf
[128];

19 
	`echo_driv”
(, 
sockaddr_š
 *);

21 ià((
fd
 = 
	`Ãt_İ’
 ("/dev/udp", 
O_RDWR
)) < 0)

23 
	`årštf
 (
¡d”r
, "open failed.\n");

24 
	`ex™
 (-1);

29 
	`bz”o
((*è&
my_addr
, (my_addr));

30 
my_addr
.
sš_çmy
 = 
AF_INET
;

31 
my_addr
.
sš_addr
.
s_addr
 = 
	`htÚl
 (
INADDR_ANY
);

32 
my_addr
.
sš_pÜt
 = 
	`htÚs
(0);

34 
fd
 = 
	`Ãt_bšd
 (fd, &
my_addr
,  (
sockaddr_š
));

39 
	`bz”o
((*è&
£rv_addr
, (serv_addr));

40 
£rv_addr
.
sš_çmy
 = 
AF_INET
;

41 
£rv_addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
 (
SERV_HOST_ADDR
);

42 
£rv_addr
.
sš_pÜt
 = 
	`htÚs
(
SERV_TCP_PORT
);

44 
	`echo_driv”
 (
fd
, &
£rv_addr
);

45 
	`şo£
 (
fd
);

47 
	`ex™
 (0);

48 
	}
}

51 
	$echo_driv”
(
fd
, 
sockaddr_š
 *
£rv_addr
)

53 
buf
[512];

54 
n
;

55 
sockaddr_š
 
fm_addr
;

57 (
n
 = 
	`»ad
 (0, 
buf
,  (buf))) != 0)

59 
	`Ãt_£nd
 (
fd
, 
buf
, 
n
, 
£rv_addr
,  (
sockaddr_š
));

61 
n
 = 
	`Ãt_»cv
 (
fd
, 
buf
,  (buf), &
fm_addr
,  (
sockaddr_š
));

63 
	`wr™e
 (1, 
buf
, 
n
);

66 
	}
}

	@osi\unpv13e\unpv13e\streams\stream_dg\net_stream.c

1 
	~<¡dio.h
>

2 
	~<sys/ty³s.h
>

3 
	~<sys/fú.h
>

4 
	~<sys/”ºo.h
>

6 
	~<sys/¡»am.h
>

7 
	~<sys/¡rİts.h
>

8 
	~<sys/tihdr.h
>

11 
”ºo
;

14 
	$Ãt_İ’
 (*
·th
, 
oæags
, *
addr
, 
add¾’
)

16 
fd
;

17 
æags
;

19 ià((
fd
 = 
	`İ’
 (
·th
, 
oæags
)) < 0)

21 
	`³¼Ü
 ("open");

24  (
fd
);

25 
	}
}

28 
	$Ãt_bšd
 (
fd
, *
addr
, 
add¾’
)

31 
T_bšd_»q
 
msg_hdr
;

32 
addr
[128];

33 } 
bšd_»q
;

34 
¡rbuf
 
ùlbuf
;

35 
T_´im™ives
 
rcvbuf
;

36 
T_”rÜ_ack
 *
”rÜ_ack
;

37 
æags
;

39 ià(
addr
 =ğ
NULL
 || 
add¾’
 == 0)

41 
	`årštf
 (
¡d”r
, "No‡ddress\n");

45 
bšd_»q
.
msg_hdr
.
PRIM_ty³
 = 
T_BIND_REQ
;

46 
bšd_»q
.
msg_hdr
.
ADDR_Ëngth
 = 
add¾’
;

47 
bšd_»q
.
msg_hdr
.
ADDR_off£t
 =  (
T_bšd_»q
);

48 
bšd_»q
.
msg_hdr
.
CONIND_numb”
 = 5;

49 
	`bcİy
 (
addr
, 
bšd_»q
.addr, 
add¾’
);

51 
ùlbuf
.
Ën
 =  (
T_bšd_»q
è+ 
add¾’
;

52 
ùlbuf
.
buf
 = (*è&
bšd_»q
;

54 ià(
	`putmsg
 (
fd
, &
ùlbuf
, 
NULL
, 0) < 0)

61 
ùlbuf
.
maxËn
 =  (
T_´im™ives
);

62 
ùlbuf
.
Ën
 = 0;

63 
ùlbuf
.
buf
 = (*è&
rcvbuf
;

64 
æags
 = 
RS_HIPRI
;

65 ià(
	`g‘msg
 (
fd
, &
ùlbuf
, 
NULL
, &
æags
) < 0)

67 
	`³¼Ü
 ("getmsg");

71 ià(
ùlbuf
.
Ën
 <  ())

73 
	`årštf
 (
¡d”r
, "Bad†ength from getmsg.\n");

74 
”ºo
 = 
EPROTO
;

77 
rcvbuf
.
ty³
)

79 
T_BIND_ACK
:

80  (
fd
);

81 
T_ERROR_ACK
:

82 ià(
ùlbuf
.
Ën
 <  (
T_”rÜ_ack
))

84 
”ºo
 = 
EPROTO
;

87 
”rÜ_ack
 = (
T_”rÜ_ack
 *è&
rcvbuf
;

88 
	`årštf
 (
¡d”r
, "Error‡ck from bind (%d %d %d)\n",

89 
”rÜ_ack
->
ERROR_´im
,

90 
”rÜ_ack
->
TLI_”rÜ
,

91 
”rÜ_ack
->
UNIX_”rÜ
);

92 
”ºo
 = 
”rÜ_ack
->
UNIX_”rÜ
;

95 
	`årštf
 (
¡d”r
, "No‡ck from bind?\n");

96 
”ºo
 = 
EPROTO
;

100 
	}
}

102 
	$Ãt_£nd
 (
fd
, *
buf
, 
Ën
, *
to_addr
, 
add¾’
)

104 
¡rbuf
 
ùlbuf
;

105 
¡rbuf
 
d©abuf
;

107 
T_un™d©a_»q
 
un™d©a_»q
;

108 
buf
[128];

109 } 
Ãtd©a
;

111 
	`bcİy
 (
to_addr
, 
Ãtd©a
.
buf
, 
add¾’
);

112 
Ãtd©a
.
un™d©a_»q
.
PRIM_ty³
 = 
T_UNITDATA_REQ
;

113 
Ãtd©a
.
un™d©a_»q
.
DEST_Ëngth
 = 
add¾’
;

114 
Ãtd©a
.
un™d©a_»q
.
DEST_off£t
 =  (
T_un™d©a_»q
);

118 
Ãtd©a
.
un™d©a_»q
.
OPT_Ëngth
 = 0;

119 
Ãtd©a
.
un™d©a_»q
.
OPT_off£t
 = 0;

121 
ùlbuf
.
Ën
 =  (
T_un™d©a_»q
è+ 
add¾’
;

122 
ùlbuf
.
buf
 = (*è&
Ãtd©a
;

124 
d©abuf
.
Ën
 =†en;

125 
d©abuf
.
buf
 = buf;

127 ià(
	`putmsg
 (
fd
, &
ùlbuf
, &
d©abuf
, 0) < 0)

129 
	`ä“
 (
Ãtd©a
.
buf
);

130  (
Ën
);

131 
	}
}

134 
	$Ãt_»cv
 (
fd
, *
buf
, 
Ën
, *
äom_addr
, 
add¾’
)

136 
¡rbuf
 
ùlbuf
;

137 
¡rbuf
 
d©abuf
;

139 
T_un™d©a_šd
 
un™d©a_šd
;

140 
buf
[128];

141 } 
Ãtd©a
;

142 *
c
;

143 
»tv®
;

144 
æags
;

146 
ùlbuf
.
maxËn
 =  (
Ãtd©a
);

147 
ùlbuf
.
buf
 = (*è&
Ãtd©a
;

149 
d©abuf
.
maxËn
 = 
Ën
;

150 
d©abuf
.
Ën
 = 0;

151 
d©abuf
.
buf
 = buf;

153 
æags
 = 0;

155 ià((
»tv®
 = 
	`g‘msg
 (
fd
, &
ùlbuf
, &
d©abuf
, &
æags
)) < 0)

158 ià(
Ãtd©a
.
un™d©a_šd
.
PRIM_ty³
 !ğ
T_UNITDATA_IND
)

160 
	`årštf
 (
¡d”r
, "Ãt_»cv: GÙ %d\n", 
Ãtd©a
.
un™d©a_šd
.
PRIM_ty³
);

161 
”ºo
 = 
EPROTO
;

164 ià(
»tv®
)

166 
”ºo
 = 
EIO
;

172 ià(
Ãtd©a
.
un™d©a_šd
.
SRC_Ëngth
 < 
add¾’
)

173 
add¾’
 = 
Ãtd©a
.
un™d©a_šd
.
SRC_Ëngth
;

175 
c
 = (*è&
Ãtd©a
;

176 
	`bcİy
 (&(
c
[
Ãtd©a
.
un™d©a_šd
.
SRC_off£t
]),

177 
äom_addr
,

178 
add¾’
);

180  (
d©abuf
.
Ën
);

181 
	}
}

	@osi\unpv13e\unpv13e\streams\stream_dg\server.c

1 
	~<¡dio.h
>

2 
	~<sys/ty³s.h
>

3 
	~<sys/fú.h
>

4 
	~<sys/”ºo.h
>

6 
	~<sys/sock‘.h
>

7 
	~<Ãtš‘/š.h
>

9 
”ºo
;

11 
	#SERV_TCP_PORT
 6000

	)

13 
	$maš
()

15 
fd
;

16 
sockaddr_š
 
my_addr
;

17 
	`echo_£rv
 ();

19 
	`bz”o
((*è&
my_addr
, (my_addr));

20 
my_addr
.
sš_çmy
 = 
AF_INET
;

21 
my_addr
.
sš_addr
.
s_addr
 = 
	`htÚl
 (
INADDR_ANY
);

22 
my_addr
.
sš_pÜt
 = 
	`htÚs
(
SERV_TCP_PORT
);

24 
fd
 = 
	`Ãt_İ’
 ("/dev/udp", 
O_RDWR
);

25 
fd
 = 
	`Ãt_bšd
 (fd, &
my_addr
,  (
sockaddr_š
));

27 
	`echo_£rv
 (
fd
);

28 
	`ex™
 (0);

29 
	}
}

32 
	$echo_£rv
 (
fd
)

34 
sockaddr_š
 
fm_addr
;

35 
buf
[512];

36 
n
;

40 
n
 = 
	`Ãt_»cv
 (
fd
, 
buf
,  (buf),

41 &
fm_addr
,  (
sockaddr_š
));

43 
	`Ãt_£nd
 (
fd
, 
buf
, 
n
,

44 &
fm_addr
,  (
sockaddr_š
));

46 
	}
}

	@osi\unpv13e\unpv13e\streams\strlist_sock.c

1 
	~"uÅ.h
"

2 
	~<¡rİts.h
>

5 
	$maš
(
¬gc
, *
¬gv
[])

7 
fd
, 
i
, 
nmods
;

8 
¡r_li¡
 
li¡
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out {cp | udp }");

13 
fd
 = 
	`Sock‘
(
AF_INET
, (
	`¡rcmp
(
¬gv
[1], "tcp") == 0)

14 ? 
SOCK_STREAM
 : 
SOCK_DGRAM
, 0);

15 ià(
	`i§¡»am
(
fd
) == 0)

16 
	`”r_qu™
("% i nÙ‡ sŒ—m", 
¬gv
[1]);

18 
li¡
.
¦_nmods
 = 
nmods
 = 
	`Ioùl
(
fd
, 
I_LIST
, (*) 0);

19 
	`´štf
("%d moduËs\n", 
nmods
);

20 
li¡
.
¦_modli¡
 = 
	`C®loc
(
nmods
, (
¡r_mli¡
));

22 
	`Ioùl
(
fd
, 
I_LIST
, &
li¡
);

24 
i
 = 1; i <ğ
nmods
; i++)

25 
	`´štf
(" %s: %s\n", (
i
 =ğ
nmods
) ? "driver" : "module",

26 
li¡
.
¦_modli¡
++);

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\streams\strlist_xti.c

1 
	~"uÅxti.h
"

2 
	~<¡rİts.h
>

5 
	$maš
(
¬gc
, *
¬gv
[])

7 
fd
, 
i
, 
nmods
;

8 
¡r_li¡
 
li¡
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:‡.out <pathname>");

13 
fd
 = 
	`T_İ’
(
¬gv
[1], 
O_RDWR
, 
NULL
);

14 ià(
	`i§¡»am
(
fd
) == 0)

15 
	`”r_qu™
("% i nÙ‡ sŒ—m", 
¬gv
[1]);

17 
li¡
.
¦_nmods
 = 
nmods
 = 
	`Ioùl
(
fd
, 
I_LIST
, (*) 0);

18 
	`´štf
("%d moduËs\n", 
nmods
);

19 
li¡
.
¦_modli¡
 = 
	`C®loc
(
nmods
, (
¡r_mli¡
));

21 
	`Ioùl
(
fd
, 
I_LIST
, &
li¡
);

23 
i
 = 1; i <ğ
nmods
; i++)

24 
	`´štf
(" %s: %s\n", (
i
 =ğ
nmods
) ? "driver" : "module",

25 
li¡
.
¦_modli¡
++);

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\streams\tpi_bind.c

1 
	~"i_daytime.h
"

4 
	$i_bšd
(
fd
, cÚ¡ *
addr
, 
size_t
 
add¾’
)

7 
T_bšd_»q
 
msg_hdr
;

8 
addr
[128];

9 } 
bšd_»q
;

11 
T_bšd_ack
 
msg_hdr
;

12 
addr
[128];

13 } 
bšd_ack
;

14 
¡rbuf
 
ùlbuf
;

15 
T_”rÜ_ack
 *
”rÜ_ack
;

16 
æags
;

18 
bšd_»q
.
msg_hdr
.
PRIM_ty³
 = 
T_BIND_REQ
;

19 
bšd_»q
.
msg_hdr
.
ADDR_Ëngth
 = 
add¾’
;

20 
bšd_»q
.
msg_hdr
.
ADDR_off£t
 = (
T_bšd_»q
);

21 
bšd_»q
.
msg_hdr
.
CONIND_numb”
 = 0;

22 
	`memıy
(
bšd_»q
.
addr
,‡ddr, 
add¾’
);

24 
ùlbuf
.
Ën
 = (
T_bšd_»q
è+ 
add¾’
;

25 
ùlbuf
.
buf
 = (*è&
bšd_»q
;

26 
	`Putmsg
(
fd
, &
ùlbuf
, 
NULL
, 0);

28 
ùlbuf
.
maxËn
 = (
bšd_ack
);

29 
ùlbuf
.
Ën
 = 0;

30 
ùlbuf
.
buf
 = (*è&
bšd_ack
;

31 
æags
 = 
RS_HIPRI
;

32 
	`G‘msg
(
fd
, &
ùlbuf
, 
NULL
, &
æags
);

35 ià(
ùlbuf
.
Ën
 < () ())

36 
	`”r_qu™
("bad†ength from getmsg");

39 
bšd_ack
.
msg_hdr
.
PRIM_ty³
) {

40 
T_BIND_ACK
:

43 
T_ERROR_ACK
:

45 ià(
ùlbuf
.
Ën
 < (è(
T_”rÜ_ack
))

46 
	`”r_qu™
("bad†ength for T_ERROR_ACK");

47 
”rÜ_ack
 = (
T_”rÜ_ack
 *è&
bšd_ack
.
msg_hdr
;

48 
	`”r_qu™
("T_ERROR_ACK from bind (%d, %d)",

49 
”rÜ_ack
->
TLI_”rÜ
,ƒ¼Ü_ack->
UNIX_”rÜ
);

53 
	`”r_qu™
("uÃx³ùed mes§gty³: %d", 
bšd_ack
.
msg_hdr
.
PRIM_ty³
);

55 
	}
}

	@osi\unpv13e\unpv13e\streams\tpi_close.c

1 
	~"i_daytime.h
"

4 
	$i_şo£
(
fd
)

6 
T_Üd»l_»q
 
Üd»l_»q
;

7 
¡rbuf
 
ùlbuf
;

9 
Üd»l_»q
.
PRIM_ty³
 = 
T_ORDREL_REQ
;

11 
ùlbuf
.
Ën
 = (
T_Üd»l_»q
);

12 
ùlbuf
.
buf
 = (*è&
Üd»l_»q
;

13 
	`Putmsg
(
fd
, &
ùlbuf
, 
NULL
, 0);

15 
	`Clo£
(
fd
);

16 
	}
}

	@osi\unpv13e\unpv13e\streams\tpi_connect.c

1 
	~"i_daytime.h
"

4 
	$i_cÚÃù
(
fd
, cÚ¡ *
addr
, 
size_t
 
add¾’
)

7 
T_cÚn_»q
 
msg_hdr
;

8 
addr
[128];

9 } 
cÚn_»q
;

11 
T_cÚn_cÚ
 
msg_hdr
;

12 
addr
[128];

13 } 
cÚn_cÚ
;

14 
¡rbuf
 
ùlbuf
;

15 
T_´im™ives
 
rcvbuf
;

16 
T_”rÜ_ack
 *
”rÜ_ack
;

17 
T_discÚ_šd
 *
discÚ_šd
;

18 
æags
;

20 
cÚn_»q
.
msg_hdr
.
PRIM_ty³
 = 
T_CONN_REQ
;

21 
cÚn_»q
.
msg_hdr
.
DEST_Ëngth
 = 
add¾’
;

22 
cÚn_»q
.
msg_hdr
.
DEST_off£t
 = (
T_cÚn_»q
);

23 
cÚn_»q
.
msg_hdr
.
OPT_Ëngth
 = 0;

24 
cÚn_»q
.
msg_hdr
.
OPT_off£t
 = 0;

25 
	`memıy
(
cÚn_»q
.
addr
,‡ddr, 
add¾’
);

27 
ùlbuf
.
Ën
 = (
T_cÚn_»q
è+ 
add¾’
;

28 
ùlbuf
.
buf
 = (*è&
cÚn_»q
;

29 
	`Putmsg
(
fd
, &
ùlbuf
, 
NULL
, 0);

31 
ùlbuf
.
maxËn
 = (
T_´im™ives
);

32 
ùlbuf
.
Ën
 = 0;

33 
ùlbuf
.
buf
 = (*è&
rcvbuf
;

34 
æags
 = 
RS_HIPRI
;

35 
	`G‘msg
(
fd
, &
ùlbuf
, 
NULL
, &
æags
);

38 ià(
ùlbuf
.
Ën
 < () ())

39 
	`”r_qu™
("tpi_connect: bad†ength from getmsg");

42 
rcvbuf
.
ty³
) {

43 
T_OK_ACK
:

46 
T_ERROR_ACK
:

48 ià(
ùlbuf
.
Ën
 < (è(
T_”rÜ_ack
))

49 
	`”r_qu™
("tpi_connect: bad†ength for T_ERROR_ACK");

50 
”rÜ_ack
 = (
T_”rÜ_ack
 *è&
rcvbuf
;

51 
	`”r_qu™
("tpi_connect: T_ERROR_ACK from conn (%d, %d)",

52 
”rÜ_ack
->
TLI_”rÜ
,ƒ¼Ü_ack->
UNIX_”rÜ
);

56 
	`”r_qu™
("i_cÚÃù: uÃx³ùed mes§gty³: %d", 
rcvbuf
.
ty³
);

59 
ùlbuf
.
maxËn
 = (
cÚn_cÚ
);

60 
ùlbuf
.
Ën
 = 0;

61 
ùlbuf
.
buf
 = (*è&
cÚn_cÚ
;

62 
æags
 = 0;

63 
	`G‘msg
(
fd
, &
ùlbuf
, 
NULL
, &
æags
);

66 ià(
ùlbuf
.
Ën
 < () ())

67 
	`”r_qu™
("tpi_connect2: bad†ength from getmsg");

70 
cÚn_cÚ
.
msg_hdr
.
PRIM_ty³
) {

71 
T_CONN_CON
:

74 
T_DISCON_IND
:

76 ià(
ùlbuf
.
Ën
 < (è(
T_discÚ_šd
))

77 
	`”r_qu™
("tpi_connect2: bad†ength for T_DISCON_IND");

78 
discÚ_šd
 = (
T_discÚ_šd
 *è&
cÚn_cÚ
.
msg_hdr
;

79 
	`”r_qu™
("tpi_connect2: T_DISCON_IND from conn (%d)",

80 
discÚ_šd
->
DISCON_»asÚ
);

84 
	`”r_qu™
("tpi_connect2: unexpected messageype: %d",

85 
cÚn_cÚ
.
msg_hdr
.
PRIM_ty³
);

87 
	}
}

	@osi\unpv13e\unpv13e\streams\tpi_daytime.c

1 
	~"i_daytime.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
fd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockaddr_š
 
myaddr
, 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:pi_daytime <IPaddress>");

13 
fd
 = 
	`O³n
(
XTI_TCP
, 
O_RDWR
, 0);

16 
	`bz”o
(&
myaddr
, (myaddr));

17 
myaddr
.
sš_çmy
 = 
AF_INET
;

18 
myaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

19 
myaddr
.
sš_pÜt
 = 
	`htÚs
(0);

21 
	`i_bšd
(
fd
, &
myaddr
, (
sockaddr_š
));

24 
	`bz”o
(&
£rvaddr
, (servaddr));

25 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

26 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

27 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

29 
	`i_cÚÃù
(
fd
, &
£rvaddr
, (
sockaddr_š
));

32 iàĞ(
n
 = 
	`i_»ad
(
fd
, 
»cvlše
, 
MAXLINE
)) <= 0) {

33 ià(
n
 == 0)

36 
	`”r_sys
("tpi_readƒrror");

38 
»cvlše
[
n
] = 0;

39 
	`åuts
(
»cvlše
, 
¡dout
);

41 
	`i_şo£
(
fd
);

42 
	`ex™
(0);

43 
	}
}

	@osi\unpv13e\unpv13e\streams\tpi_daytime.h

1 
	~"uÅxti.h
"

2 
	~<sys/¡»am.h
>

3 
	~<sys/tihdr.h
>

5 
i_bšd
(, cÚ¡ *, 
size_t
);

6 
i_cÚÃù
(, cÚ¡ *, 
size_t
);

7 
ssize_t
 
i_»ad
(, *, 
size_t
);

8 
i_şo£
();

	@osi\unpv13e\unpv13e\streams\tpi_read.c

1 
	~"i_daytime.h
"

3 
ssize_t


4 
	$i_»ad
(
fd
, *
buf
, 
size_t
 
Ën
)

6 
¡rbuf
 
ùlbuf
;

7 
¡rbuf
 
d©buf
;

8 
T_´im™ives
 
rcvbuf
;

9 
æags
;

11 
ùlbuf
.
maxËn
 = (
T_´im™ives
);

12 
ùlbuf
.
buf
 = (*è&
rcvbuf
;

14 
d©buf
.
maxËn
 = 
Ën
;

15 
d©buf
.
buf
 = buf;

16 
d©buf
.
Ën
 = 0;

18 
æags
 = 0;

19 
	`G‘msg
(
fd
, &
ùlbuf
, &
d©buf
, &
æags
);

21 ià(
ùlbuf
.
Ën
 >= () ()) {

22 ià(
rcvbuf
.
ty³
 =ğ
T_DATA_IND
)

23 (
d©buf
.
Ën
);

24 ià(
rcvbuf
.
ty³
 =ğ
T_ORDREL_IND
)

27 
	`”r_qu™
("i_»ad: uÃx³ùedy³ %d", 
rcvbuf
.
ty³
);

28 } ià(
ùlbuf
.
Ën
 == -1)

29 (
d©buf
.
Ën
);

31 
	`”r_qu™
("tpi_read: bad†ength from getmsg");

32 
	}
}

	@osi\unpv13e\unpv13e\streams\unpxti.h

2 #iâdef 
__uÅ_xti_h


3 
	#__uÅ_xti_h


	)

5 
	~"uÅ.h
"

7 
	~<xti.h
>

8 #ifdef 
HAVE_XTI_INET_H


9 
	~<xti_š‘.h
>

11 #ifdef 
HAVE_NETCONFIG_H


12 
	~<ÃtcÚfig.h
>

14 #ifdef 
HAVE_NETDIR_H


15 
	~<Ãtdœ.h
>

18 #ifdef 
INFTIM_UNPH


19 #undeà
INFTIM


22 
	~<¡rİts.h
>

27 #iâdef 
T_INET_TCP


28 
	#T_INET_TCP
 
INET_TCP


	)

32 #iâdef 
T_INET_UDP


33 
	#T_INET_UDP
 
INET_UDP


	)

35 #iâdef 
T_INET_IP


36 
	#T_INET_IP
 
INET_IP


	)

38 #iâdef 
T_TCP_NODELAY


39 
	#T_TCP_NODELAY
 
TCP_NODELAY


	)

41 #iâdef 
T_TCP_MAXSEG


42 
	#T_TCP_MAXSEG
 
TCP_MAXSEG


	)

44 #iâdef 
T_TCP_KEEPALIVE


45 
	#T_TCP_KEEPALIVE
 
TCP_KEEPALIVE


	)

47 #iâdef 
T_UDP_CHECKSUM


48 
	#T_UDP_CHECKSUM
 
UDP_CHECKSUM


	)

50 #iâdef 
T_IP_OPTIONS


51 
	#T_IP_OPTIONS
 
IP_OPTIONS


	)

53 #iâdef 
T_IP_TOS


54 
	#T_IP_TOS
 
IP_TOS


	)

56 #iâdef 
T_IP_TTL


57 
	#T_IP_TTL
 
IP_TTL


	)

59 #iâdef 
T_IP_REUSEADDR


60 
	#T_IP_REUSEADDR
 
IP_REUSEADDR


	)

62 #iâdef 
T_IP_DONTROUTE


63 
	#T_IP_DONTROUTE
 
IP_DONTROUTE


	)

66 #iâdef 
T_IP_BROADCAST


67 
	#T_IP_BROADCAST
 
IP_BROADCAST


	)

72 #ifdef 
HAVE_DEV_TCP


73 
	#XTI_TCP
 "/dev/tı"

	)

74 
	#XTI_UDP
 "/dev/udp"

	)

76 #ifdef 
HAVE_DEV_XTI_TCP


77 
	#XTI_TCP
 "/dev/xti/tı"

	)

78 
	#XTI_UDP
 "/dev/xti/udp"

	)

80 #ifdef 
HAVE_DEV_STREAMS_XTISO_TCP


81 
	#XTI_TCP
 "/dev/¡»ams/xtiso/tı+"

	)

82 
	#XTI_UDP
 "/dev/¡»ams/xtiso/udp+"

	)

87 
xti_£rv_dev
[];

90 
”r_xti
(cÚ¡ *
fmt
, ...);

91 
”r_xti_»t
(cÚ¡ *
fmt
, ...);

93 
G‘msg
(, 
¡rbuf
 *, strbuf *, *);

94 
Putmsg
(, cÚ¡ 
¡rbuf
 *, const strbuf *, );

96 #ifdef 
HAVE_NETCONFIG_H


97 *
S‘ÃtcÚfig
();

98 *
S‘Ã©h
();

101 *
T_®loc
(, , );

102 
T_acû±
(, , 
t_ÿÎ
 *);

103 
T_bšd
(, cÚ¡ 
t_bšd
 *, t_bind *);

104 
T_şo£
();

105 
T_cÚÃù
(, cÚ¡ 
t_ÿÎ
 *, t_call *);

106 
T_ä“
(*, );

107 
T_g‘´Ùaddr
(, 
t_bšd
 *, t_bind *);

108 
T_g‘¡©e
();

109 
T_li¡’
(, 
t_ÿÎ
 *);

110 
T_look
();

111 
T_İ’
(cÚ¡ *, , 
t_šfo
 *);

112 
T_İtmgmt
(, cÚ¡ 
t_İtmgmt
 *, t_optmgmt *);

113 
T_rcv
(, *, , *);

114 
T_rcvdis
(, 
t_discÚ
 *);

115 
T_rcv»l
();

116 
T_rcvud©a
(, 
t_un™d©a
 *, *);

117 
T_rcvud”r
(, 
t_ud”r
 *);

118 
T_¢d
(, *, , );

119 
T_¢d»l
();

120 
T_¢dud©a
(, 
t_un™d©a
 *);

122 
xti_acû±
(, 
Ãtbuf
 *, );

123 
xti_g‘İt
(, , , *, 
sockËn_t
 *);

124 *
xti_æags_¡r
();

125 *
xti_ook_¡r
();

126 *
xti_Áİ
(cÚ¡ 
Ãtbuf
 *);

127 *
xti_Áİ_ho¡
(cÚ¡ 
Ãtbuf
 *);

128 
xti_rdwr
();

129 
xti_£tİt
(, , , *, 
sockËn_t
);

131 
Xti_acû±
(, 
Ãtbuf
 *, );

132 
Xti_g‘İt
(, , , *, 
sockËn_t
 *);

133 *
Xti_æags_¡r
();

134 *
Xti_ook_¡r
();

135 *
Xti_Áİ
(cÚ¡ 
Ãtbuf
 *);

136 *
Xti_Áİ_ho¡
(cÚ¡ 
Ãtbuf
 *);

137 
Xti_rdwr
();

138 
Xti_£tİt
(, , , *, 
sockËn_t
);

140 *
xti_¡r_Ënd
(
t_İthdr
 *);

141 *
xti_¡r_usÿÏrd
(
t_İthdr
 *);

142 *
xti_¡r_uch¬d
(
t_İthdr
 *);

143 *
xti_¡r_uch¬x
(
t_İthdr
 *);

144 *
xti_¡r_yn
(
t_usÿÏr_t
);

145 *
xti_¡r_syng
(
t_sÿÏr_t
);

146 *
xti_¡r_uiyn
(
t_İthdr
 *);

147 *
xti_¡r_usyn
(
t_İthdr
 *);

148 *
xti_¡r_lšg”
(
t_İthdr
 *);

149 *
xti_¡r_k·live
(
t_İthdr
 *);

150 *
xti_¡r_æags
(
t_sÿÏr_t
);

	@osi\unpv13e\unpv13e\tcpcliserv\sigchldwait.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9 
pid
 = 
	`wa™
(&
¡©
);

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

12 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\sigchldwaitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0)

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

12 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\str_cli08.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

8 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

10 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

12 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0)

13 
	`”r_qu™
("str_cli: servererminated…rematurely");

15 
	`Fputs
(
»cvlše
, 
¡dout
);

17 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\str_cli09.c

1 
	~"uÅ.h
"

2 
	~"sum.h
"

5 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

7 
£ndlše
[
MAXLINE
];

8 
¬gs
‡rgs;

9 
»suÉ
„esult;

11 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

13 ià(
	`ssÿnf
(
£ndlše
, "%ld%ld", &
¬gs
.
¬g1
, &¬gs.
¬g2
) != 2) {

14 
	`´štf
("šv®id iÅut: %s", 
£ndlše
);

17 
	`Wr™’
(
sockfd
, &
¬gs
, (args));

19 ià(
	`R—dn
(
sockfd
, &
»suÉ
, (result)) == 0)

20 
	`”r_qu™
("str_cli: servererminated…rematurely");

22 
	`´štf
("%ld\n", 
»suÉ
.
sum
);

24 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\str_cli11.c

1 
	~"uÅ.h
"

4 
	$¡r_şi
(
FILE
 *
å
, 
sockfd
)

6 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE];

8 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

10 
	`Wr™’
(
sockfd
, 
£ndlše
, 1);

11 
	`¦“p
(1);

12 
	`Wr™’
(
sockfd
, 
£ndlše
+1, 
	`¡¾’
(sendline)-1);

14 ià(
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) == 0)

15 
	`”r_qu™
("str_cli: servererminated…rematurely");

17 
	`Fputs
(
»cvlše
, 
¡dout
);

19 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\str_echo08.c

1 
	~"uÅ.h
"

4 
	$¡r_echo
(
sockfd
)

6 
¬g1
, 
¬g2
;

7 
ssize_t
 
n
;

8 
lše
[
MAXLINE
];

11 iàĞ(
n
 = 
	`R—dlše
(
sockfd
, 
lše
, 
MAXLINE
)) == 0)

14 ià(
	`ssÿnf
(
lše
, "%ld%ld", &
¬g1
, &
¬g2
) == 2)

15 
	`¢´štf
(
lše
, Öše), "%ld\n", 
¬g1
 + 
¬g2
);

17 
	`¢´štf
(
lše
, (line), "inputƒrror\n");

19 
n
 = 
	`¡¾’
(
lše
);

20 
	`Wr™’
(
sockfd
, 
lše
, 
n
);

22 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\str_echo09.c

1 
	~"uÅ.h
"

2 
	~"sum.h
"

5 
	$¡r_echo
(
sockfd
)

7 
ssize_t
 
n
;

8 
¬gs
‡rgs;

9 
»suÉ
„esult;

12 iàĞ(
n
 = 
	`R—dn
(
sockfd
, &
¬gs
, (args))) == 0)

15 
»suÉ
.
sum
 = 
¬gs
.
¬g1
 +‡rgs.
¬g2
;

16 
	`Wr™’
(
sockfd
, &
»suÉ
, (result));

18 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\sum.h

1 
	s¬gs
 {

2 
	m¬g1
;

3 
	m¬g2
;

6 
	s»suÉ
 {

7 
	msum
;

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
i
, 
sockfd
[5];

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
i
 = 0; i < 5; i++) {

13 
sockfd
[
i
] = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
[
i
], (
SA
 *è&
£rvaddr
, (servaddr));

23 
	`¡r_şi
(
¡dš
, 
sockfd
[0]);

25 
	`ex™
(0);

26 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli05.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli06.c

4 
	~"uÅ.h
"

7 
	$maš
(
¬gc
, **
¬gv
)

9 
sockfd
;

10 
sockaddr_š
 
£rvaddr
;

12 ià(
¬gc
 != 2)

13 
	`”r_qu™
("usage:cpcli <IPaddress>");

15 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

17 
	`bz”o
(&
£rvaddr
, (servaddr));

18 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

19 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

20 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

22 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

24 
	`Wr™’
(
sockfd
, "foo", 3);

25 
	`¦“p
(30);

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli07.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
	`sig_®rm
();

8 
™im”v®
 
v®
;

9 
sockaddr_š
 
£rvaddr
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage:cpcli <IPaddress>");

14 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

16 
	`bz”o
(&
£rvaddr
, (servaddr));

17 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

18 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

22 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

23 
v®
.
™_š‹rv®
.
tv_£c
 = 0;

24 
v®
.
™_š‹rv®
.
tv_u£c
 = 0;

25 
v®
.
™_v®ue
.
tv_£c
 = 0;

26 
v®
.
™_v®ue
.
tv_u£c
 = 50000;

27 ià(
	`£t™im”
(
ITIMER_REAL
, &
v®
, 
NULL
) == -1)

28 
	`”r_sys
("setitimerƒrror");

30 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

32 
	`¡r_şi
(
¡dš
, 
sockfd
);

34 
	`ex™
(0);

35 
	}
}

38 
	$sig_®rm
(
signo
)

40 
	`ex™
(0);

41 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli08.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli09.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage:cpcli <IPaddress>");

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

17 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`¡r_şi
(
¡dš
, 
sockfd
);

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli10.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
lšg”
 
lšg
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
lšg
.
l_Úoff
 = 1;

25 
lšg
.
l_lšg”
 = 0;

26 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg
, (ling));

28 
	`ex™
(0);

29 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpcli11.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
sockfd
;

8 
sockaddr_š
 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage:cpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
	`¡r_şi
(
¡dš
, 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

11 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

13 
	`bz”o
(&
£rvaddr
, (servaddr));

14 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

15 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

20 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
ş’
 = (
şŸddr
);

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

26 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

27 
	`Clo£
(
li¡’fd
);

28 
	`¡r_echo
(
cÚnfd
);

29 
	`ex™
(0);

31 
	`Clo£
(
cÚnfd
);

33 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

29 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

30 
	`Clo£
(
li¡’fd
);

31 
	`¡r_echo
(
cÚnfd
);

32 
	`ex™
(0);

34 
	`Clo£
(
cÚnfd
);

36 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv08.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpserv09.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpservpoll01.c

2 
	~"uÅ.h
"

3 
	~<lim™s.h
>

6 
	$maš
(
¬gc
, **
¬gv
)

8 
i
, 
maxi
, 
li¡’fd
, 
cÚnfd
, 
sockfd
;

9 
Ä—dy
;

10 
ssize_t
 
n
;

11 
buf
[
MAXLINE
];

12 
sockËn_t
 
ş’
;

13 
pŞlfd
 
ş›Á
[
OPEN_MAX
];

14 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

16 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

18 
	`bz”o
(&
£rvaddr
, (servaddr));

19 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

20 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

21 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

23 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

25 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

27 
ş›Á
[0].
fd
 = 
li¡’fd
;

28 
ş›Á
[0].
ev’ts
 = 
POLLRDNORM
;

29 
i
 = 1; i < 
OPEN_MAX
; i++)

30 
ş›Á
[
i
].
fd
 = -1;

31 
maxi
 = 0;

36 
Ä—dy
 = 
	`PŞl
(
ş›Á
, 
maxi
+1, 
INFTIM
);

38 ià(
ş›Á
[0].
»v’ts
 & 
POLLRDNORM
) {

39 
ş’
 = (
şŸddr
);

40 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

41 #ifdef 
NOTDEF


42 
	`´štf
("Ãw cl›Á: %s\n", 
	`Sock_Áİ
((
SA
 *è&
şŸddr
, 
ş’
));

45 
i
 = 1; i < 
OPEN_MAX
; i++)

46 ià(
ş›Á
[
i
].
fd
 < 0) {

47 
ş›Á
[
i
].
fd
 = 
cÚnfd
;

50 ià(
i
 =ğ
OPEN_MAX
)

51 
	`”r_qu™
("too many clients");

53 
ş›Á
[
i
].
ev’ts
 = 
POLLRDNORM
;

54 ià(
i
 > 
maxi
)

55 
maxi
 = 
i
;

57 ià(--
Ä—dy
 <= 0)

61 
i
 = 1; i <ğ
maxi
; i++) {

62 iàĞ(
sockfd
 = 
ş›Á
[
i
].
fd
) < 0)

64 ià(
ş›Á
[
i
].
»v’ts
 & (
POLLRDNORM
 | 
POLLERR
)) {

65 iàĞ(
n
 = 
	`»ad
(
sockfd
, 
buf
, 
MAXLINE
)) < 0) {

66 ià(
”ºo
 =ğ
ECONNRESET
) {

68 #ifdef 
NOTDEF


69 
	`´štf
("ş›Á[%d]‡bÜ‹d cÚÃùiÚ\n", 
i
);

71 
	`Clo£
(
sockfd
);

72 
ş›Á
[
i
].
fd
 = -1;

74 
	`”r_sys
("readƒrror");

75 } ià(
n
 == 0) {

77 #ifdef 
NOTDEF


78 
	`´štf
("ş›Á[%d] clo£d cÚÃùiÚ\n", 
i
);

80 
	`Clo£
(
sockfd
);

81 
ş›Á
[
i
].
fd
 = -1;

83 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

85 ià(--
Ä—dy
 <= 0)

90 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tcpservselect01.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
i
, 
maxi
, 
maxfd
, 
li¡’fd
, 
cÚnfd
, 
sockfd
;

8 
Ä—dy
, 
ş›Á
[
FD_SETSIZE
];

9 
ssize_t
 
n
;

10 
fd_£t
 
r£t
, 
®l£t
;

11 
buf
[
MAXLINE
];

12 
sockËn_t
 
ş’
;

13 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

15 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

17 
	`bz”o
(&
£rvaddr
, (servaddr));

18 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

19 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

20 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

22 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

24 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

26 
maxfd
 = 
li¡’fd
;

27 
maxi
 = -1;

28 
i
 = 0; i < 
FD_SETSIZE
; i++)

29 
ş›Á
[
i
] = -1;

30 
	`FD_ZERO
(&
®l£t
);

31 
	`FD_SET
(
li¡’fd
, &
®l£t
);

36 
r£t
 = 
®l£t
;

37 
Ä—dy
 = 
	`S–eù
(
maxfd
+1, &
r£t
, 
NULL
, NULL, NULL);

39 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
)) {

40 
ş’
 = (
şŸddr
);

41 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

42 #ifdef 
NOTDEF


43 
	`´štf
("new client: %s,…ort %d\n",

44 
	`IÃt_Áİ
(
AF_INET
, &
şŸddr
.
sš_addr
, 4, 
NULL
),

45 
	`Áohs
(
şŸddr
.
sš_pÜt
));

48 
i
 = 0; i < 
FD_SETSIZE
; i++)

49 ià(
ş›Á
[
i
] < 0) {

50 
ş›Á
[
i
] = 
cÚnfd
;

53 ià(
i
 =ğ
FD_SETSIZE
)

54 
	`”r_qu™
("too many clients");

56 
	`FD_SET
(
cÚnfd
, &
®l£t
);

57 ià(
cÚnfd
 > 
maxfd
)

58 
maxfd
 = 
cÚnfd
;

59 ià(
i
 > 
maxi
)

60 
maxi
 = 
i
;

62 ià(--
Ä—dy
 <= 0)

66 
i
 = 0; i <ğ
maxi
; i++) {

67 iàĞ(
sockfd
 = 
ş›Á
[
i
]) < 0)

69 ià(
	`FD_ISSET
(
sockfd
, &
r£t
)) {

70 iàĞ(
n
 = 
	`R—d
(
sockfd
, 
buf
, 
MAXLINE
)) == 0) {

72 
	`Clo£
(
sockfd
);

73 
	`FD_CLR
(
sockfd
, &
®l£t
);

74 
ş›Á
[
i
] = -1;

76 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

78 ià(--
Ä—dy
 <= 0)

83 
	}
}

	@osi\unpv13e\unpv13e\tcpcliserv\tsigpipe.c

1 
	~"uÅ.h
"

4 
	$sig_pe
(
signo
)

6 
	`´štf
("SIGPIPE„eceived\n");

8 
	}
}

11 
	$maš
(
¬gc
, **
¬gv
)

13 
sockfd
;

14 
sockaddr_š
 
£rvaddr
;

16 ià(
¬gc
 != 2)

17 
	`”r_qu™
("usage:cpcli <IPaddress>");

19 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

21 
	`bz”o
(&
£rvaddr
, (servaddr));

22 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

23 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(13);

24 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

26 
	`SigÇl
(
SIGPIPE
, 
sig_pe
);

28 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

30 
	`¦“p
(2);

31 
	`Wr™e
(
sockfd
, "hello", 5);

32 
	`¦“p
(2);

33 
	`Wr™e
(
sockfd
, "world", 5);

35 
	`ex™
(0);

36 
	}
}

	@osi\unpv13e\unpv13e\test\accept_eintr.c

1 
	~"uÅ.h
"

6 
	$sig_št
(
signo
)

8 
	`´štf
("received SIGINT\n");

10 
	}
}

13 
	$maš
(
¬gc
, **
¬gv
)

15 
li¡’fd
, 
cÚnfd
;

16 
sockËn_t
 
ş’
;

17 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

19 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

21 
	`bz”o
(&
£rvaddr
, (servaddr));

22 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

23 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

24 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

26 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

28 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

30 
	`SigÇl
(
SIGINT
, 
sig_št
);

33 
ş’
 = (
şŸddr
);

34 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
);

37 
	}
}

	@osi\unpv13e\unpv13e\test\funcs.c

1 
	~"‹¡.h
"

8 
	$TıSockByAddr
(*
addr
, 
pÜt
 )

10 
sockfd
;

12 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

14 
	`bz”o
(&
£rvaddr
, (servaddr));

15 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

16 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

17 
	`IÃt_±Ú
(
AF_INET
, 
addr
, &
£rvaddr
.
sš_addr
);

19 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 (
sockfd
);

22 
	}
}

30 
	$UdpSockByAddr
(*
addr
, 
pÜt
 )

32 
sockfd
;

34 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

36 
	`bz”o
(&
£rvaddr
, (servaddr));

37 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

38 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

39 
	`IÃt_±Ú
(
AF_INET
, 
addr
, &
£rvaddr
.
sš_addr
);

41 (
sockfd
);

42 
	}
}

49 
	$UdpCÚnSockByAddr
(*
addr
, 
pÜt
 )

51 
sockfd
;

53 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

55 
	`bz”o
(&
£rvaddr
, (servaddr));

56 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

57 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

58 
	`IÃt_±Ú
(
AF_INET
, 
addr
, &
£rvaddr
.
sš_addr
);

60 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

62 (
sockfd
);

63 
	}
}

	@osi\unpv13e\unpv13e\test\readline.h

2 
	m»ad_fd
;

3 *
	m»ad_±r
;

4 
size_t
 
	m»ad_maxËn
;

6 
	m¾_út
;

7 *
	m¾_buåŒ
;

8 
	m¾_buf
[
MAXLINE
];

9 } 
	tRlše
;

11 
»adlše_rš™
(, *, 
size_t
, 
Rlše
 *);

12 
ssize_t
 
»adlše_r
(
Rlše
 *);

	@osi\unpv13e\unpv13e\test\readline1.c

2 
	~"uÅ.h
"

5 
ssize_t


6 
	$»adlše
(
fd
, *
v±r
, 
size_t
 
maxËn
)

8 
ssize_t
 
n
, 
rc
;

9 
c
, *
±r
;

11 
±r
 = 
v±r
;

12 
n
 = 1;‚ < 
maxËn
;‚++) {

13 
agaš
:

14 iàĞ(
rc
 = 
	`»ad
(
fd
, &
c
, 1)) == 1) {

15 *
±r
++ = 
c
;

16 ià(
c
 == '\n')

18 } ià(
rc
 == 0) {

19 *
±r
 = 0;

20 (
n
 - 1);

22 ià(
”ºo
 =ğ
EINTR
)

23 
agaš
;

28 *
±r
 = 0;

29 (
n
);

30 
	}
}

33 
ssize_t


34 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

36 
ssize_t
 
n
;

38 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) < 0)

39 
	`”r_sys
("readlineƒrror");

40 (
n
);

41 
	}
}

	@osi\unpv13e\unpv13e\test\readline2.c

2 
	~"uÅ.h
"

4 
ssize_t


5 
	$my_»ad
(
fd
, *
±r
)

7 
»ad_út
 = 0;

8 *
»ad_±r
;

9 
»ad_buf
[
MAXLINE
];

11 ià(
»ad_út
 <= 0) {

12 iàĞ(
»ad_út
 = 
	`»ad
(
fd
, 
»ad_buf
, (read_buf))) < 0)

13 
	`”r_sys
("readƒrror");

14 ià(
»ad_út
 == 0)

16 
»ad_±r
 = 
»ad_buf
;

19 
»ad_út
--;

20 *
±r
 = *
»ad_±r
++ & 255;

22 
	}
}

24 
ssize_t


25 
	$»adlše
(
fd
, *
v±r
, 
size_t
 
maxËn
)

27 
n
, 
rc
;

28 
c
, *
±r
;

30 
±r
 = 
v±r
;

31 
n
 = 1;‚ < 
maxËn
;‚++) {

32 iàĞ(
rc
 = 
	`my_»ad
(
fd
, &
c
)) == 1) {

33 *
±r
++ = 
c
;

34 ià(
c
 == '\n')

36 } ià(
rc
 == 0) {

37 *
±r
 = 0;

38 (
n
 - 1);

43 *
±r
 = 0;

44 (
n
);

45 
	}
}

48 
ssize_t


49 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

51 
ssize_t
 
n
;

53 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) == -1)

54 
	`”r_sys
("readlineƒrror");

55 (
n
);

56 
	}
}

	@osi\unpv13e\unpv13e\test\readline3.c

2 
	~"uÅ.h
"

3 
	~"»adlše.h
"

5 
ssize_t


6 
	$my_»ad
(
Rlše
 *
½Œ
, *
±r
)

8 ià(
½Œ
->
¾_út
 <= 0) {

9 
agaš
:

10 
½Œ
->
¾_út
 = 
	`»ad
Ô±r->
»ad_fd
,„±r->
¾_buf
, (rptr->rl_buf));

11 ià(
½Œ
->
¾_út
 < 0) {

12 ià(
”ºo
 =ğ
EINTR
)

13 
agaš
;

17 ià(
½Œ
->
¾_út
 == 0)

19 
½Œ
->
¾_buåŒ
 =„±r->
¾_buf
;

22 
½Œ
->
¾_út
--;

23 *
±r
 = *
½Œ
->
¾_buåŒ
++ & 255;

25 
	}
}

28 
	$»adlše_rš™
(
fd
, *
±r
, 
size_t
 
maxËn
, 
Rlše
 *
½Œ
)

30 
½Œ
->
»ad_fd
 = 
fd
;

31 
½Œ
->
»ad_±r
 = 
±r
;

32 
½Œ
->
»ad_maxËn
 = 
maxËn
;

34 
½Œ
->
¾_út
 = 0;

35 
½Œ
->
¾_buåŒ
 =„±r->
¾_buf
;

36 
	}
}

38 
ssize_t


39 
	$»adlše_r
(
Rlše
 *
½Œ
)

41 
n
, 
rc
;

42 
c
, *
±r
;

44 
±r
 = 
½Œ
->
»ad_±r
;

45 
n
 = 1;‚ < 
½Œ
->
»ad_maxËn
;‚++) {

46 iàĞ(
rc
 = 
	`my_»ad
(
½Œ
, &
c
)) == 1) {

47 *
±r
++ = 
c
;

48 ià(
c
 == '\n')

50 } ià(
rc
 == 0) {

51 *
±r
 = 0;

52 (
n
 - 1);

57 *
±r
 = 0;

58 (
n
);

59 
	}
}

62 
ssize_t


63 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

65 
ssize_t
 
n
;

67 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) == -1)

68 
	`”r_sys
("readlineƒrror");

69 (
n
);

70 
	}
}

	@osi\unpv13e\unpv13e\test\test.h

1 
	~"uÅ.h
"

4 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

5 
buff
[8192];

6 
v”bo£
;

8 
TıSockByAddr
(*, );

9 
UdpSockByAddr
(*, );

10 
UdpCÚnSockByAddr
(*, );

	@osi\unpv13e\unpv13e\test\test1.c

1 
	~"‹¡.h
"

12 
sockaddr_š
 
	g£rvaddr
, 
	gşŸddr
;

13 
	gbuff
[8192];

14 
	gv”bo£
;

21 
	$h—d”_æags
()

25 #iâdef 
MSG_DONTROUTE


26 
	`´štf
("+ MSG_DONTROUTE‚ot defined\n");

29 #iâdef 
MSG_OOB


30 
	`´štf
("+ MSG_OOB‚ot defined\n");

33 #iâdef 
MSG_PEEK


34 
	`´štf
("+ MSG_PEEK‚ot defined\n");

37 #iâdef 
MSG_WAITALL


38 
	`´štf
("+ MSG_WAITALL‚ot defined\n");

40 
	}
}

49 
	$£ndto_01
()

51 
sockfd
, 
n
;

52 
sockËn_t
 
Ën
;

54 
sockfd
 = 
	`TıSockByAddr
("140.252.13.34", 7);

61 
	`S’dto
(
sockfd
, "h–lo", 5, 0, 
NULL
, NULL);

63 iàĞ(
n
 = 
	`Recväom
(
sockfd
, 
buff
, (buff), 0, 
NULL
, NULL)) != 5)

64 
	`”r_qu™
("! Recvfromƒxpected 5");

72 
	`S’dto
(
sockfd
, "wÜld", 5, 0, 
NULL
, NULL);

74 
Ën
 = (
£rvaddr
) * 2;

75 iàĞ(
n
 = 
	`Recväom
(
sockfd
, 
buff
, (buff), 0,

76 (
SA
 *è&
£rvaddr
, &
Ën
)) != 5)

77 
	`”r_qu™
("! Recvfromƒxpected 5");

78 ià(
Ën
 != 0) {

79 
	`”r_msg
("+„ecvfrom on TCP socket„eturns†en = %d for sender's‡ddr",

80 
Ën
);

81 ià(
Ën
 =ğ(
£rvaddr
))

82 
	`´štf
("„ecvfrom from %s,…ort %d\n",

83 
	`š‘_Áß
(
£rvaddr
.
sš_addr
), 
	`Áohs
(£rvaddr.
sš_pÜt
));

86 
	`Clo£
(
sockfd
);

93 
sockfd
 = 
	`TıSockByAddr
("140.252.13.34", 7);

96 
n
 = 
	`£ndto
(
sockfd
, "h–lo1", 6, 0, (
SA
 *è&
£rvaddr
, (servaddr));

97 ià(
n
 < 0)

98 
	`”r_»t
("sendto on TCP socket specifying dest‡ddr„eturnsƒrror");

99 ià(
n
 == 6)

100 #ifdef 
MSG_EOF


101 
	`”r_msg
("+ sendto on TCP socket specifying dest‡ddr OK (T/TCP supported)");

103 
	`”r_msg
("+ sendto on TCP socket specifying dest‡ddr OK");

106 
	`”r_qu™
("! s’dtØÚ TCP sock‘ s³cifyšg de¡‡ddr,‚ = %d", 
n
);

108 
	`Clo£
(
sockfd
);

114 
sockfd
 = 
	`UdpSockByAddr
("140.252.13.34", 7);

117 iàĞ(
n
 = 
	`£ndto
(
sockfd
, "h–lo12", 7, 0, (
SA
 *) 0, 0)) >= 0)

118 
	`”r_msg
("+ s’dtØÚ uncÚÃùed UDP w™houˆde¡‡dd¸OK,‚ = %d", 
n
);

119 ià(
”ºo
 !ğ
EDESTADDRREQ
)

120 
	`”r_»t
("+ sendto on unconnected UDP without dest‡ddr, unexpectedƒrrno");

123 iàĞ(
n
 = 
	`wr™e
(
sockfd
, "hello", 7)) >= 0)

124 
	`”r_msg
("+ wr™Ú uncÚÃùed UDP OK,‚ = %d", 
n
);

125 ià(
”ºo
 !ğ
EDESTADDRREQ
)

126 
	`”r_»t
("+ write on unconnected UDP, unexpectedƒrrno");

128 
	`Clo£
(
sockfd
);

134 
sockfd
 = 
	`UdpCÚnSockByAddr
("140.252.13.34", 7);

137 iàĞ(
n
 = 
	`wr™e
(
sockfd
, "hello123", 8)) < 0)

138 
	`”r_sys
("! wr™Ú cÚÃùed UDP,‚ = %d", 
n
);

139 ià(
n
 != 8)

140 
	`”r_qu™
("! wr™Ú cÚÃùed UDP,‚ = %d", 
n
);

143 iàĞ(
n
 = 
	`£ndto
(
sockfd
, "h–lo1234", 9, 0, (
SA
 *) 0, 0)) < 0)

144 
	`”r_sys
("! s’dtØÚ cÚÃùed UDP w™houˆde¡‡ddr,‚ = %d", 
n
);

145 ià(
n
 != 9)

146 
	`”r_qu™
("! s’dtØÚ cÚÃùed UDP w™houˆde¡‡ddr,‚ = %d", 
n
);

149 
n
 = 
	`£ndto
(
sockfd
, "h–lo12345", 10, 0, (
SA
 *è&
£rvaddr
, (servaddr));

150 ià(
n
 < 0 && 
”ºo
 !ğ
EISCONN
)

151 
	`”r_»t
("+ sendto on connected UDP with dest‡ddr, unexpectedƒrrno");

152 ià(
n
 >= 0)

153 
	`”r_msg
("+ s’dtØÚ cÚÃùed UDP w™h de¡‡dd¸OK,‚ = %d", 
n
);

155 
	`Clo£
(
sockfd
);

156 
	}
}

165 
	$udp_01
()

167 
	}
}

170 
	$u§ge
(cÚ¡ *
msg
)

172 
	`”r_msg
(

176 ià(
msg
[0] != 0)

177 
	`”r_qu™
("%s", 
msg
);

178 
	`ex™
(1);

179 
	}
}

182 
	$maš
(
¬gc
, **
¬gv
)

184 
c
;

186 
İ‹¼
 = 0;

187  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "v")) != -1) {

188 
c
) {

190 
v”bo£
 = 1;

194 
	`u§ge
("unrecognized option");

198 ià(
v”bo£
è
	`´štf
("header_flags\n");

199 
	`h—d”_æags
();

201 ià(
v”bo£
è
	`´štf
("udp_01\n");

202 
	`udp_01
();

204 ià(
v”bo£
è
	`´štf
("sendto_01\n");

205 
	`£ndto_01
();

206 
	}
}

	@osi\unpv13e\unpv13e\test\test2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
§Ën
;

8 
addršfo
 *
»s
;

9 
sockaddr
 *
şi
, *
£rv
;

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage:est2 <IPaddress>");

14 #ifdef 
nÙdef


15 
»s
 = 
	`Ho¡_£rv
(
¬gv
[1], "daytime", 
AF_UNSPEC
, 
SOCK_DGRAM
);

16 
	`´štf
("»s->ai_add¾’ = %d\n", 
»s
->
ai_add¾’
);

17 
	`´štf
("»s->ai_add¸ğ%p\n", 
»s
->
ai_addr
);

18 
	`´štf
("»s->ai_Ãxˆğ%p\n", 
»s
->
ai_Ãxt
);

19 
	`´štf
("»s->ai_addr->§_çmy = %p\n", 
»s
->
ai_addr
->
§_çmy
);

21 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1], "13", (**è&
£rv
, &
§Ën
);

22 
	`´štf
("sockfd = %d\n", 
sockfd
);

24 
	`ex™
(0);

25 
	}
}

26 #ifdef 
nÙdef


28 
	$udp_ş›Á
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, **
§±r
, 
sockËn_t
 *
ËÅ
)

30 
sockfd
, 
n
;

31 
addršfo
 
hšts
, *
»s
, *
»s§ve
;

33 
	`bz”o
(&
hšts
, (
addršfo
));

34 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

35 
hšts
.
ai_sockty³
 = 
SOCK_DGRAM
;

37 iàĞ(
n
 = 
	`g‘addršfo
(
ho¡
, 
£rv
, &
hšts
, &
»s
)) != 0)

38 
	`”r_qu™
("udp_clientƒrror for %s, %s: %s",

39 
ho¡
, 
£rv
, 
	`gai_¡»¼Ü
(
n
));

40 
»s§ve
 = 
»s
;

43 
sockfd
 = 
	`sock‘
(
»s
->
ai_çmy
,„es->
ai_sockty³
,„es->
ai_´ÙocŞ
);

44 ià(
sockfd
 >= 0)

46 }  (
»s
 =„es->
ai_Ãxt
è!ğ
NULL
);

48 ià(
»s
 =ğ
NULL
)

49 
	`”r_sys
("udp_ş›Áƒ¼Ü fÜ %s, %s", 
ho¡
, 
£rv
);

51 *
§±r
 = 
	`M®loc
(
»s
->
ai_add¾’
);

52 
	`memıy
(*
§±r
, 
»s
->
ai_addr
,„es->
ai_add¾’
);

53 *
ËÅ
 = 
»s
->
ai_add¾’
;

55 
	`ä“addršfo
(
»s§ve
);

57 (
sockfd
);

58 
	}
}

61 
	$Udp_ş›Á
(cÚ¡ *
ho¡
, cÚ¡ *
£rv
, **
§±r
, 
sockËn_t
 *
ËÅŒ
)

63 (
	`udp_ş›Á
(
ho¡
, 
£rv
, 
§±r
, 
ËÅŒ
));

64 
	}
}

	@osi\unpv13e\unpv13e\test\tisfdtype.c

1 
	~"uÅ.h
"

3 
	$maš
()

5 
tısock
, 
udpsock
;

7 
	`´štf
("¡dš: %d\n", 
	`Isfdty³
(
STDIN_FILENO
, 
S_IFSOCK
));

8 
	`´štf
("¡dout: %d\n", 
	`Isfdty³
(
STDOUT_FILENO
, 
S_IFSOCK
));

9 
	`´štf
("¡d”r: %d\n", 
	`Isfdty³
(
STDERR_FILENO
, 
S_IFSOCK
));

11 
tısock
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

12 
	`´štf
("TCP sock‘: %d\n", 
	`Isfdty³
(
tısock
, 
S_IFSOCK
));

14 
udpsock
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

15 
	`´štf
("UDP sock‘: %d\n", 
	`Isfdty³
(
udpsock
, 
S_IFSOCK
));

17 
	`ex™
(0);

18 
	}
}

	@osi\unpv13e\unpv13e\test\treadline1.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
couÁ
 = 0;

7 
ssize_t
 
n
;

8 
»cvlše
[
MAXLINE
];

10  ( 
n
 = 
	`»adlše
(
STDIN_FILENO
, 
»cvlše
, 
MAXLINE
)) > 0)

11 
couÁ
++;

12 
	`´štf
("%d†šes\n", 
couÁ
);

13 
	}
}

	@osi\unpv13e\unpv13e\test\treadline2.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
couÁ
 = 0;

7 
ssize_t
 
n
;

8 
»cvlše
[
MAXLINE
];

10  ( 
n
 = 
	`»adlše
(
STDIN_FILENO
, 
»cvlše
, 
MAXLINE
)) > 0)

11 
couÁ
++;

12 
	`´štf
("%d†šes\n", 
couÁ
);

13 
	}
}

	@osi\unpv13e\unpv13e\test\treadline3.c

1 
	~"uÅ.h
"

2 
	~"»adlše.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
couÁ
 = 0;

8 
ssize_t
 
n
;

9 
»cvlše
[
MAXLINE
];

10 
Rlše
 
¾še
;

12 
	`»adlše_rš™
(
STDIN_FILENO
, 
»cvlše
, 
MAXLINE
, &
¾še
);

13  (
n
 = 
	`»adlše_r
(&
¾še
)) > 0)

14 
couÁ
++;

15 
	`´štf
("%d†šes\n", 
couÁ
);

16 
	}
}

	@osi\unpv13e\unpv13e\test\tshutdown.c

1 
	~"uÅ.h
"

3 
	#BUFF
 100000

	)

4 
	gbuff
[
BUFF
];

7 
	$maš
(
¬gc
, **
¬gv
)

9 
sockfd
, 
nby‹s
;

10 
ssize_t
 
n
;

12 ià(
¬gc
 != 3)

13 
	`”r_qu™
("usage:shutdown <hostname> <service>");

15 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

16 
	`årštf
(
¡d”r
, "connected\n");

18  (
n
 = 
	`R—d
(
STDIN_FILENO
, 
buff
, 
BUFF
)) > 0) {

19 
	`Wr™’
(
sockfd
, 
buff
, 
n
);

21 
	`Clo£
(
STDIN_FILENO
);

24 
nby‹s
 = 0;

25  (
n
 = 
	`R—d
(
sockfd
, 
buff
, 
BUFF
)) > 0) {

27 
	`Wr™e
(
STDOUT_FILENO
, 
buff
, 
n
);

28 
nby‹s
 +ğ
n
;

30 
	`årštf
(
¡d”r
, "tÙ®: %d by‹ »ad from sock‘\n", 
nby‹s
);

31 
	`Clo£
(
STDOUT_FILENO
);

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\test\tsnprintf.c

13 
	~"uÅ.h
"

16 
	$maš
(
¬gc
, **
¬gv
)

18 
n
;

19 
buf
[1024];

21 
n
 = 
	`¢´štf
(
buf
, 4, "%d", 9999);

22 ià(
n
 > 3)

23 
	`´štf
("”rÜ: sÅrštàov”æowed bufãr,‚ = %d\n", 
n
);

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\threads\example01.c

1 
	~"uÅth»ad.h
"

3 
	#NLOOP
 5000

	)

5 
	gcouÁ”
;

7 *
do™
(*);

10 
	$maš
(
¬gc
, **
¬gv
)

12 
±h»ad_t
 
tidA
, 
tidB
;

14 
	`Pth»ad_ü—‹
(&
tidA
, 
NULL
, &
do™
, NULL);

15 
	`Pth»ad_ü—‹
(&
tidB
, 
NULL
, &
do™
, NULL);

18 
	`Pth»ad_još
(
tidA
, 
NULL
);

19 
	`Pth»ad_još
(
tidB
, 
NULL
);

21 
	`ex™
(0);

22 
	}
}

25 
	$do™
(*
v±r
)

27 
i
, 
v®
;

34 
i
 = 0; i < 
NLOOP
; i++) {

35 
v®
 = 
couÁ”
;

36 
	`´štf
("%d: %d\n", 
	`±h»ad_£lf
(), 
v®
 + 1);

37 
couÁ”
 = 
v®
 + 1;

40 (
NULL
);

41 
	}
}

	@osi\unpv13e\unpv13e\threads\example02.c

1 
	~"uÅth»ad.h
"

3 
	#NLOOP
 5000

	)

5 
	gcouÁ”
;

6 
±h»ad_mu‹x_t
 
	gcouÁ”_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

8 *
do™
(*);

11 
	$maš
(
¬gc
, **
¬gv
)

13 
±h»ad_t
 
tidA
, 
tidB
;

15 
	`Pth»ad_ü—‹
(&
tidA
, 
NULL
, &
do™
, NULL);

16 
	`Pth»ad_ü—‹
(&
tidB
, 
NULL
, &
do™
, NULL);

19 
	`Pth»ad_još
(
tidA
, 
NULL
);

20 
	`Pth»ad_još
(
tidB
, 
NULL
);

22 
	`ex™
(0);

23 
	}
}

26 
	$do™
(*
v±r
)

28 
i
, 
v®
;

35 
i
 = 0; i < 
NLOOP
; i++) {

36 
	`Pth»ad_mu‹x_lock
(&
couÁ”_mu‹x
);

38 
v®
 = 
couÁ”
;

39 
	`´štf
("%d: %d\n", 
	`±h»ad_£lf
(), 
v®
 + 1);

40 
couÁ”
 = 
v®
 + 1;

42 
	`Pth»ad_mu‹x_uÆock
(&
couÁ”_mu‹x
);

45 (
NULL
);

46 
	}
}

	@osi\unpv13e\unpv13e\threads\example03.c

1 
	~"uÅth»ad.h
"

3 
	#Pth»ad_mu‹x_lock
(
m±r
) \

4 { 
n
; \

5 iàĞ(
n
 = 
	`±h»ad_mu‹x_lock
(
m±r
)) != 0) \

6 { 
”ºo
 = 
n
; 
	`”r_sys
("pthread_mutex_lockƒrror"); } \

7 }

	)

8 
	#Pth»ad_mu‹x_uÆock
(
m±r
) \

9 { 
n
; \

10 iàĞ(
n
 = 
	`±h»ad_mu‹x_uÆock
(
m±r
)) != 0) \

11 { 
”ºo
 = 
n
; 
	`”r_sys
("pthread_mutex_unlockƒrror"); } \

12 }

	)

13 
	#Pth»ad_cÚd_wa™
(
ıŒ
,
m±r
) \

14 { 
n
; \

15 iàĞ(
n
 = 
	`±h»ad_cÚd_wa™
(
ıŒ
,
m±r
)) != 0) \

16 { 
”ºo
 = 
n
; 
	`”r_sys
("pthread_cond_waitƒrror"); } \

17 }

	)

18 
	#Pth»ad_cÚd_sigÇl
(
ıŒ
) \

19 { 
n
; \

20 iàĞ(
n
 = 
	`±h»ad_cÚd_sigÇl
(
ıŒ
)) != 0) \

21 { 
”ºo
 = 
n
; 
	`”r_sys
("pthread_cond_signalƒrror"); } \

22 }

	)

24 
	#NLOOP
 50

	)

25 
	#BUFFSIZE
 10

	)

27 
	sbuf_t
 {

28 
	mb_buf
[
BUFFSIZE
];

29 
	mb_n™ems
;

30 
	mb_Ãxtg‘
;

31 
	mb_Ãxut
;

32 
±h»ad_mu‹x_t
 
	mb_mu‹x
;

33 
±h»ad_cÚd_t
 
	mb_cÚd_cÚsum”
;

34 
±h»ad_cÚd_t
 
	mb_cÚd_´oduûr
;

35 } 
	gbuf_t
;

37 *
´oduû_loİ
(*);

38 *
cÚsume_loİ
(*);

41 
	$maš
(
¬gc
, **
¬gv
)

43 
n
;

44 
±h»ad_t
 
tidA
, 
tidB
;

46 
	`´štf
("main,‡ddr(stack) = %x,‡ddr(global) = %x,‡ddr(func) = %x\n",

47 &
n
, &
buf_t
, &
´oduû_loİ
);

48 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tidA
, 
NULL
, &
´oduû_loİ
, NULL)) != 0)

49 
”ºo
 = 
n
, 
	`”r_sys
("pthread_createƒrror for A");

50 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tidB
, 
NULL
, &
cÚsume_loİ
, NULL)) != 0)

51 
”ºo
 = 
n
, 
	`”r_sys
("pthread_createƒrror for B");

54 iàĞ(
n
 = 
	`±h»ad_još
(
tidA
, 
NULL
)) != 0)

55 
”ºo
 = 
n
, 
	`”r_sys
("pthread_joinƒrror for A");

56 iàĞ(
n
 = 
	`±h»ad_još
(
tidB
, 
NULL
)) != 0)

57 
”ºo
 = 
n
, 
	`”r_sys
("pthread_joinƒrror for B");

59 
	`ex™
(0);

60 
	}
}

63 
	$´oduû
(
buf_t
 *
b±r
, 
v®
)

65 
	`Pth»ad_mu‹x_lock
(&
b±r
->
b_mu‹x
);

67 
b±r
->
b_n™ems
 >ğ
BUFFSIZE
)

68 
	`Pth»ad_cÚd_wa™
(&
b±r
->
b_cÚd_´oduûr
, &b±r->
b_mu‹x
);

71 
	`´štf
("´oduû %d\n", 
v®
);

72 
b±r
->
b_buf
[b±r->
b_Ãxut
] = 
v®
;

73 ià(++
b±r
->
b_Ãxut
 >ğ
BUFFSIZE
)

74 
b±r
->
b_Ãxut
 = 0;

75 
b±r
->
b_n™ems
++;

78 
	`Pth»ad_cÚd_sigÇl
(&
b±r
->
b_cÚd_cÚsum”
);

79 
	`Pth»ad_mu‹x_uÆock
(&
b±r
->
b_mu‹x
);

80 
	}
}

83 
	$cÚsume
(
buf_t
 *
b±r
)

85 
v®
;

87 
	`Pth»ad_mu‹x_lock
(&
b±r
->
b_mu‹x
);

89 
b±r
->
b_n™ems
 <= 0)

90 
	`Pth»ad_cÚd_wa™
(&
b±r
->
b_cÚd_cÚsum”
, &b±r->
b_mu‹x
);

93 
v®
 = 
b±r
->
b_buf
[b±r->
b_Ãxtg‘
];

94 
	`´štf
("cÚsum%d\n", 
v®
);

95 ià(++
b±r
->
b_Ãxtg‘
 >ğ
BUFFSIZE
)

96 
b±r
->
b_Ãxtg‘
 = 0;

97 
b±r
->
b_n™ems
--;

100 
	`Pth»ad_cÚd_sigÇl
(&
b±r
->
b_cÚd_´oduûr
);

101 
	`Pth»ad_mu‹x_uÆock
(&
b±r
->
b_mu‹x
);

103 (
v®
);

104 
	}
}

107 
	$´oduû_loİ
(*
v±r
)

109 
i
;

111 
	`´štf
("´oduû_loİh»ad,‡ddr(¡ackèğ%x\n", &
i
);

112 
i
 = 0; i < 
NLOOP
; i++) {

113 
	`´oduû
(&
buf_t
, 
i
);

116 (
NULL
);

117 
	}
}

120 
	$cÚsume_loİ
(*
v±r
)

122 
i
, 
v®
;

124 
	`´štf
("cÚsume_loİh»ad,‡ddr(¡ackèğ%x\n", &
i
);

125 
i
 = 0; i < 
NLOOP
; i++) {

126 
v®
 = 
	`cÚsume
(&
buf_t
);

129 (
NULL
);

130 
	}
}

	@osi\unpv13e\unpv13e\threads\readline.c

2 
	~"uÅth»ad.h
"

4 
±h»ad_key_t
 
	g¾_key
;

5 
±h»ad_Úû_t
 
	g¾_Úû
 = 
PTHREAD_ONCE_INIT
;

8 
	$»adlše_de¡ruùÜ
(*
±r
)

10 
	`ä“
(
±r
);

11 
	}
}

14 
	$»adlše_Úû
()

16 
	`Pth»ad_key_ü—‹
(&
¾_key
, 
»adlše_de¡ruùÜ
);

17 
	}
}

20 
	m¾_út
;

21 *
	m¾_buåŒ
;

22 
	m¾_buf
[
MAXLINE
];

23 } 
	tRlše
;

27 
ssize_t


28 
	$my_»ad
(
Rlše
 *
tsd
, 
fd
, *
±r
)

30 ià(
tsd
->
¾_út
 <= 0) {

31 
agaš
:

32 iàĞ(
tsd
->
¾_út
 = 
	`»ad
(
fd
,sd->
¾_buf
, 
MAXLINE
)) < 0) {

33 ià(
”ºo
 =ğ
EINTR
)

34 
agaš
;

36 } ià(
tsd
->
¾_út
 == 0)

38 
tsd
->
¾_buåŒ
 =sd->
¾_buf
;

41 
tsd
->
¾_út
--;

42 *
±r
 = *
tsd
->
¾_buåŒ
++;

44 
	}
}

46 
ssize_t


47 
	$»adlše
(
fd
, *
v±r
, 
size_t
 
maxËn
)

49 
size_t
 
n
, 
rc
;

50 
c
, *
±r
;

51 
Rlše
 *
tsd
;

53 
	`Pth»ad_Úû
(&
¾_Úû
, 
»adlše_Úû
);

54 iàĞ(
tsd
 = 
	`±h»ad_g‘¥ecific
(
¾_key
)è=ğ
NULL
) {

55 
tsd
 = 
	`C®loc
(1, (
Rlše
));

56 
	`Pth»ad_£t¥ecific
(
¾_key
, 
tsd
);

59 
±r
 = 
v±r
;

60 
n
 = 1;‚ < 
maxËn
;‚++) {

61 iàĞ(
rc
 = 
	`my_»ad
(
tsd
, 
fd
, &
c
)) == 1) {

62 *
±r
++ = 
c
;

63 ià(
c
 == '\n')

65 } ià(
rc
 == 0) {

66 *
±r
 = 0;

67 (
n
 - 1);

72 *
±r
 = 0;

73 (
n
);

74 
	}
}

77 
ssize_t


78 
	$R—dlše
(
fd
, *
±r
, 
size_t
 
maxËn
)

80 
ssize_t
 
n
;

82 iàĞ(
n
 = 
	`»adlše
(
fd
, 
±r
, 
maxËn
)) < 0)

83 
	`”r_sys
("readlineƒrror");

84 (
n
);

85 
	}
}

	@osi\unpv13e\unpv13e\threads\strclithread.c

1 
	~"uÅth»ad.h
"

3 *
cİyto
(*);

5 
	gsockfd
;

6 
FILE
 *
	gå
;

9 
	$¡r_şi
(
FILE
 *
å_¬g
, 
sockfd_¬g
)

11 
»cvlše
[
MAXLINE
];

12 
±h»ad_t
 
tid
;

14 
sockfd
 = 
sockfd_¬g
;

15 
å
 = 
å_¬g
;

17 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, 
cİyto
, NULL);

19 
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) > 0)

20 
	`Fputs
(
»cvlše
, 
¡dout
);

21 
	}
}

24 
	$cİyto
(*
¬g
)

26 
£ndlše
[
MAXLINE
];

28 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
)

29 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

31 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

33 (
NULL
);

35 
	}
}

	@osi\unpv13e\unpv13e\threads\strclithread2.c

1 
	~"uÅth»ad.h
"

3 *
cİyto
(*);

5 
	gsockfd
;

6 
FILE
 *
	gå
;

7 
	gdÚe
;

10 
	$¡r_şi
(
FILE
 *
å_¬g
, 
sockfd_¬g
)

12 
»cvlše
[
MAXLINE
];

13 
±h»ad_t
 
tid
;

15 
sockfd
 = 
sockfd_¬g
;

16 
å
 = 
å_¬g
;

18 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, 
cİyto
, NULL);

20 
	`R—dlše
(
sockfd
, 
»cvlše
, 
MAXLINE
) > 0)

21 
	`Fputs
(
»cvlše
, 
¡dout
);

23 ià(
dÚe
 == 0)

24 
	`”r_qu™
("servererminated…rematurely");

25 
	}
}

28 
	$cİyto
(*
¬g
)

30 
£ndlše
[
MAXLINE
];

32 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
)

33 
	`Wr™’
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

35 
	`Shutdown
(
sockfd
, 
SHUT_WR
);

37 
dÚe
 = 1;

38 (
NULL
);

40 
	}
}

	@osi\unpv13e\unpv13e\threads\tcpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpcli <hostname> <service>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`¡r_şi
(
¡dš
, 
sockfd
);

15 
	`ex™
(0);

16 
	}
}

	@osi\unpv13e\unpv13e\threads\tcpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

8 ià(
¬gc
 != 3)

9 
	`”r_qu™
("usage:cpcli <hostname> <service>");

11 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

13 
	`¡r_şi
(
¡dš
, 
sockfd
);

15 
	`ex™
(0);

16 
	}
}

	@osi\unpv13e\unpv13e\threads\tcpserv01.c

1 
	~"uÅth»ad.h
"

3 *
do™
(*);

6 
	$maš
(
¬gc
, **
¬gv
)

8 
li¡’fd
, 
cÚnfd
;

9 
±h»ad_t
 
tid
;

10 
sockËn_t
 
add¾’
, 
Ën
;

11 
sockaddr
 *
şŸddr
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage:cpserv01 [ <host> ] <service or…ort>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
Ën
 = 
add¾’
;

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

25 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, &
do™
, (*è
cÚnfd
);

27 
	}
}

30 
	$do™
(*
¬g
)

32 
	`Pth»ad_d‘ach
(
	`±h»ad_£lf
());

33 
	`¡r_echo
((è
¬g
);

34 
	`Clo£
((è
¬g
);

35 (
NULL
);

36 
	}
}

	@osi\unpv13e\unpv13e\threads\tcpserv02.c

1 
	~"uÅth»ad.h
"

3 *
do™
(*);

6 
	$maš
(
¬gc
, **
¬gv
)

8 
li¡’fd
, *
Œ
;

9 
th»ad_t
 
tid
;

10 
sockËn_t
 
add¾’
, 
Ën
;

11 
sockaddr
 *
şŸddr
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage:cpserv01 [ <host> ] <service or…ort>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
Ën
 = 
add¾’
;

24 
Œ
 = 
	`M®loc
(());

25 *
Œ
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

26 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, &
do™
, 
Œ
);

28 
	}
}

31 
	$do™
(*
¬g
)

33 
cÚnfd
;

35 
cÚnfd
 = *((*è
¬g
);

36 
	`ä“
(
¬g
);

38 
	`Pth»ad_d‘ach
(
	`±h»ad_£lf
());

39 
	`¡r_echo
(
cÚnfd
);

40 
	`Clo£
(
cÚnfd
);

41 (
NULL
);

42 
	}
}

	@osi\unpv13e\unpv13e\threads\test01.c

1 
	~"uÅth»ad.h
"

4 
	$myfunc
(*
±r
)

6 
	`·u£
();

7 
	}
}

10 
	$maš
(
¬gc
, **
¬gv
)

12 
±h»ad_t
 
tid
;

13 
n
;

17 
”ºo
 = 0;

18 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tid
, 
NULL
, 
myfunc
, NULL)) != 0) {

19 
	`´štf
("±h»ad_ü—‹„‘uºed %d,ƒ¼nØğ%d\n", 
n
, 
”ºo
);

21 
”ºo
 = 0;

22 
n
 = 
	`±h»ad_još
(777777, 
NULL
);

23 
	`´štf
("±h»ad_još„‘uºed %d,ƒ¼nØğ%d\n", 
n
, 
”ºo
);

25 
	`ex™
(0);

27 
	`´štf
("ü—‹did %d\n", 
tid
);

29 
	}
}

	@osi\unpv13e\unpv13e\threads\test02.c

1 
	~"uÅth»ad.h
"

4 
	$myfunc
(*
±r
)

6 
v®
;

8 
	`´štf
("th»ad ID oàmyfunc: %d\n", 
	`±h»ad_£lf
());

10 
v®
 = *((*è
±r
);

11 
	`´štf
("v® = %d\n", 
v®
);

12 
	`¦“p
(10);

13 
v®
 = *((*è
±r
);

14 
	`´štf
("v® = %d\n", 
v®
);

15 
	}
}

18 
	$maš
(
¬gc
, **
¬gv
)

20 
±h»ad_t
 
tid
;

21 
n
, 
v®
;

23 
	`´štf
("th»ad ID oàmaš: %d\n", 
	`±h»ad_£lf
());

27 
v®
 = 123;

28 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tid
, 
NULL
, 
myfunc
, &
v®
)) != 0)

29 
”ºo
 = 
n
, 
	`”r_sys
("pthread_createƒrror");

30 
	`¦“p
(5);

31 
v®
 = 789;

32 
	`¦“p
(20);

33 
	`ex™
(0);

34 
	}
}

	@osi\unpv13e\unpv13e\threads\test03.c

3 
	~"uÅth»ad.h
"

5 
	gndÚe
;

6 
±h»ad_mu‹x_t
 
	gndÚe_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

7 
±h»ad_cÚd_t
 
	gndÚe_cÚd
 = 
PTHREAD_COND_INITIALIZER
;

10 
	$myfunc
(*
±r
)

12 
v®
;

14 
	`¦“p
(100);

15 (
NULL
);

16 
	}
}

19 
	$maš
(
¬gc
, **
¬gv
)

21 
±h»ad_t
 
tid
;

22 
n
, 
v®
;

23 
timev®
 
tv
;

24 
time¥ec
 
ts
;

26 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tid
, 
NULL
, 
myfunc
, &
v®
)) != 0)

27 
”ºo
 = 
n
, 
	`”r_sys
("pthread_createƒrror");

29 ià(
	`g‘timeofday
(&
tv
, 
NULL
) < 0)

30 
	`”r_sys
("gettimeofdayƒrror");

31 
ts
.
tv_£c
 = 
tv
.tv_sec + 5;

32 
ts
.
tv_n£c
 = 
tv
.
tv_u£c
 * 1000;

34 iàĞ(
n
 = 
	`±h»ad_mu‹x_lock
(&
ndÚe_mu‹x
)) != 0)

35 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_lockƒrror");

36 
ndÚe
 == 0)

37 iàĞ(
n
 = 
	`±h»ad_cÚd_timedwa™
(&
ndÚe_cÚd
, &
ndÚe_mu‹x
, &
ts
)) != 0){

38 ià(
n
 =ğ
ETIME
)

39 
	`”r_qu™
("timewaitimed out");

40 
”ºo
 = 
n
, 
	`”r_sys
("pthread_cond_timedwaitƒrror");

43 iàĞ(
n
 = 
	`±h»ad_mu‹x_uÆock
(&
ndÚe_mu‹x
)) != 0)

44 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_unlockƒrror");

46 
	`ex™
(0);

47 
	}
}

	@osi\unpv13e\unpv13e\threads\test04.c

3 
	~"uÅth»ad.h
"

5 *
	gšfe
;

8 
	$myfunc
(*
±r
)

10 
i
, 
fdš
;

11 
buf
[
MAXLINE
];

12 
FILE
 *
åout
;

14 
	`¢´štf
(
buf
, (buf), "‹mp.%d", 
	`±h»ad_£lf
());

15 
åout
 = 
	`Fİ’
(
buf
, "w+");

18 
i
 = 0; i < 5; i++) {

19 
fdš
 = 
	`O³n
(
šfe
, 
O_RDONLY
, 0);

21 
	`R—dlše
(
fdš
, 
buf
, (buf)) > 0) {

22 
	`åuts
(
buf
, 
åout
);

24 
	`Clo£
(
fdš
);

26 
	`Fşo£
(
åout
);

28 
	`´štf
("th»ad %d dÚe\n", 
	`±h»ad_£lf
());

29 (
NULL
);

30 
	}
}

33 
	$maš
(
¬gc
, **
¬gv
)

35 
i
, 
Áh»ads
;

36 
±h»ad_t
 
tid
;

38 ià(
¬gc
 != 3)

39 
	`”r_qu™
("usage:est04 <input-file> <#threads>");

40 
šfe
 = 
¬gv
[1];

41 
Áh»ads
 = 
	`©oi
(
¬gv
[2]);

43 
i
 = 0; i < 
Áh»ads
; i++) {

44 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, 
myfunc
, NULL);

47 
	`·u£
();

49 
	`ex™
(0);

50 
	}
}

	@osi\unpv13e\unpv13e\threads\test05.c

3 
	~"uÅth»ad.h
"

5 
±h»ad_key_t
 
	gmy_key
;

8 
	$maš
(
¬gc
, **
¬gv
)

10 *
Œ
;

12 
	`Pth»ad_key_ü—‹
(&
my_key
, 
NULL
);

13 
	`´štf
("fœ¡ key = %d\n", 
my_key
);

15 
	`Pth»ad_key_ü—‹
(&
my_key
, 
NULL
);

16 
	`´štf
("£cÚd key = %d\n", 
my_key
);

18 
	`Pth»ad_key_ü—‹
(&
my_key
, 
NULL
);

19 
	`´štf
("thœd key = %d\n", 
my_key
);

21 iàĞ(
Œ
 = 
	`±h»ad_g‘¥ecific
((
±h»ad_key_t
è0)è=ğ
NULL
)

22 
	`´štf
("key 0…ointer is NULL\n");

24 
	`´štf
("v®uš key 0 = %d\n", *
Œ
);

26 
”ºo
 = 67;

27 iàĞ(
Œ
 = 
	`±h»ad_g‘¥ecific
((
±h»ad_key_t
è0)è=ğ
NULL
)

28 
	`´štf
("key 0…ointer is NULL\n");

30 
	`´štf
("v®uš key 0 = %d\n", *
Œ
);

32 
	`ex™
(0);

33 
	}
}

	@osi\unpv13e\unpv13e\threads\unpthread.h

4 #iâdef 
__uÅ_±h»ad_h


5 
	#__uÅ_±h»ad_h


	)

7 
	~"uÅ.h
"

9 
Pth»ad_ü—‹
(
±h»ad_t
 *, cÚ¡ 
±h»ad_©Œ_t
 *,

11 
Pth»ad_još
(
±h»ad_t
, **);

12 
Pth»ad_d‘ach
(
±h»ad_t
);

13 
Pth»ad_kl
(
±h»ad_t
, );

15 
Pth»ad_mu‹x©Œ_š™
(
±h»ad_mu‹x©Œ_t
 *);

16 
Pth»ad_mu‹x©Œ_£sh¬ed
(
±h»ad_mu‹x©Œ_t
 *, );

17 
Pth»ad_mu‹x_š™
(
±h»ad_mu‹x_t
 *, 
±h»ad_mu‹x©Œ_t
 *);

18 
Pth»ad_mu‹x_lock
(
±h»ad_mu‹x_t
 *);

19 
Pth»ad_mu‹x_uÆock
(
±h»ad_mu‹x_t
 *);

21 
Pth»ad_cÚd_brßdÿ¡
(
±h»ad_cÚd_t
 *);

22 
Pth»ad_cÚd_sigÇl
(
±h»ad_cÚd_t
 *);

23 
Pth»ad_cÚd_wa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *);

24 
Pth»ad_cÚd_timedwa™
(
±h»ad_cÚd_t
 *, 
±h»ad_mu‹x_t
 *,

25 cÚ¡ 
time¥ec
 *);

27 
Pth»ad_key_ü—‹
(
±h»ad_key_t
 *, (*)(*));

28 
	`Pth»ad_£t¥ecific
(
±h»ad_key_t
, const *);

29 
	`Pth»ad_Úû
(
±h»ad_Úû_t
 *, (*)());

	@osi\unpv13e\unpv13e\threads\web01.c

2 
	~"uÅth»ad.h
"

3 
	~<th»ad.h
>

5 
	#MAXFILES
 20

	)

6 
	#SERV
 "80"

	)

8 
	sfe
 {

9 *
	mf_Çme
;

10 *
	mf_ho¡
;

11 
	mf_fd
;

12 
	mf_æags
;

13 
±h»ad_t
 
	mf_tid
;

14 } 
	gfe
[
MAXFILES
];

15 
	#F_CONNECTING
 1

	)

16 
	#F_READING
 2

	)

17 
	#F_DONE
 4

	)

19 
	#GET_CMD
 "GET % HTTP/1.0\r\n\r\n"

	)

21 
	gncÚn
, 
	gnfes
, 
	gÆeátocÚn
, 
	gÆeátÜ—d
;

23 *
do_g‘_»ad
(*);

24 
home_·ge
(const *, const *);

25 
wr™e_g‘_cmd
(
fe
 *);

28 
	$maš
(
¬gc
, **
¬gv
)

30 
i
, 
n
, 
maxncÚn
;

31 
±h»ad_t
 
tid
;

32 
fe
 *
åŒ
;

34 ià(
¬gc
 < 5)

35 
	`”r_qu™
("usage: web <#conns> <IPaddr> <homepage> file1 ...");

36 
maxncÚn
 = 
	`©oi
(
¬gv
[1]);

38 
nfes
 = 
	`mš
(
¬gc
 - 4, 
MAXFILES
);

39 
i
 = 0; i < 
nfes
; i++) {

40 
fe
[
i
].
f_Çme
 = 
¬gv
[i + 4];

41 
fe
[
i
].
f_ho¡
 = 
¬gv
[2];

42 
fe
[
i
].
f_æags
 = 0;

44 
	`´štf
("nfe ğ%d\n", 
nfes
);

46 
	`home_·ge
(
¬gv
[2],‡rgv[3]);

48 
ÆeátÜ—d
 = 
ÆeátocÚn
 = 
nfes
;

49 
ncÚn
 = 0;

52 
ÆeátÜ—d
 > 0) {

53 
ncÚn
 < 
maxncÚn
 && 
ÆeátocÚn
 > 0) {

55 
i
 = 0 ; i < 
nfes
; i++)

56 ià(
fe
[
i
].
f_æags
 == 0)

58 ià(
i
 =ğ
nfes
)

59 
	`”r_qu™
("ÆeátocÚÀğ%d buˆnÙhšg found", 
ÆeátocÚn
);

61 
fe
[
i
].
f_æags
 = 
F_CONNECTING
;

62 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, &
do_g‘_»ad
, &
fe
[
i
]);

63 
fe
[
i
].
f_tid
 = 
tid
;

64 
ncÚn
++;

65 
ÆeátocÚn
--;

68 iàĞ(
n
 = 
	`thr_još
(0, &
tid
, (**è&
åŒ
)) != 0)

69 
”ºo
 = 
n
, 
	`”r_sys
("thr_joinƒrror");

71 
ncÚn
--;

72 
ÆeátÜ—d
--;

73 
	`´štf
("th»ad id %d fÜ % dÚe\n", 
tid
, 
åŒ
->
f_Çme
);

76 
	`ex™
(0);

77 
	}
}

82 
	$do_g‘_»ad
(*
v±r
)

84 
fd
, 
n
;

85 
lše
[
MAXLINE
];

86 
fe
 *
åŒ
;

88 
åŒ
 = (
fe
 *è
v±r
;

90 
fd
 = 
	`Tı_cÚÃù
(
åŒ
->
f_ho¡
, 
SERV
);

91 
åŒ
->
f_fd
 = 
fd
;

92 
	`´štf
("do_get_read for %s, fd %d,hread %d\n",

93 
åŒ
->
f_Çme
, 
fd
, f±r->
f_tid
);

95 
	`wr™e_g‘_cmd
(
åŒ
);

99 iàĞ(
n
 = 
	`R—d
(
fd
, 
lše
, 
MAXLINE
)) == 0)

102 
	`´štf
("»ad %d by‹ äom %s\n", 
n
, 
åŒ
->
f_Çme
);

104 
	`´štf
("’d-of-fÚ %s\n", 
åŒ
->
f_Çme
);

105 
	`Clo£
(
fd
);

106 
åŒ
->
f_æags
 = 
F_DONE
;

108 (
åŒ
);

109 
	}
}

114 
	$wr™e_g‘_cmd
(
fe
 *
åŒ
)

116 
n
;

117 
lše
[
MAXLINE
];

119 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
åŒ
->
f_Çme
);

120 
	`Wr™’
(
åŒ
->
f_fd
, 
lše
, 
n
);

121 
	`´štf
("wrÙ%d by‹ fÜ %s\n", 
n
, 
åŒ
->
f_Çme
);

123 
åŒ
->
f_æags
 = 
F_READING
;

124 
	}
}

129 
	$home_·ge
(cÚ¡ *
ho¡
, cÚ¡ *
âame
)

131 
fd
, 
n
;

132 
lše
[
MAXLINE
];

134 
fd
 = 
	`Tı_cÚÃù
(
ho¡
, 
SERV
);

136 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
âame
);

137 
	`Wr™’
(
fd
, 
lše
, 
n
);

140 iàĞ(
n
 = 
	`R—d
(
fd
, 
lše
, 
MAXLINE
)) == 0)

143 
	`´štf
("»ad %d by‹ oàhom·ge\n", 
n
);

146 
	`´štf
("end-of-file on home…age\n");

147 
	`Clo£
(
fd
);

148 
	}
}

	@osi\unpv13e\unpv13e\threads\web02.c

3 
	~"uÅth»ad.h
"

4 
	~<th»ad.h
>

6 
	#MAXFILES
 20

	)

7 
	#SERV
 "80"

	)

9 
	sfe
 {

10 *
	mf_Çme
;

11 *
	mf_ho¡
;

12 
	mf_fd
;

13 
	mf_æags
;

14 
±h»ad_t
 
	mf_tid
;

15 } 
	gfe
[
MAXFILES
];

16 
	#F_CONNECTING
 1

	)

17 
	#F_READING
 2

	)

18 
	#F_DONE
 4

	)

19 
	#F_JOINED
 8

	)

21 
	gncÚn
, 
	gnfes
, 
	gÆeátocÚn
, 
	gÆeátÜ—d
;

22 
	gg‘
[] = "GET / HTTP/1.0\r\n\r\n";

24 
	gndÚe
;

25 
±h»ad_mu‹x_t
 
	gndÚe_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

27 *
do_g‘_»ad
(*);

28 
home_·ge
(const *, const *);

29 
wr™e_g‘_cmd
(
fe
 *);

32 
	$maš
(
¬gc
, **
¬gv
)

34 
i
, 
n
, 
maxncÚn
;

35 
±h»ad_t
 
tid
;

36 
fe
 *
åŒ
;

38 ià(
¬gc
 < 5)

39 
	`”r_qu™
("usage: web <#conns> <IPaddr> <homepage> file1 ...");

40 
maxncÚn
 = 
	`©oi
(
¬gv
[1]);

42 
nfes
 = 
	`mš
(
¬gc
 - 4, 
MAXFILES
);

43 
i
 = 0; i < 
nfes
; i++) {

44 
fe
[
i
].
f_Çme
 = 
¬gv
[i + 4];

45 
fe
[
i
].
f_ho¡
 = 
¬gv
[2];

46 
fe
[
i
].
f_æags
 = 0;

48 
	`´štf
("nfe ğ%d\n", 
nfes
);

50 
	`home_·ge
(
¬gv
[2],‡rgv[3]);

52 
ÆeátÜ—d
 = 
ÆeátocÚn
 = 
nfes
;

53 
ncÚn
 = 0;

54 
ÆeátÜ—d
 > 0) {

56 
ncÚn
 < 
maxncÚn
 && 
ÆeátocÚn
 > 0) {

58 
i
 = 0 ; i < 
nfes
; i++)

59 ià(
fe
[
i
].
f_æags
 == 0)

61 ià(
i
 =ğ
nfes
)

62 
	`”r_qu™
("ÆeátocÚÀğ%d buˆnÙhšg found", 
ÆeátocÚn
);

64 iàĞ(
n
 = 
	`±h»ad_ü—‹
(&
tid
, 
NULL
, &
do_g‘_»ad
, &
fe
[
i
])) != 0)

65 
”ºo
 = 
n
, 
	`”r_sys
("pthread_createƒrror");

66 
	`´štf
("ü—‹dh»ad %d\n", 
tid
);

67 
fe
[
i
].
f_tid
 = 
tid
;

68 
fe
[
i
].
f_æags
 = 
F_CONNECTING
;

69 
ncÚn
++;

70 
ÆeátocÚn
--;

72 
	`thr_y›ld
();

75 iàĞ(
n
 = 
	`±h»ad_mu‹x_lock
(&
ndÚe_mu‹x
)) != 0)

76 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_lockƒrror");

77 ià(
ndÚe
 > 0) {

78 
i
 = 0; i < 
nfes
; i++) {

79 ià(
fe
[
i
].
f_æags
 & 
F_DONE
) {

80 iàĞ(
n
 = 
	`±h»ad_još
(
fe
[
i
].
f_tid
, (**è&
åŒ
)) != 0)

81 
”ºo
 = 
n
, 
	`”r_sys
("pthread_joinƒrror");

83 ià(&
fe
[
i
] !ğ
åŒ
)

84 
	`”r_qu™
("file[i] != fptr");

85 
åŒ
->
f_æags
 = 
F_JOINED
;

86 
ndÚe
--;

87 
ncÚn
--;

88 
ÆeátÜ—d
--;

89 
	`´štf
("thread id %d for %s done\n",

90 
fe
[
i
].
f_tid
, 
åŒ
->
f_Çme
);

94 iàĞ(
n
 = 
	`±h»ad_mu‹x_uÆock
(&
ndÚe_mu‹x
)) != 0)

95 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_unlockƒrror");

98 
	`ex™
(0);

99 
	}
}

102 
	$do_g‘_»ad
(*
v±r
)

104 
fd
, 
n
;

105 
lše
[
MAXLINE
];

106 
fe
 *
åŒ
;

108 
åŒ
 = (
fe
 *è
v±r
;

110 
fd
 = 
	`Tı_cÚÃù
(
åŒ
->
f_ho¡
, 
SERV
);

111 
åŒ
->
f_fd
 = 
fd
;

112 
	`´štf
("do_get_read for %s, fd %d,hread %d\n",

113 
åŒ
->
f_Çme
, 
fd
, f±r->
f_tid
);

115 
	`wr™e_g‘_cmd
(
åŒ
);

119 iàĞ(
n
 = 
	`»ad
(
fd
, 
lše
, 
MAXLINE
)) <= 0) {

120 ià(
n
 == 0)

123 
	`”r_sys
("readƒrror");

125 
	`´štf
("»ad %d by‹ äom %s\n", 
n
, 
åŒ
->
f_Çme
);

127 
	`´štf
("’d-of-fÚ %s\n", 
åŒ
->
f_Çme
);

128 
	`şo£
(
fd
);

129 
åŒ
->
f_æags
 = 
F_DONE
;

131 iàĞ(
n
 = 
	`±h»ad_mu‹x_lock
(&
ndÚe_mu‹x
)) != 0)

132 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_lockƒrror");

133 
ndÚe
++;

134 iàĞ(
n
 = 
	`±h»ad_mu‹x_uÆock
(&
ndÚe_mu‹x
)) != 0)

135 
”ºo
 = 
n
, 
	`”r_sys
("pthread_mutex_unlockƒrror");

137 (
åŒ
);

138 
	}
}

141 
	$wr™e_g‘_cmd
(
fe
 *
åŒ
)

143 
n
;

144 
lše
[
MAXLINE
];

146 
	`¡rıy
(
lše
, "GET ");

147 
	`¡rÿt
(
lše
, 
åŒ
->
f_Çme
);

148 
	`¡rÿt
(
lše
, " HTTP/1.0\r\n\r\n");

149 
n
 = 
	`¡¾’
(
lše
);

150 ià(
	`wr™’
(
åŒ
->
f_fd
, 
lše
, 
n
) !=‚)

151 
	`”r_sys
("writenƒrror");

152 
	`´štf
("wrÙ%d by‹ fÜ %s\n", 
n
, 
åŒ
->
f_Çme
);

154 
åŒ
->
f_æags
 = 
F_READING
;

155 
	}
}

158 
	$home_·ge
(cÚ¡ *
ho¡
, cÚ¡ *
âame
)

160 
fd
, 
n
;

161 
lše
[
MAXLINE
];

163 
fd
 = 
	`Tı_cÚÃù
(
ho¡
, 
SERV
);

165 
	`¡rıy
(
lše
, "GET ");

166 
	`¡rÿt
(
lše
, 
âame
);

167 
	`¡rÿt
(
lše
, " HTTP/1.0\r\n\r\n");

168 
n
 = 
	`¡¾’
(
lše
);

169 ià(
	`wr™’
(
fd
, 
lše
, 
n
) !=‚)

170 
	`”r_sys
("writenƒrror");

173 iàĞ(
n
 = 
	`»ad
(
fd
, 
lše
, 
MAXLINE
)) <= 0) {

174 ià(
n
 == 0)

177 
	`”r_sys
("readƒrror");

179 
	`´štf
("»ad %d by‹ oàhom·ge\n", 
n
);

182 
	`´štf
("end-of-file on home…age\n");

183 
	`şo£
(
fd
);

184 
	}
}

	@osi\unpv13e\unpv13e\threads\web03.c

1 
	~"uÅth»ad.h
"

2 
	~<th»ad.h
>

4 
	#MAXFILES
 20

	)

5 
	#SERV
 "80"

	)

7 
	sfe
 {

8 *
	mf_Çme
;

9 *
	mf_ho¡
;

10 
	mf_fd
;

11 
	mf_æags
;

12 
±h»ad_t
 
	mf_tid
;

13 } 
	gfe
[
MAXFILES
];

14 
	#F_CONNECTING
 1

	)

15 
	#F_READING
 2

	)

16 
	#F_DONE
 4

	)

17 
	#F_JOINED
 8

	)

19 
	#GET_CMD
 "GET % HTTP/1.0\r\n\r\n"

	)

21 
	gncÚn
, 
	gnfes
, 
	gÆeátocÚn
, 
	gÆeátÜ—d
;

23 
	gndÚe
;

24 
±h»ad_mu‹x_t
 
	gndÚe_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

25 
±h»ad_cÚd_t
 
	gndÚe_cÚd
 = 
PTHREAD_COND_INITIALIZER
;

27 *
do_g‘_»ad
(*);

28 
home_·ge
(const *, const *);

29 
wr™e_g‘_cmd
(
fe
 *);

32 
	$maš
(
¬gc
, **
¬gv
)

34 
i
, 
maxncÚn
;

35 
±h»ad_t
 
tid
;

36 
fe
 *
åŒ
;

38 ià(
¬gc
 < 5)

39 
	`”r_qu™
("usage: web <#conns> <IPaddr> <homepage> file1 ...");

40 
maxncÚn
 = 
	`©oi
(
¬gv
[1]);

42 
nfes
 = 
	`mš
(
¬gc
 - 4, 
MAXFILES
);

43 
i
 = 0; i < 
nfes
; i++) {

44 
fe
[
i
].
f_Çme
 = 
¬gv
[i + 4];

45 
fe
[
i
].
f_ho¡
 = 
¬gv
[2];

46 
fe
[
i
].
f_æags
 = 0;

48 
	`´štf
("nfe ğ%d\n", 
nfes
);

50 
	`home_·ge
(
¬gv
[2],‡rgv[3]);

52 
ÆeátÜ—d
 = 
ÆeátocÚn
 = 
nfes
;

53 
ncÚn
 = 0;

55 
ÆeátÜ—d
 > 0) {

56 
ncÚn
 < 
maxncÚn
 && 
ÆeátocÚn
 > 0) {

58 
i
 = 0 ; i < 
nfes
; i++)

59 ià(
fe
[
i
].
f_æags
 == 0)

61 ià(
i
 =ğ
nfes
)

62 
	`”r_qu™
("ÆeátocÚÀğ%d buˆnÙhšg found", 
ÆeátocÚn
);

64 
fe
[
i
].
f_æags
 = 
F_CONNECTING
;

65 
	`Pth»ad_ü—‹
(&
tid
, 
NULL
, &
do_g‘_»ad
, &
fe
[
i
]);

66 
fe
[
i
].
f_tid
 = 
tid
;

67 
ncÚn
++;

68 
ÆeátocÚn
--;

72 
	`Pth»ad_mu‹x_lock
(&
ndÚe_mu‹x
);

73 
ndÚe
 == 0)

74 
	`Pth»ad_cÚd_wa™
(&
ndÚe_cÚd
, &
ndÚe_mu‹x
);

76 
i
 = 0; i < 
nfes
; i++) {

77 ià(
fe
[
i
].
f_æags
 & 
F_DONE
) {

78 
	`Pth»ad_još
(
fe
[
i
].
f_tid
, (**è&
åŒ
);

80 ià(&
fe
[
i
] !ğ
åŒ
)

81 
	`”r_qu™
("file[i] != fptr");

82 
åŒ
->
f_æags
 = 
F_JOINED
;

83 
ndÚe
--;

84 
ncÚn
--;

85 
ÆeátÜ—d
--;

86 
	`´štf
("th»ad %d fÜ % dÚe\n", 
åŒ
->
f_tid
, f±r->
f_Çme
);

89 
	`Pth»ad_mu‹x_uÆock
(&
ndÚe_mu‹x
);

92 
	`ex™
(0);

93 
	}
}

97 
	$do_g‘_»ad
(*
v±r
)

99 
fd
, 
n
;

100 
lše
[
MAXLINE
];

101 
fe
 *
åŒ
;

103 
åŒ
 = (
fe
 *è
v±r
;

105 
fd
 = 
	`Tı_cÚÃù
(
åŒ
->
f_ho¡
, 
SERV
);

106 
åŒ
->
f_fd
 = 
fd
;

107 
	`´štf
("do_get_read for %s, fd %d,hread %d\n",

108 
åŒ
->
f_Çme
, 
fd
, f±r->
f_tid
);

110 
	`wr™e_g‘_cmd
(
åŒ
);

114 iàĞ(
n
 = 
	`R—d
(
fd
, 
lše
, 
MAXLINE
)) == 0)

117 
	`´štf
("»ad %d by‹ äom %s\n", 
n
, 
åŒ
->
f_Çme
);

119 
	`´štf
("’d-of-fÚ %s\n", 
åŒ
->
f_Çme
);

120 
	`Clo£
(
fd
);

121 
åŒ
->
f_æags
 = 
F_DONE
;

123 
	`Pth»ad_mu‹x_lock
(&
ndÚe_mu‹x
);

124 
ndÚe
++;

125 
	`Pth»ad_cÚd_sigÇl
(&
ndÚe_cÚd
);

126 
	`Pth»ad_mu‹x_uÆock
(&
ndÚe_mu‹x
);

128 (
åŒ
);

129 
	}
}

132 
	$wr™e_g‘_cmd
(
fe
 *
åŒ
)

134 
n
;

135 
lše
[
MAXLINE
];

137 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
åŒ
->
f_Çme
);

138 
	`Wr™’
(
åŒ
->
f_fd
, 
lše
, 
n
);

139 
	`´štf
("wrÙ%d by‹ fÜ %s\n", 
n
, 
åŒ
->
f_Çme
);

141 
åŒ
->
f_æags
 = 
F_READING
;

142 
	}
}

145 
	$home_·ge
(cÚ¡ *
ho¡
, cÚ¡ *
âame
)

147 
fd
, 
n
;

148 
lše
[
MAXLINE
];

150 
fd
 = 
	`Tı_cÚÃù
(
ho¡
, 
SERV
);

152 
n
 = 
	`¢´štf
(
lše
, Öše), 
GET_CMD
, 
âame
);

153 
	`Wr™’
(
fd
, 
lše
, 
n
);

156 iàĞ(
n
 = 
	`R—d
(
fd
, 
lše
, 
MAXLINE
)) == 0)

159 
	`´štf
("»ad %d by‹ oàhom·ge\n", 
n
);

162 
	`´štf
("end-of-file on home…age\n");

163 
	`Clo£
(
fd
);

164 
	}
}

	@osi\unpv13e\unpv13e\traceroute\icmpcode_v4.c

1 
	~"Œaû.h
"

4 
	$icmpcode_v4
(
code
)

6 
”rbuf
[100];

7 
code
) {

24 : 
	`¥rštf
(
”rbuf
, "[unknowÀcod%d]", 
code
);

25  
”rbuf
;

27 
	}
}

	@osi\unpv13e\unpv13e\traceroute\icmpcode_v6.c

1 
	~"Œaû.h
"

4 
	$icmpcode_v6
(
code
)

6 #ifdef 
IPV6


7 
”rbuf
[100];

8 
code
) {

9 
ICMP6_DST_UNREACH_NOROUTE
:

11 
ICMP6_DST_UNREACH_ADMIN
:

13 
ICMP6_DST_UNREACH_NOTNEIGHBOR
:

15 
ICMP6_DST_UNREACH_ADDR
:

17 
ICMP6_DST_UNREACH_NOPORT
:

20 
	`¥rštf
(
”rbuf
, "[unknowÀcod%d]", 
code
);

21  
”rbuf
;

24 
	}
}

	@osi\unpv13e\unpv13e\traceroute\main.c

1 
	~"Œaû.h
"

3 
´Ùo
 
	g´Ùo_v4
 = { 
icmpcode_v4
, 
»cv_v4
, 
NULL
, NULL, NULL, NULL, 0,

4 
IPPROTO_ICMP
, 
IPPROTO_IP
, 
IP_TTL
 };

6 #ifdef 
IPV6


7 
´Ùo
 
	g´Ùo_v6
 = { 
icmpcode_v6
, 
»cv_v6
, 
NULL
, NULL, NULL, NULL, 0,

8 
IPPROTO_ICMPV6
, 
IPPROTO_IPV6
, 
IPV6_UNICAST_HOPS
 };

11 
	gd©®’
 = (
»c
);

12 
	gmax_‰l
 = 30;

13 
	gÅrobes
 = 3;

14 
u_shÜt
 
	gdpÜt
 = 32768 + 666;

17 
	$maš
(
¬gc
, **
¬gv
)

19 
c
;

20 
addršfo
 *
ai
;

21 *
h
;

23 
İ‹¼
 = 0;

24  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "m:v")) != -1) {

25 
c
) {

27 iàĞ(
max_‰l
 = 
	`©oi
(
İrg
)) <= 1)

28 
	`”r_qu™
("invalid -m value");

32 
v”bo£
++;

36 
	`”r_qu™
("uÄecognized o±iÚ: %c", 
c
);

40 ià(
İtšd
 !ğ
¬gc
-1)

41 
	`”r_qu™
("usage:raceroute [ -m <maxttl> -v ] <hostname>");

42 
ho¡
 = 
¬gv
[
İtšd
];

44 
pid
 = 
	`g‘pid
();

45 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

47 
ai
 = 
	`Ho¡_£rv
(
ho¡
, 
NULL
, 0, 0);

49 
h
 = 
	`Sock_Áİ_ho¡
(
ai
->
ai_addr
,‡i->
ai_add¾’
);

50 
	`´štf
("tracerouteo %s (%s): %d hops max, %d data bytes\n",

51 
ai
->
ai_ÿnÚÇme
 ?‡i->ai_ÿnÚÇm: 
h
,

52 
h
, 
max_‰l
, 
d©®’
);

55 ià(
ai
->
ai_çmy
 =ğ
AF_INET
) {

56 
´
 = &
´Ùo_v4
;

57 #ifdef 
IPV6


58 } ià(
ai
->
ai_çmy
 =ğ
AF_INET6
) {

59 
´
 = &
´Ùo_v6
;

60 ià(
	`IN6_IS_ADDR_V4MAPPED
(&(((
sockaddr_š6
 *)
ai
->
ai_addr
)->
sš6_addr
)))

61 
	`”r_qu™
("cannotraceroute IPv4-mapped IPv6‡ddress");

64 
	`”r_qu™
("unknowÀadd»s çmy %d", 
ai
->
ai_çmy
);

66 
´
->
§£nd
 = 
ai
->
ai_addr
;

67 
´
->
§»cv
 = 
	`C®loc
(1, 
ai
->
ai_add¾’
);

68 
´
->
§Ï¡
 = 
	`C®loc
(1, 
ai
->
ai_add¾’
);

69 
´
->
§bšd
 = 
	`C®loc
(1, 
ai
->
ai_add¾’
);

70 
´
->
§Ën
 = 
ai
->
ai_add¾’
;

72 
	`Œaûloİ
();

74 
	`ex™
(0);

75 
	}
}

	@osi\unpv13e\unpv13e\traceroute\recv_v4.c

1 
	~"Œaû.h
"

3 
gÙ®¬m
;

13 
	$»cv_v4
(
£q
, 
timev®
 *
tv
)

15 
hËn1
, 
hËn2
, 
icm¶’
, 
»t
;

16 
sockËn_t
 
Ën
;

17 
ssize_t
 
n
;

18 

 *, *
h
;

19 
icmp
 *icmp;

20 
udphdr
 *
udp
;

22 
gÙ®¬m
 = 0;

23 
	`®¬m
(3);

25 ià(
gÙ®¬m
)

27 
Ën
 = 
´
->
§Ën
;

28 
n
 = 
	`»cväom
(
»cvfd
, 
»cvbuf
, Ôecvbuf), 0, 
´
->
§»cv
, &
Ën
);

29 ià(
n
 < 0) {

30 ià(
”ºo
 =ğ
EINTR
)

33 
	`”r_sys
("recvfromƒrror");

36 

 = ( *è
»cvbuf
;

37 
hËn1
 = 

->
_hl
 << 2;

39 
icmp
 = (icm°*è(
»cvbuf
 + 
hËn1
);

40 iàĞ(
icm¶’
 = 
n
 - 
hËn1
) < 8)

43 ià(
icmp
->
icmp_ty³
 =ğ
ICMP_TIMXCEED
 &&

44 
icmp
->
icmp_code
 =ğ
ICMP_TIMXCEED_INTRANS
) {

45 ià(
icm¶’
 < 8 + (

))

48 
h
 = (

 *è(
»cvbuf
 + 
hËn1
 + 8);

49 
hËn2
 = 
h
->
_hl
 << 2;

50 ià(
icm¶’
 < 8 + 
hËn2
 + 4)

53 
udp
 = (
udphdr
 *è(
»cvbuf
 + 
hËn1
 + 8 + 
hËn2
);

54 ià(
h
->
_p
 =ğ
IPPROTO_UDP
 &&

55 
udp
->
uh_¥Üt
 =ğ
	`htÚs
(
¥Üt
) &&

56 
udp
->
uh_dpÜt
 =ğ
	`htÚs
(
dpÜt
 + 
£q
)) {

57 
»t
 = -2;

61 } ià(
icmp
->
icmp_ty³
 =ğ
ICMP_UNREACH
) {

62 ià(
icm¶’
 < 8 + (

))

65 
h
 = (

 *è(
»cvbuf
 + 
hËn1
 + 8);

66 
hËn2
 = 
h
->
_hl
 << 2;

67 ià(
icm¶’
 < 8 + 
hËn2
 + 4)

70 
udp
 = (
udphdr
 *è(
»cvbuf
 + 
hËn1
 + 8 + 
hËn2
);

71 ià(
h
->
_p
 =ğ
IPPROTO_UDP
 &&

72 
udp
->
uh_¥Üt
 =ğ
	`htÚs
(
¥Üt
) &&

73 
udp
->
uh_dpÜt
 =ğ
	`htÚs
(
dpÜt
 + 
£q
)) {

74 ià(
icmp
->
icmp_code
 =ğ
ICMP_UNREACH_PORT
)

75 
»t
 = -1;

77 
»t
 = 
icmp
->
icmp_code
;

81 ià(
v”bo£
) {

82 
	`´štf
(" (from %s:ype = %d, code = %d)\n",

83 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

84 
icmp
->
icmp_ty³
, icmp->
icmp_code
);

88 
	`®¬m
(0);

89 
	`G‘timeofday
(
tv
, 
NULL
);

90 (
»t
);

91 
	}
}

	@osi\unpv13e\unpv13e\traceroute\recv_v6.c

1 
	~"Œaû.h
"

3 
gÙ®¬m
;

13 
	$»cv_v6
(
£q
, 
timev®
 *
tv
)

15 #ifdef 
IPV6


16 
hËn2
, 
icmp6Ën
, 
»t
;

17 
ssize_t
 
n
;

18 
sockËn_t
 
Ën
;

19 
6_hdr
 *
h6
;

20 
icmp6_hdr
 *
icmp6
;

21 
udphdr
 *
udp
;

23 
gÙ®¬m
 = 0;

24 
	`®¬m
(3);

26 ià(
gÙ®¬m
)

28 
Ën
 = 
´
->
§Ën
;

29 
n
 = 
	`»cväom
(
»cvfd
, 
»cvbuf
, Ôecvbuf), 0, 
´
->
§»cv
, &
Ën
);

30 ià(
n
 < 0) {

31 ià(
”ºo
 =ğ
EINTR
)

34 
	`”r_sys
("recvfromƒrror");

37 
icmp6
 = (
icmp6_hdr
 *è
»cvbuf
;

38 iàĞĞ
icmp6Ën
 = 
n
 ) < 8)

41 ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_TIME_EXCEEDED
 &&

42 
icmp6
->
icmp6_code
 =ğ
ICMP6_TIME_EXCEED_TRANSIT
) {

43 ià(
icmp6Ën
 < 8 + (
6_hdr
) + 4)

46 
h6
 = (
6_hdr
 *è(
»cvbuf
 + 8);

47 
hËn2
 = (
6_hdr
);

48 
udp
 = (
udphdr
 *è(
»cvbuf
 + 8 + 
hËn2
);

49 ià(
h6
->
6_nxt
 =ğ
IPPROTO_UDP
 &&

50 
udp
->
uh_¥Üt
 =ğ
	`htÚs
(
¥Üt
) &&

51 
udp
->
uh_dpÜt
 =ğ
	`htÚs
(
dpÜt
 + 
£q
))

52 
»t
 = -2;

55 } ià(
icmp6
->
icmp6_ty³
 =ğ
ICMP6_DST_UNREACH
) {

56 ià(
icmp6Ën
 < 8 + (
6_hdr
) + 4)

59 
h6
 = (
6_hdr
 *è(
»cvbuf
 + 8);

60 
hËn2
 = (
6_hdr
);

61 
udp
 = (
udphdr
 *è(
»cvbuf
 + 8 + 
hËn2
);

62 ià(
h6
->
6_nxt
 =ğ
IPPROTO_UDP
 &&

63 
udp
->
uh_¥Üt
 =ğ
	`htÚs
(
¥Üt
) &&

64 
udp
->
uh_dpÜt
 =ğ
	`htÚs
(
dpÜt
 + 
£q
)) {

65 ià(
icmp6
->
icmp6_code
 =ğ
ICMP6_DST_UNREACH_NOPORT
)

66 
»t
 = -1;

68 
»t
 = 
icmp6
->
icmp6_code
;

71 } ià(
v”bo£
) {

72 
	`´štf
(" (from %s:ype = %d, code = %d)\n",

73 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
),

74 
icmp6
->
icmp6_ty³
, icmp6->
icmp6_code
);

78 
	`®¬m
(0);

79 
	`G‘timeofday
(
tv
, 
NULL
);

80 (
»t
);

82 
	}
}

	@osi\unpv13e\unpv13e\traceroute\sig_alrm.c

1 
	~"Œaû.h
"

3 
	ggÙ®¬m
;

6 
	$sig_®rm
(
signo
)

8 
gÙ®¬m
 = 1;

10 
	}
}

	@osi\unpv13e\unpv13e\traceroute\trace.h

1 
	~"uÅ.h
"

2 
	~<Ãtš‘/š_sy¡m.h
>

3 
	~<Ãtš‘/.h
>

4 
	~<Ãtš‘/_icmp.h
>

5 
	~<Ãtš‘/udp.h
>

7 
	#BUFSIZE
 1500

	)

9 
	s»c
 {

10 
u_shÜt
 
	m»c_£q
;

11 
u_shÜt
 
	m»c_‰l
;

12 
timev®
 
	m»c_tv
;

16 
	g»cvbuf
[
BUFSIZE
];

17 
	g£ndbuf
[
BUFSIZE
];

19 
	gd©®’
;

20 *
	gho¡
;

21 
u_shÜt
 
	g¥Üt
, 
	gdpÜt
;

22 
	gn£Á
;

23 
pid_t
 
	gpid
;

24 
	g´obe
, 
	gÅrobes
;

25 
	g£ndfd
, 
	g»cvfd
;

26 
	g‰l
, 
	gmax_‰l
;

27 
	gv”bo£
;

30 cÚ¡ *
icmpcode_v4
();

31 cÚ¡ *
icmpcode_v6
();

32 
»cv_v4
(, 
timev®
 *);

33 
»cv_v6
(, 
timev®
 *);

34 
sig_®rm
();

35 
Œaûloİ
();

36 
tv_sub
(
timev®
 *, timeval *);

38 
	s´Ùo
 {

39 cÚ¡ *(*
	micmpcode
)();

40 (*
	m»cv
)(, 
	mtimev®
 *);

41 
sockaddr
 *
	m§£nd
;

42 
sockaddr
 *
	m§»cv
;

43 
sockaddr
 *
	m§Ï¡
;

44 
sockaddr
 *
	m§bšd
;

45 
sockËn_t
 
	m§Ën
;

46 
	micmµrÙo
;

47 
	m‰Îev–
;

48 
	m‰lİŠame
;

49 } *
	g´
;

51 #ifdef 
IPV6


53 
	~<Ãtš‘/6.h
>

54 
	~<Ãtš‘/icmp6.h
>

	@osi\unpv13e\unpv13e\traceroute\traceloop.c

1 
	~"Œaû.h
"

4 
	$Œaûloİ
()

6 
£q
, 
code
, 
dÚe
;

7 
¹t
;

8 
»c
 *rec;

9 
timev®
 
tv»cv
;

11 
»cvfd
 = 
	`Sock‘
(
´
->
§£nd
->
§_çmy
, 
SOCK_RAW
,…r->
icmµrÙo
);

12 
	`£tuid
(
	`g‘uid
());

14 #ifdef 
IPV6


15 ià(
´
->
§£nd
->
§_çmy
 =ğ
AF_INET6
 && 
v”bo£
 == 0) {

16 
icmp6_f‹r
 
myft
;

17 
	`ICMP6_FILTER_SETBLOCKALL
(&
myft
);

18 
	`ICMP6_FILTER_SETPASS
(
ICMP6_TIME_EXCEEDED
, &
myft
);

19 
	`ICMP6_FILTER_SETPASS
(
ICMP6_DST_UNREACH
, &
myft
);

20 
	`£tsockİt
(
»cvfd
, 
IPPROTO_IPV6
, 
ICMP6_FILTER
,

21 &
myft
, (myfilt));

25 
£ndfd
 = 
	`Sock‘
(
´
->
§£nd
->
§_çmy
, 
SOCK_DGRAM
, 0);

27 
´
->
§bšd
->
§_çmy
 =…r->
§£nd
->sa_family;

28 
¥Üt
 = (
	`g‘pid
() & 0xffff) | 0x8000;

29 
	`sock_£t_pÜt
(
´
->
§bšd
,…r->
§Ën
, 
	`htÚs
(
¥Üt
));

30 
	`Bšd
(
£ndfd
, 
´
->
§bšd
,…r->
§Ën
);

32 
	`sig_®rm
(
SIGALRM
);

34 
£q
 = 0;

35 
dÚe
 = 0;

36 
‰l
 = 1; <ğ
max_‰l
 && 
dÚe
 == 0;tl++) {

37 
	`S‘sockİt
(
£ndfd
, 
´
->
‰Îev–
,…r->
‰lİŠame
, &
‰l
, ());

38 
	`bz”o
(
´
->
§Ï¡
,…r->
§Ën
);

40 
	`´štf
("%2d ", 
‰l
);

41 
	`fæush
(
¡dout
);

43 
´obe
 = 0;…rob< 
Årobes
;…robe++) {

44 
»c
 = (»ø*è
£ndbuf
;

45 
»c
->
»c_£q
 = ++
£q
;

46 
»c
->
»c_‰l
 = 
‰l
;

47 
	`G‘timeofday
(&
»c
->
»c_tv
, 
NULL
);

49 
	`sock_£t_pÜt
(
´
->
§£nd
,…r->
§Ën
, 
	`htÚs
(
dpÜt
 + 
£q
));

50 
	`S’dto
(
£ndfd
, 
£ndbuf
, 
d©®’
, 0, 
´
->
§£nd
,…r->
§Ën
);

52 iàĞ(
code
 = (*
´
->
»cv
)(
£q
, &
tv»cv
)) == -3)

53 
	`´štf
(" *");

55 
¡r
[
NI_MAXHOST
];

57 ià(
	`sock_cmp_addr
(
´
->
§»cv
,…r->
§Ï¡
,…r->
§Ën
) != 0) {

58 ià(
	`g‘Çmešfo
(
´
->
§»cv
,…r->
§Ën
, 
¡r
, (str),

59 
NULL
, 0, 0) == 0)

60 
	`´štf
(" % (%s)", 
¡r
,

61 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
));

63 
	`´štf
(" %s",

64 
	`Sock_Áİ_ho¡
(
´
->
§»cv
,…r->
§Ën
));

65 
	`memıy
(
´
->
§Ï¡
,…r->
§»cv
,…r->
§Ën
);

67 
	`tv_sub
(&
tv»cv
, &
»c
->
»c_tv
);

68 
¹t
 = 
tv»cv
.
tv_£c
 * 1000.0 +v»cv.
tv_u£c
 / 1000.0;

69 
	`´štf
(" %.3àms", 
¹t
);

71 ià(
code
 == -1)

72 
dÚe
++;

73 ià(
code
 >= 0)

74 
	`´štf
(" (ICMP %s)", (*
´
->
icmpcode
)(
code
));

76 
	`fæush
(
¡dout
);

78 
	`´štf
("\n");

80 
	}
}

	@osi\unpv13e\unpv13e\traceroute\tv_sub.c

1 
	~"uÅ.h
"

4 
	$tv_sub
(
timev®
 *
out
, timev® *
š
)

6 iàĞ(
out
->
tv_u£c
 -ğ
š
->tv_usec) < 0) {

7 --
out
->
tv_£c
;

8 
out
->
tv_u£c
 += 1000000;

10 
out
->
tv_£c
 -ğ
š
->tv_sec;

11 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\cleanup.c

1 
	~"udpcksum.h
"

5 
	$ş—nup
(
signo
)

7 
pÿp_¡©
 
¡©
;

9 
	`putc
('\n', 
¡dout
);

11 ià(
v”bo£
) {

12 ià(
	`pÿp_¡©s
(
pd
, &
¡©
) < 0)

13 
	`”r_qu™
("pÿp_¡©s: %s\n", 
	`pÿp_g‘”r
(
pd
));

14 
	`´štf
("%d…ack‘ »ûived by f‹r\n", 
¡©
.
ps_»cv
);

15 
	`´štf
("%d…ack‘ drİ³d by k”Ãl\n", 
¡©
.
ps_drİ
);

18 
	`ex™
(0);

19 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\main.c

2 
	~"udpcksum.h
"

5 
sockaddr
 *
	gde¡
, *
	gloÿl
;

6 
sockaddr_š
 
	gloÿÎookup
;

7 
sockËn_t
 
	gde¡Ën
, 
	gloÿÎ’
;

9 
	gd©®šk
;

10 *
	gdeviû
;

11 
pÿp_t
 *
	gpd
;

12 
	g¿wfd
;

13 
	g¢­Ën
 = 200;

14 
	gv”bo£
;

15 
	gz”osum
;

17 
u§ge
(const *);

20 
	$maš
(
¬gc
, *
¬gv
[])

22 
c
, 
lİt
=0;

23 *
±r
, 
loÿÊame
[1024], *
loÿÍÜt
;

24 
addršfo
 *
a
;

28 
İ‹¼
 = 0;

29  (
c
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "0i:l:v")) != -1) {

30 
c
) {

33 
z”osum
 = 1;

37 
deviû
 = 
İrg
;

41 iàĞ(
±r
 = 
	`¡¼chr
(
İrg
, '.')è=ğ
NULL
)

42 
	`u§ge
("invalid -l option");

44 *
±r
++ = 0;

45 
loÿÍÜt
 = 
±r
;

46 
	`¡ºıy
(
loÿÊame
, 
İrg
, (localname));

47 
lİt
 = 1;

51 
v”bo£
 = 1;

55 
	`u§ge
("unrecognized option");

60 ià(
İtšd
 !ğ
¬gc
-2)

61 
	`u§ge
("missing <host>‡nd/or <serv>");

64 
a
 = 
	`Ho¡_£rv
(
¬gv
[
İtšd
],‡rgv[İtšd+1], 
AF_INET
, 
SOCK_DGRAM
);

65 
de¡
 = 
a
->
ai_addr
;

66 
de¡Ën
 = 
a
->
ai_add¾’
;

76 ià(
lİt
) {

78 
a
 = 
	`Ho¡_£rv
(
loÿÊame
, 
loÿÍÜt
, 
AF_INET
, 
SOCK_DGRAM
);

79 
loÿl
 = 
a
->
ai_addr
;

80 
loÿÎ’
 = 
a
->
ai_add¾’
;

82 
s
;

83 
s
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

84 
	`CÚÃù
(
s
, 
de¡
, 
de¡Ën
);

86 
loÿÎ’
 = (
loÿÎookup
);

87 
loÿl
 = (
sockaddr
 *)&
loÿÎookup
;

88 
	`G‘sockÇme
(
s
, 
loÿl
, &
loÿÎ’
);

89 ià(
loÿÎookup
.
sš_addr
.
s_addr
 =ğ
	`htÚl
(
INADDR_ANY
))

90 
	`”r_qu™
("Can't determine†ocal‡ddress - use -l\n");

91 
	`şo£
(
s
);

94 
	`İ’_ouut
();

96 
	`İ’_pÿp
();

98 
	`£tuid
(
	`g‘uid
());

100 
	`SigÇl
(
SIGTERM
, 
ş—nup
);

101 
	`SigÇl
(
SIGINT
, 
ş—nup
);

102 
	`SigÇl
(
SIGHUP
, 
ş—nup
);

104 
	`‹¡_udp
();

106 
	`ş—nup
(0);

107 
	}
}

111 
	$u§ge
(cÚ¡ *
msg
)

113 
	`”r_msg
(

121 ià(
msg
[0] != 0)

122 
	`”r_qu™
("%s", 
msg
);

123 
	`ex™
(1);

124 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\pcap.c

2 
	~"udpcksum.h
"

4 
	#CMD
 "ud°ªd srøho¡ % ªd srøpÜˆ%d"

	)

7 
	$İ’_pÿp
()

9 
ušt32_t
 
loÿÊ‘
, 
Ãtmask
;

10 
cmd
[
MAXLINE
], 
”rbuf
[
PCAP_ERRBUF_SIZE
],

11 
¡r1
[
INET_ADDRSTRLEN
], 
¡r2
[INET_ADDRSTRLEN];

12 
bpf_´og¿m
 
fcode
;

14 ià(
deviû
 =ğ
NULL
) {

15 iàĞ(
deviû
 = 
	`pÿp_lookupdev
(
”rbuf
)è=ğ
NULL
)

16 
	`”r_qu™
("pÿp_lookup: %s", 
”rbuf
);

18 
	`´štf
("deviû = %s\n", 
deviû
);

21 iàĞ(
pd
 = 
	`pÿp_İ’_live
(
deviû
, 
¢­Ën
, 0, 500, 
”rbuf
)è=ğ
NULL
)

22 
	`”r_qu™
("pÿp_İ’_live: %s", 
”rbuf
);

24 ià(
	`pÿp_looku²‘
(
deviû
, &
loÿÊ‘
, &
Ãtmask
, 
”rbuf
) < 0)

25 
	`”r_qu™
("pÿp_looku²‘: %s", 
”rbuf
);

26 ià(
v”bo£
)

27 
	`´štf
("localnet = %s,‚etmask = %s\n",

28 
	`IÃt_Áİ
(
AF_INET
, &
loÿÊ‘
, 
¡r1
, (str1)),

29 
	`IÃt_Áİ
(
AF_INET
, &
Ãtmask
, 
¡r2
, (str2)));

31 
	`¢´štf
(
cmd
, (cmd), 
CMD
,

32 
	`Sock_Áİ_ho¡
(
de¡
, 
de¡Ën
),

33 
	`Áohs
(
	`sock_g‘_pÜt
(
de¡
, 
de¡Ën
)));

34 ià(
v”bo£
)

35 
	`´štf
("cmd = %s\n", 
cmd
);

36 ià(
	`pÿp_compe
(
pd
, &
fcode
, 
cmd
, 0, 
Ãtmask
) < 0)

37 
	`”r_qu™
("pÿp_compe: %s", 
	`pÿp_g‘”r
(
pd
));

39 ià(
	`pÿp_£tf‹r
(
pd
, &
fcode
) < 0)

40 
	`”r_qu™
("pÿp_£tf‹r: %s", 
	`pÿp_g‘”r
(
pd
));

42 iàĞ(
d©®šk
 = 
	`pÿp_d©®šk
(
pd
)) < 0)

43 
	`”r_qu™
("pÿp_d©®šk: %s", 
	`pÿp_g‘”r
(
pd
));

44 ià(
v”bo£
)

45 
	`´štf
("d©®šk = %d\n", 
d©®šk
);

46 
	}
}

51 
	$Ãxt_pÿp
(*
Ën
)

53 *
±r
;

54 
pÿp_pkthdr
 
hdr
;

57  (
±r
 = (*è
	`pÿp_Ãxt
(
pd
, &
hdr
)è=ğ
NULL
)

60 *
Ën
 = 
hdr
.
ÿ¶’
;

61 (
±r
);

62 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\senddnsquery-libnet.c

1 
	~"udpcksum.h
"

2 
	~<libÃt.h
>

10 
libÃt_t
 *
	gl
;

13 
	$İ’_ouut
()

15 
”rbuf
[
LIBNET_ERRBUF_SIZE
];

18 
l
 = 
	`libÃt_š™
(
LIBNET_RAW4
, 
NULL
, 
”rbuf
);

19 ià(
l
 =ğ
NULL
) {

20 
	`”r_qu™
("Cª'ˆš™ŸlizlibÃt: %s", 
”rbuf
);

22 
	}
}

27 
	$£nd_dns_qu”y
()

29 
qbuf
[24], *
±r
;

30 
u_št16_t
 
Úe
;

31 
·ck‘_size
 = 
LIBNET_UDP_H
 + 
LIBNET_DNSV4_H
 + 24;

32 
libÃt_±ag_t
 
_g
, 
udp_g
, 
dns_g
;

35 
±r
 = 
qbuf
;

36 
	`memıy
(
±r
, "\001a\014root-servers\003net\000", 20);

37 
±r
 += 20;

38 
Úe
 = 
	`htÚs
(1);

39 
	`memıy
(
±r
, &
Úe
, 2);

40 
±r
 += 2;

41 
	`memıy
(
±r
, &
Úe
, 2);

44 
dns_g
 = 
	`libÃt_bud_dnsv4
(

49 
qbuf
 , 24 , 
l
, 
dns_g
);

51 
udp_g
 = 
	`libÃt_bud_udp
(

52 ((
sockaddr_š
 *è
loÿl
)->
sš_pÜt
 ,

53 ((
sockaddr_š
 *è
de¡
)->
sš_pÜt
 ,

54 
·ck‘_size
 , 0 ,

55 
NULL
 , 0 , 
l
, 
udp_g
);

58 ià(
z”osum
)

59 ià(
	`libÃt_toggË_checksum
(
l
, 
udp_g
, 
LIBNET_OFF
) < 0)

60 
	`”r_qu™
("tuºšg ofàchecksums: %s\n", 
	`libÃt_g‘”rÜ
(
l
));

63 
_g
 = 
	`libÃt_bud_v4
(
·ck‘_size
 + 
LIBNET_IPV4_H
 ,

65 
TTL_OUT
 , 
IPPROTO_UDP
 ,

67 ((
sockaddr_š
 *è
loÿl
)->
sš_addr
.
s_addr
 ,

68 ((
sockaddr_š
 *è
de¡
)->
sš_addr
.
s_addr
 ,

69 
NULL
 , 0 , 
l
, 
_g
);

72 ià(
	`libÃt_wr™e
(
l
) < 0) {

73 
	`”r_qu™
("libÃt_wr™e: %s\n", 
	`libÃt_g‘”rÜ
(
l
));

75 ià(
v”bo£
)

76 
	`´štf
("£Á: %d by‹ oàd©a\n", 
·ck‘_size
);

77 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\senddnsquery-raw.c

1 
	~"udpcksum.h
"

10 
	$£nd_dns_qu”y
()

12 
size_t
 
nby‹s
;

13 *
buf
, *
±r
;

15 
buf
 = 
	`M®loc
((
udphdr
) + 100);

16 
±r
 = 
buf
 + (
udphdr
);

18 *((
ušt16_t
 *è
±r
èğ
	`htÚs
(1234);

19 
±r
 += 2;

20 *((
ušt16_t
 *è
±r
èğ
	`htÚs
(0x0100);

21 
±r
 += 2;

22 *((
ušt16_t
 *è
±r
èğ
	`htÚs
(1);

23 
±r
 += 2;

24 *((
ušt16_t
 *è
±r
) = 0;

25 
±r
 += 2;

26 *((
ušt16_t
 *è
±r
) = 0;

27 
±r
 += 2;

28 *((
ušt16_t
 *è
±r
) = 0;

29 
±r
 += 2;

31 
	`memıy
(
±r
, "\001a\014root-servers\003net\000", 20);

32 
±r
 += 20;

33 *((
ušt16_t
 *è
±r
èğ
	`htÚs
(1);

34 
±r
 += 2;

35 *((
ušt16_t
 *è
±r
èğ
	`htÚs
(1);

36 
±r
 += 2;

38 
nby‹s
 = (
±r
 - 
buf
è- (
udphdr
);

39 
	`udp_wr™e
(
buf
, 
nby‹s
);

40 ià(
v”bo£
)

41 
	`´štf
("£Á: %d by‹ oàd©a\n", 
nby‹s
);

42 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\udpcksum.c

2 
	~"udpcksum.h
"

3 
	~<£tjmp.h
>

5 
sigjmp_buf
 
	gjmpbuf
;

6 
	gÿnjump
;

9 
	$sig_®rm
(
signo
)

11 ià(
ÿnjump
 == 0)

13 
	`siglÚgjmp
(
jmpbuf
, 1);

14 
	}
}

19 
	$‹¡_udp
()

21 vŞ©
n£Á
 = 0, 
timeout
 = 3;

22 
udphdr
 *
ui
;

24 
	`SigÇl
(
SIGALRM
, 
sig_®rm
);

26 ià(
	`sig£tjmp
(
jmpbuf
, 1)) {

27 ià(
n£Á
 >= 3)

28 
	`”r_qu™
("no„esponse");

29 
	`´štf
("timeout\n");

30 
timeout
 *= 2;

32 
ÿnjump
 = 1;

34 
	`£nd_dns_qu”y
();

35 
n£Á
++;

37 
	`®¬m
(
timeout
);

38 
ui
 = 
	`udp_»ad
();

39 
ÿnjump
 = 0;

40 
	`®¬m
(0);

42 ià(
ui
->
ui_sum
 == 0)

43 
	`´štf
("UDP checksums off\n");

45 
	`´štf
("UDP checksums on\n");

46 ià(
v”bo£
)

47 
	`´štf
("»ûived UDP checksum = %x\n", 
	`Áohs
(
ui
->
ui_sum
));

48 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\udpcksum.h

1 
	~"uÅ.h
"

2 
	~<pÿp.h
>

4 
	~<Ãtš‘/š_sy¡m.h
>

5 
	~<Ãtš‘/š.h
>

6 
	~<Ãtš‘/.h
>

7 
	~<Ãtš‘/_v¬.h
>

8 
	~<Ãtš‘/udp.h
>

9 
	~<Ãtš‘/udp_v¬.h
>

10 
	~<Ãt/if.h
>

11 
	~<Ãtš‘/if_‘h”.h
>

13 
	#TTL_OUT
 64

	)

16 
sockaddr
 *
de¡
, *
loÿl
;

17 
sockËn_t
 
de¡Ën
, 
loÿÎ’
;

18 
d©®šk
;

19 *
deviû
;

20 
pÿp_t
 *
pd
;

21 
¿wfd
;

22 
¢­Ën
;

23 
v”bo£
;

24 
z”osum
;

27 
ş—nup
();

28 *
Ãxt_pÿp
(*);

29 
İ’_ouut
();

30 
İ’_pÿp
();

31 
£nd_dns_qu”y
();

32 
‹¡_udp
();

33 
udp_wr™e
(*, );

34 
udphdr
 *
udp_»ad
();

	@osi\unpv13e\unpv13e\udpcksum\udpread.c

1 
	~"udpcksum.h
"

3 
udphdr
 *
udp_check
(*, );

11 
udphdr
 *

12 
	$udp_»ad
()

14 
Ën
;

15 *
±r
;

16 
‘h”_h—d”
 *
•Œ
;

19 
±r
 = 
	`Ãxt_pÿp
(&
Ën
);

21 
d©®šk
) {

22 
DLT_NULL
:

23 (
	`udp_check
(
±r
+4, 
Ën
-4));

25 
DLT_EN10MB
:

26 
•Œ
 = (
‘h”_h—d”
 *è
±r
;

27 ià(
	`Áohs
(
•Œ
->
‘h”_ty³
è!ğ
ETHERTYPE_IP
)

28 
	`”r_qu™
("Eth”Ãˆty³ %x‚Ù IP", 
	`Áohs
(
•Œ
->
‘h”_ty³
));

29 (
	`udp_check
(
±r
+14, 
Ën
-14));

31 
DLT_SLIP
:

32 (
	`udp_check
(
±r
+24, 
Ën
-24));

34 
DLT_PPP
:

35 (
	`udp_check
(
±r
+24, 
Ën
-24));

38 
	`”r_qu™
("unsuµÜ‹d d©®šk (%d)", 
d©®šk
);

41 
	}
}

52 
udphdr
 *

53 
	$udp_check
(*
±r
, 
Ën
)

55 
hËn
;

56 

 *ip;

57 
udphdr
 *
ui
;

60 ià(
Ën
 < (

è+ (
udphdr
))

61 
	`”r_qu™
("ËÀğ%d", 
Ën
);

65 

 = ( *è
±r
;

66 ià(

->
_v
 !ğ
IPVERSION
)

67 
	`”r_qu™
("_v = %d", 

->
_v
);

68 
hËn
 = 

->
_hl
 << 2;

70 ià(
hËn
 < (

))

71 
	`”r_qu™
("_hÈğ%d", 

->
_hl
);

72 ià(
Ën
 < 
hËn
 + (
udphdr
))

73 
	`”r_qu™
("ËÀğ%d, hËÀğ%d", 
Ën
, 
hËn
);

76 iàĞ(

->
_sum
 = 
	`š_cksum
((
ušt16_t
 *è, 
hËn
)) != 0)

77 
	`”r_qu™
("ip checksumƒrror");

79 ià(

->
_p
 =ğ
IPPROTO_UDP
) {

80 
ui
 = (
udphdr
 *è

;

81 (
ui
);

83 
	`”r_qu™
("not‡ UDP…acket");

84 
	}
}

	@osi\unpv13e\unpv13e\udpcksum\udpwrite.c

1 
	~"udpcksum.h
"

4 
	g¿wfd
;

7 
	$İ’_ouut
()

9 
Ú
=1;

16 
¿wfd
 = 
	`Sock‘
(
de¡
->
§_çmy
, 
SOCK_RAW
, 0);

18 
	`S‘sockİt
(
¿wfd
, 
IPPROTO_IP
, 
IP_HDRINCL
, &
Ú
, (on));

19 
	}
}

29 
	$udp_wr™e
(*
buf
, 
u£¾’
)

31 
udphdr
 *
ui
;

32 

 *ip;

35 

 = ( *è
buf
;

36 
ui
 = (
udphdr
 *è
buf
;

37 
	`bz”o
(
ui
, (*ui));

39 
ui
->
ui_Ën
 = 
	`htÚs
((
ušt16_t
è((
udphdr
è+ 
u£¾’
));

41 
u£¾’
 +ğ(
udphdr
);

43 
ui
->
ui_´
 = 
IPPROTO_UDP
;

44 
ui
->
ui_¤c
.
s_addr
 = ((
sockaddr_š
 *è
loÿl
)->
sš_addr
.s_addr;

45 
ui
->
ui_d¡
.
s_addr
 = ((
sockaddr_š
 *è
de¡
)->
sš_addr
.s_addr;

46 
ui
->
ui_¥Üt
 = ((
sockaddr_š
 *è
loÿl
)->
sš_pÜt
;

47 
ui
->
ui_dpÜt
 = ((
sockaddr_š
 *è
de¡
)->
sš_pÜt
;

48 
ui
->
ui_uËn
 = ui->
ui_Ën
;

49 ià(
z”osum
 == 0) {

51 iàĞ(
ui
->
ui_sum
 = 
	`š_cksum
((
u_št16_t
 *èui, 
u£¾’
)) == 0)

52 
ui
->
ui_sum
 = 0xffff;

54 
ui
->
ui_sum
 = ui->
ui_Ën
;

60 

->
_v
 = 
IPVERSION
;

61 

->
_hl
 = (ip) >> 2;

62 

->
_tos
 = 0;

63 #ià
	`defšed
(
lšux
è|| defšed(
__O³nBSD__
)

64 

->
_Ën
 = 
	`htÚs
(
u£¾’
);

66 

->
_Ën
 = 
u£¾’
;

68 

->
_id
 = 0;

69 

->
_off
 = 0;

70 

->
_‰l
 = 
TTL_OUT
;

72 
	`S’dto
(
¿wfd
, 
buf
, 
u£¾’
, 0, 
de¡
, 
de¡Ën
);

73 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgcliaddr.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr
 *
´•ly_addr
;

11 
´•ly_addr
 = 
	`M®loc
(
£rvËn
);

13 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

17 
Ën
 = 
£rvËn
;

18 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
´•ly_addr
, &
Ën
);

19 ià(
Ën
 !ğ
£rvËn
 || 
	`memcmp
(
p£rvaddr
, 
´•ly_addr
,†en) != 0) {

20 
	`´štf
("reply from %s (ignored)\n",

21 
	`Sock_Áİ
(
´•ly_addr
, 
Ën
));

25 
»cvlše
[
n
] = 0;

26 
	`Fputs
(
»cvlše
, 
¡dout
);

28 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgclibig.c

1 
	~"uÅ.h
"

3 #undeà
MAXLINE


4 
	#MAXLINE
 65507

	)

7 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

9 
size
;

10 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

11 
ssize_t
 
n
;

13 
size
 = 70000;

14 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
size
, (size));

15 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, (size));

17 
	`S’dto
(
sockfd
, 
£ndlše
, 
MAXLINE
, 0, 
p£rvaddr
, 
£rvËn
);

19 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, 
NULL
, NULL);

21 
	`´štf
("»ûived %d by‹s\n", 
n
);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgcliconnect.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

9 
	`CÚÃù
(
sockfd
, (
SA
 *è
p£rvaddr
, 
£rvËn
);

11 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

13 
	`Wr™e
(
sockfd
, 
£ndlše
, 
	`¡¾’
(sendline));

15 
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
);

17 
»cvlše
[
n
] = 0;

18 
	`Fputs
(
»cvlše
, 
¡dout
);

20 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgcliinetaddr.c

1 
	~"uÅ.h
"

4 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

6 
n
;

7 
£ndlše
[
MAXLINE
], 
»cvlše
[MAXLINE + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr_š
 *
»¶yaddr
;

11 
»¶yaddr
 = 
	`M®loc
(
£rvËn
);

13 
	`Fg‘s
(
£ndlše
, 
MAXLINE
, 
å
è!ğ
NULL
) {

15 
	`S’dto
(
sockfd
, 
£ndlše
, 
	`¡¾’
(£ndlše), 0, 
p£rvaddr
, 
£rvËn
);

17 
Ën
 = 
£rvËn
;

18 
n
 = 
	`Recväom
(
sockfd
, 
»cvlše
, 
MAXLINE
, 0, (
SA
 *è
»¶yaddr
, &
Ën
);

19 
	`´štf
("received„eply from %s,…ort %d\n",

20 
	`š‘_Áß
(
»¶yaddr
->
sš_addr
), 
	`htÚs
Ô•lyaddr->
sš_pÜt
));

22 
»cvlše
[
n
] = 0;

23 
	`Fputs
(
»cvlše
, 
¡dout
);

25 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgcliloop1.c

1 
	~"uÅ.h
"

3 
	#NDG
 2000

	)

4 
	#DGLEN
 1400

	)

7 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

9 
i
;

10 
£ndlše
[
DGLEN
];

12 
i
 = 0; i < 
NDG
; i++) {

13 
	`S’dto
(
sockfd
, 
£ndlše
, 
DGLEN
, 0, 
p£rvaddr
, 
£rvËn
);

15 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgcliloop3.c

1 
	~"uÅ.h
"

6 
	#NDG
 2000

	)

7 
	#DGLEN
 65507

	)

10 
	$dg_şi
(
FILE
 *
å
, 
sockfd
, cÚ¡ 
SA
 *
p£rvaddr
, 
sockËn_t
 
£rvËn
)

12 
i
, 
n
;

13 
£ndlše
[
DGLEN
];

15 
n
 = 100 * 1024;

16 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
n
, (n));

18 
i
 = 0; i < 
NDG
; i++) {

19 
	`S’dto
(
sockfd
, 
£ndlše
, 
DGLEN
, 0, 
p£rvaddr
, 
£rvËn
);

21 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgecholoop1.c

1 
	~"uÅ.h
"

3 
»cväom_št
();

4 
	gcouÁ
;

7 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

9 
sockËn_t
 
Ën
;

10 
mesg
[
MAXLINE
];

12 
	`SigÇl
(
SIGINT
, 
»cväom_št
);

15 
Ën
 = 
ş’
;

16 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
pşŸddr
, &
Ën
);

18 
couÁ
++;

20 
	}
}

23 
	$»cväom_št
(
signo
)

25 
	`´štf
("\Äeûived %d d©ag¿ms\n", 
couÁ
);

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\dgecholoop2.c

1 
	~"uÅ.h
"

3 
»cväom_št
();

4 
	gcouÁ
;

7 
	$dg_echo
(
sockfd
, 
SA
 *
pşŸddr
, 
sockËn_t
 
ş’
)

9 
n
;

10 
sockËn_t
 
Ën
;

11 
mesg
[
MAXLINE
];

13 
	`SigÇl
(
SIGINT
, 
»cväom_št
);

15 
n
 = 220 * 1024;

16 
	`S‘sockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
n
, (n));

19 
Ën
 = 
ş’
;

20 
	`Recväom
(
sockfd
, 
mesg
, 
MAXLINE
, 0, 
pşŸddr
, &
Ën
);

22 
couÁ
++;

24 
	}
}

27 
	$»cväom_št
(
signo
)

29 
	`´štf
("\Äeûived %d d©ag¿ms\n", 
couÁ
);

30 
	`ex™
(0);

31 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\sigchldwaitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0)

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

12 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 #ifdef 
HAVE_SOCKADDR_SA_LEN


14 
£rvaddr
.
sš_Ën
 = (servaddr);

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

22 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

24 
	`ex™
(0);

25 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli03.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(7);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli04.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli05.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`bz”o
(&
şŸddr
, (cliaddr));

20 
şŸddr
.
sš_çmy
 = 
AF_INET
;

21 
şŸddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

22 
şŸddr
.
sš_pÜt
 = 
	`htÚs
(0);

23 
	`Bšd
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

25 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

27 
	`ex™
(0);

28 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli08.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
;

9 ià(
¬gc
 != 2)

10 
	`”r_qu™
("usage: udpcli <IPaddress>");

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(9);

15 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

17 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

19 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`ex™
(0);

22 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli09.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
Ën
;

8 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage: udpcli <IPaddress>");

13 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

17 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

18 
	`IÃt_±Ú
(
AF_INET
, 
¬gv
[1], &
£rvaddr
.
sš_addr
);

20 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

22 
Ën
 = (
şŸddr
);

23 
	`G‘sockÇme
(
sockfd
, (
SA
 *è&
şŸddr
, &
Ën
);

24 
	`´štf
("loÿÈadd»s %s\n", 
	`Sock_Áİ
((
SA
 *è&
şŸddr
, 
Ën
));

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpcli10.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
§Ën
;

8 
sockaddr
 *
§
;

10 ià(
¬gc
 != 3)

11 
	`”r_qu™
("usage: udpcli02 <hostname> <service>");

13 
sockfd
 = 
	`Udp_ş›Á
(
¬gv
[1],‡rgv[2], (**è&
§
, &
§Ën
);

15 
	`dg_şi
(
¡dš
, 
sockfd
, 
§
, 
§Ën
);

17 
	`ex™
(0);

18 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpserv06.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpserv07.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_š
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

13 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

14 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\udpcliserv\udpservselect01.c

2 
	~"uÅ.h
"

5 
	$maš
(
¬gc
, **
¬gv
)

7 
li¡’fd
, 
cÚnfd
, 
udpfd
, 
Ä—dy
, 
maxfdp1
;

8 
mesg
[
MAXLINE
];

9 
pid_t
 
chdpid
;

10 
fd_£t
 
r£t
;

11 
ssize_t
 
n
;

12 
sockËn_t
 
Ën
;

13 cÚ¡ 
Ú
 = 1;

14 
sockaddr_š
 
şŸddr
, 
£rvaddr
;

15 
	`sig_chld
();

18 
li¡’fd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

20 
	`bz”o
(&
£rvaddr
, (servaddr));

21 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

22 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

23 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

25 
	`S‘sockİt
(
li¡’fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Ú
, (on));

26 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

28 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

31 
udpfd
 = 
	`Sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

33 
	`bz”o
(&
£rvaddr
, (servaddr));

34 
£rvaddr
.
sš_çmy
 = 
AF_INET
;

35 
£rvaddr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

36 
£rvaddr
.
sš_pÜt
 = 
	`htÚs
(
SERV_PORT
);

38 
	`Bšd
(
udpfd
, (
SA
 *è&
£rvaddr
, (servaddr));

42 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

44 
	`FD_ZERO
(&
r£t
);

45 
maxfdp1
 = 
	`max
(
li¡’fd
, 
udpfd
) + 1;

47 
	`FD_SET
(
li¡’fd
, &
r£t
);

48 
	`FD_SET
(
udpfd
, &
r£t
);

49 iàĞ(
Ä—dy
 = 
	`£Ëù
(
maxfdp1
, &
r£t
, 
NULL
, NULL, NULL)) < 0) {

50 ià(
”ºo
 =ğ
EINTR
)

53 
	`”r_sys
("selectƒrror");

56 ià(
	`FD_ISSET
(
li¡’fd
, &
r£t
)) {

57 
Ën
 = (
şŸddr
);

58 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
Ën
);

60 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

61 
	`Clo£
(
li¡’fd
);

62 
	`¡r_echo
(
cÚnfd
);

63 
	`ex™
(0);

65 
	`Clo£
(
cÚnfd
);

68 ià(
	`FD_ISSET
(
udpfd
, &
r£t
)) {

69 
Ën
 = (
şŸddr
);

70 
n
 = 
	`Recväom
(
udpfd
, 
mesg
, 
MAXLINE
, 0, (
SA
 *è&
şŸddr
, &
Ën
);

72 
	`S’dto
(
udpfd
, 
mesg
, 
n
, 0, (
SA
 *è&
şŸddr
, 
Ën
);

75 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\daytimetcpcli.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
, 
n
;

7 
»cvlše
[
MAXLINE
 + 1];

8 
sockËn_t
 
Ën
;

9 
sockaddr
 *
§
;

11 ià(
¬gc
 != 3)

12 
	`”r_qu™
("usage: daytimetcpcli <hostname/IPaddress> <service/port#>");

14 
sockfd
 = 
	`Tı_cÚÃù
(
¬gv
[1],‡rgv[2]);

16 
§
 = 
	`M®loc
((
sockaddr_¡Üage
));

17 
Ën
 = (
sockaddr_¡Üage
);

18 
	`G‘³”Çme
(
sockfd
, 
§
, &
Ën
);

19 
	`´štf
("cÚÃùedØ%s\n", 
	`Sock_Áİ_ho¡
(
§
, 
Ën
));

20 
	`¦“p
(5);

22  (
n
 = 
	`R—d
(
sockfd
, 
»cvlše
, 
MAXLINE
)) > 0) {

23 
»cvlše
[
n
] = 0;

24 
	`´štf
("%d by‹s: %s", 
n
, 
»cvlše
);

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\daytimetcpsrv2.c

1 
	~"uÅ.h
"

2 
	~<time.h
>

5 
	$maš
(
¬gc
, **
¬gv
)

7 
i
, 
li¡’fd
, 
cÚnfd
;

8 
sockËn_t
 
add¾’
, 
Ën
;

9 
sockaddr
 *
şŸddr
;

10 
buff
[
MAXLINE
];

11 
time_t
 
ticks
;

13 ià(
¬gc
 == 2)

14 
li¡’fd
 = 
	`Tı_li¡’
(
NULL
, 
¬gv
[1], &
add¾’
);

15 ià(
¬gc
 == 3)

16 
li¡’fd
 = 
	`Tı_li¡’
(
¬gv
[1],‡rgv[2], &
add¾’
);

18 
	`”r_qu™
("usage: daytimetcpsrv2 [ <host> ] <service or…ort>");

20 
şŸddr
 = 
	`M®loc
(
add¾’
);

23 
Ën
 = 
add¾’
;

24 
cÚnfd
 = 
	`Acû±
(
li¡’fd
, 
şŸddr
, &
Ën
);

25 
	`´štf
("cÚÃùiÚ from %s\n", 
	`Sock_Áİ
(
şŸddr
, 
Ën
));

27 
ticks
 = 
	`time
(
NULL
);

28 
	`¢´štf
(
buff
, (buff), "%.24s\r\n", 
	`ùime
(&
ticks
));

29 
i
 = 0; i < 
	`¡¾’
(
buff
); i++)

30 
	`S’d
(
cÚnfd
, &
buff
[
i
], 1, 
MSG_EOR
);

32 
	`Clo£
(
cÚnfd
);

34 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\mycat.c

1 
	~"uÅ.h
"

3 
my_İ’
(const *, );

6 
	$maš
(
¬gc
, **
¬gv
)

8 
fd
, 
n
;

9 
buff
[
BUFFSIZE
];

11 ià(
¬gc
 != 2)

12 
	`”r_qu™
("usage: mycat <pathname>");

14 iàĞ(
fd
 = 
	`my_İ’
(
¬gv
[1], 
O_RDONLY
)) < 0)

15 
	`”r_sys
("ÿÂÙ o³À%s", 
¬gv
[1]);

17  (
n
 = 
	`R—d
(
fd
, 
buff
, 
BUFFSIZE
)) > 0)

18 
	`Wr™e
(
STDOUT_FILENO
, 
buff
, 
n
);

20 
	`ex™
(0);

21 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\myopen.c

1 
	~"uÅ.h
"

4 
	$my_İ’
(cÚ¡ *
·thÇme
, 
mode
)

6 
fd
, 
sockfd
[2], 
¡©us
;

7 
pid_t
 
chdpid
;

8 
c
, 
¬gsockfd
[10], 
¬gmode
[10];

10 
	`Sock‘·œ
(
AF_LOCAL
, 
SOCK_STREAM
, 0, 
sockfd
);

12 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

13 
	`Clo£
(
sockfd
[0]);

14 
	`¢´štf
(
¬gsockfd
, ×rgsockfd), "%d", 
sockfd
[1]);

15 
	`¢´štf
(
¬gmode
, ×rgmode), "%d", 
mode
);

16 
	`exeş
("./İ’fe", "İ’fe", 
¬gsockfd
, 
·thÇme
, 
¬gmode
,

17 (*è
NULL
);

18 
	`”r_sys
("execlƒrror");

22 
	`Clo£
(
sockfd
[1]);

24 
	`Wa™pid
(
chdpid
, &
¡©us
, 0);

25 ià(
	`WIFEXITED
(
¡©us
) == 0)

26 
	`”r_qu™
("child did‚oterminate");

27 iàĞ(
¡©us
 = 
	`WEXITSTATUS
(status)) == 0)

28 
	`R—d_fd
(
sockfd
[0], &
c
, 1, &
fd
);

30 
”ºo
 = 
¡©us
;

31 
fd
 = -1;

34 
	`Clo£
(
sockfd
[0]);

35 (
fd
);

36 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\openfile.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
fd
;

8 ià(
¬gc
 != 4)

9 
	`”r_qu™
("openfile <sockfd#> <filename> <mode>");

11 iàĞ(
fd
 = 
	`İ’
(
¬gv
[2], 
	`©oi
(argv[3]))) < 0)

12 
	`ex™
Ğ(
”ºo
 > 0) ?ƒrrno : 255 );

14 ià(
	`wr™e_fd
(
	`©oi
(
¬gv
[1]), "", 1, 
fd
) < 0)

15 
	`ex™
Ğ(
”ºo
 > 0) ?ƒrrno : 255 );

17 
	`ex™
(0);

18 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\readcred.c

1 
	~"uÅ.h
"

3 
	#CONTROL_LEN
 ((
cmsghdr
è+ (
cmsgüed
))

	)

5 
ssize_t


6 
	$»ad_üed
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
cmsgüed
 *
cmsgüed±r
)

8 
msghdr
 
msg
;

9 
iovec
 
iov
[1];

10 
cÚŒŞ
[
CONTROL_LEN
];

11 
n
;

13 
msg
.
msg_Çme
 = 
NULL
;

14 
msg
.
msg_Çm–’
 = 0;

15 
iov
[0].
iov_ba£
 = 
±r
;

16 
iov
[0].
iov_Ën
 = 
nby‹s
;

17 
msg
.
msg_iov
 = 
iov
;

18 
msg
.
msg_iovËn
 = 1;

19 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ
;

20 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ
);

21 
msg
.
msg_æags
 = 0;

23 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, 0)) < 0)

24 (
n
);

26 
cmsgüed±r
->
cmüed_ngroups
 = 0;

27 ià(
cmsgüed±r
 && 
msg
.
msg_cÚŒŞËn
 > 0) {

28 
cmsghdr
 *
cm±r
 = (cmsghd¸*è
cÚŒŞ
;

30 ià(
cm±r
->
cmsg_Ën
 < 
CONTROL_LEN
)

31 
	`”r_qu™
("cÚŒŞ†’gth = %d", 
cm±r
->
cmsg_Ën
);

32 ià(
cm±r
->
cmsg_Ëv–
 !ğ
SOL_SOCKET
)

33 
	`”r_qu™
("control†evel != SOL_SOCKET");

34 ià(
cm±r
->
cmsg_ty³
 !ğ
SCM_CREDS
)

35 
	`”r_qu™
("controlype != SCM_CREDS");

36 
	`memıy
(
cmsgüed±r
, 
	`CMSG_DATA
(
cm±r
), (
cmsgüed
));

39 (
n
);

40 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\sigchldwaitpid.c

1 
	~"uÅ.h
"

4 
	$sig_chld
(
signo
)

6 
pid_t
 
pid
;

7 
¡©
;

9  (
pid
 = 
	`wa™pid
(-1, &
¡©
, 
WNOHANG
)) > 0) {

10 
	`´štf
("chd %d”mš©ed\n", 
pid
);

13 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\strecho.c

1 
	~"uÅ.h
"

3 
ssize_t
 
»ad_üed
(, *, 
size_t
, 
cmsgüed
 *);

6 
	$¡r_echo
(
sockfd
)

8 
ssize_t
 
n
;

9 
i
;

10 
buf
[
MAXLINE
];

11 
cmsgüed
 
üed
;

13 
agaš
:

14  (
n
 = 
	`»ad_üed
(
sockfd
, 
buf
, 
MAXLINE
, &
üed
)) > 0) {

15 ià(
üed
.
cmüed_ngroups
 == 0) {

16 
	`´štf
("(no credentials„eturned)\n");

18 
	`´štf
("PID oà£nd” = %d\n", 
üed
.
cmüed_pid
);

19 
	`´štf
("»® u£¸ID = %d\n", 
üed
.
cmüed_uid
);

20 
	`´štf
("»® grou°ID = %d\n", 
üed
.
cmüed_gid
);

21 
	`´štf
("efãùivu£¸ID = %d\n", 
üed
.
cmüed_euid
);

22 
	`´štf
("%d groups:", 
üed
.
cmüed_ngroups
 - 1);

23 
i
 = 1; i < 
üed
.
cmüed_ngroups
; i++)

24 
	`´štf
(" %d", 
üed
.
cmüed_groups
[
i
]);

25 
	`´štf
("\n");

27 
	`Wr™’
(
sockfd
, 
buf
, 
n
);

30 ià(
n
 < 0 && 
”ºo
 =ğ
EINTR
)

31 
agaš
;

32 ià(
n
 < 0)

33 
	`”r_sys
("str_echo:„eadƒrror");

34 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\testfcred.c

1 
	~"uÅ.h
"

2 
	~<sys/·¿m.h
>

3 
	~<sys/uüed.h
>

5 
	$maš
()

7 
	`´štf
("sizeof(¡ruù füedèğ%d\n", (
füed
));

8 
	`´štf
("sizeof(¡ruù cmsghdrèğ%d\n", (
cmsghdr
));

9 
	`ex™
(0);

10 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\tfcred01.c

1 
	~"uÅ.h
"

2 
	~<sys/·¿m.h
>

3 
	~<sys/uüed.h
>

5 
ssize_t
 
»cv_üed
(, *, 
size_t
, 
füed
 *);

7 
	$maš
()

9 
fd
[2], 
Ú
, 
n
;

10 
buf
[100];

11 
füed
 
üed
;

13 ià(
	`sock‘·œ
(
AF_LOCAL
, 
SOCK_STREAM
, 0, 
fd
) < 0)

14 
	`”r_sys
("socketpairƒrror");

17 
Ú
 = 1;

18 
	`S‘sockİt
(
fd
[1], 0, 
LOCAL_CREDS
, &
Ú
, (on));

20 
	`Wr™e
(
fd
[0], "hello, world\n", 13);

22 iàĞ(
n
 = 
	`»cv_üed
(
fd
[1], 
buf
, (buf), &
üed
)) < 0)

23 
	`”r_sys
("recv_credƒrror");

24 ià(
n
 == 0)

25 
	`”r_qu™
("recv_cred, unexpected EOF");

27 
buf
[
n
] = 0;

28 
	`´štf
("d©a: %s", 
buf
);

30 ià(
üed
.
fc_ngroups
 == 0)

31 
	`´štf
("(no credentials„eturned)\n");

33 
	`´štf
("»® u£¸ID = %d\n", 
üed
.
fc_ruid
);

34 
	`´štf
("»® grou°ID = %d\n", 
üed
.
fc_rgid
);

35 
	`´štf
("logš‚amğ%-*s\n", 
MAXLOGNAME
, 
üed
.
fc_logš
);

36 
	`´štf
("efãùivu£¸ID = %d\n", 
üed
.
fc_uid
);

37 
	`´štf
("efãùivgrou°ID = %d\n", 
üed
.
fc_gid
);

38 
	`´štf
("%d suµËm’ry groups:", 
üed
.
fc_ngroups
 - 1);

39 
n
 = 1;‚ < 
üed
.
fc_ngroups
;‚++)

40 
	`´štf
(" %d", 
üed
.
fc_groups
[
n
]);

41 
	`´štf
("\n");

44 
	`ex™
(0);

45 
	}
}

47 
	#CONTROL_LEN
 ((
cmsghdr
è+ (
füed
))

	)

49 
ssize_t


50 
	$»cv_üed
(
fd
, *
±r
, 
size_t
 
nby‹s
, 
füed
 *
füed±r
)

52 
msghdr
 
msg
;

53 
iovec
 
iov
[1];

54 
cÚŒŞ
[
CONTROL_LEN
 + 20];

55 
n
;

57 
msg
.
msg_Çme
 = 
NULL
;

58 
msg
.
msg_Çm–’
 = 0;

59 
iov
[0].
iov_ba£
 = 
±r
;

60 
iov
[0].
iov_Ën
 = 
nby‹s
;

61 
msg
.
msg_iov
 = 
iov
;

62 
msg
.
msg_iovËn
 = 1;

63 
msg
.
msg_cÚŒŞ
 = 
cÚŒŞ
;

64 
msg
.
msg_cÚŒŞËn
 = (
cÚŒŞ
);

65 
msg
.
msg_æags
 = 0;

67 iàĞ(
n
 = 
	`»cvmsg
(
fd
, &
msg
, 0)) < 0)

68 (
n
);

70 
füed±r
->
fc_ngroups
 = 0;

71 ià(
füed±r
 && 
msg
.
msg_cÚŒŞËn
 > 0) {

72 
cmsghdr
 *
cm±r
 = (cmsghd¸*è
cÚŒŞ
;

74 ià(
cm±r
->
cmsg_Ën
 !ğ(
cmsghdr
è+ (
füed
))

75 
	`”r_qu™
("cÚŒŞ†’gth = %d", 
cm±r
->
cmsg_Ën
);

76 ià(
cm±r
->
cmsg_Ëv–
 !ğ
SOL_SOCKET
)

77 
	`”r_qu™
("control†evel != SOL_SOCKET");

78 ià(
cm±r
->
cmsg_ty³
 !ğ
SCM_CREDS
)

79 
	`”r_qu™
("controlype != SCM_CREDS");

80 
	`memıy
(
füed±r
, 
	`CMSG_DATA
(
cm±r
), (
füed
));

83 (
n
);

84 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixbind.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockËn_t
 
Ën
;

8 
sockaddr_un
 
addr1
, 
addr2
;

10 ià(
¬gc
 != 2)

11 
	`”r_qu™
("usage: unixbind <pathname>");

13 
sockfd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_STREAM
, 0);

15 
	`uÆšk
(
¬gv
[1]);

17 
	`bz”o
(&
addr1
, (addr1));

18 
addr1
.
sun_çmy
 = 
AF_LOCAL
;

19 
	`¡ºıy
(
addr1
.
sun_·th
, 
¬gv
[1], (addr1.sun_path)-1);

20 
	`Bšd
(
sockfd
, (
SA
 *è&
addr1
, 
	`SUN_LEN
(&addr1));

22 
Ën
 = (
addr2
);

23 
	`G‘sockÇme
(
sockfd
, (
SA
 *è&
addr2
, &
Ën
);

24 
	`´štf
("bound‚amğ%s,„‘uºed†’ = %d\n", 
addr2
.
sun_·th
, 
Ën
);

26 
	`ex™
(0);

27 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixdgcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_un
 
şŸddr
, 
£rvaddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_DGRAM
, 0);

11 
	`bz”o
(&
şŸddr
, (cliaddr));

12 
şŸddr
.
sun_çmy
 = 
AF_LOCAL
;

13 
	`¡rıy
(
şŸddr
.
sun_·th
, 
	`tm²am
(
NULL
));

15 
	`Bšd
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

17 
	`bz”o
(&
£rvaddr
, (servaddr));

18 
£rvaddr
.
sun_çmy
 = 
AF_LOCAL
;

19 
	`¡rıy
(
£rvaddr
.
sun_·th
, 
UNIXDG_PATH
);

21 
	`dg_şi
(
¡dš
, 
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

23 
	`ex™
(0);

24 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixdgserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_un
 
£rvaddr
, 
şŸddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_DGRAM
, 0);

11 
	`uÆšk
(
UNIXDG_PATH
);

12 
	`bz”o
(&
£rvaddr
, (servaddr));

13 
£rvaddr
.
sun_çmy
 = 
AF_LOCAL
;

14 
	`¡rıy
(
£rvaddr
.
sun_·th
, 
UNIXDG_PATH
);

16 
	`Bšd
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

18 
	`dg_echo
(
sockfd
, (
SA
 *è&
şŸddr
, (cliaddr));

19 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixstrcli01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
sockfd
;

7 
sockaddr_un
 
£rvaddr
;

9 
sockfd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_STREAM
, 0);

11 
	`bz”o
(&
£rvaddr
, (servaddr));

12 
£rvaddr
.
sun_çmy
 = 
AF_LOCAL
;

13 
	`¡rıy
(
£rvaddr
.
sun_·th
, 
UNIXSTR_PATH
);

15 
	`CÚÃù
(
sockfd
, (
SA
 *è&
£rvaddr
, (servaddr));

17 
	`¡r_şi
(
¡dš
, 
sockfd
);

19 
	`ex™
(0);

20 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixstrserv01.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_un
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_STREAM
, 0);

14 
	`uÆšk
(
UNIXSTR_PATH
);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sun_çmy
 = 
AF_LOCAL
;

17 
	`¡rıy
(
£rvaddr
.
sun_·th
, 
UNIXSTR_PATH
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@osi\unpv13e\unpv13e\unixdomain\unixstrserv02.c

1 
	~"uÅ.h
"

4 
	$maš
(
¬gc
, **
¬gv
)

6 
li¡’fd
, 
cÚnfd
;

7 
pid_t
 
chdpid
;

8 
sockËn_t
 
ş’
;

9 
sockaddr_un
 
şŸddr
, 
£rvaddr
;

10 
	`sig_chld
();

12 
li¡’fd
 = 
	`Sock‘
(
AF_LOCAL
, 
SOCK_STREAM
, 0);

14 
	`uÆšk
(
UNIXSTR_PATH
);

15 
	`bz”o
(&
£rvaddr
, (servaddr));

16 
£rvaddr
.
sun_çmy
 = 
AF_LOCAL
;

17 
	`¡rıy
(
£rvaddr
.
sun_·th
, 
UNIXSTR_PATH
);

19 
	`Bšd
(
li¡’fd
, (
SA
 *è&
£rvaddr
, (servaddr));

21 
	`Li¡’
(
li¡’fd
, 
LISTENQ
);

23 
	`SigÇl
(
SIGCHLD
, 
sig_chld
);

26 
ş’
 = (
şŸddr
);

27 iàĞ(
cÚnfd
 = 
	`acû±
(
li¡’fd
, (
SA
 *è&
şŸddr
, &
ş’
)) < 0) {

28 ià(
”ºo
 =ğ
EINTR
)

31 
	`”r_sys
("acceptƒrror");

34 iàĞ(
chdpid
 = 
	`FÜk
()) == 0) {

35 
	`Clo£
(
li¡’fd
);

36 
	`¡r_echo
(
cÚnfd
);

37 
	`ex™
(0);

39 
	`Clo£
(
cÚnfd
);

41 
	}
}

	@test.c

10 
	~<¡dio.h
>

11 
	~<¡ršg.h
>

12 
	~<¡dlib.h
>

14 
	~"libty³.h
"

15 
	~"cÚfigP¬s.h
"

17 
	$maš
()

20  
OSI_OK
;

21 
	}
}

	@tool\configPars.c

15 
	~<¡dio.h
>

16 
	~<¡dlib.h
>

17 
	~<¡ršg.h
>

19 
	~"toŞ.h
"

20 
	~"‹xt.h
"

21 
	~"cÚfigP¬s.h
"

23 
·rs_cÚfig_lše
Ğ
STRING
 
cÚfig_lše_¡r
, STRING* 
·¿m_¡r_±r
, STRING* 
v®ue_¡r_±r
 );

25 
	$g‘_cÚfig_v®ue
(
LIST_HANDLE
 
‹xt_hªdË
, 
STRING
 
cÚfig_Çme
, STRING* 
cÚfig_v®ue_±r
)

27 
MATCH_WORD_POSITION
 
¡r_posi
;

28 
LIST_HANDLE
 
lše_hªdË
;

29 
STRING
 
lše_¡r
, 
·¿m_¡r
, 
v®ue_¡r
;

30 
LINE_NODE_PTR
 
lše_node_±r
;

32 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| 
cÚfig_Çme
==
NULL
 || 
cÚfig_v®ue_±r
==NULL)

34 
	`´štf
("Parameterƒrror!\n");

35  
OSI_ERROR
;

38 
lše_hªdË
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

39 ià(
lše_hªdË
 =ğ
NULL
)

41  
OSI_ERROR
;

44 
¡r_posi
.
lše_node_hªdË
=
lše_hªdË
;

45 ià(
	`fšd_keywÜd
(
‹xt_hªdË
,
cÚfig_Çme
,&
¡r_posi
,
READ_PERMISSION_TAG
)==
OSI_ERROR
)

47 
	`´štf
("CªnÙ fšd keywÜd:%s!\n", 
cÚfig_Çme
);

48 
E¼Ex™
;

51 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`G‘D©a
(
¡r_posi
.
lše_node_hªdË
))==
NULL
)

53 
E¼Ex™
;

56 
lše_¡r
=
lše_node_±r
->
lše_±r
;

58 ià(
	`·rs_cÚfig_lše
(
lše_¡r
,&
·¿m_¡r
,&
v®ue_¡r
)==
OSI_ERROR
)

60 
	`´štf
("Pars config stringƒrror!\n");

61 
E¼Ex™
;

64 *
cÚfig_v®ue_±r
=
v®ue_¡r
;

65  
OSI_OK
;

67 
E¼Ex™
:

68 
	`D–‘eHªdË
(
lše_hªdË
);

69  
OSI_ERROR
;

70 
	}
}

72 
	$modify_cÚfig
(
LIST_HANDLE
 
‹xt_hªdË
, 
STRING
 
cÚfig_Çme
, STRING 
cÚfig_v®ue
)

74 
STRING
 
Ãw_lše_¡r
;

75 
Ãw_lše_Ën
, 
cÚfig_Çme_Ën
, 
cÚfig_v®ue_Ën
;

77 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| 
cÚfig_Çme
==
NULL
 || 
cÚfig_v®ue
==NULL)

79  
OSI_ERROR
;

81 
cÚfig_Çme_Ën
=
	`¡¾’
(
cÚfig_Çme
);

82 
cÚfig_v®ue_Ën
=
	`¡¾’
(
cÚfig_v®ue
);

83 
Ãw_lše_Ën
=
cÚfig_Çme_Ën
+
cÚfig_v®ue_Ën
+1;

85 ià((
Ãw_lše_¡r
=(
STRING
)
	`m®loc
(
Ãw_lše_Ën
+1))==
NULL
)

87  
OSI_ERROR
;

90 
	`memıy
(
Ãw_lše_¡r
, 
cÚfig_Çme
, 
cÚfig_Çme_Ën
);

91 
Ãw_lše_¡r
[
cÚfig_Çme_Ën
]='=';

92 
	`memıy
(
Ãw_lše_¡r
+
cÚfig_Çme_Ën
+1,
cÚfig_v®ue
,
cÚfig_v®ue_Ën
);

93 
Ãw_lše_¡r
[
Ãw_lše_Ën
]='\0';

95 ià(
	`»¶aû_lše_kw
(
‹xt_hªdË
,
cÚfig_Çme
,
Ãw_lše_¡r
)==
OSI_ERROR
)

97 
	`´štf
("Replace†ineƒrror!\n");

98 
E¼Ex™
;

101  
OSI_OK
;

103 
E¼Ex™
:

104 ià(
Ãw_lše_¡r
)

106 
	`ä“
(
Ãw_lše_¡r
);

108  
OSI_ERROR
;

109 
	}
}

111 
	$·rs_cÚfig_lše
(

112 
STRING
 
cÚfig_lše_¡r
,

113 
STRING
* 
·¿m_¡r_±r
,

114 
STRING
* 
v®ue_¡r_±r


117 
d–i_šdex
, 
cÚfig_lše_Ën
,
šdex
;

118 
STRING
 
·¿m_¡r
, 
v®ue_¡r
;

119 
c
;

121 ià(
cÚfig_lše_¡r
==
NULL
 || 
·¿m_¡r_±r
==NULL || 
v®ue_¡r_±r
==NULL)

123  
OSI_ERROR
;

126 
d–i_šdex
=
	`fšd¡r
(
cÚfig_lše_¡r
,"=");

127 ià(
d–i_šdex
==
OSI_ERROR
)

129 
	`´štf
("Cannot find delimiter of config†ine!\n");

130  
OSI_ERROR
;

133 
·¿m_¡r
=
v®ue_¡r
=
NULL
;

135 ià((
·¿m_¡r
=(
STRING
)
	`m®loc
(
d–i_šdex
+1))==
NULL
)

137 
	`´štf
("Memory†imited!\n");

138 
E¼Ex™
;

141 
cÚfig_lše_Ën
=
	`¡¾’
(
cÚfig_lše_¡r
);

143 ià((
v®ue_¡r
=(
STRING
)
	`m®loc
(
cÚfig_lše_Ën
-
d–i_šdex
)))

145 
	`´štf
("Memory†imited!\n");

146 
E¼Ex™
;

149 *
cÚfig_lše_¡r
==' ' || *config_line_str=='\t')

150 
cÚfig_lše_¡r
++;

152 
šdex
=0;

153 (
c
=*
cÚfig_lše_¡r
++) != '=')

155 
·¿m_¡r
[
šdex
++]=
c
;

157 
·¿m_¡r
[
šdex
]='\0';

158 ià(
šdex
==0)

160 
	`´štf
("Config†ine syntaxƒrror!\n");

161 
E¼Ex™
;

164 
šdex
=0;

165 *
cÚfig_lše_¡r
)

167 ià(*
cÚfig_lše_¡r
==' ' || *config_line_str=='\t')

169 
cÚfig_lše_¡r
++;

171 
v®ue_¡r
[
šdex
++]=*
cÚfig_lše_¡r
++;

174 ià(
šdex
==0)

176 
	`´štf
("Config†ine syntaxƒrror!\n");

177 
E¼Ex™
;

180 
v®ue_¡r
[
šdex
]='\0';

182 *
·¿m_¡r_±r
=
·¿m_¡r
;

183 *
v®ue_¡r_±r
=
v®ue_¡r
;

185  
OSI_OK
;

187 
E¼Ex™
:

188 ià(
·¿m_¡r
)

190 
	`ä“
(
·¿m_¡r
);

192 ià(
v®ue_¡r
)

194 
	`ä“
(
v®ue_¡r
);

196  
OSI_ERROR
;

197 
	}
}

	@tool\text.c

13 
	~<¡dio.h
>

14 
	~<¡dlib.h
>

15 
	~<¡ršg.h
>

17 
	~"toŞ.h
"

18 
	~"‹xt.h
"

21 
lše_kw_cmp_fun
(* 
node_d©a_±r
, * 
keywÜd
, * 
u£rd©a
);

23 
LIST_HANDLE
 
	$»ad_‹xt
(
STRING
 
‹xt_f’ame
)

25 
FILE
* 
å
;

26 * 
lše_±r
;

27 
lše_Ën
;

28 
Ä—d
,
couÁ
;

29 
LINE_NODE
 
lše_node
;

30 
LIST_HANDLE
 
hªdË
;

31 * 
cmp_funs
[1];

33 ià(
‹xt_f’ame
 =ğ
NULL
)

35  
NULL
;

38 
hªdË
=
NULL
;

40 
å
=
	`fİ’
(
‹xt_f’ame
,"r");

41 ià(
å
 =ğ
NULL
)

43 
	`´štf
("Openext fileƒrror!\n");

44  
NULL
;

48 ià((
hªdË
=
	`C»©eHªdË
(
LIST_HEAD_TYPE
))==
NULL
)

50 
E¼Ex™
;

53 
cmp_funs
[0]=(*)
lše_kw_cmp_fun
;

54 ià(
	`In™Ÿlize
(
hªdË
,1,
cmp_funs
)==
OSI_ERROR
)

56 
	`D–‘eHªdË
(
hªdË
);

57 
E¼Ex™
;

60 
	`f£ek
(
å
,0,
SEEK_SET
);

61 
lše_±r
=
NULL
;

62 
lše_Ën
=0;

63 
couÁ
=0;

64 (
Ä—d
=
	`g‘lše
(&
lše_±r
,&
lše_Ën
,
å
)è!ğ
OSI_ERROR
)

66 
lše_node
.
lše_±r
=line_ptr;

67 
lše_node
.
lše_Ën
=
Ä—d
;

68 ià(
	`In£¹NodeH—d
(
hªdË
,(
lše_node
),&lše_node)==
OSI_ERROR
)

70 
	`´štf
("Insertext†ineƒrror, maybe memory†imited!\n");

71 
	`fşo£
(
å
);

72  
hªdË
;

74 
lše_±r
=
NULL
;

75 
lše_Ën
=0;

78 
	`fşo£
(
å
);

79  
hªdË
;

81 
E¼Ex™
:

83 
	`fşo£
(
å
);

84  
NULL
;

85 
	}
}

87 
	$fšd_keywÜd
(

88 
LIST_HANDLE
 
‹xt_hªdË
,

89 
STRING
 
keywÜd
,

90 
MATCH_WORD_POSITION_PTR
 
¡r_posi_±r
,

91 
³rmi_g


94 * 
keywÜd_±r_¬¿y
[1];

95 
cmp_šdex
, 
m©ched_šdex
,
»tv®
;

96 
LIST_HANDLE
 
lše_node_hªdË
;

98 ià(
¡r_posi_±r
==
NULL
 || 
	`IsHªdËEm±y
(
‹xt_hªdË
))

100 
	`´štf
("Parameterƒrror!\n");

101  
OSI_ERROR
;

104 
lše_node_hªdË
=
¡r_posi_±r
->line_node_handle;

105 ià(
	`IsHªdËEm±y
(
lše_node_hªdË
))

107 
	`´štf
("Empty handle!\n");

108  
OSI_ERROR
;

111 ià(
keywÜd
==
NULL
)

113 
	`´štf
("No keyword for match!\n");

114  
OSI_ERROR
;

117 
keywÜd_±r_¬¿y
[0]=(*)
keywÜd
;

118 
cmp_šdex
=0x1;

119 
»tv®
=
	`FšdSW
(
‹xt_hªdË
,
keywÜd_±r_¬¿y
,
cmp_šdex
,

120 
lše_node_hªdË
,
³rmi_g
,(*)&
m©ched_šdex
);

122 ià(
»tv®
 < 0)

124 
	`´štf
("Find keywordƒrror!\n");

125  
OSI_ERROR
;

128 
¡r_posi_±r
->
lše_num
=
»tv®
;

129 
¡r_posi_±r
->
wÜd_šdex_begš
=
m©ched_šdex
;

130 
¡r_posi_±r
->
wÜd_šdex_’d
=
m©ched_šdex
+
	`¡¾’
(
keywÜd
)-1;

131 
¡r_posi_±r
->
³rmi_g
=permi_tag;

132  
OSI_OK
;

133 
	}
}

135 
	$fšd_lše_num
(

136 
LIST_HANDLE
 
‹xt_hªdË
,

137 
lše_num
,

138 
LIST_HANDLE
 
lše_node
,

139 
³rmi_g


142 
»tv®
;

144 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| IsHªdËEm±y(
lše_node
è|| 
lše_num
<0)

146 
	`´štf
("Parameterƒrror!\n");

147  
OSI_ERROR
;

150 
»tv®
=
	`FšdNodeNum
(
‹xt_hªdË
,
lše_num
,
lše_node
,
³rmi_g
);

152 
»tv®
)

154 
OSI_ERROR
:

155 
	`´štf
("Cannot find specific†ine!\n");

156  
OSI_ERROR
;

158 
LIST_PERMISSION_DENY
:

159 
	`´štf
("Permission deny!\n");

160  
OSI_ERROR
;

162 
OSI_OK
:

163  
OSI_OK
;

169  
OSI_ERROR
;

170 
	}
}

172 
	$»¶aû_lše_num
(

173 
LIST_HANDLE
 
‹xt_hªdË
,

174 
lše_num
,

175 
STRING
 
Ãw_lše_¡r


178 
LIST_HANDLE
 
lše_hªdË
;

179 
LINE_NODE_PTR
 
lše_node_±r
;

180 
Ãw_lše_Ën
, 
Şd_lše_Ën
;

182 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| 
lše_num
 < 0 || 
Ãw_lše_¡r
 =ğ
NULL
)

184 
	`´štf
("Parameterƒrror!\n");

185  
OSI_ERROR
;

188 ià((
lše_hªdË
=
	`C»©eHªdË
(
LIST_NODE_TYPE
))==
NULL
)

190  
OSI_ERROR
;

193 ià(
	`fšd_lše_num
(
‹xt_hªdË
,
lše_num
,
lše_hªdË
,
WRITE_PERMISSION_TAG
)==
OSI_ERROR
)

195 
	`´štf
("Find†ine with‚umberagƒrror!\n");

196  
OSI_ERROR
;

199 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`G‘D©a
(
lše_hªdË
))==
NULL
)

201 
	`R–—£P”missiÚ
(
lše_hªdË
,
WRITE_PERMISSION_TAG
);

202 
	`´štf
("Error: Empty‚ode!\n");

203  
OSI_ERROR
;

206 
Ãw_lše_Ën
=
	`¡¾’
(
Ãw_lše_¡r
)+1;

207 
Şd_lše_Ën
=
	`¡¾’
(
lše_node_±r
->
lše_±r
);

209 ià(
Ãw_lše_Ën
 > 
Şd_lše_Ën
)

211 
lše_node_±r
->
lše_±r
=(
STRING
)
	`»®loc
Öše_node_±r->lše_±r, 
Ãw_lše_Ën
+1);

214 
	`memıy
(
lše_node_±r
->
lše_±r
,
Ãw_lše_¡r
,
Ãw_lše_Ën
-1);

215 
lše_node_±r
->
lše_±r
[
Ãw_lše_Ën
-1]='\r';

216 
lše_node_±r
->
lše_±r
[
Ãw_lše_Ën
]='\0';

217 
lše_node_±r
->
lše_Ën
=
Ãw_lše_Ën
;

219 
	`R–—£P”missiÚ
(
lše_hªdË
,
WRITE_PERMISSION_TAG
);

220 
	`D–‘eHªdË
(
lše_hªdË
);

222  
OSI_OK
;

223 
	}
}

225 
	$»¶aû_lše_kw
(

226 
LIST_HANDLE
 
‹xt_hªdË
,

227 
STRING
 
keywÜd
,

228 
STRING
 
Ãw_lše_¡r


231 
LIST_HANDLE
 
lše_hªdË
;

232 
LINE_NODE_PTR
 
lše_node_±r
;

233 
MATCH_WORD_POSITION
 
¡r_posi
;

234 
STRING
 
Şd_lše_¡r
;

235 
»tv®
, 
Şd_lše_Ën
, 
Ãw_lše_Ën
;

237 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| 
Ãw_lše_¡r
==
NULL
)

239  
OSI_ERROR
;

242 
lše_hªdË
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

243 ià(
lše_hªdË
==
NULL
)

245  
OSI_ERROR
;

248 
¡r_posi
.
lše_node_hªdË
=
lše_hªdË
;

249 
»tv®
=
	`fšd_keywÜd
(
‹xt_hªdË
,
keywÜd
,&
¡r_posi
,
WRITE_PERMISSION_TAG
);

250 ià(
»tv®
==
OSI_ERROR
)

252 
	`´štf
("Cannot find keyword!\n");

253 
	`D–‘eHªdË
(
lše_hªdË
);

254  
OSI_ERROR
;

257 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`G‘D©a
(
lše_hªdË
))==
NULL
)

259 
	`´štf
("Error: Empty‚ode!\n");

260 
	`D–‘eHªdË
(
lše_hªdË
);

261  
OSI_ERROR
;

264 
Şd_lše_¡r
=
lše_node_±r
->
lše_±r
;

265 
Şd_lše_Ën
=
lše_node_±r
->
lše_Ën
;

267 
Ãw_lše_Ën
=
	`¡¾’
(
Ãw_lše_¡r
)+1;

268 ià(
Ãw_lše_Ën
 > 
Şd_lše_Ën
)

270 
lše_node_±r
->
lše_±r
=(
STRING
è
	`»®loc
Öše_node_±r->lše_±r,
Ãw_lše_Ën
+1);

273 
	`memıy
(
lše_node_±r
->
lše_±r
,
Ãw_lše_¡r
, 
Ãw_lše_Ën
-1);

274 
lše_node_±r
->
lše_±r
[
Ãw_lše_Ën
-1]='\r';

275 
lše_node_±r
->
lše_±r
[
Ãw_lše_Ën
]='\0';

276 
lše_node_±r
->
lše_Ën
=
Ãw_lše_Ën
;

278 
	`R–—£P”missiÚ
(
lše_hªdË
,
WRITE_PERMISSION_TAG
);

279 
	`D–‘eHªdË
(
lše_hªdË
);

280  
OSI_OK
;

281 
	}
}

283 
	$»¶aû_kw
(

284 
LIST_HANDLE
 
‹xt_hªdË
,

285 
STRING
 
keywÜd
,

286 
STRING
 
Ãw_¡ršg


289 
LIST_HANDLE
 
lše_hªdË
;

290 
LINE_NODE_PTR
 
lše_node_±r
;

291 
MATCH_WORD_POSITION
 
¡r_posi
;

292 
»tv®
, 
Ãw_lše_Ëngth
,
wib
,
w›
,
Şd_lše_Ën
,
Ãw_¡ršg_Ën
;

293 
STRING
 
Şd_lše_¡r
,
Ãw_lše_¡r
;

295 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
è|| 
Ãw_¡ršg
==
NULL
)

297  
OSI_ERROR
;

301 
lše_hªdË
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

302 ià(
lše_hªdË
==
NULL
)

304  
OSI_ERROR
;

307 
¡r_posi
.
lše_node_hªdË
=
lše_hªdË
;

308 
»tv®
=
	`fšd_keywÜd
(
‹xt_hªdË
,
keywÜd
,&
¡r_posi
,
WRITE_PERMISSION_TAG
);

309 ià(
»tv®
==
OSI_ERROR
)

311 
	`´štf
("Cannot find keyword!\n");

312 
	`D–‘eHªdË
(
lše_hªdË
);

313  
OSI_ERROR
;

316 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`G‘D©a
(
lše_hªdË
))==
NULL
)

318 
	`´štf
("Error: Empty‚ode!\n");

319 
	`D–‘eHªdË
(
lše_hªdË
);

320  
OSI_ERROR
;

323 
Şd_lše_¡r
=
lše_node_±r
->
lše_±r
;

324 
Şd_lše_Ën
=
lše_node_±r
->
lše_Ën
;

325 
wib
=
¡r_posi
.
wÜd_šdex_begš
;

326 
w›
=
¡r_posi
.
wÜd_šdex_’d
;

328 
Ãw_¡ršg_Ën
=
	`¡¾’
(
Ãw_¡ršg
);

329 
Ãw_lše_Ëngth
=
Şd_lše_Ën
-(
w›
-
wib
+1)+
Ãw_¡ršg_Ën
;

330 ià(
Ãw_lše_Ëngth
 > 
Şd_lše_Ën
)

332 ià(
	`»®loc
(
lše_node_±r
->
lše_±r
,
Ãw_lše_Ëngth
)==
NULL
)

334 
	`´štf
("Cannot„eallocateƒnough space for‚ew†ine!\n");

335 
	`D–‘eHªdË
(
lše_hªdË
);

336  
OSI_ERROR
;

339 
Ãw_lše_¡r
=
lše_node_±r
->
lše_±r
;

340 
	`memıy
(
Ãw_lše_¡r
+
wib
,
Ãw_¡ršg
,
Ãw_¡ršg_Ën
);

341 
	`memıy
(
Ãw_lše_¡r
+
wib
+
Ãw_¡ršg_Ën
,
Şd_lše_¡r
+
w›
+1,
Şd_lše_Ën
-wie-1);

342 
Ãw_lše_¡r
[
Ãw_lše_Ëngth
]='\0';

344 
lše_node_±r
->
lše_Ën
=
Ãw_lše_Ëngth
;

346 
	`D–‘eHªdË
(
lše_hªdË
);

347  
OSI_OK
;

348 
	}
}

350 
	$š£¹_lše
(

351 
LIST_HANDLE
 
‹xt_hªdË
,

352 
STRING
 
keywÜd
,

353 
STRING
 
šs_lše
,

354 
šs_posi


357 
LIST_HANDLE
 
lše_hªdË
;

358 
LINE_NODE_PTR
 
lše_node_±r
;

359 
STRING
 
Ãw_lše
;

360 
»tv®
, 
šs_Ëngth
;

361 
MATCH_WORD_POSITION
 
¡r_posi
;

363 
lše_node_±r
=
lše_hªdË
=
Ãw_lše
=
NULL
;

365 ià(
	`IsHªdËEm±y
(
‹xt_hªdË
) ||

366 
keywÜd
==
NULL
 || 
šs_lše
==NULL)

368 
	`´štf
("Parametersƒrror!\n");

369  
OSI_ERROR
;

372 
lše_hªdË
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

374 ià(
lše_hªdË
==
NULL
)

376  
OSI_ERROR
;

378 
¡r_posi
.
lše_node_hªdË
=
lše_hªdË
;

379 ià(
	`fšd_keywÜd
(
‹xt_hªdË
,
keywÜd
,&
¡r_posi
,
READ_PERMISSION_TAG
)==
OSI_ERROR
)

381 
	`´štf
("Cannot find keyword!\n");

382  
OSI_ERROR
;

385 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`m®loc
((
LINE_NODE
)))==
NULL
)

387 
	`R–—£P”missiÚ
(
lše_hªdË
,
READ_PERMISSION_TAG
);

388 
	`´štf
("Memory†imited!\n");

389  
OSI_ERROR
;

392 
šs_Ëngth
=
	`¡¾’
(
šs_lše
);

394 ià((
Ãw_lše
=(
STRING
)
	`m®loc
(
šs_Ëngth
+2))==
NULL
)

396 
	`´štf
("Memory†imited!\n");

397 
E¼Ex™
;

400 
	`memıy
(
Ãw_lše
,
šs_lše
,
šs_Ëngth
);

402 
Ãw_lše
[
šs_Ëngth
]='\r';

403 
Ãw_lše
[
šs_Ëngth
+1]='\0';

405 
lše_node_±r
->
lše_±r
=
Ãw_lše
;

406 
lše_node_±r
->
lše_Ën
=
šs_Ëngth
+1;

408 
»tv®
=
	`In£¹NodeHªdË
(
‹xt_hªdË
,
lše_hªdË
,
šs_posi
,(
LINE_NODE
),(*)
lše_node_±r
);

410 ià(
»tv®
 =ğ
OSI_ERROR
)

412 
	`´štf
("Insert‚odeo†istƒrror!\n");

413 
E¼Ex™
;

416 
	`R–—£P”missiÚ
(
lše_hªdË
,
READ_PERMISSION_TAG
);

417  
OSI_OK
;

419 
E¼Ex™
:

421 ià(
lše_node_±r
 !ğ
NULL
)

423 
	`ä“
(
lše_node_±r
);

426 ià(
lše_node_±r
 !ğ
NULL
)

428 
	`ä“
(
lše_node_±r
);

430 
	`R–—£P”missiÚ
(
lše_hªdË
,
READ_PERMISSION_TAG
);

431  
OSI_ERROR
;

432 
	}
}

434 
	$‹xt_§ve
(
STRING
 
cÚfig_f’ame
, 
LIST_HANDLE
 
‹xt_hªdË
)

436 
FILE
* 
å
;

437 
LIST_HANDLE
 
hªdË1
, 
hªdË2
;

438 
amouÁ
, 
»tv®
;

439 
LINE_NODE_PTR
 
lše_node_±r
;

441 ià(
cÚfig_f’ame
 =ğ
NULL
)

443  
OSI_ERROR
;

446 
å
=
	`fİ’
(
cÚfig_f’ame
,"w");

448 ià(
å
==
NULL
)

450 
	`´štf
("Cannot open config file!\n");

451  
OSI_ERROR
;

454 
hªdË1
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

455 
hªdË2
=
	`C»©eHªdË
(
LIST_NODE_TYPE
);

457 
	`HªdËCpy
(
hªdË1
,
‹xt_hªdË
);

458 
amouÁ
=
	`CouÁ
(
‹xt_hªdË
);

460 
amouÁ
>0)

462 
»tv®
=
	`G‘NextNode
(
‹xt_hªdË
,
hªdË1
,
hªdË2
,0,
READ_PERMISSION_TAG
);

463 ià(
»tv®
 =ğ
OSI_ERROR
 ||„‘v® =ğ
LIST_PERMISSION_DENY
)

468 
	`R–—£P”missiÚ
(
hªdË1
,
READ_PERMISSION_TAG
);

470 ià((
lše_node_±r
=(
LINE_NODE_PTR
)
	`G‘D©a
(
hªdË2
))==
NULL
)

472 
	`´štf
("Empty†ine!\n");

473 
	`HªdËCpy
(
hªdË1
,
hªdË2
);

474 
amouÁ
--;

478 ià(
lše_node_±r
->
lše_±r
 !ğ
NULL
)

481 ià(
	`fwr™e
(
lše_node_±r
->
lše_±r
,lše_node_±r->
lše_Ën
,1,
å
)<0)

483 
	`´štf
("Writeextƒrror!\n");

487 ià(
	`fwr™e
("\n",1,1,
å
) < 0)

489 
	`´štf
("Writeextƒrror!\n");

495 
amouÁ
--;

496 
	`HªdËCpy
(
hªdË1
,
hªdË2
);

498 
	`R–—£P”missiÚ
(
hªdË1
,
READ_PERMISSION_TAG
);

500 
	`D–‘eHªdË
(
hªdË1
);

501 
	`D–‘eHªdË
(
hªdË2
);

503 
	`fşo£
(
å
);

505  
OSI_OK
;

506 
	}
}

508 
	$lše_kw_cmp_fun
(* 
node_d©a_±r
, * 
keywÜd
, * 
u£rd©a
)

510 
LINE_NODE_PTR
 
lše_node_±r
;

511 
STRING
 
keywÜd¡r
;

512 
šdex
, * 
šdex_±r
;

515 
lše_node_±r
=(
LINE_NODE_PTR
)
node_d©a_±r
;

516 
keywÜd¡r
=(
STRING
è
keywÜd
;

518 
šdex
=
	`fšd¡r
(
lše_node_±r
->
lše_±r
,
keywÜd¡r
);

520 ià(
šdex
 =ğ
OSI_ERROR
)

522  
OSI_ERROR
;

525 ià(
u£rd©a
)

527 
šdex_±r
=(*)
u£rd©a
;

528 *
šdex_±r
=
šdex
;

530  
OSI_OK
;

531 
	}
}

	@tool\tool.c

17 
	~<¡dio.h
>

18 
	~<¡dlib.h
>

19 
	~<¡ršg.h
>

21 #ifdeà
LINUX_OS


22 
	~<time.h
>

23 
	~<sys/time.h
>

24 
	~<as£¹.h
>

25 
	~<”ºo.h
>

26 
	~<uni¡d.h
>

27 
	~<fú.h
>

28 
	~<m®loc.h
>

29 
	~<ùy³.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/ioùl.h
>

32 
	~<asm/ty³s.h
>

33 
	~<asm/ioùl.h
>

34 
	~<sys/vfs.h
>

35 
	~<¡d¬g.h
>

37 
	~<Ãtdb.h
>

38 
	~<sys/sock‘.h
>

39 
	~<Ãtš‘/š.h
>

40 
	~<¬·/š‘.h
>

41 
	~<Ãt/rou‹.h
>

42 
	~<Ãt/if.h
>

43 
	~<»sŞv.h
>

44 
	~<lšux/sockios.h
>

49 
	~"toŞ.h
"

62 #ifdeà
WINDOWS_OS


64 
	$g‘lše
(** 
lš•Œ
, * 
n
, 
FILE
* 
å
)

66 
couÁ
;

67 
cur_off£t
;

68 
ci
;

69 * 
»adbuf
;

71 
cur_off£t
=
	`á–l
(
å
);

73 
couÁ
=0;

74 (
ci
=
	`fg‘c
(
å
)è!ğ'\n' && c˜!ğ
EOF
)

76 
couÁ
++;

79 ià(
couÁ
 == 0)

81  
OSI_ERROR
;

84 
couÁ
++;

85 ià(*
lš•Œ
 =ğ
NULL
 || *
n
 < 
couÁ
)

87 ià((*
lš•Œ
=(*)
	`»®loc
(*lš•Œ,
couÁ
))==
NULL
)

89  
OSI_ERROR
;

92 *
n
=
couÁ
;

94 
	`f£ek
(
å
,
cur_off£t
,
SEEK_SET
);

95 
»adbuf
=*
lš•Œ
;

96 
couÁ
=0;

97 (
ci
=
	`fg‘c
(
å
)è!ğ'\n' && c˜!ğ
EOF
)

99 
»adbuf
[
couÁ
++]=()
ci
;

102 
»adbuf
[
couÁ
]='\0';

104  
couÁ
;

105 
	}
}

118 
	$fšd¡r
(* 
Üigš®_¡r
, * 
m©ch_¡r
)

120 
šdex
=0;

122 ià(
Üigš®_¡r
==
NULL
 || 
m©ch_¡r
==NULL)

124  
OSI_ERROR
;

127 
Üigš®_¡r
[
šdex
]!='\0')

129 ià(
Üigš®_¡r
[
šdex
]==
m©ch_¡r
[0])

131 ià(
	`¡rcmp
(
Üigš®_¡r
+
šdex
, 
m©ch_¡r
)==0)

133  
šdex
;

136 
šdex
++;

139  
OSI_ERROR
;

140 
	}
}

144 
	$TCPLškToS”v”
(
ULONG
 
´eAddr
,
UINT16
 
pÜt
,
bufsize
)

146 #ifdeà
LINUX_OS


147 
s
;

148 
sockaddr_š
 
³”addr_š
;

149 
İ’
;

154 ià(
´eAddr
==0 || 
pÜt
==0)

156  
OSI_ERROR
;

159 ià((
s
=
	`sock‘
(
AF_INET
,
SOCK_STREAM
,0))==
OSI_ERROR
)

161 
	`´štf
("Create socket fail!\n");

162  
OSI_ERROR
;

165 ià(
bufsize
>0)

167 ià(
	`£tsockİt
 (
s
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
bufsize
,  (bufsize))==
OSI_ERROR
)

169 
	`´štf
("Set socket buffer sizeƒrror, usehe default buffer size!\n");

174 
³”addr_š
.
sš_çmy
 = 
AF_INET
;

175 
³”addr_š
.
sš_addr
.
s_addr
 = 
INADDR_ANY
;

176 
³”addr_š
.
sš_pÜt
 = 0;

177 ià(
	`bšd
 (
s
, (
sockaddr
*)&
³”addr_š
,  (peeraddr_in))< 0)

179 
	`´štf
("bindƒrror\n");

180 
	`şo£
 (
s
);

181  
OSI_ERROR
;

183 
³”addr_š
.
sš_addr
.
s_addr
 = 
´eAddr
;

184 
³”addr_š
.
sš_pÜt
 = 
	`htÚs
 (
pÜt
);

186 ià(
	`cÚÃù
 (
s
, (
sockaddr
 *)&
³”addr_š
, Õ“¿ddr_š)è=ğ
OSI_ERROR
)

188 
	`şo£
(
s
);

189  
OSI_ERROR
;

192  
s
;

195 #ifdeà
WINDOWS_OS


197  
OSI_OK
;

199 
	}
}

201 
	$©om»ad
(
fd
,* 
buf
, 
Ën
)

204 #ifdeà
LINUX_OS


205 
fd_£t
 
r£t
;

206 
timev®
 
£Ëù_timeout
;

207 
»mËn
,
¾’
,
»t
,
couÁ
=60;

209 
»mËn
=
Ën
;

210 
¾’
=0;

211 
»mËn
>0 && 
couÁ
--)

213 
	`FD_ZERO
(&
r£t
);

214 
	`FD_SET
(
fd
,&
r£t
);

215 
£Ëù_timeout
.
tv_£c
=1;

216 
£Ëù_timeout
.
tv_u£c
=0;

217 ià(
	`£Ëù
(
fd
+1,&
r£t
,
NULL
,NULL,&
£Ëù_timeout
)>0)

219 
»t
=
	`»ad
(
fd
,
buf
+
¾’
,
»mËn
);

220 ià(
»t
<=0)

222  
OSI_ERROR
;

224 
»mËn
-=
»t
;

225 
¾’
+=
»t
;

228 ià(
»mËn
==0)

230  
OSI_OK
;

232  
OSI_ERROR
;

236 #ifdeà
WINDOWS_OS


237  
OSI_OK
;

239 
	}
}

251 
	$©omwr™e
(
fd
, * 
buf
, 
Ën
)

254 #ifdeà
LINUX_OS


255 
fd_£t
 
w£t
;

256 
timev®
 
£Ëù_timeout
;

257 
»mËn
,
wËn
,
»t
,
couÁ
=60;

259 ià(
Ën
<0)

261  
OSI_ERROR
;

263 ià(
Ën
==0)

265  
OSI_OK
;

268 
»mËn
=
Ën
;

269 
wËn
=0;

270 
»mËn
>0 && 
couÁ
--)

272 
	`FD_ZERO
(&
w£t
);

273 
	`FD_SET
(
fd
,&
w£t
);

274 
£Ëù_timeout
.
tv_£c
=1;

275 
£Ëù_timeout
.
tv_u£c
=0;

276 ià(
	`£Ëù
(
fd
+1,
NULL
,&
w£t
,NULL,&
£Ëù_timeout
)>0)

278 
»t
=
	`wr™e
(
fd
,
buf
+
wËn
,
»mËn
);

279 ià(
»t
==
OSI_ERROR
)

281  
OSI_ERROR
;

283 
»mËn
-=
»t
;

284 
wËn
+=
»t
;

288 ià(
»mËn
==0)

290  
OSI_OK
;

293  
OSI_ERROR
;

296 #ifdeà
WINDOWS_OS


298  
OSI_OK
;

300 
	}
}

302 
	$low”
 (
c
)

304 ià(
c
 >= 'A' && c<= 'Z')

305  
c
+'a'-'A';

307  
c
;

308 
	}
}

310 
	$¡rcm¶ow
(cÚ¡ * 
s1
,cÚ¡ * 
s2
)

312 
i
,
j
,
c1
,
c2
,
cmp
;

314 
cmp
=0;

315 
i
=0;

316 
j
=0;

317 
s1
[
i
] || 
s2
[
j
])

319 
c1
=
	`low”
(
s1
[
i
]);

320 
c2
=
	`low”
(
s2
[
j
]);

321 ià((
cmp
=
c1
-
c2
)!=0)

323  
cmp
;

325 ià(
s1
[
i
])

326 
i
++;

327 ià(
s2
[
j
])

328 
j
++;

330  
cmp
;

331 
	}
}

334 
	$¡rm©ch
 (
n
,
STRING
 
¡¿¼ay
[], STRING 
cs
)

336 
n
--)

338 ià(
	`¡rcm¶ow
(
¡¿¼ay
[
n
],
cs
)==0)

340  
n
;

343  
OSI_ERROR
;

344 
	}
}

346 
	$bez”os
 (
n
,* 
p
)

348 * 
ı
;

350 
ı
=
p
;

351 
n
--)

353 
ı
[
n
]='\0';

355 
	}
}

357 * 
	$z”os
 (
n
)

359 * 
p
;

361 
p
=
	`m®loc
(
n
);

362 ià(
p
==
NULL
)

364  
p
;

366 
	`bez”os
(
n
,
p
);

367  
p
;

368 
	}
}

370 
	$¡rcm²
(cÚ¡ * 
s1
, cÚ¡ * 
s2
, 
n
)

372 
i
,
c1
,
c2
,
cmp
;

374 
cmp
=0;

375 
i
=0;

376 (
s1
[
i
] || 
s2
[i]è&& 
n
-->0)

378 
c1
=
s1
[
i
];

379 
c2
=
s2
[
i
];

380 ià((
cmp
=
c1
-
c2
)!=0)

382  
cmp
;

384 
i
++;

386  
cmp
;

387 
	}
}

389 
	$by‹_sum
(* 
buf
, 
Ën
)

391 
sum
;

393 ià(
buf
==
NULL
 || 
Ën
<0)

395  
OSI_ERROR
;

398 
sum
=0;

400 
Ën
--)

402 
sum
+=*
buf
++;

405  
sum
;

406 
	}
}

408 
	$fšdch¬
(
c
, * 
¡r
, 
ÿ£_£ns™ive
)

410 
šdex
=0;

412 ià(
¡r
==
NULL
)

414  
OSI_ERROR
;

417 
¡r
[
šdex
])

419 ià(
ÿ£_£ns™ive
==1)

421 ià(
c
==
¡r
[
šdex
])

423  
šdex
;

428 ià(
	`low”
(
c
)=öow”(
¡r
[
šdex
]))

430  
šdex
;

433 
šdex
++;

436  
OSI_ERROR
;

437 
	}
}

	@
1
.
0
576
21757
data_structure\list.c
include\actree.h
include\configPars.h
include\libtype.h
include\list.h
include\mgconfig.h
include\mgosi.h
include\osi\debug.h
include\osi\pthreadWrap.h
include\text.h
include\tool.h
osi\debug\debug.c
osi\debug\debug.h
osi\ioApiWrap\debug.h
osi\ioApiWrap\fileIoWrap.c
osi\ioApiWrap\ioApiWrap.h
osi\ioApiWrap\ioHeader.h
osi\ioApiWrap\stdIoWrap.c
osi\mgosi.c
osi\netApiWrap\dataType.h
osi\netApiWrap\debug.h
osi\netApiWrap\ioctl.c
osi\netApiWrap\mcastApiWrap.c
osi\netApiWrap\misc.h
osi\netApiWrap\netApiWrap.h
osi\netApiWrap\netHeader.h
osi\netApiWrap\netIO.c
osi\netApiWrap\netconfig.c
osi\netApiWrap\sock.c
osi\netApiWrap\sockopt.c
osi\netApiWrap\tcpApiWrap.c
osi\netApiWrap\udpApiWrap.c
osi\pthreadWrap\debug.h
osi\pthreadWrap\mqueue.c
osi\pthreadWrap\pthread.c
osi\pthreadWrap\pthreadAttr.c
osi\pthreadWrap\pthreadHead.h
osi\pthreadWrap\pthreadSched.c
osi\pthreadWrap\pthreadSync.c
osi\pthreadWrap\pthreadSyncAttr.c
osi\pthreadWrap\pthreadWrap.h
osi\timeApiWrap\debug.h
osi\timeApiWrap\timeApiWrap.c
osi\timeApiWrap\timeApiWrap.h
osi\timeApiWrap\timeHeader.h
osi\unpv13e\unpv13e\advio\daytimetcpcli.c
osi\unpv13e\unpv13e\advio\daytimeudpcli3.c
osi\unpv13e\unpv13e\advio\daytimeudpcli4.c
osi\unpv13e\unpv13e\advio\dgclitimeo.c
osi\unpv13e\unpv13e\advio\dgclitimeo1.c
osi\unpv13e\unpv13e\advio\dgclitimeo2.c
osi\unpv13e\unpv13e\advio\dgclitimeo3.c
osi\unpv13e\unpv13e\advio\dgechoaddr.c
osi\unpv13e\unpv13e\advio\old\dgechoaddr.c
osi\unpv13e\unpv13e\advio\old\recvfromflags.c
osi\unpv13e\unpv13e\advio\old\test01.c
osi\unpv13e\unpv13e\advio\recvfromflags.c
osi\unpv13e\unpv13e\advio\sig_chld_waitpid.c
osi\unpv13e\unpv13e\advio\str_cli_kqueue04.c
osi\unpv13e\unpv13e\advio\str_cli_poll03.c
osi\unpv13e\unpv13e\advio\str_cli_select02.c
osi\unpv13e\unpv13e\advio\str_echo_stdio02.c
osi\unpv13e\unpv13e\advio\tcpcli01.c
osi\unpv13e\unpv13e\advio\tcpcli02.c
osi\unpv13e\unpv13e\advio\tcpcli03.c
osi\unpv13e\unpv13e\advio\tcpcli04.c
osi\unpv13e\unpv13e\advio\tcpserv02.c
osi\unpv13e\unpv13e\advio\udpcli01.c
osi\unpv13e\unpv13e\advio\udpcli02.c
osi\unpv13e\unpv13e\advio\udpcli03.c
osi\unpv13e\unpv13e\advio\udpserv01.c
osi\unpv13e\unpv13e\advio\udpserv03.c
osi\unpv13e\unpv13e\advio\udpserv04.c
osi\unpv13e\unpv13e\bcast\dgclibcast1.c
osi\unpv13e\unpv13e\bcast\dgclibcast2.c
osi\unpv13e\unpv13e\bcast\dgclibcast3.c
osi\unpv13e\unpv13e\bcast\dgclibcast4.c
osi\unpv13e\unpv13e\bcast\dgclibcast5.c
osi\unpv13e\unpv13e\bcast\dgclibcast6.c
osi\unpv13e\unpv13e\bcast\udpcli01.c
osi\unpv13e\unpv13e\bcast\udpcli02.c
osi\unpv13e\unpv13e\bcast\udpcli03.c
osi\unpv13e\unpv13e\bcast\udpcli04.c
osi\unpv13e\unpv13e\bcast\udpcli05.c
osi\unpv13e\unpv13e\bcast\udpcli06.c
osi\unpv13e\unpv13e\debug\backlog.c
osi\unpv13e\unpv13e\debug\qlen.c
osi\unpv13e\unpv13e\debug\test01.c
osi\unpv13e\unpv13e\debug\test02.c
osi\unpv13e\unpv13e\debug\test03.c
osi\unpv13e\unpv13e\debug\test04.c
osi\unpv13e\unpv13e\debug\test05.c
osi\unpv13e\unpv13e\debug\test06.c
osi\unpv13e\unpv13e\debug\unpxti.h
osi\unpv13e\unpv13e\icmpd\dgcli01.c
osi\unpv13e\unpv13e\icmpd\icmpd.c
osi\unpv13e\unpv13e\icmpd\icmpd.h
osi\unpv13e\unpv13e\icmpd\readable_conn.c
osi\unpv13e\unpv13e\icmpd\readable_listen.c
osi\unpv13e\unpv13e\icmpd\readable_v4.c
osi\unpv13e\unpv13e\icmpd\readable_v6.c
osi\unpv13e\unpv13e\icmpd\udpcli01.c
osi\unpv13e\unpv13e\icmpd\unpicmpd.h
osi\unpv13e\unpv13e\inetd\daytimetcpsrv2.c
osi\unpv13e\unpv13e\inetd\daytimetcpsrv3.c
osi\unpv13e\unpv13e\intro\byteorder.c
osi\unpv13e\unpv13e\intro\daytimetcpcli.c
osi\unpv13e\unpv13e\intro\daytimetcpcli1.c
osi\unpv13e\unpv13e\intro\daytimetcpcli2.c
osi\unpv13e\unpv13e\intro\daytimetcpcli3.c
osi\unpv13e\unpv13e\intro\daytimetcpcliv6.c
osi\unpv13e\unpv13e\intro\daytimetcpsrv.c
osi\unpv13e\unpv13e\intro\daytimetcpsrv1.c
osi\unpv13e\unpv13e\intro\daytimetcpsrv2.c
osi\unpv13e\unpv13e\intro\daytimetcpsrv3.c
osi\unpv13e\unpv13e\intro\daytimetcpsrvv6.c
osi\unpv13e\unpv13e\ioctl\lsif01.c
osi\unpv13e\unpv13e\ioctl\lsif02.c
osi\unpv13e\unpv13e\ioctl\prifinfo.c
osi\unpv13e\unpv13e\ioctl\prmac.c
osi\unpv13e\unpv13e\ioctl\test1.c
osi\unpv13e\unpv13e\ipopts\dgechoprintroute.c
osi\unpv13e\unpv13e\ipopts\sigchldwaitpid.c
osi\unpv13e\unpv13e\ipopts\sourceroute.c
osi\unpv13e\unpv13e\ipopts\sourceroute6.c
osi\unpv13e\unpv13e\ipopts\tcpcli01.c
osi\unpv13e\unpv13e\ipopts\tcpserv01.c
osi\unpv13e\unpv13e\ipopts\udpcli01.c
osi\unpv13e\unpv13e\ipopts\udpserv01.c
osi\unpv13e\unpv13e\key\add.c
osi\unpv13e\unpv13e\key\dump.c
osi\unpv13e\unpv13e\key\name.c
osi\unpv13e\unpv13e\key\printsadbmsg.c
osi\unpv13e\unpv13e\key\register.c
osi\unpv13e\unpv13e\key\unp.h
osi\unpv13e\unpv13e\lib\addrinfo.h
osi\unpv13e\unpv13e\lib\connect_nonb.c
osi\unpv13e\unpv13e\lib\connect_timeo.c
osi\unpv13e\unpv13e\lib\daemon_inetd.c
osi\unpv13e\unpv13e\lib\daemon_init.c
osi\unpv13e\unpv13e\lib\dg_cli.c
osi\unpv13e\unpv13e\lib\dg_echo.c
osi\unpv13e\unpv13e\lib\error.c
osi\unpv13e\unpv13e\lib\family_to_level.c
osi\unpv13e\unpv13e\lib\get_ifi_info.c
osi\unpv13e\unpv13e\lib\gf_time.c
osi\unpv13e\unpv13e\lib\host_serv.c
osi\unpv13e\unpv13e\lib\hstrerror.c
osi\unpv13e\unpv13e\lib\if_indextoname.c
osi\unpv13e\unpv13e\lib\if_nameindex.c
osi\unpv13e\unpv13e\lib\if_nametoindex.c
osi\unpv13e\unpv13e\lib\in6addr_any.c
osi\unpv13e\unpv13e\lib\mcast_get_if.c
osi\unpv13e\unpv13e\lib\mcast_get_loop.c
osi\unpv13e\unpv13e\lib\mcast_get_ttl.c
osi\unpv13e\unpv13e\lib\mcast_join.c
osi\unpv13e\unpv13e\lib\mcast_leave.c
osi\unpv13e\unpv13e\lib\mcast_set_if.c
osi\unpv13e\unpv13e\lib\mcast_set_loop.c
osi\unpv13e\unpv13e\lib\mcast_set_ttl.c
osi\unpv13e\unpv13e\lib\my_addrs.c
osi\unpv13e\unpv13e\lib\pselect.c
osi\unpv13e\unpv13e\lib\read_fd.c
osi\unpv13e\unpv13e\lib\readable_timeo.c
osi\unpv13e\unpv13e\lib\readline.c
osi\unpv13e\unpv13e\lib\readn.c
osi\unpv13e\unpv13e\lib\rtt.c
osi\unpv13e\unpv13e\lib\signal.c
osi\unpv13e\unpv13e\lib\signal_intr.c
osi\unpv13e\unpv13e\lib\snprintf.c
osi\unpv13e\unpv13e\lib\sock_bind_wild.c
osi\unpv13e\unpv13e\lib\sock_cmp_addr.c
osi\unpv13e\unpv13e\lib\sock_cmp_port.c
osi\unpv13e\unpv13e\lib\sock_get_port.c
osi\unpv13e\unpv13e\lib\sock_ntop.c
osi\unpv13e\unpv13e\lib\sock_ntop_host.c
osi\unpv13e\unpv13e\lib\sock_set_addr.c
osi\unpv13e\unpv13e\lib\sock_set_port.c
osi\unpv13e\unpv13e\lib\sock_set_wild.c
osi\unpv13e\unpv13e\lib\sockatmark.c
osi\unpv13e\unpv13e\lib\sockfd_to_family.c
osi\unpv13e\unpv13e\lib\str_cli.c
osi\unpv13e\unpv13e\lib\str_echo.c
osi\unpv13e\unpv13e\lib\tcp_connect.c
osi\unpv13e\unpv13e\lib\tcp_listen.c
osi\unpv13e\unpv13e\lib\tv_sub.c
osi\unpv13e\unpv13e\lib\udp_client.c
osi\unpv13e\unpv13e\lib\udp_connect.c
osi\unpv13e\unpv13e\lib\udp_server.c
osi\unpv13e\unpv13e\lib\unp.h
osi\unpv13e\unpv13e\lib\unpifi.h
osi\unpv13e\unpv13e\lib\unprtt.h
osi\unpv13e\unpv13e\lib\unpthread.h
osi\unpv13e\unpv13e\lib\wraplib.c
osi\unpv13e\unpv13e\lib\wrappthread.c
osi\unpv13e\unpv13e\lib\wrapsock.c
osi\unpv13e\unpv13e\lib\wrapstdio.c
osi\unpv13e\unpv13e\lib\wrapunix.c
osi\unpv13e\unpv13e\lib\writable_timeo.c
osi\unpv13e\unpv13e\lib\write_fd.c
osi\unpv13e\unpv13e\lib\writen.c
osi\unpv13e\unpv13e\libfree\addrinfo.h
osi\unpv13e\unpv13e\libfree\getaddrinfo.c
osi\unpv13e\unpv13e\libfree\getnameinfo.c
osi\unpv13e\unpv13e\libfree\in_cksum.c
osi\unpv13e\unpv13e\libfree\inet_aton.c
osi\unpv13e\unpv13e\libfree\inet_ntop.c
osi\unpv13e\unpv13e\libfree\inet_ntop_ipv4.c
osi\unpv13e\unpv13e\libfree\inet_pton.c
osi\unpv13e\unpv13e\libfree\inet_pton_ipv4.c
osi\unpv13e\unpv13e\libfree\test_ascii2addr.c
osi\unpv13e\unpv13e\libfree\test_getservbyname_r.c
osi\unpv13e\unpv13e\libfree\test_inet_pton.c
osi\unpv13e\unpv13e\libgai\addrinfo.h
osi\unpv13e\unpv13e\libgai\freeaddrinfo.c
osi\unpv13e\unpv13e\libgai\ga_aistruct.c
osi\unpv13e\unpv13e\libgai\ga_clone.c
osi\unpv13e\unpv13e\libgai\ga_echeck.c
osi\unpv13e\unpv13e\libgai\ga_nsearch.c
osi\unpv13e\unpv13e\libgai\ga_port.c
osi\unpv13e\unpv13e\libgai\ga_serv.c
osi\unpv13e\unpv13e\libgai\ga_unix.c
osi\unpv13e\unpv13e\libgai\gai_hdr.h
osi\unpv13e\unpv13e\libgai\gai_strerror.c
osi\unpv13e\unpv13e\libgai\getaddrinfo.c
osi\unpv13e\unpv13e\libgai\getnameinfo.c
osi\unpv13e\unpv13e\libgai\gn_ipv46.c
osi\unpv13e\unpv13e\libgai\old\ga_unixstruct.c
osi\unpv13e\unpv13e\libgai\old\savecopy.c
osi\unpv13e\unpv13e\libgai\test1.c
osi\unpv13e\unpv13e\libgai\testga.c
osi\unpv13e\unpv13e\libroute\get_rtaddrs.c
osi\unpv13e\unpv13e\libroute\if_indextoname.c
osi\unpv13e\unpv13e\libroute\if_nameindex.c
osi\unpv13e\unpv13e\libroute\if_nametoindex.c
osi\unpv13e\unpv13e\libroute\net_rt_dump.c
osi\unpv13e\unpv13e\libroute\net_rt_iflist.c
osi\unpv13e\unpv13e\libroute\sock_masktop.c
osi\unpv13e\unpv13e\libroute\unproute.h
osi\unpv13e\unpv13e\mcast\dgclibcast1.c
osi\unpv13e\unpv13e\mcast\dgclimcast5.c
osi\unpv13e\unpv13e\mcast\dgclimcast6.c
osi\unpv13e\unpv13e\mcast\main.c
osi\unpv13e\unpv13e\mcast\recv.c
osi\unpv13e\unpv13e\mcast\send.c
osi\unpv13e\unpv13e\mcast\udpcli01.c
osi\unpv13e\unpv13e\mcast\udpcli05.c
osi\unpv13e\unpv13e\mcast\udpcli06.c
osi\unpv13e\unpv13e\mcast\udpserv01.c
osi\unpv13e\unpv13e\mysdr\loop.c
osi\unpv13e\unpv13e\mysdr\main.c
osi\unpv13e\unpv13e\mysdr\mysdr.h
osi\unpv13e\unpv13e\names\daytimetcpcli.c
osi\unpv13e\unpv13e\names\daytimetcpcli1.c
osi\unpv13e\unpv13e\names\daytimetcpcli2.c
osi\unpv13e\unpv13e\names\daytimetcpcli3.c
osi\unpv13e\unpv13e\names\daytimetcpsrv1.c
osi\unpv13e\unpv13e\names\daytimetcpsrv2.c
osi\unpv13e\unpv13e\names\daytimetcpsrv3.c
osi\unpv13e\unpv13e\names\daytimetcpsrv4.c
osi\unpv13e\unpv13e\names\daytimeudpcli1.c
osi\unpv13e\unpv13e\names\daytimeudpcli2.c
osi\unpv13e\unpv13e\names\daytimeudpsrv2.c
osi\unpv13e\unpv13e\names\daytimeudpsrv3.c
osi\unpv13e\unpv13e\names\hostent.c
osi\unpv13e\unpv13e\names\hostent2.c
osi\unpv13e\unpv13e\names\hostent3.c
osi\unpv13e\unpv13e\names\myaddrs1.c
osi\unpv13e\unpv13e\names\netent.c
osi\unpv13e\unpv13e\names\prmyaddrs.c
osi\unpv13e\unpv13e\names\prmyaddrs1.c
osi\unpv13e\unpv13e\names\test1.c
osi\unpv13e\unpv13e\names\test2.c
osi\unpv13e\unpv13e\names\udp_server_reuseaddr.c
osi\unpv13e\unpv13e\nonblock\daytimetcpcli.c
osi\unpv13e\unpv13e\nonblock\home_page.c
osi\unpv13e\unpv13e\nonblock\start_connect.c
osi\unpv13e\unpv13e\nonblock\strclifork.c
osi\unpv13e\unpv13e\nonblock\strclinonb.c
osi\unpv13e\unpv13e\nonblock\tcpcli01.c
osi\unpv13e\unpv13e\nonblock\tcpcli02.c
osi\unpv13e\unpv13e\nonblock\tcpcli03.c
osi\unpv13e\unpv13e\nonblock\tcpcli04.c
osi\unpv13e\unpv13e\nonblock\tcpservselect03.c
osi\unpv13e\unpv13e\nonblock\web.c
osi\unpv13e\unpv13e\nonblock\web.h
osi\unpv13e\unpv13e\nonblock\write_get_cmd.c
osi\unpv13e\unpv13e\oob\heartbeatcli.c
osi\unpv13e\unpv13e\oob\heartbeatserv.c
osi\unpv13e\unpv13e\oob\sigchldwaitpid.c
osi\unpv13e\unpv13e\oob\strcliselect02.c
osi\unpv13e\unpv13e\oob\strecho02.c
osi\unpv13e\unpv13e\oob\tcpcli02.c
osi\unpv13e\unpv13e\oob\tcprecv01.c
osi\unpv13e\unpv13e\oob\tcprecv02.c
osi\unpv13e\unpv13e\oob\tcprecv03.c
osi\unpv13e\unpv13e\oob\tcprecv03p.c
osi\unpv13e\unpv13e\oob\tcprecv04.c
osi\unpv13e\unpv13e\oob\tcprecv05.c
osi\unpv13e\unpv13e\oob\tcprecv06.c
osi\unpv13e\unpv13e\oob\tcpsend01.c
osi\unpv13e\unpv13e\oob\tcpsend02.c
osi\unpv13e\unpv13e\oob\tcpsend03.c
osi\unpv13e\unpv13e\oob\tcpsend04.c
osi\unpv13e\unpv13e\oob\tcpsend05.c
osi\unpv13e\unpv13e\oob\tcpsend06.c
osi\unpv13e\unpv13e\oob\tcpserv02.c
osi\unpv13e\unpv13e\ping\bsdping.c
osi\unpv13e\unpv13e\ping\init_v6.c
osi\unpv13e\unpv13e\ping\main.c
osi\unpv13e\unpv13e\ping\old\icmp6.h
osi\unpv13e\unpv13e\ping\old\ip6.h
osi\unpv13e\unpv13e\ping\ping.h
osi\unpv13e\unpv13e\ping\ping_v4.c
osi\unpv13e\unpv13e\ping\proc_v4.c
osi\unpv13e\unpv13e\ping\proc_v6.c
osi\unpv13e\unpv13e\ping\readloop.c
osi\unpv13e\unpv13e\ping\send_v4.c
osi\unpv13e\unpv13e\ping\send_v6.c
osi\unpv13e\unpv13e\ping\sig_alrm.c
osi\unpv13e\unpv13e\ping\tv_sub.c
osi\unpv13e\unpv13e\route\checkudpsum.c
osi\unpv13e\unpv13e\route\get_ifi_info.c
osi\unpv13e\unpv13e\route\getrt.c
osi\unpv13e\unpv13e\route\mynetstat.c
osi\unpv13e\unpv13e\route\prifindex.c
osi\unpv13e\unpv13e\route\prifinfo.c
osi\unpv13e\unpv13e\route\prifname.c
osi\unpv13e\unpv13e\route\prifnameindex.c
osi\unpv13e\unpv13e\route\unproute.h
osi\unpv13e\unpv13e\rtt\dg_cli.c
osi\unpv13e\unpv13e\rtt\dg_echo.c
osi\unpv13e\unpv13e\rtt\dg_send_recv.c
osi\unpv13e\unpv13e\rtt\udpcli01.c
osi\unpv13e\unpv13e\rtt\unprtt.h
osi\unpv13e\unpv13e\sctp\sctp_addr_to_associd.c
osi\unpv13e\unpv13e\sctp\sctp_bindargs.c
osi\unpv13e\unpv13e\sctp\sctp_check_notify.c
osi\unpv13e\unpv13e\sctp\sctp_displayevents.c
osi\unpv13e\unpv13e\sctp\sctp_getnostrm.c
osi\unpv13e\unpv13e\sctp\sctp_modify_hb.c
osi\unpv13e\unpv13e\sctp\sctp_pdapircv.c
osi\unpv13e\unpv13e\sctp\sctp_print_addrs.c
osi\unpv13e\unpv13e\sctp\sctp_strcli.c
osi\unpv13e\unpv13e\sctp\sctp_strcli1.c
osi\unpv13e\unpv13e\sctp\sctp_strcli_un.c
osi\unpv13e\unpv13e\sctp\sctp_strcliecho.c
osi\unpv13e\unpv13e\sctp\sctp_strcliecho2.c
osi\unpv13e\unpv13e\sctp\sctp_wrapper.c
osi\unpv13e\unpv13e\sctp\sctpclient01.c
osi\unpv13e\unpv13e\sctp\sctpclient02.c
osi\unpv13e\unpv13e\sctp\sctpclient04.c
osi\unpv13e\unpv13e\sctp\sctpserv01.c
osi\unpv13e\unpv13e\sctp\sctpserv02.c
osi\unpv13e\unpv13e\sctp\sctpserv03.c
osi\unpv13e\unpv13e\sctp\sctpserv04.c
osi\unpv13e\unpv13e\sctp\sctpserv05.c
osi\unpv13e\unpv13e\sctp\sctpserv06.c
osi\unpv13e\unpv13e\sctp\sctpserv07.c
osi\unpv13e\unpv13e\sctp\sctpserv_fork.c
osi\unpv13e\unpv13e\sctp\unp.h
osi\unpv13e\unpv13e\select\strcliselect01.c
osi\unpv13e\unpv13e\select\strcliselect02.c
osi\unpv13e\unpv13e\select\tcpcli01.c
osi\unpv13e\unpv13e\select\tcpcli02.c
osi\unpv13e\unpv13e\select\tcpcli03.c
osi\unpv13e\unpv13e\server\child.h
osi\unpv13e\unpv13e\server\child02.c
osi\unpv13e\unpv13e\server\child02l.c
osi\unpv13e\unpv13e\server\child02m.c
osi\unpv13e\unpv13e\server\child03.c
osi\unpv13e\unpv13e\server\child03m.c
osi\unpv13e\unpv13e\server\child04.c
osi\unpv13e\unpv13e\server\child05.c
osi\unpv13e\unpv13e\server\client.c
osi\unpv13e\unpv13e\server\clientrst.c
osi\unpv13e\unpv13e\server\lock_fcntl.c
osi\unpv13e\unpv13e\server\lock_pthread.c
osi\unpv13e\unpv13e\server\meter.c
osi\unpv13e\unpv13e\server\pr_cpu_time.c
osi\unpv13e\unpv13e\server\pthread07.c
osi\unpv13e\unpv13e\server\pthread07.h
osi\unpv13e\unpv13e\server\pthread08.c
osi\unpv13e\unpv13e\server\pthread08.h
osi\unpv13e\unpv13e\server\pthread09.c
osi\unpv13e\unpv13e\server\pthread09.h
osi\unpv13e\unpv13e\server\readline.c
osi\unpv13e\unpv13e\server\readline_r.c
osi\unpv13e\unpv13e\server\readline_r.h
osi\unpv13e\unpv13e\server\serv00.c
osi\unpv13e\unpv13e\server\serv01.c
osi\unpv13e\unpv13e\server\serv02.c
osi\unpv13e\unpv13e\server\serv02m.c
osi\unpv13e\unpv13e\server\serv03.c
osi\unpv13e\unpv13e\server\serv03m.c
osi\unpv13e\unpv13e\server\serv04.c
osi\unpv13e\unpv13e\server\serv05.c
osi\unpv13e\unpv13e\server\serv06.c
osi\unpv13e\unpv13e\server\serv07.c
osi\unpv13e\unpv13e\server\serv08.c
osi\unpv13e\unpv13e\server\serv09.c
osi\unpv13e\unpv13e\server\sig_chld_waitpid.c
osi\unpv13e\unpv13e\server\unpthread.h
osi\unpv13e\unpv13e\server\web_child.c
osi\unpv13e\unpv13e\server\web_child_r.c
osi\unpv13e\unpv13e\sigio\dgcli01.c
osi\unpv13e\unpv13e\sigio\dgecho01.c
osi\unpv13e\unpv13e\sigio\udpcli01.c
osi\unpv13e\unpv13e\sigio\udpserv01.c
osi\unpv13e\unpv13e\sock\buffers.c
osi\unpv13e\unpv13e\sock\cliopen.c
osi\unpv13e\unpv13e\sock\crlf.c
osi\unpv13e\unpv13e\sock\error.c
osi\unpv13e\unpv13e\sock\loop.c
osi\unpv13e\unpv13e\sock\looptcp.c
osi\unpv13e\unpv13e\sock\loopudp.c
osi\unpv13e\unpv13e\sock\main.c
osi\unpv13e\unpv13e\sock\multicast.c
osi\unpv13e\unpv13e\sock\ourhdr.h
osi\unpv13e\unpv13e\sock\pattern.c
osi\unpv13e\unpv13e\sock\servopen.c
osi\unpv13e\unpv13e\sock\sinktcp.c
osi\unpv13e\unpv13e\sock\sinkudp.c
osi\unpv13e\unpv13e\sock\sleepus.c
osi\unpv13e\unpv13e\sock\sock.h
osi\unpv13e\unpv13e\sock\sockopts.c
osi\unpv13e\unpv13e\sock\sourceroute.c
osi\unpv13e\unpv13e\sock\sourcesink.c
osi\unpv13e\unpv13e\sock\sourcetcp.c
osi\unpv13e\unpv13e\sock\sourceudp.c
osi\unpv13e\unpv13e\sock\strerror.c
osi\unpv13e\unpv13e\sock\tellwait.c
osi\unpv13e\unpv13e\sock\write.c
osi\unpv13e\unpv13e\sock\writen.c
osi\unpv13e\unpv13e\sockopt\checkopts.c
osi\unpv13e\unpv13e\sockopt\prdefaults.c
osi\unpv13e\unpv13e\sockopt\rcvbuf.c
osi\unpv13e\unpv13e\sockopt\rcvbufset.c
osi\unpv13e\unpv13e\sockopt\sockopt.c
osi\unpv13e\unpv13e\sparc64-unknown-freebsd5.1\config.h
osi\unpv13e\unpv13e\ssntp\main.c
osi\unpv13e\unpv13e\ssntp\ntp.h
osi\unpv13e\unpv13e\ssntp\sntp.h
osi\unpv13e\unpv13e\ssntp\sntp_proc.c
osi\unpv13e\unpv13e\streams\stream_dg\client.c
osi\unpv13e\unpv13e\streams\stream_dg\net_stream.c
osi\unpv13e\unpv13e\streams\stream_dg\server.c
osi\unpv13e\unpv13e\streams\strlist_sock.c
osi\unpv13e\unpv13e\streams\strlist_xti.c
osi\unpv13e\unpv13e\streams\tpi_bind.c
osi\unpv13e\unpv13e\streams\tpi_close.c
osi\unpv13e\unpv13e\streams\tpi_connect.c
osi\unpv13e\unpv13e\streams\tpi_daytime.c
osi\unpv13e\unpv13e\streams\tpi_daytime.h
osi\unpv13e\unpv13e\streams\tpi_read.c
osi\unpv13e\unpv13e\streams\unpxti.h
osi\unpv13e\unpv13e\tcpcliserv\sigchldwait.c
osi\unpv13e\unpv13e\tcpcliserv\sigchldwaitpid.c
osi\unpv13e\unpv13e\tcpcliserv\str_cli08.c
osi\unpv13e\unpv13e\tcpcliserv\str_cli09.c
osi\unpv13e\unpv13e\tcpcliserv\str_cli11.c
osi\unpv13e\unpv13e\tcpcliserv\str_echo08.c
osi\unpv13e\unpv13e\tcpcliserv\str_echo09.c
osi\unpv13e\unpv13e\tcpcliserv\sum.h
osi\unpv13e\unpv13e\tcpcliserv\tcpcli01.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli04.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli05.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli06.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli07.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli08.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli09.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli10.c
osi\unpv13e\unpv13e\tcpcliserv\tcpcli11.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv01.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv02.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv03.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv04.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv08.c
osi\unpv13e\unpv13e\tcpcliserv\tcpserv09.c
osi\unpv13e\unpv13e\tcpcliserv\tcpservpoll01.c
osi\unpv13e\unpv13e\tcpcliserv\tcpservselect01.c
osi\unpv13e\unpv13e\tcpcliserv\tsigpipe.c
osi\unpv13e\unpv13e\test\accept_eintr.c
osi\unpv13e\unpv13e\test\funcs.c
osi\unpv13e\unpv13e\test\readline.h
osi\unpv13e\unpv13e\test\readline1.c
osi\unpv13e\unpv13e\test\readline2.c
osi\unpv13e\unpv13e\test\readline3.c
osi\unpv13e\unpv13e\test\test.h
osi\unpv13e\unpv13e\test\test1.c
osi\unpv13e\unpv13e\test\test2.c
osi\unpv13e\unpv13e\test\tisfdtype.c
osi\unpv13e\unpv13e\test\treadline1.c
osi\unpv13e\unpv13e\test\treadline2.c
osi\unpv13e\unpv13e\test\treadline3.c
osi\unpv13e\unpv13e\test\tshutdown.c
osi\unpv13e\unpv13e\test\tsnprintf.c
osi\unpv13e\unpv13e\threads\example01.c
osi\unpv13e\unpv13e\threads\example02.c
osi\unpv13e\unpv13e\threads\example03.c
osi\unpv13e\unpv13e\threads\readline.c
osi\unpv13e\unpv13e\threads\strclithread.c
osi\unpv13e\unpv13e\threads\strclithread2.c
osi\unpv13e\unpv13e\threads\tcpcli01.c
osi\unpv13e\unpv13e\threads\tcpcli02.c
osi\unpv13e\unpv13e\threads\tcpserv01.c
osi\unpv13e\unpv13e\threads\tcpserv02.c
osi\unpv13e\unpv13e\threads\test01.c
osi\unpv13e\unpv13e\threads\test02.c
osi\unpv13e\unpv13e\threads\test03.c
osi\unpv13e\unpv13e\threads\test04.c
osi\unpv13e\unpv13e\threads\test05.c
osi\unpv13e\unpv13e\threads\unpthread.h
osi\unpv13e\unpv13e\threads\web01.c
osi\unpv13e\unpv13e\threads\web02.c
osi\unpv13e\unpv13e\threads\web03.c
osi\unpv13e\unpv13e\traceroute\icmpcode_v4.c
osi\unpv13e\unpv13e\traceroute\icmpcode_v6.c
osi\unpv13e\unpv13e\traceroute\main.c
osi\unpv13e\unpv13e\traceroute\recv_v4.c
osi\unpv13e\unpv13e\traceroute\recv_v6.c
osi\unpv13e\unpv13e\traceroute\sig_alrm.c
osi\unpv13e\unpv13e\traceroute\trace.h
osi\unpv13e\unpv13e\traceroute\traceloop.c
osi\unpv13e\unpv13e\traceroute\tv_sub.c
osi\unpv13e\unpv13e\udpcksum\cleanup.c
osi\unpv13e\unpv13e\udpcksum\main.c
osi\unpv13e\unpv13e\udpcksum\pcap.c
osi\unpv13e\unpv13e\udpcksum\senddnsquery-libnet.c
osi\unpv13e\unpv13e\udpcksum\senddnsquery-raw.c
osi\unpv13e\unpv13e\udpcksum\udpcksum.c
osi\unpv13e\unpv13e\udpcksum\udpcksum.h
osi\unpv13e\unpv13e\udpcksum\udpread.c
osi\unpv13e\unpv13e\udpcksum\udpwrite.c
osi\unpv13e\unpv13e\udpcliserv\dgcliaddr.c
osi\unpv13e\unpv13e\udpcliserv\dgclibig.c
osi\unpv13e\unpv13e\udpcliserv\dgcliconnect.c
osi\unpv13e\unpv13e\udpcliserv\dgcliinetaddr.c
osi\unpv13e\unpv13e\udpcliserv\dgcliloop1.c
osi\unpv13e\unpv13e\udpcliserv\dgcliloop3.c
osi\unpv13e\unpv13e\udpcliserv\dgecholoop1.c
osi\unpv13e\unpv13e\udpcliserv\dgecholoop2.c
osi\unpv13e\unpv13e\udpcliserv\sigchldwaitpid.c
osi\unpv13e\unpv13e\udpcliserv\udpcli01.c
osi\unpv13e\unpv13e\udpcliserv\udpcli02.c
osi\unpv13e\unpv13e\udpcliserv\udpcli03.c
osi\unpv13e\unpv13e\udpcliserv\udpcli04.c
osi\unpv13e\unpv13e\udpcliserv\udpcli05.c
osi\unpv13e\unpv13e\udpcliserv\udpcli06.c
osi\unpv13e\unpv13e\udpcliserv\udpcli08.c
osi\unpv13e\unpv13e\udpcliserv\udpcli09.c
osi\unpv13e\unpv13e\udpcliserv\udpcli10.c
osi\unpv13e\unpv13e\udpcliserv\udpserv01.c
osi\unpv13e\unpv13e\udpcliserv\udpserv06.c
osi\unpv13e\unpv13e\udpcliserv\udpserv07.c
osi\unpv13e\unpv13e\udpcliserv\udpservselect01.c
osi\unpv13e\unpv13e\unixdomain\daytimetcpcli.c
osi\unpv13e\unpv13e\unixdomain\daytimetcpsrv2.c
osi\unpv13e\unpv13e\unixdomain\mycat.c
osi\unpv13e\unpv13e\unixdomain\myopen.c
osi\unpv13e\unpv13e\unixdomain\openfile.c
osi\unpv13e\unpv13e\unixdomain\readcred.c
osi\unpv13e\unpv13e\unixdomain\sigchldwaitpid.c
osi\unpv13e\unpv13e\unixdomain\strecho.c
osi\unpv13e\unpv13e\unixdomain\testfcred.c
osi\unpv13e\unpv13e\unixdomain\tfcred01.c
osi\unpv13e\unpv13e\unixdomain\unixbind.c
osi\unpv13e\unpv13e\unixdomain\unixdgcli01.c
osi\unpv13e\unpv13e\unixdomain\unixdgserv01.c
osi\unpv13e\unpv13e\unixdomain\unixstrcli01.c
osi\unpv13e\unpv13e\unixdomain\unixstrserv01.c
osi\unpv13e\unpv13e\unixdomain\unixstrserv02.c
test.c
tool\configPars.c
tool\text.c
tool\tool.c
